---
title: "Wealth"
output: 
  html_document:
    theme: united
    highlight: tango
    toc: true
    toc_depth: 6
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: true
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->



```{r setup, include=FALSE,  echo=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_laia.r")
```

<!-- ########################################################## --> 

# Description of DataSchema variable 

* Short name: `wealth`
* Variable label: `Total score based in all sources of income transformed into a comparable and normalized categoric variable.`
* Domain: `Socio-demographic and economic characteristics`
* Value type: `categorical ordinal`
* Category coding:

**Code** | **Category Label**
-------- | ------------------
1        | 1st quintile
2        | 2nd quintile
3        | 3rd quintile
4        | 4th quintile
5        | 5th quintile

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing

* Comments: `Need to pay attention to specificities like: before/after taxes or contributions. People: HH income is prioritized. When not available individual/caregiver/informant/family income is caolected. Source: Pension/family/work/government/disablity/total. all sources are taken into account. For some studies, the maximum value can be compared (and crossed by sex and age to control biases) . Time-lapse: weekly, monthly, in the last 12 months. 'Many values are missing since not all respondents have all sources of income or, within the household there is not always more members, in these cases do not confuse missing data with missing values and mean a 0 should be added to the total sum in each case.`

```{r lab, echo=FALSE}
ds_label <- "Wealth"
ds_label_all <- "Total score based in all sources of income transformed into a comparable and normalized categoric variable"
```

# Data process

## aksst

### Wave 1 

#### Study-specific variable description

| **Name** | `e_013_1` |`e_014_1`|
|----------|------------|-|
| **Label** | `E-013-1:NET INCOME BRACKET` |`E-014-1:SPOUSE INCOME BRACKET`|
| **Table name** | `jstar_2007_5cities` |`jstar_2011_5cities`|
| **Description** |  |  |




```{r assign_aksst1, echo=F}
opal.assign.table.tibble(o, 'JSTAR_wealth','JSTAR_datasets_restricted.jstar_2007_5cities',
                         variables=list('e_013_1', 'e_014_1'), missings = TRUE)
JSTAR_wealth <- opal.execute(o,'JSTAR_wealth')
```

```{r local_aksst1, echo=F}
vari <- JSTAR_wealth$e_013_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_013_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- JSTAR_wealth$e_014_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_014_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study specific varibale calculate the mean value of each category and then, divide the population into 5 groups each containing 20$\%$ of the corresponding N and the missing values have to be recoded as follows: 

* `- into 999`
* `NA into 999`



**R script:**

```{r harmo_aksst1}
JSTAR_wealth$e_013_1_2 <- NA
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"-200]"')] <- 200
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"-300)"')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"-500)"')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"(200-300]"')] <- 250
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"(200-500)"')] <- 350
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"(300-500]"')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"(500-1000)"')] <- 750
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"(500-700]"')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"(700-"')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[1000-"')] <- 1000
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[300-300]"')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[300-500)"')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[300-500]"')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[500-"')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[500-500]"')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[500-700)"')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[500-700]"')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[700-1000)"')] <- 850
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='"[700-700]"')] <- 700

JSTAR_wealth$e_014_1_2 <- NA
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"-200]"')] <- 200
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"-300)"')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"-300]"')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"-500)"')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"-500]"')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"(200-300]"')] <- 250
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"(200-500)"')] <- 350
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"(300-500]"')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"(500-"')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"(500-1000)"')] <- 750
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"(500-700]"')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"(700-"')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[1000-"')] <- 1000
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[300-300]"')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[300-500)"')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[300-500]"')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[500-"')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[500-500]"')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[500-700)"')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[500-700]"')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='"[700-1000)"')] <- 850

JSTAR_wealth$sum <- apply(JSTAR_wealth[,4:5], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))
JSTAR_wealth$sum[which(JSTAR_wealth$sum==0)] <- NA
qq <- quantile(JSTAR_wealth$sum, probs = seq(0, 1, .2), na.rm = TRUE)

JSTAR_aksst_ds_w1 <- tibble(id=JSTAR_wealth$id)
JSTAR_aksst_ds_w1$wealth <- car::recode(JSTAR_wealth$sum, "0:qq[2]=1; (qq[2]+1):qq[3]=2; (qq[3]+1):qq[4]=3; (qq[4]+1):qq[5]=4; (qq[5]+1):hi=5")
JSTAR_aksst_ds_w1$wealth[is.na(JSTAR_aksst_ds_w1$wealth)] <- 999
JSTAR_aksst_ds_w1$wealth <- as.integer(JSTAR_aksst_ds_w1$wealth)
JSTAR_aksst_ds_w1$wealth <- labelled(JSTAR_aksst_ds_w1$wealth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_aksst1, echo=F, echo=F}
vari <- JSTAR_aksst_ds_w1$wealth
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(JSTAR_aksst_ds_w1, aes(x=factor(wealth))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_aksst1, echo=F, echo=F}
```





```{r importOPAL_aksst1, echo=F, echo=F}

#opal.assign.data(o, 'JSTAR_aksst_ds_w1', JSTAR_aksst_ds_w1)
#opal.symbol_import(o,'JSTAR_aksst_ds_w1', project='_Athlos_Harm_Dataset')
wealth <- JSTAR_aksst_ds_w1
save(wealth, file = "../RData/aksst_w1/wealth.RData")
rm(wealth)

JSTAR_aksst_m_ds_w1 <- JSTAR_aksst_ds_w1
JSTAR_aksst_m_ds_w1$wealth <- car::recode(JSTAR_aksst_m_ds_w1$wealth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'JSTAR_aksst_m_ds_w1', JSTAR_aksst_m_ds_w1)
#opal.symbol_import(o,'JSTAR_aksst_m_ds_w1', project='_Athlos_Harm_Dataset')
```





### Wave 2 

#### Study-specific variable description

| **Name** | `e_013_1` |`e_014_1`|
|----------|------------|-|
| **Label** | `E-013_1:RESPONDENT'S DISPOSAL INCOME, BRACKET` |`E-014_1:SPOUSE'S DISPOSAL INCOME, BRACKET`|
| **Table name** | `jstar_2009_5cities` |`jstar_2009_5cities`|
| **Description** |  |  |



```{r assign_aksst2, echo=F}
opal.assign.table.tibble(o, 'JSTAR_wealth','JSTAR_datasets_restricted.jstar_2009_5cities',
                         variables=list('e_013_1', 'e_014_1'), missings = TRUE)
JSTAR_wealth <- opal.execute(o,'JSTAR_wealth')
```

```{r local_aksst2, echo=F}
vari <- JSTAR_wealth$e_013_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_013_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- JSTAR_wealth$e_014_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_014_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study specific varibale calculate the mean value of each category and then, divide the population into 5 groups each containing 20$\%$ of the corresponding N and the missing values have to be recoded as follows: 

* `- into 999`
* `NA into 999`

**R script:**

```{r harmo_aksst2}
JSTAR_wealth$e_013_1_2 <- NA
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_300]')] <- 250
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_500)')] <- 350
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_1000)')] <- 750
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[1000_')] <- 1000
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500)')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_500]')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700)')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_1000)')] <- 850
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_200]')] <- 200
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300)')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_500)')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_500]')] <- 500

JSTAR_wealth$e_014_1_2 <- NA
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_300]')] <- 250
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_500)')] <- 350
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_1000')] <- 750
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_700]')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(700_')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[1000_')] <- 1000
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500)')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_700)')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_700]')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[700_700]')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_200]')] <- 200
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300)')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500)')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500]')] <- 500

JSTAR_wealth$sum <- apply(JSTAR_wealth[,4:5], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))
JSTAR_wealth$sum[which(JSTAR_wealth$sum==0)] <- NA
qq <- quantile(JSTAR_wealth$sum, probs = seq(0, 1, .2), na.rm = TRUE)


JSTAR_aksst_ds_w2 <- tibble(id=JSTAR_wealth$id)
JSTAR_aksst_ds_w2$wealth <- car::recode(JSTAR_wealth$sum, "0:qq[2]=1; (qq[2]+1):qq[3]=2; (qq[3]+1):qq[4]=3; (qq[4]+1):qq[5]=4; (qq[5]+1):hi=5")
JSTAR_aksst_ds_w2$wealth[is.na(JSTAR_aksst_ds_w2$wealth)] <- 999
JSTAR_aksst_ds_w2$wealth <- as.integer(JSTAR_aksst_ds_w2$wealth)
JSTAR_aksst_ds_w2$wealth <- labelled(JSTAR_aksst_ds_w2$wealth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_aksst2, echo=F}
vari <- JSTAR_aksst_ds_w2$wealth
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(JSTAR_aksst_ds_w2, aes(x=factor(wealth))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_aksst2, echo=F}
```





```{r importOPAL_aksst2, echo=F}

#opal.assign.data(o, 'JSTAR_aksst_ds_w2', JSTAR_aksst_ds_w2)
#opal.symbol_import(o,'JSTAR_aksst_ds_w2', project='_Athlos_Harm_Dataset')
wealth <- JSTAR_aksst_ds_w2
save(wealth, file = "../RData/aksst_w2/wealth.RData")
rm(wealth)

JSTAR_aksst_m_ds_w2 <- JSTAR_aksst_ds_w2
JSTAR_aksst_m_ds_w2$wealth <- car::recode(JSTAR_aksst_m_ds_w2$wealth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'JSTAR_aksst_m_ds_w2', JSTAR_aksst_m_ds_w2)
#opal.symbol_import(o,'JSTAR_aksst_m_ds_w2', project='_Athlos_Harm_Dataset')
```





### Wave 3 

#### Study-specific variable description

| **Name** | `e_013_1` |`e_014_1`|
|----------|------------|-|
| **Label** | `11E-013-1:RESPONDENT'S DISPOSAL INCOME, BRACKET` |`11E-014-1:SPOUSE'S DISPOSAL INCOME, BRACKET`|
| **Table name** | `jstar_2011_5cities` |`jstar_2011_5cities`|
| **Description** |  |  |



```{r assign_aksst3, echo=F}
opal.assign.table.tibble(o, 'JSTAR_wealth','JSTAR_datasets_restricted.jstar_2011_5cities',
                         variables=list('e_013_1', 'e_014_1'), missings = TRUE)
JSTAR_wealth <- opal.execute(o,'JSTAR_wealth')
```

```{r local_aksst3, echo=F}
vari <- JSTAR_wealth$e_013_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_013_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- JSTAR_wealth$e_014_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_014_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study specific varibale calculate the mean value of each category and then, divide the population into 5 groups each containing 20$\%$ of the corresponding N and the missing values have to be recoded as follows: 

* `- into 999`
* `NA into 999`

**R script:**

```{r harmo_aksst3}
JSTAR_wealth$e_013_1_2 <- NA
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_300]')] <- 250
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_500)')] <- 350
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_1000')] <- 750
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[1000_')] <- 1000
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500)')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_500]')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700)')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_1000')] <- 850
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_200]')] <- 200
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300)')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_500)')] <- 500

JSTAR_wealth$e_014_1_2 <- NA
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_300]')] <- 250
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_500)')] <- 350
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_1000')] <- 750
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_700]')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(700_')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[1000_')] <- 1000
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500)')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_700)')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_200]')] <- 200
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300)')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500)')] <- 500

JSTAR_wealth$sum <- apply(JSTAR_wealth[,4:5], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))
JSTAR_wealth$sum[which(JSTAR_wealth$sum==0)] <- NA
qq <- quantile(JSTAR_wealth$sum, probs = seq(0, 1, .2), na.rm = TRUE)


JSTAR_aksst_ds_w3 <- tibble(id=JSTAR_wealth$id)
JSTAR_aksst_ds_w3$wealth <- car::recode(JSTAR_wealth$sum, "0:qq[2]=1; (qq[2]+1):qq[3]=2; (qq[3]+1):qq[4]=3; (qq[4]+1):qq[5]=4; (qq[5]+1):hi=5")
JSTAR_aksst_ds_w3$wealth[is.na(JSTAR_aksst_ds_w3$wealth)] <- 999
JSTAR_aksst_ds_w3$wealth <- as.integer(JSTAR_aksst_ds_w3$wealth)
JSTAR_aksst_ds_w3$wealth <- labelled(JSTAR_aksst_ds_w3$wealth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_aksst3, echo=F}
vari <- JSTAR_aksst_ds_w3$wealth
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(JSTAR_aksst_ds_w3, aes(x=factor(wealth))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_aksst3, echo=F}
```





```{r importOPAL_aksst3, echo=F}

#opal.assign.data(o, 'JSTAR_aksst_ds_w3', JSTAR_aksst_ds_w3)
#opal.symbol_import(o,'JSTAR_aksst_ds_w3', project='_Athlos_Harm_Dataset')
wealth <- JSTAR_aksst_ds_w3
save(wealth, file = "../RData/aksst_w3/wealth.RData")
rm(wealth)

JSTAR_aksst_m_ds_w3 <- JSTAR_aksst_ds_w3
JSTAR_aksst_m_ds_w3$wealth <- car::recode(JSTAR_aksst_m_ds_w3$wealth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'JSTAR_aksst_m_ds_w3', JSTAR_aksst_m_ds_w3)
#opal.symbol_import(o,'JSTAR_aksst_m_ds_w3', project='_Athlos_Harm_Dataset')
```





## tn

### Wave 1 

#### Study-specific variable description

| **Name** | `e_013_1` | `e_014_1` |
|----------|------------|-|
| **Label** | `E-013-1:NET INCOME BRACKET` | `E-014-1:NET INCOME BRACKET, SPOUSE` |
| **Table name** | `jstar_2009_2cities` |`jstar_2009_2cities` |
| **Description** |  |  | 



```{r assign_tn1, echo=F}
opal.assign.table.tibble(o, 'JSTAR_wealth','JSTAR_datasets_restricted.jstar_2009_2cities',
                         variables=list('e_013_1', 'e_014_1'), missings = TRUE)
JSTAR_wealth <- opal.execute(o,'JSTAR_wealth')
```

```{r local_tn1, echo=F}
vari <- JSTAR_wealth$e_013_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_013_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- JSTAR_wealth$e_014_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_014_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study specific varibale calculate the mean value of each category and then, divide the population into 5 groups each containing 20$\%$ of the corresponding N and the missing values have to be recoded as follows: 

* `- into 999`
* `NA into 999`

**R script:**

```{r harmo_tn1}
JSTAR_wealth$e_013_1_2 <- NA
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_300]')] <- 250
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_500)')] <- 350
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_1000)')] <- 750
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[1000_')] <- 1000
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500)')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_500]')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700)')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_1000)')] <- 850
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_200]')] <- 200
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300)')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_500]')] <- 500

JSTAR_wealth$e_014_1_2 <- NA
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_300]')] <- 250
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_500)')] <- 350
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_1000)')] <- 750
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_700]')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(700_')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[1000_')] <- 1000
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500)')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_500]')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_700)')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[700_')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[700_1000)')] <- 850
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_200]')] <- 200
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300)')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500)')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500]')] <- 500

JSTAR_wealth$sum <- apply(JSTAR_wealth[,4:5], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))
JSTAR_wealth$sum[which(JSTAR_wealth$sum==0)] <- NA
qq <- quantile(JSTAR_wealth$sum, probs = seq(0, 1, .2), na.rm = TRUE)

JSTAR_tn_ds_w1 <- tibble(id=JSTAR_wealth$id)
JSTAR_tn_ds_w1$wealth <- car::recode(JSTAR_wealth$sum, "0:qq[2]=1; (qq[2]+1):qq[3]=2; (qq[3]+1):qq[4]=3; (qq[4]+1):qq[5]=4; (qq[5]+1):hi=5")
JSTAR_tn_ds_w1$wealth[is.na(JSTAR_tn_ds_w1$wealth)] <- 999
JSTAR_tn_ds_w1$wealth <- as.integer(JSTAR_tn_ds_w1$wealth)
JSTAR_tn_ds_w1$wealth <- labelled(JSTAR_tn_ds_w1$wealth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_tn1, echo=F}
vari <- JSTAR_tn_ds_w1$wealth
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(JSTAR_tn_ds_w1, aes(x=factor(wealth))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_tn1, echo=F}
```





```{r importOPAL_tn1, echo=F}

#opal.assign.data(o, 'JSTAR_tn_ds_w1', JSTAR_tn_ds_w1)
#opal.symbol_import(o,'JSTAR_tn_ds_w1', project='_Athlos_Harm_Dataset')
wealth <- JSTAR_tn_ds_w1
save(wealth, file = "../RData/tn_w1/wealth.RData")
rm(wealth)

JSTAR_tn_m_ds_w1 <- JSTAR_tn_ds_w1
JSTAR_tn_m_ds_w1$wealth <- car::recode(JSTAR_tn_m_ds_w1$wealth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'JSTAR_tn_m_ds_w1', JSTAR_tn_m_ds_w1)
#opal.symbol_import(o,'JSTAR_tn_m_ds_w1', project='_Athlos_Harm_Dataset')
```





### Wave 2 

#### Study-specific variable description

| **Name** | `e_013_1` |`e_014_1`|
|----------|------------|-|-|
| **Label** | `11E-013-1:RESPONDENT'S DISPOSAL INCOME, BRACKET` | `11E-014-1:SPOUSE'S DISPOSAL INCOME, BRACKET` | 
| **Table name** | `jstar_2011_2cities`|`jstar_2011_2cities`|
| **Description** |  |  |  

<!--
Especifico todas las variables locales porque aunque no se usen en armonizar, aparecen en las tablas mostradas en las validaciones
-->

```{r assign_tn2, echo=F}
opal.assign.table.tibble(o, 'JSTAR_wealth','JSTAR_datasets_restricted.jstar_2011_2cities',
                         variables=list('e_013_1', 'e_014_1'), missings = TRUE)
JSTAR_wealth <- opal.execute(o,'JSTAR_wealth')
```

```{r local_tn2, echo=F}
vari <- JSTAR_wealth$e_013_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_013_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- JSTAR_wealth$e_014_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_014_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study specific varibale calculate the mean value of each category and then, divide the population into 5 groups each containing 20$\%$ of the corresponding N and the missing values have to be recoded as follows: 

* `- into 999`
* `NA into 999`

**R script:**

```{r harmo_tn2}
JSTAR_wealth$e_013_1_2 <- NA
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_300]')] <- 250
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_500)')] <- 350
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_1000)')] <- 750
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[1000_')] <- 1000
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500)')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_500]')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700)')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_1000)')] <- 850
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_200]')] <- 200
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300)')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_500]')] <- 500

JSTAR_wealth$e_014_1_2 <- NA
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_300]')] <- 250
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_500)')] <- 350
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_1000)')] <- 750
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_700]')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(700_')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[1000_')] <- 1000
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500)')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_500]')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_700)')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[700_')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[700_1000)')] <- 850
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_200]')] <- 200
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300)')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500)')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500]')] <- 500

JSTAR_wealth$sum <- apply(JSTAR_wealth[,4:5], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))
JSTAR_wealth$sum[which(JSTAR_wealth$sum==0)] <- NA
qq <- quantile(JSTAR_wealth$sum, probs = seq(0, 1, .2), na.rm = TRUE)


JSTAR_tn_ds_w2 <- tibble(id=JSTAR_wealth$id)
JSTAR_tn_ds_w2$wealth <- car::recode(JSTAR_wealth$sum, "0:qq[2]=1; (qq[2]+1):qq[3]=2; (qq[3]+1):qq[4]=3; (qq[4]+1):qq[5]=4; (qq[5]+1):hi=5")
JSTAR_tn_ds_w2$wealth[is.na(JSTAR_tn_ds_w2$wealth)] <- 999
JSTAR_tn_ds_w2$wealth <- as.integer(JSTAR_tn_ds_w2$wealth)
JSTAR_tn_ds_w2$wealth <- labelled(JSTAR_tn_ds_w2$wealth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_tn2, echo=F}
vari <- JSTAR_tn_ds_w2$wealth
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(JSTAR_tn_ds_w2, aes(x=factor(wealth))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_tn2, echo=F,results='asis'}
```




```{r importOPAL_tn2, echo=F}

#opal.assign.data(o, 'JSTAR_tn_ds_w2', JSTAR_tn_ds_w2)
#opal.symbol_import(o,'JSTAR_tn_ds_w2', project='_Athlos_Harm_Dataset')
wealth <- JSTAR_tn_ds_w2
save(wealth, file = "../RData/tn_w2/wealth.RData")
rm(wealth)

JSTAR_tn_m_ds_w2 <- JSTAR_tn_ds_w2
JSTAR_tn_m_ds_w2$wealth <- car::recode(JSTAR_tn_m_ds_w2$wealth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'JSTAR_tn_m_ds_w2', JSTAR_tn_m_ds_w2)
#opal.symbol_import(o,'JSTAR_tn_m_ds_w2', project='_Athlos_Harm_Dataset')
```





## cth

### Wave 1 

#### Study-specific variable description

| **Name** | `e_013_1` |`e_014_1`|
|----------|------------|-|
| **Label** | `E-013-1:NET INCOME BRACKET: TEN THOUSAND YEN` |`E-014-1:NET INCOME BRACKET, SPOUSE: TEN THOUSAND YEN`|
| **Table name** | `jstar_2011_3cities` |`jstar_2011_3cities` |
| **Description** |  |  |


```{r assign_cth1, echo=F}
opal.assign.table.tibble(o, 'JSTAR_wealth','JSTAR_datasets_restricted.jstar_2011_3cities',
                         variables=list('e_013_1', 'e_014_1'), missings = TRUE)
JSTAR_wealth <- opal.execute(o,'JSTAR_wealth')
```

```{r local_cth1, echo=F}
vari <- JSTAR_wealth$e_013_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_013_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- JSTAR_wealth$e_014_1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(JSTAR_wealth, aes(e_014_1)) + geom_histogram(stat="count", fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study specific varibale calculate the mean value of each category and then, divide the population into 5 groups each containing 20$\%$ of the corresponding N and the missing values have to be recoded as follows: 

* `- into 999`
* `NA into 999`

**R script:**

```{r harmo_cth1}
JSTAR_wealth$e_013_1_2 <- NA
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_300]')] <- 250
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(200_500)')] <- 350
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_1000)')] <- 750
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(500_700]')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='(700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[1000_')] <- 1000
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500)')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[300_500]')] <- 400
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_500]')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[500_700)')] <- 600
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_1000)')] <- 850
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='[700_700]')] <- 700
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_200]')] <- 200
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300)')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_300]')] <- 300
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_500)')] <- 500
JSTAR_wealth$e_013_1_2[which(JSTAR_wealth$e_013_1=='_500]')] <- 500

JSTAR_wealth$e_014_1_2 <- NA
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_300]')] <- 250
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(200_500)')] <- 350
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_1000)')] <- 750
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(500_700]')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='(700_')] <- 700
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[1000_')] <- 1000
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500)')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[300_500]')] <- 400
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_500]')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_700)')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[500_700]')] <- 600
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='[700_1000)')] <- 850
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_200]')] <- 200
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300)')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_300]')] <- 300
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500)')] <- 500
JSTAR_wealth$e_014_1_2[which(JSTAR_wealth$e_014_1=='_500]')] <- 500

JSTAR_wealth$sum <- apply(JSTAR_wealth[,4:5], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))
JSTAR_wealth$sum[which(JSTAR_wealth$sum==0)] <- NA
qq <- quantile(JSTAR_wealth$sum, probs = seq(0, 1, .2), na.rm = TRUE)


JSTAR_cth_ds_w1 <- tibble(id=JSTAR_wealth$id)
JSTAR_cth_ds_w1$wealth <- car::recode(JSTAR_wealth$sum, "0:qq[2]=1; (qq[2]+1):qq[3]=2; (qq[3]+1):qq[4]=3; (qq[4]+1):qq[5]=4; (qq[5]+1):hi=5")
JSTAR_cth_ds_w1$wealth[is.na(JSTAR_cth_ds_w1$wealth)] <- 999
JSTAR_cth_ds_w1$wealth <- as.integer(JSTAR_cth_ds_w1$wealth)
JSTAR_cth_ds_w1$wealth <- labelled(JSTAR_cth_ds_w1$wealth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_cth1, echo=F}
vari <- JSTAR_cth_ds_w1$wealth
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(JSTAR_cth_ds_w1, aes(x=factor(wealth))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_cth1, echo=F}
```





```{r importOPAL_cth1, echo=F}

#opal.assign.data(o, 'JSTAR_cth_ds_w1', JSTAR_cth_ds_w1)
#opal.symbol_import(o,'JSTAR_cth_ds_w1', project='_Athlos_Harm_Dataset')
wealth <- JSTAR_cth_ds_w1
save(wealth, file = "../RData/cth_w1/wealth.RData")
rm(wealth)

JSTAR_cth_m_ds_w1 <- JSTAR_cth_ds_w1
JSTAR_cth_m_ds_w1$wealth <- car::recode(JSTAR_cth_m_ds_w1$wealth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'JSTAR_cth_m_ds_w1', JSTAR_cth_m_ds_w1)
#opal.symbol_import(o,'JSTAR_cth_m_ds_w1', project='_Athlos_Harm_Dataset')
```






# Quality estimation
Quintiles were generated by dividing the population into 5 groups each containing 20% of the corresponding N.   
Different income questions ask about different timing. 
The total income questions ask about the past year. 
The private-transfer income questions allow the respondent to report either regular monthly or total 
such income in the past year. 
Regarding pension income, Waves 1 and 2 ask total such income in the past year, 
while Wave 3 onward asks how many payments are currently received through the pension source per year 
(unless that payment frequency is regulated by the government) and then about the current regular amount 
of that payment.
Sources of income were: Business, stocks, public pensions, primary residence, value of other real estate, net value of company/business, and non-housing financial wealth. 

There are categories like "-200]" and to calculate the mean value of thouse categories we use the only value 
that appears. 


```{r closeRsession, echo=FALSE}
opal.logout(o)
```
