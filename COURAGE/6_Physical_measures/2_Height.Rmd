---
title: "Height"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---
  
<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/Rmds/setup_albert.r")
```
<!-- ########################################################## --> 




# Description of DataSchema variable

The description of harmonised variable is the following:
  
* Name: `height`
* Label: `height of the participant`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
* Comments: `Antropomeric measure for height should be measured in centimeters.`


### COURAGE - Finnish - Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q2506_height`
* Label: `height`
* Type of variable: `countinous`
* Missings
    + `997 = Disable to measure`
    + `998 = Refusal`

```{r assign_fin}
opal.assign.table.tibble(o, 'COURAGE_fin_w1_heig','Courage.Courage_Finland_w1',
                         variables=list('q2506_height'), missings = TRUE)
```

```{r local_fin}
COURAGE_fin_w1_heig <- opal.execute(o,'COURAGE_fin_w1_heig')
Continuous_summary(var = COURAGE_fin_w1_heig$q2506_height, missing_values = c(997,998))
ggplot(COURAGE_fin_w1_heig, aes(q2506_height)) + geom_histogram(stat="count", fill="steelblue") + xlab("Height") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `997 into 993`
* `998 into 997`

R code of the ALGORITHM:

```{r harmo_fin}
COURAGE_ds_fin_w1 <- tibble(id=COURAGE_fin_w1_heig$id)
COURAGE_ds_fin_w1$height <- car::recode(COURAGE_fin_w1_heig$q2506_height, "NA=999; 997=993; 998=997")
COURAGE_ds_fin_w1$height <- labelled(COURAGE_ds_fin_w1$height, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_fin}
Continuous_summary(var = COURAGE_ds_fin_w1$height, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(COURAGE_ds_fin_w1, aes(height)) + geom_histogram(stat="count", fill="steelblue") + xlab("height") + ylab("Frequency") + xlim(100,250) 
```

#### Validation
```{r crosstabulation_fin}
```







### COURAGE - Polish - Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q2506_height`
* Label: `height`
* Type of variable: `countinous`
* Missings
    + `997 = Disable to measure`
    + `998 = Refusal`

```{r assign_pol1}
opal.assign.table.tibble(o, 'COURAGE_pol_w1_heig','Courage.Courage_Poland_w1',
                         variables=list('q2506_height'), missings = TRUE)
```

```{r local_pol1}
COURAGE_pol_w1_heig <- opal.execute(o,'COURAGE_pol_w1_heig')
Continuous_summary(var = COURAGE_pol_w1_heig$q2506_height, missing_values = c(997,998))
ggplot(COURAGE_pol_w1_heig, aes(q2506_height)) + geom_histogram(stat="count", fill="steelblue") + xlab("Height") + ylab("Frequency")
```

This variables have values from smallers than 101 that we are going to considered as mistakes and they will be recoded as 999. There are also values larger than  1370 that we are going to considered as mistakes and they will be recoded as 999.

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `997 into 993`
* `998 into 997`


R code of the ALGORITHM:

```{r harmo_pol1}
COURAGE_ds_pol_w1 <- tibble(id=COURAGE_pol_w1_heig$id)
COURAGE_ds_pol_w1$height <- car::recode(COURAGE_pol_w1_heig$q2506_height, "NA=999; 997=993; 998=997; lo:101=999; 1370:hi=999")
COURAGE_ds_pol_w1$height <- labelled(COURAGE_ds_pol_w1$height, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_pol1}
Continuous_summary(var = COURAGE_ds_pol_w1$height, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(COURAGE_ds_pol_w1, aes(height)) + geom_histogram(stat="count", fill="steelblue") + xlab("height") + ylab("Frequency") + xlim(100,250) 
```

#### Validation
There are some unusual values that are lower than 100 and upper than 250 cm. 
```{r crosstabulation_pol1}
COURAGE_pol_w1_heig[which(COURAGE_pol_w1_heig$q2506_height<100 | (COURAGE_pol_w1_heig$q2506_height>250 & COURAGE_pol_w1_heig$q2506_height!=997 & COURAGE_pol_w1_heig$q2506_height!=998)),]
```






### COURAGE - Polish - Wave 2 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q2506_height_s1`
* Label: `height`
* Type of variable: `countinous`
* Missings
    + `997 = Disable to measure`
    + `998 = Refusal`

```{r assign_pol2}
opal.assign.table.tibble(o, 'COURAGE_pol_w2_heig','Courage.Courage_Poland_w2',
                         variables=list('q2506_height_s1'), missings = TRUE)
```

```{r local_pol2}
COURAGE_pol_w2_heig <- opal.execute(o,'COURAGE_pol_w2_heig')
Continuous_summary(var = COURAGE_pol_w2_heig$q2506_height_s1, missing_values = c(997,998))
ggplot(COURAGE_pol_w2_heig, aes(q2506_height_s1)) + geom_histogram(stat="count", fill="steelblue") + xlab("Height") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `997 into 993`
* `998 into 997`

R code of the ALGORITHM:

```{r harmo_pol2}
COURAGE_ds_pol_w2 <- tibble(id=COURAGE_pol_w2_heig$id)
COURAGE_ds_pol_w2$height <- car::recode(COURAGE_pol_w2_heig$q2506_height_s1, "NA=999; 997=993; 998=997")
COURAGE_ds_pol_w2$height <- labelled(COURAGE_ds_pol_w2$height, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_pol2}
Continuous_summary(var = COURAGE_ds_pol_w2$height, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(COURAGE_ds_pol_w2, aes(height)) + geom_histogram(stat="count", fill="steelblue") + xlab("height") + ylab("Frequency") + xlim(100,250) 
```

#### Validation
```{r crosstabulation_pol2}

```




### COURAGE - Spain - Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q2506_height`
* Label: `height`
* Type of variable: `countinous`
* Missings
    + `997 = Disable to measure`
    + `998 = Refusal`

```{r assign_spain1}
opal.assign.table.tibble(o, 'COURAGE_spain_w1_heig','Courage.Courage_Spain_w1',
                         variables=list('q2506_height'), missings = TRUE)
```

```{r local_spain1}
COURAGE_spain_w1_heig <- opal.execute(o,'COURAGE_spain_w1_heig')
Continuous_summary(var = COURAGE_spain_w1_heig$q2506_height, missing_values = c(997,998, 889))
ggplot(COURAGE_spain_w1_heig, aes(q2506_height)) + geom_histogram(stat="count", fill="steelblue") + xlab("Height") + ylab("Frequency")
```

There are values 889 that are going to be considered as mistake instead of 998, therefore they will be recoded as 997.

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `997 into 993`
* `998 into 997`


R code of the ALGORITHM:

```{r harmo_spain1}
COURAGE_ds_spain_w1 <- tibble(id=COURAGE_spain_w1_heig$id)
COURAGE_ds_spain_w1$height <- car::recode(COURAGE_spain_w1_heig$q2506_height, "NA=999; 997=993; c(998,889)=997")
COURAGE_ds_spain_w1$height <- labelled(COURAGE_ds_spain_w1$height, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_spain1}
Continuous_summary(var = COURAGE_ds_spain_w1$height, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(COURAGE_ds_spain_w1, aes(height)) + geom_histogram(stat="count", fill="steelblue") + xlab("height") + ylab("Frequency") + xlim(100,250) 
```

#### Validation
```{r crosstabulation_spain1}
```





### COURAGE - Spain - Wave 2 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q2506_height_s1`
* Label: `height`
* Type of variable: `countinous`
* Missings
    + `997 = Disable to measure`
    + `998 = Refusal`

```{r assign_spain2}
opal.assign.table.tibble(o, 'COURAGE_spain_w2_heig','Courage.Courage_Spain_w2_1',
                         variables=list('q2506_height_s1'), missings = TRUE)
```

```{r local_spain2}
COURAGE_spain_w2_heig <- opal.execute(o,'COURAGE_spain_w2_heig')
Continuous_summary(var = COURAGE_spain_w2_heig$q2506_height_s1, missing_values = c(997,998))
ggplot(COURAGE_spain_w2_heig, aes(q2506_height_s1)) + geom_histogram(stat="count", fill="steelblue") + xlab("Height") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `997 into 993`
* `998 into 997`


R code of the ALGORITHM:

```{r harmo_spain2}
COURAGE_ds_spain_w2 <- tibble(id=COURAGE_spain_w2_heig$id)
COURAGE_ds_spain_w2$height <- car::recode(COURAGE_spain_w2_heig$q2506_height_s1, "NA=999; 997=993; 998=997")
COURAGE_ds_spain_w2$height <- labelled(COURAGE_ds_spain_w2$height, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_spain2}
Continuous_summary(var = COURAGE_ds_spain_w2$height, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(COURAGE_ds_spain_w2, aes(height)) + geom_histogram(stat="count", fill="steelblue") + xlab("height") + ylab("Frequency") + xlim(100,250) 
```

#### Validation
There are some unusual values that are lower than 100. 
```{r crosstabulation_spain2}
COURAGE_spain_w2_heig[which(COURAGE_spain_w2_heig$q2506_height_s1<100),]
```



# Quality estimation
No comments.


```{r save, echo=FALSE}
height <- COURAGE_ds_spain_w1
save(height, file = "../RData/spain_w1/height.RData")
rm(height)

height <- COURAGE_ds_spain_w2
save(height, file = "../RData/spain_w2/height.RData")
rm(height)

height <- COURAGE_ds_pol_w1
save(height, file = "../RData/pol_w1/height.RData")
rm(height)

height <- COURAGE_ds_pol_w2
save(height, file = "../RData/pol_w2/height.RData")
rm(height)

height <- COURAGE_ds_fin_w1
save(height, file = "../RData/fin_w1/height.RData")
rm(height)
```


```{r closeRsession, echo=FALSE} 
opal.logout(o)
```

