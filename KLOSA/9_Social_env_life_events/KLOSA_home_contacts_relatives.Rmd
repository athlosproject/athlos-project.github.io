---
title: "KLOSA"
author: "Katarzyna Jablonska"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true 
    depth: 4
    number_sections: true  
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r prepare, message=FALSE, include=FALSE}
library(bitops)
library(RCurl)
library(rjson)
library(mime)
library(opal)
library(tibble)
library(car)
library(labelled)
library(Hmisc)
source("Continuous_summary.R")
source("Categorical_summary.R")

# authenticate within opal server 
o <- opal.login('','...','http://...')
```

# Socio-demographic and economic characteristics 

## `Living with relatives`

### Description of DataSchema variable `Are living in home with family members/relatives (= daily contact with family member)?`

The description of harmonised variable is the following:
  
* Name: `home_rel`
* Label: `Are living in home with family members/relatives (= daily contact with family member)?`
* Type: categorical
* Categories: 
    + `0 = no`
    + `1 = yes`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done/not yet recorded`
    + `995 = Don't answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`



### KLOSA - Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `w01cv018_01` UP TO `w01cv018_09` **I cannot find them on the Opal website, but write a code just in case**
* Label: `The relationship between 1st non panel household member and a CV respondent`
* Categories: 
    + `1 = Father/mother`
    + `2 = Father-in-law/Mother-in-law`
    + `3 = spouse`
    + `4 = Son/daughter`
    + `5 = Son-in-law/daughter-in-law`
    + `6 = Brother/sister`
    + `7 = grand child(ren)`
    + `8 = Child of brother/sister`
    + `9 = Brother-in-law/sister-in-law`
    + `10 = Child of brother-in-law/sister-in-law`
    + `11 = Spouse of grandchild`
    + `12 = Great grand child(ren)`
    + `13 = Others`
    

```{r assign1}
opal.assign.table.tibble(o, 'KLOSA_w1_home_rel','KLOSA.w01_main_e', 
                        variables=list('w01cv018_01','w01cv018_02','w01cv018_03','w01cv018_04','w01cv018_05','w01cv018_06',
                                       'w01cv018_07','w01cv018_08','w01cv018_09'), missings = TRUE)
```

```{r local1}
KLOSA_w1_home_rel <- opal.execute(o,'KLOSA_w1_home_rel')
Categorical_summary(var = KLOSA_w1_home_rel$w01cv018_01, missing_values = NA)
ggplot(KLOSA_w1_home_rel, aes(x=factor(w01cv018_01))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("The relationship between 1st non panel household member and a CV respondent") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any variable is in 1:12 then 1`

R code of the ALGORITHM:

```{r harmo1}
KLOSA_ds_w1 <- tibble(id=KLOSA_w1_home_rel$id)

KLOSA_w1_home_rel$w01cv018_01 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_01), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_02 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_02), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_03 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_03), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_04 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_04), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_05 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_05), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_06 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_06), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_07 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_07), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_08 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_08), "NA='-999'")
KLOSA_w1_home_rel$w01cv018_09 <- car::recode(as.vector(KLOSA_w1_home_rel$w01cv018_09), "NA='-999'")

KLOSA_ds_w1$home_rel <- c(NA) # I think it is required
for(i in 1:dim(KLOSA_w1_home_rel)[1]){
  if( KLOSA_w1_home_rel$w01cv018_01[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_02[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_03[i] %in% c(1:12) | 
    KLOSA_w1_home_rel$w01cv018_04[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_05[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_06[i] %in% c(1:12) | 
    KLOSA_w1_home_rel$w01cv018_07[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_08[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_09[i] %in% c(1:12) ) {
  KLOSA_ds_w1$home_rel[i] = 1 }
  else if( KLOSA_w1_home_rel$w01cv018_01[i] == -999 & KLOSA_w1_home_rel$w01cv018_02[i] == -999 & KLOSA_w1_home_rel$w01cv018_03[i] == -999 & 
    KLOSA_w1_home_rel$w01cv018_04[i] == -999 & KLOSA_w1_home_rel$w01cv018_05[i] == -999 & KLOSA_w1_home_rel$w01cv018_06[i] == -999 & 
    KLOSA_w1_home_rel$w01cv018_07[i] == -999 & KLOSA_w1_home_rel$w01cv018_08[i] == -999 & KLOSA_w1_home_rel$w01cv018_09[i] == -999 ) {
  KLOSA_ds_w1$home_rel[i] = 999 }
  else if( !( KLOSA_w1_home_rel$w01cv018_01[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_02[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_03[i] %in% c(1:12) | 
    KLOSA_w1_home_rel$w01cv018_04[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_05[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_06[i] %in% c(1:12) | 
    KLOSA_w1_home_rel$w01cv018_07[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_08[i] %in% c(1:12) | KLOSA_w1_home_rel$w01cv018_09[i] %in% c(1:12) ) ) {
  KLOSA_ds_w1$home_rel[i] = 0 }
}

KLOSA_ds_w1$home_rel <- car::recode(as.vector(KLOSA_ds_w1$home_rel), "NA='999'")
KLOSA_ds_w1$home_rel <- labelled(KLOSA_ds_w1$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript1}
Categorical_summary(var = KLOSA_ds_w1$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(KLOSA_ds_w1, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### KLOSA - Wave 2

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `w02CV007_01` UP TO `w02CV007_09`
* Label: `The relationship between 1st non panel household member and a CV respondent`
* Categories: 
    + `1 = Father/mother`
    + `2 = Father-in-law/Mother-in-law`
    + `3 = spouse`
    + `4 = Son/daughter`
    + `5 = Son-in-law/daughter-in-law`
    + `6 = Brother/sister`
    + `7 = grand child(ren)`
    + `8 = Child of brother/sister`
    + `9 = Brother-in-law/sister-in-law`
    + `10 = Child of brother-in-law/sister-in-law`
    + `11 = Spouse of grandchild`
    + `12 = Great grand child(ren)`
    + `13 = Others`
    

```{r assign2}
opal.assign.table.tibble(o, 'KLOSA_w2_home_rel','KLOSA.w02_main_e_spss', 
                        variables=list('w02CV007_01','w02CV007_02','w02CV007_03','w02CV007_04','w02CV007_05','w02CV007_06',
                                       'w02CV007_07','w02CV007_08','w02CV007_09'), missings = TRUE)
```

```{r local2}
KLOSA_w2_home_rel <- opal.execute(o,'KLOSA_w2_home_rel')
Categorical_summary(var = KLOSA_w2_home_rel$w02CV007_01, missing_values = NA)
ggplot(KLOSA_w2_home_rel, aes(x=factor(w02CV007_01))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("The relationship between 1st non panel household member and a CV respondent") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any variable is in 1:12 then 1`

R code of the ALGORITHM:

```{r harmo2}
KLOSA_ds_w2 <- tibble(id=KLOSA_w2_home_rel$id)

KLOSA_w2_home_rel$w02CV007_01 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_01), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_02 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_02), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_03 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_03), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_04 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_04), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_05 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_05), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_06 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_06), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_07 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_07), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_08 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_08), "NA='-999'")
KLOSA_w2_home_rel$w02CV007_09 <- car::recode(as.vector(KLOSA_w2_home_rel$w02CV007_09), "NA='-999'")

KLOSA_ds_w2$home_rel <- c(NA) # I think it is required
for(i in 1:dim(KLOSA_w2_home_rel)[1]){
  if( KLOSA_w2_home_rel$w02CV007_01[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_02[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_03[i] %in% c(1:12) | 
    KLOSA_w2_home_rel$w02CV007_04[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_05[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_06[i] %in% c(1:12) | 
    KLOSA_w2_home_rel$w02CV007_07[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_08[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_09[i] %in% c(1:12) ) {
  KLOSA_ds_w2$home_rel[i] = 1 }
  else if( KLOSA_w2_home_rel$w02CV007_01[i] == -999 & KLOSA_w2_home_rel$w02CV007_02[i] == -999 & KLOSA_w2_home_rel$w02CV007_03[i] == -999 & 
    KLOSA_w2_home_rel$w02CV007_04[i] == -999 & KLOSA_w2_home_rel$w02CV007_05[i] == -999 & KLOSA_w2_home_rel$w02CV007_06[i] == -999 & 
    KLOSA_w2_home_rel$w02CV007_07[i] == -999 & KLOSA_w2_home_rel$w02CV007_08[i] == -999 & KLOSA_w2_home_rel$w02CV007_09[i] == -999 ) {
  KLOSA_ds_w2$home_rel[i] = 999 }
  else if( !( KLOSA_w2_home_rel$w02CV007_01[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_02[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_03[i] %in% c(1:12) | 
    KLOSA_w2_home_rel$w02CV007_04[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_05[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_06[i] %in% c(1:12) | 
    KLOSA_w2_home_rel$w02CV007_07[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_08[i] %in% c(1:12) | KLOSA_w2_home_rel$w02CV007_09[i] %in% c(1:12) ) ) {
  KLOSA_ds_w2$home_rel[i] = 0 }
}

KLOSA_ds_w2$home_rel <- car::recode(as.vector(KLOSA_ds_w2$home_rel), "NA='999'")
KLOSA_ds_w2$home_rel <- labelled(KLOSA_ds_w2$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript2}
Categorical_summary(var = KLOSA_ds_w2$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(KLOSA_ds_w2, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### KLOSA - Wave 3

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `w03CV007_01` UP TO `w03CV007_01`
* Label: `The relationship between 1st non panel household member`
* Categories: 
    + `1 = Father/mother`
    + `2 = Father-in-law/Mother-in-law`
    + `3 = spouse`
    + `4 = Son/daughter`
    + `5 = Son-in-law/daughter-in-law`
    + `6 = Brother/sister`
    + `7 = grand child(ren)`
    + `8 = Child of brother/sister`
    + `9 = Brother-in-law/sister-in-law`
    + `10 = Child of brother-in-law/sister-in-law`
    + `11 = Spouse of grandchild`
    + `12 = Great grand child(ren)`
    + `13 = Others`
    

```{r assign3}
opal.assign.table.tibble(o, 'KLOSA_w3_home_rel','KLOSA.w03_main_e_spss_albert', 
                        variables=list('w03CV007_01','w03CV007_02','w03CV007_03','w03CV007_04','w03CV007_05','w03CV007_06',
                                       'w03CV007_07'), missings = TRUE)
```

```{r local3}
KLOSA_w3_home_rel <- opal.execute(o,'KLOSA_w3_home_rel')
Categorical_summary(var = KLOSA_w3_home_rel$w03CV007_01, missing_values = NA)
ggplot(KLOSA_w3_home_rel, aes(x=factor(w03CV007_01))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("The relationship between 1st non panel household member") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any variable is in 1:12 then 1`

R code of the ALGORITHM:

```{r harmo3}
KLOSA_ds_w3 <- tibble(id=KLOSA_w3_home_rel$id)

KLOSA_w3_home_rel$w03CV007_01 <- car::recode(as.vector(KLOSA_w3_home_rel$w03CV007_01), "NA='-999'")
KLOSA_w3_home_rel$w03CV007_02 <- car::recode(as.vector(KLOSA_w3_home_rel$w03CV007_02), "NA='-999'")
KLOSA_w3_home_rel$w03CV007_03 <- car::recode(as.vector(KLOSA_w3_home_rel$w03CV007_03), "NA='-999'")
KLOSA_w3_home_rel$w03CV007_04 <- car::recode(as.vector(KLOSA_w3_home_rel$w03CV007_04), "NA='-999'")
KLOSA_w3_home_rel$w03CV007_05 <- car::recode(as.vector(KLOSA_w3_home_rel$w03CV007_05), "NA='-999'")
KLOSA_w3_home_rel$w03CV007_06 <- car::recode(as.vector(KLOSA_w3_home_rel$w03CV007_06), "NA='-999'")
KLOSA_w3_home_rel$w03CV007_07 <- car::recode(as.vector(KLOSA_w3_home_rel$w03CV007_07), "NA='-999'")

KLOSA_ds_w3$home_rel <- c(NA) # I think it is required
for(i in 1:dim(KLOSA_w3_home_rel)[1]){
  if( KLOSA_w3_home_rel$w03CV007_01[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_02[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_03[i] %in% c(1:12) | 
    KLOSA_w3_home_rel$w03CV007_04[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_05[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_06[i] %in% c(1:12) | 
    KLOSA_w3_home_rel$w03CV007_07[i] %in% c(1:12) ) {
  KLOSA_ds_w3$home_rel[i] = 1 }
  else if( KLOSA_w3_home_rel$w03CV007_01[i] == -999 & KLOSA_w3_home_rel$w03CV007_02[i] == -999 & KLOSA_w3_home_rel$w03CV007_03[i] == -999 & 
    KLOSA_w3_home_rel$w03CV007_04[i] == -999 & KLOSA_w3_home_rel$w03CV007_05[i] == -999 & KLOSA_w3_home_rel$w03CV007_06[i] == -999 & 
    KLOSA_w3_home_rel$w03CV007_07[i] == -999 ) {
  KLOSA_ds_w3$home_rel[i] = 999 }
  else if( !( KLOSA_w3_home_rel$w03CV007_01[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_02[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_03[i] %in% c(1:12) | 
    KLOSA_w3_home_rel$w03CV007_04[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_05[i] %in% c(1:12) | KLOSA_w3_home_rel$w03CV007_06[i] %in% c(1:12) | 
    KLOSA_w3_home_rel$w03CV007_07[i] %in% c(1:12) ) ) {
  KLOSA_ds_w3$home_rel[i] = 0 }
}

KLOSA_ds_w3$home_rel <- car::recode(as.vector(KLOSA_ds_w3$home_rel), "NA='999'")
KLOSA_ds_w3$home_rel <- labelled(KLOSA_ds_w3$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript3}
Categorical_summary(var = KLOSA_ds_w3$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(KLOSA_ds_w3, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

##### Validation
```{r crosstabulation3}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### KLOSA - Wave 4

#### Study-specific variables

The study-specific variable elected to be harmonised is:


* Name: `w04CV007_01` UP TO `w04CV007_10`
* Label: `The relationship between 1st non panel household member and a CV respondentr`
* Categories: 
    + `1 = Father/mother`
    + `2 = Father-in-law/Mother-in-law`
    + `3 = spouse`
    + `4 = Son/daughter`
    + `5 = Son-in-law/daughter-in-law`
    + `6 = Brother/sister`
    + `7 = grand child(ren)`
    + `8 = Child of brother/sister`
    + `9 = Brother-in-law/sister-in-law`
    + `10 = Child of brother-in-law/sister-in-law`
    + `11 = Spouse of grandchild`
    + `12 = Great grand child(ren)`
    + `13 = Others`
    

```{r assign4}
opal.assign.table.tibble(o, 'KLOSA_w4_home_rel','KLOSA.w04_main_e_spss', 
                        variables=list('w04CV007_01','w04CV007_02','w04CV007_03','w04CV007_04','w04CV007_05','w04CV007_06',
                                       'w04CV007_07','w04CV007_08','w04CV007_09','w04CV007_10'), missings = TRUE)
```

```{r local4}
KLOSA_w4_home_rel <- opal.execute(o,'KLOSA_w4_home_rel')
Categorical_summary(var = KLOSA_w4_home_rel$w04CV007_01, missing_values = NA)
ggplot(KLOSA_w4_home_rel, aes(x=factor(w04CV007_01))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("The relationship between 1st non panel household member and a CV respondent") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any variable is in 1:12 then 1`

R code of the ALGORITHM:

```{r harmo4}
KLOSA_ds_w4 <- tibble(id=KLOSA_w4_home_rel$id)

KLOSA_w4_home_rel$w04CV007_01 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_01), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_02 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_02), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_03 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_03), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_04 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_04), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_05 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_05), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_06 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_06), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_07 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_07), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_08 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_08), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_09 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_09), "NA='-999'")
KLOSA_w4_home_rel$w04CV007_10 <- car::recode(as.vector(KLOSA_w4_home_rel$w04CV007_10), "NA='-999'")

KLOSA_ds_w4$home_rel <- c(NA) # I think it is required
for(i in 1:dim(KLOSA_w4_home_rel)[1]){
  if( KLOSA_w4_home_rel$w04CV007_01[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_02[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_03[i] %in% c(1:12) | 
    KLOSA_w4_home_rel$w04CV007_04[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_05[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_06[i] %in% c(1:12) | 
    KLOSA_w4_home_rel$w04CV007_07[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_08[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_09[i] %in% c(1:12) |
    KLOSA_w4_home_rel$w04CV007_10[i] %in% c(1:12) ) {
  KLOSA_ds_w4$home_rel[i] = 1 }
  else if( KLOSA_w4_home_rel$w04CV007_01[i] == -999 & KLOSA_w4_home_rel$w04CV007_02[i] == -999 & KLOSA_w4_home_rel$w04CV007_03[i] == -999 & 
    KLOSA_w4_home_rel$w04CV007_04[i] == -999 & KLOSA_w4_home_rel$w04CV007_05[i] == -999 & KLOSA_w4_home_rel$w04CV007_06[i] == -999 & 
    KLOSA_w4_home_rel$w04CV007_07[i] == -999 & KLOSA_w4_home_rel$w04CV007_08[i] == -999 & KLOSA_w4_home_rel$w04CV007_09[i] == -999 &
    KLOSA_w4_home_rel$w04CV007_10[i] == -999 ) {
  KLOSA_ds_w4$home_rel[i] = 999 }
  else if( !( KLOSA_w4_home_rel$w04CV007_01[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_02[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_03[i] %in% c(1:12) | 
    KLOSA_w4_home_rel$w04CV007_04[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_05[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_06[i] %in% c(1:12) | 
    KLOSA_w4_home_rel$w04CV007_07[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_08[i] %in% c(1:12) | KLOSA_w4_home_rel$w04CV007_09[i] %in% c(1:12) |
    KLOSA_w4_home_rel$w04CV007_10[i] %in% c(1:12) ) ) {
  KLOSA_ds_w4$home_rel[i] = 0 }
}

KLOSA_ds_w4$home_rel <- car::recode(as.vector(KLOSA_ds_w4$home_rel), "NA='999'")
KLOSA_ds_w4$home_rel <- labelled(KLOSA_ds_w4$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript4}
Categorical_summary(var = KLOSA_ds_w4$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(KLOSA_ds_w4, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation4}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]
