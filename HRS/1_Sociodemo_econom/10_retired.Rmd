---
title: "Retired"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 
<!-- # Installation, loading packages -->
```{r setup, include=FALSE}
source("../../setup_iago.r")
```
<!-- ########################################################## --> 
<!-- # Loading DS description -->
```{r main, child='../../_DS_Rmd/retiredDS.Rmd'}
```
```{r global, echo=F}
source('../../_DS_Rmd/retiredDS.R')
```



# Data process

```{r age_function}

#function to compute the age
comp_age <- function(y_birth, m_birth, a_year, a_month, miss){
  N <- length(y_birth)
  #first, it's computed the age of all
  age <- rep(NA,N)
  age[which(a_month<m_birth)] <- (a_year[which(a_month<m_birth)]-y_birth[which(a_month<m_birth)])-1
  age[which(a_month>=m_birth)] <- a_year[which(a_month>=m_birth)]-y_birth[which(a_month>=m_birth)]
  age[which(m_birth>900)] <- a_year[which(m_birth>900)]-y_birth[which(m_birth>900)]
  
  #It's emphasized the individues having missing
  
  mis <- rep(0,N)
  for(i in 1:length(miss)){
    mis[which(y_birth==miss[i])] <- miss[i]
  }
  age[which(mis!=0)] <- mis[which(mis!=0)]

  mis <- rep(0,N)
  for(i in 1:length(miss)){
    mis[which(a_year==miss[i])] <- miss[i]
  }
  age[which(mis!=0)] <- mis[which(mis!=0)]
  
  age

}

```

## HRS

### Wave 1

#### Study-specific variable description

| **Name** | `R1SAYRET` | `R1RETMON` | `R1RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R1SAYRET:W1 R considers self retired`| `R1RETMON:W1 Month Retired if say retired` | `R1RETYR:W1 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w1`| `HRS-HRS-w1`| `HRS-HRS-w1`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w1, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w1','HRS.HRS-HRS-w1',variables=list('R1SAYRET','R1RETMON','R1RETYR'), missings = T)
HRS_hrs_w1 <- opal.execute(o,'HRS_hrs_w1')
load(paste0(datafolder,"hrs_w1/mbirth.RData"))
HRS_hrs_w1 <- left_join(HRS_hrs_w1,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w1/ybirth.RData"))
HRS_hrs_w1 <- left_join(HRS_hrs_w1,ybirth,by="id")
rm(ybirth)

```

```{r local hrs_w1, echo=F}

vbl <- HRS_hrs_w1$R1RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R1RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w1,!vbl %in% vbl_miss), aes(R1RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w1$R1RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R1RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w1,!vbl %in% vbl_miss), aes(R1RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w1$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w1,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w1$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w1,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w1$R1SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R1SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w1, aes(x=factor(R1SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `change 0,2 into 0`
* `change 3 into 996`
* `NA into 999`



To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w1}

# Categorical variable harmonization
HRS_ds_hrs_w1 <- tibble(id=HRS_hrs_w1$id)
HRS_ds_hrs_w1$retired <- car::recode(HRS_hrs_w1$R1SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

# Continuous variable harmonization
HRS_hrs_w1$month <- car::recode(HRS_hrs_w1$R1RETMON, "NA = 999")
HRS_hrs_w1$year <- car::recode(HRS_hrs_w1$R1RETYR, "NA = 999")
HRS_ds_hrs_w1$age_retired <- comp_age(y_birth=HRS_hrs_w1$ybirth, m_birth=HRS_hrs_w1$mbirth , a_year=HRS_hrs_w1$year, a_month=HRS_hrs_w1$month, miss=miss_values_vector)
HRS_ds_hrs_w1$age_retired[which(HRS_ds_hrs_w1$retired==0)] <- 996

```


#### Statistics of the new harmonized variable

```{r descript hrs_w1, echo=F}

vbl <- HRS_ds_hrs_w1$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w1, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vbl <- HRS_ds_hrs_w1$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w1,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")

```


#### Validation

```{r crosstabulation hrs_w1, echo=F}








```



### Wave 2

#### Study-specific variable description

| **Name** | `R2SAYRET` | `R2RETMON` | `R2RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R2SAYRET:W2 R considers self retired`| `R2RETMON:W2 Month Retired if say retired` | `R2RETYR:W2 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w2`| `HRS-HRS-w2`| `HRS-HRS-w2`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w2, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w2','HRS.HRS-HRS-w2',variables=list('R2SAYRET','R2RETMON','R2RETYR'), missings = T)
HRS_hrs_w2 <- opal.execute(o,'HRS_hrs_w2')
load(paste0(datafolder,"hrs_w2/mbirth.RData"))
HRS_hrs_w2 <- left_join(HRS_hrs_w2,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w2/ybirth.RData"))
HRS_hrs_w2 <- left_join(HRS_hrs_w2,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w2, echo=F}

vbl <- HRS_hrs_w2$R2RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R2RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w2,!vbl %in% vbl_miss), aes(R2RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w2$R2RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R2RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w2,!vbl %in% vbl_miss), aes(R2RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w2$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w2,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w2$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w2,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w2$R2SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R2SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w2, aes(x=factor(R2SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")








```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `NA into 999`







To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w2}

# Categorical variable harmonization
HRS_ds_hrs_w2 <- tibble(id=HRS_hrs_w2$id)
HRS_ds_hrs_w2$retired <- car::recode(HRS_hrs_w2$R2SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w2 <- left_join(HRS_hrs_w2,HRS_ds_hrs_w1, by="id")
# Continuous variable harmonization
HRS_hrs_w2$month <- car::recode(HRS_hrs_w2$R2RETMON, "NA = 999")
HRS_hrs_w2$year <- car::recode(HRS_hrs_w2$R2RETYR, "NA = 999")
HRS_ds_hrs_w2$age_retired <- comp_age(y_birth=HRS_hrs_w2$ybirth, m_birth=HRS_hrs_w2$mbirth , a_year=HRS_hrs_w2$year, a_month=HRS_hrs_w2$month, miss=miss_values_vector)
HRS_ds_hrs_w2$age_retired[which(HRS_ds_hrs_w2$retired==1 & !is.na(HRS_hrs_w2$age_retired) & !HRS_hrs_w2$age_retired %in% miss_values_vector)] <- HRS_hrs_w2$age_retired[which(HRS_ds_hrs_w2$retired==1 & !is.na(HRS_hrs_w2$age_retired) & !HRS_hrs_w2$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w2$age_retired[which(HRS_ds_hrs_w2$retired==0)] <- 996





```


#### Statistics of the new harmonized variable

```{r descript hrs_w2, echo=F}

vbl <- HRS_ds_hrs_w2$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w2, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")



vbl <- HRS_ds_hrs_w2$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w2,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation hrs_w2, echo=F, results='asis'}








```




### Wave 3

#### Study-specific variable description

| **Name** | `R3SAYRET` | `R3RETMON` | `R3RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R3SAYRET:W3 R considers self retired`| `R3RETMON:W3 Month Retired if say retired` | `R3RETYR:W3 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w3`| `HRS-HRS-w3`| `HRS-HRS-w3`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w3, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w3','HRS.HRS-HRS-w3',variables=list('R3SAYRET','R3RETMON','R3RETYR'), missings = T)
HRS_hrs_w3 <- opal.execute(o,'HRS_hrs_w3')
load(paste0(datafolder,"hrs_w3/mbirth.RData"))
HRS_hrs_w3 <- left_join(HRS_hrs_w3,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w3/ybirth.RData"))
HRS_hrs_w3 <- left_join(HRS_hrs_w3,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w3, echo=F}

vbl <- HRS_hrs_w3$R3RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R3RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w3,!vbl %in% vbl_miss), aes(R3RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w3$R3RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R3RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w3,!vbl %in% vbl_miss), aes(R3RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w3$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w3,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w3$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w3,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w3$R3SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R3SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w3, aes(x=factor(R3SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")






```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w3}

# Categorical variable harmonization
HRS_ds_hrs_w3 <- tibble(id=HRS_hrs_w3$id)
HRS_ds_hrs_w3$retired <- car::recode(HRS_hrs_w3$R3SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w3 <- left_join(HRS_hrs_w3,HRS_ds_hrs_w2, by="id")

# Continuous variable harmonization
HRS_hrs_w3$month <- car::recode(HRS_hrs_w3$R3RETMON, "NA = 999")
HRS_hrs_w3$year <- car::recode(HRS_hrs_w3$R3RETYR, "NA = 999")
HRS_ds_hrs_w3$age_retired <- comp_age(y_birth=HRS_hrs_w3$ybirth, m_birth=HRS_hrs_w3$mbirth , a_year=HRS_hrs_w3$year, a_month=HRS_hrs_w3$month, miss=miss_values_vector)
HRS_ds_hrs_w3$age_retired[which(HRS_ds_hrs_w3$retired==1 & !is.na(HRS_hrs_w3$age_retired) & !HRS_hrs_w3$age_retired %in% miss_values_vector)] <- HRS_hrs_w3$age_retired[which(HRS_ds_hrs_w3$retired==1 & !is.na(HRS_hrs_w3$age_retired) & !HRS_hrs_w3$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w3$age_retired[which(HRS_ds_hrs_w3$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w3, echo=F}

vbl <- HRS_ds_hrs_w3$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w3, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_hrs_w3$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w3,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w3, echo=F, results='asis'}









```




### Wave 4

#### Study-specific variable description

| **Name** | `R4SAYRET` | `R4RETMON` | `R4RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R4SAYRET:W4 R considers self retired`| `R4RETMON:W4 Month Retired if say retired` | `R4RETYR:W4 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w4`| `HRS-HRS-w4`| `HRS-HRS-w4`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w4','HRS.HRS-HRS-w4',variables=list('R4SAYRET','R4RETMON','R4RETYR'), missings = T)
HRS_hrs_w4 <- opal.execute(o,'HRS_hrs_w4')
load(paste0(datafolder,"hrs_w4/mbirth.RData"))
HRS_hrs_w4 <- left_join(HRS_hrs_w4,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w4/ybirth.RData"))
HRS_hrs_w4 <- left_join(HRS_hrs_w4,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w4, echo=F}

vbl <- HRS_hrs_w4$R4RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w4,!vbl %in% vbl_miss), aes(R4RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w4$R4RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w4,!vbl %in% vbl_miss), aes(R4RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w4$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w4,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w4$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w4,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w4$R4SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R4SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w4, aes(x=factor(R4SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")






```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w4}


# Categorical variable harmonization
HRS_ds_hrs_w4 <- tibble(id=HRS_hrs_w4$id)
HRS_ds_hrs_w4$retired <- car::recode(HRS_hrs_w4$R4SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w4 <- left_join(HRS_hrs_w4,HRS_ds_hrs_w3, by="id")

# Continuous variable harmonization
HRS_hrs_w4$month <- car::recode(HRS_hrs_w4$R4RETMON, "NA = 999")
HRS_hrs_w4$year <- car::recode(HRS_hrs_w4$R4RETYR, "NA = 999")
HRS_ds_hrs_w4$age_retired <- comp_age(y_birth=HRS_hrs_w4$ybirth, m_birth=HRS_hrs_w4$mbirth , a_year=HRS_hrs_w4$year, a_month=HRS_hrs_w4$month, miss=miss_values_vector)
HRS_ds_hrs_w4$age_retired[which(HRS_ds_hrs_w4$retired==1 & !is.na(HRS_hrs_w4$age_retired) & !HRS_hrs_w4$age_retired %in% miss_values_vector)] <- HRS_hrs_w4$age_retired[which(HRS_ds_hrs_w4$retired==1 & !is.na(HRS_hrs_w4$age_retired) & !HRS_hrs_w4$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w4$age_retired[which(HRS_ds_hrs_w4$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w4, echo=F}

vbl <- HRS_ds_hrs_w4$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w4, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w4$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w4,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w4, echo=F, results='asis'}









```



### Wave 5

#### Study-specific variable description

| **Name** | `R5SAYRET` | `R5RETMON` | `R5RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R5SAYRET:W5 R considers self retired`| `R5RETMON:W5 Month Retired if say retired` | `R5RETYR:W5 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w5`| `HRS-HRS-w5`| `HRS-HRS-w5`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w5','HRS.HRS-HRS-w5',variables=list('R5SAYRET','R5RETMON','R5RETYR'), missings = T)
HRS_hrs_w5 <- opal.execute(o,'HRS_hrs_w5')
load(paste0(datafolder,"hrs_w5/mbirth.RData"))
HRS_hrs_w5 <- left_join(HRS_hrs_w5,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w5/ybirth.RData"))
HRS_hrs_w5 <- left_join(HRS_hrs_w5,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w5, echo=F}

vbl <- HRS_hrs_w5$R5RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w5,!vbl %in% vbl_miss), aes(R5RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w5$R5RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w5,!vbl %in% vbl_miss), aes(R5RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w5$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w5,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w5$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w5,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w5$R5SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R5SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w5, aes(x=factor(R5SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w5}




# Categorical variable harmonization
HRS_ds_hrs_w5 <- tibble(id=HRS_hrs_w5$id)
HRS_ds_hrs_w5$retired <- car::recode(HRS_hrs_w5$R5SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w5 <- left_join(HRS_hrs_w5,HRS_ds_hrs_w4, by="id")
# Continuous variable harmonization
HRS_hrs_w5$month <- car::recode(HRS_hrs_w5$R5RETMON, "NA = 999")
HRS_hrs_w5$year <- car::recode(HRS_hrs_w5$R5RETYR, "NA = 999")
HRS_ds_hrs_w5$age_retired <- comp_age(y_birth=HRS_hrs_w5$ybirth, m_birth=HRS_hrs_w5$mbirth , a_year=HRS_hrs_w5$year, a_month=HRS_hrs_w5$month, miss=miss_values_vector)
HRS_ds_hrs_w5$age_retired[which(HRS_ds_hrs_w5$retired==1 & !is.na(HRS_hrs_w5$age_retired) & !HRS_hrs_w5$age_retired %in% miss_values_vector)] <- HRS_hrs_w5$age_retired[which(HRS_ds_hrs_w5$retired==1 & !is.na(HRS_hrs_w5$age_retired) & !HRS_hrs_w5$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w5$age_retired[which(HRS_ds_hrs_w5$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w5, echo=F}

vbl <- HRS_ds_hrs_w5$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w5, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w5$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w5,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w5, echo=F, results='asis'}









```



### Wave 6

#### Study-specific variable description

| **Name** | `R6SAYRET` | `R6RETMON` | `R6RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R6SAYRET:W6 R considers self retired`| `R6RETMON:W6 Month Retired if say retired` | `R6RETYR:W6 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w6`| `HRS-HRS-w6`| `HRS-HRS-w6`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w6','HRS.HRS-HRS-w6',variables=list('R6SAYRET','R6RETMON','R6RETYR'), missings = T)
HRS_hrs_w6 <- opal.execute(o,'HRS_hrs_w6')
load(paste0(datafolder,"hrs_w6/mbirth.RData"))
HRS_hrs_w6 <- left_join(HRS_hrs_w6,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w6/ybirth.RData"))
HRS_hrs_w6 <- left_join(HRS_hrs_w6,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w6, echo=F}

vbl <- HRS_hrs_w6$R6RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w6,!vbl %in% vbl_miss), aes(R6RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w6$R6RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w6,!vbl %in% vbl_miss), aes(R6RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w6$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w6,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w6$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w6,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w6$R6SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R6SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w6, aes(x=factor(R6SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w6}




# Categorical variable harmonization
HRS_ds_hrs_w6 <- tibble(id=HRS_hrs_w6$id)
HRS_ds_hrs_w6$retired <- car::recode(HRS_hrs_w6$R6SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w6 <- left_join(HRS_hrs_w6,HRS_ds_hrs_w5, by="id")
# Continuous variable harmonization
HRS_hrs_w6$month <- car::recode(HRS_hrs_w6$R6RETMON, "NA = 999")
HRS_hrs_w6$year <- car::recode(HRS_hrs_w6$R6RETYR, "NA = 999")
HRS_ds_hrs_w6$age_retired <- comp_age(y_birth=HRS_hrs_w6$ybirth, m_birth=HRS_hrs_w6$mbirth , a_year=HRS_hrs_w6$year, a_month=HRS_hrs_w6$month, miss=miss_values_vector)
HRS_ds_hrs_w6$age_retired[which(HRS_ds_hrs_w6$retired==1 & !is.na(HRS_hrs_w6$age_retired) & !HRS_hrs_w6$age_retired %in% miss_values_vector)] <- HRS_hrs_w6$age_retired[which(HRS_ds_hrs_w6$retired==1 & !is.na(HRS_hrs_w6$age_retired) & !HRS_hrs_w6$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w6$age_retired[which(HRS_ds_hrs_w6$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w6, echo=F}

vbl <- HRS_ds_hrs_w6$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w6, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w6$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w6,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w6, echo=F, results='asis'}









```




### Wave 7

#### Study-specific variable description

| **Name** | `R7SAYRET` | `R7RETMON` | `R7RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R7SAYRET:W7 R considers self retired`| `R7RETMON:W7 Month Retired if say retired` | `R7RETYR:W7 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w7`| `HRS-HRS-w7`| `HRS-HRS-w7`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w7','HRS.HRS-HRS-w7',variables=list('R7SAYRET','R7RETMON','R7RETYR'), missings = T)
HRS_hrs_w7 <- opal.execute(o,'HRS_hrs_w7')
load(paste0(datafolder,"hrs_w7/mbirth.RData"))
HRS_hrs_w7 <- left_join(HRS_hrs_w7,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w7/ybirth.RData"))
HRS_hrs_w7 <- left_join(HRS_hrs_w7,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w7, echo=F}

vbl <- HRS_hrs_w7$R7RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w7,!vbl %in% vbl_miss), aes(R7RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w7$R7RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w7,!vbl %in% vbl_miss), aes(R7RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w7$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w7,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w7$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w7,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w7$R7SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R7SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w7, aes(x=factor(R7SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w7}




# Categorical variable harmonization
HRS_ds_hrs_w7 <- tibble(id=HRS_hrs_w7$id)
HRS_ds_hrs_w7$retired <- car::recode(HRS_hrs_w7$R7SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w7 <- left_join(HRS_hrs_w7,HRS_ds_hrs_w6, by="id")
# Continuous variable harmonization
HRS_hrs_w7$month <- car::recode(HRS_hrs_w7$R7RETMON, "NA = 999")
HRS_hrs_w7$year <- car::recode(HRS_hrs_w7$R7RETYR, "NA = 999")
HRS_ds_hrs_w7$age_retired <- comp_age(y_birth=HRS_hrs_w7$ybirth, m_birth=HRS_hrs_w7$mbirth , a_year=HRS_hrs_w7$year, a_month=HRS_hrs_w7$month, miss=miss_values_vector)
HRS_ds_hrs_w7$age_retired[which(HRS_ds_hrs_w7$retired==1 & !is.na(HRS_hrs_w7$age_retired) & !HRS_hrs_w7$age_retired %in% miss_values_vector)] <- HRS_hrs_w7$age_retired[which(HRS_ds_hrs_w7$retired==1 & !is.na(HRS_hrs_w7$age_retired) & !HRS_hrs_w7$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w7$age_retired[which(HRS_ds_hrs_w7$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript hrs_w7, echo=F}

vbl <- HRS_ds_hrs_w7$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w7, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w7$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w7,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w7, echo=F, results='asis'}









```



### Wave 8

#### Study-specific variable description

| **Name** | `R8SAYRET` | `R8RETMON` | `R8RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R8SAYRET:W8 R considers self retired`| `R8RETMON:W8 Month Retired if say retired` | `R8RETYR:W8 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w8`| `HRS-HRS-w8`| `HRS-HRS-w8`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w8','HRS.HRS-HRS-w8',variables=list('R8SAYRET','R8RETMON','R8RETYR'), missings = T)
HRS_hrs_w8 <- opal.execute(o,'HRS_hrs_w8')
load(paste0(datafolder,"hrs_w8/mbirth.RData"))
HRS_hrs_w8 <- left_join(HRS_hrs_w8,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w8/ybirth.RData"))
HRS_hrs_w8 <- left_join(HRS_hrs_w8,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w8, echo=F}

vbl <- HRS_hrs_w8$R8RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w8,!vbl %in% vbl_miss), aes(R8RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w8$R8RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w8,!vbl %in% vbl_miss), aes(R8RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w8$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w8,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w8$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w8,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w8$R8SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R8SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w8, aes(x=factor(R8SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w8}




# Categorical variable harmonization
HRS_ds_hrs_w8 <- tibble(id=HRS_hrs_w8$id)
HRS_ds_hrs_w8$retired <- car::recode(HRS_hrs_w8$R8SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w8 <- left_join(HRS_hrs_w8,HRS_ds_hrs_w7, by="id")
# Continuous variable harmonization
HRS_hrs_w8$month <- car::recode(HRS_hrs_w8$R8RETMON, "NA = 999")
HRS_hrs_w8$year <- car::recode(HRS_hrs_w8$R8RETYR, "NA = 999")
HRS_ds_hrs_w8$age_retired <- comp_age(y_birth=HRS_hrs_w8$ybirth, m_birth=HRS_hrs_w8$mbirth , a_year=HRS_hrs_w8$year, a_month=HRS_hrs_w8$month, miss=miss_values_vector)
HRS_ds_hrs_w8$age_retired[which(HRS_ds_hrs_w8$retired==1 & !is.na(HRS_hrs_w8$age_retired) & !HRS_hrs_w8$age_retired %in% miss_values_vector)] <- HRS_hrs_w8$age_retired[which(HRS_ds_hrs_w8$retired==1 & !is.na(HRS_hrs_w8$age_retired) & !HRS_hrs_w8$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w8$age_retired[which(HRS_ds_hrs_w8$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w8, echo=F}

vbl <- HRS_ds_hrs_w8$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w8, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w8$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w8,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w8, echo=F, results='asis'}









```



### Wave 9

#### Study-specific variable description

| **Name** | `R9SAYRET` | `R9RETMON` | `R9RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R9SAYRET:W9 R considers self retired`| `R9RETMON:W9 Month Retired if say retired` | `R9RETYR:W9 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w9`| `HRS-HRS-w9`| `HRS-HRS-w9`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w9','HRS.HRS-HRS-w9',variables=list('R9SAYRET','R9RETMON','R9RETYR'), missings = T)
HRS_hrs_w9 <- opal.execute(o,'HRS_hrs_w9')
load(paste0(datafolder,"hrs_w9/mbirth.RData"))
HRS_hrs_w9 <- left_join(HRS_hrs_w9,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w9/ybirth.RData"))
HRS_hrs_w9 <- left_join(HRS_hrs_w9,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w9, echo=F}

vbl <- HRS_hrs_w9$R9RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w9,!vbl %in% vbl_miss), aes(R9RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w9$R9RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w9,!vbl %in% vbl_miss), aes(R9RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w9$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w9,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w9$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w9,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w9$R9SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R9SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w9, aes(x=factor(R9SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w9}




# Categorical variable harmonization
HRS_ds_hrs_w9 <- tibble(id=HRS_hrs_w9$id)
HRS_ds_hrs_w9$retired <- car::recode(HRS_hrs_w9$R9SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w9 <- left_join(HRS_hrs_w9,HRS_ds_hrs_w8, by="id")
# Continuous variable harmonization
HRS_hrs_w9$month <- car::recode(HRS_hrs_w9$R9RETMON, "NA = 999")
HRS_hrs_w9$year <- car::recode(HRS_hrs_w9$R9RETYR, "NA = 999")
HRS_ds_hrs_w9$age_retired <- comp_age(y_birth=HRS_hrs_w9$ybirth, m_birth=HRS_hrs_w9$mbirth , a_year=HRS_hrs_w9$year, a_month=HRS_hrs_w9$month, miss=miss_values_vector)
HRS_ds_hrs_w9$age_retired[which(HRS_ds_hrs_w9$retired==1 & !is.na(HRS_hrs_w9$age_retired) & !HRS_hrs_w9$age_retired %in% miss_values_vector)] <- HRS_hrs_w9$age_retired[which(HRS_ds_hrs_w9$retired==1 & !is.na(HRS_hrs_w9$age_retired) & !HRS_hrs_w9$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w9$age_retired[which(HRS_ds_hrs_w9$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w9, echo=F}

vbl <- HRS_ds_hrs_w9$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w9, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w9$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w9,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w9, echo=F, results='asis'}









```




### Wave 10

#### Study-specific variable description

| **Name** | `R10SAYRET` | `R10RETMON` | `R10RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R10SAYRET:W10 R considers self retired`| `R10RETMON:W10 Month Retired if say retired` | `R10RETYR:W10 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w10`| `HRS-HRS-w10`| `HRS-HRS-w10`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w10','HRS.HRS-HRS-w10',variables=list('R10SAYRET','R10RETMON','R10RETYR'), missings = T)
HRS_hrs_w10 <- opal.execute(o,'HRS_hrs_w10')
load(paste0(datafolder,"hrs_w10/mbirth.RData"))
HRS_hrs_w10 <- left_join(HRS_hrs_w10,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w10/ybirth.RData"))
HRS_hrs_w10 <- left_join(HRS_hrs_w10,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w10, echo=F}

vbl <- HRS_hrs_w10$R10RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w10,!vbl %in% vbl_miss), aes(R10RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w10$R10RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w10,!vbl %in% vbl_miss), aes(R10RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w10$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w10,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w10$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w10,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w10$R10SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R10SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w10, aes(x=factor(R10SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w10}




# Categorical variable harmonization
HRS_ds_hrs_w10 <- tibble(id=HRS_hrs_w10$id)
HRS_ds_hrs_w10$retired <- car::recode(HRS_hrs_w10$R10SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w10 <- left_join(HRS_hrs_w10,HRS_ds_hrs_w9, by="id")
# Continuous variable harmonization
HRS_hrs_w10$month <- car::recode(HRS_hrs_w10$R10RETMON, "NA = 999")
HRS_hrs_w10$year <- car::recode(HRS_hrs_w10$R10RETYR, "NA = 999")
HRS_ds_hrs_w10$age_retired <- comp_age(y_birth=HRS_hrs_w10$ybirth, m_birth=HRS_hrs_w10$mbirth , a_year=HRS_hrs_w10$year, a_month=HRS_hrs_w10$month, miss=miss_values_vector)
HRS_ds_hrs_w10$age_retired[which(HRS_ds_hrs_w10$retired==1 & !is.na(HRS_hrs_w10$age_retired) & !HRS_hrs_w10$age_retired %in% miss_values_vector)] <- HRS_hrs_w10$age_retired[which(HRS_ds_hrs_w10$retired==1 & !is.na(HRS_hrs_w10$age_retired) & !HRS_hrs_w10$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w10$age_retired[which(HRS_ds_hrs_w10$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w10, echo=F}

vbl <- HRS_ds_hrs_w10$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w10, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w10$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w10,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w10, echo=F, results='asis'}









```



### Wave 11

#### Study-specific variable description

| **Name** | `R11SAYRET` | `R11RETMON` | `R11RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R11SAYRET:W11 R considers self retired`| `R11RETMON:W11 Month Retired if say retired` | `R11RETYR:W11 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-HRS-w11`| `HRS-HRS-w11`| `HRS-HRS-w11`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign hrs_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w11','HRS.HRS-HRS-w11',variables=list('R11SAYRET','R11RETMON','R11RETYR'), missings = T)
HRS_hrs_w11 <- opal.execute(o,'HRS_hrs_w11')
load(paste0(datafolder,"hrs_w11/mbirth.RData"))
HRS_hrs_w11 <- left_join(HRS_hrs_w11,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"hrs_w11/ybirth.RData"))
HRS_hrs_w11 <- left_join(HRS_hrs_w11,ybirth,by="id")
rm(ybirth)












```

```{r local hrs_w11, echo=F}

vbl <- HRS_hrs_w11$R11RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w11,!vbl %in% vbl_miss), aes(R11RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w11$R11RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w11,!vbl %in% vbl_miss), aes(R11RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w11$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w11,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_hrs_w11$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_hrs_w11,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_hrs_w11$R11SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R11SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w11, aes(x=factor(R11SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo hrs_w11}




# Categorical variable harmonization
HRS_ds_hrs_w11 <- tibble(id=HRS_hrs_w11$id)
HRS_ds_hrs_w11$retired <- car::recode(HRS_hrs_w11$R11SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_hrs_w11 <- left_join(HRS_hrs_w11,HRS_ds_hrs_w10, by="id")
# Continuous variable harmonization
HRS_hrs_w11$month <- car::recode(HRS_hrs_w11$R11RETMON, "NA = 999")
HRS_hrs_w11$year <- car::recode(HRS_hrs_w11$R11RETYR, "NA = 999")
HRS_ds_hrs_w11$age_retired <- comp_age(y_birth=HRS_hrs_w11$ybirth, m_birth=HRS_hrs_w11$mbirth , a_year=HRS_hrs_w11$year, a_month=HRS_hrs_w11$month, miss=miss_values_vector)
HRS_ds_hrs_w11$age_retired[which(HRS_ds_hrs_w11$retired==1 & !is.na(HRS_hrs_w11$age_retired) & !HRS_hrs_w11$age_retired %in% miss_values_vector)] <- HRS_hrs_w11$age_retired[which(HRS_ds_hrs_w11$retired==1 & !is.na(HRS_hrs_w11$age_retired) & !HRS_hrs_w11$age_retired %in% miss_values_vector)]
HRS_ds_hrs_w11$age_retired[which(HRS_ds_hrs_w11$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript hrs_w11, echo=F}

vbl <- HRS_ds_hrs_w11$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w11, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_hrs_w11$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_hrs_w11,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation hrs_w11, echo=F, results='asis'}









```



## AHEAD


### Wave 2

#### Study-specific variable description

| **Name** | `R2SAYRET` | `R2RETMON` | `R2RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R2SAYRET:W2 R considers self retired`| `R2RETMON:W2 Month Retired if say retired` | `R2RETYR:W2 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w2`| `HRS-AHEAD-w2`| `HRS-AHEAD-w2`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w2, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w2','HRS.HRS-AHEAD-w2',variables=list('R2SAYRET','R2RETMON','R2RETYR'), missings = T)
HRS_ahead_w2 <- opal.execute(o,'HRS_ahead_w2')
load(paste0(datafolder,"ahead_w2/mbirth.RData"))
HRS_ahead_w2 <- left_join(HRS_ahead_w2,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w2/ybirth.RData"))
HRS_ahead_w2 <- left_join(HRS_ahead_w2,ybirth,by="id")
rm(ybirth)

```

```{r local ahead_w2, echo=F}

vbl <- HRS_ahead_w2$R2RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R2RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w2,!vbl %in% vbl_miss), aes(R2RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w2$R2RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R2RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w2,!vbl %in% vbl_miss), aes(R2RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w2$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w2,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w2$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w2,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w2$R2SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R2SAYRET')
#kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w2, aes(x=factor(R2SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `change 0,2 into 0`
* `change 3 into 996`
* `NA into 999`

Since  in this wave and population the variable `R2SAYRET` is missing,, we harmonize `retired` as follows:

* `if R2RETYR is no missing, retired = 1`
* `otherwise, retired = 999`


To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w2}

# Categorical variable harmonization
HRS_ds_ahead_w2 <- tibble(id=HRS_ahead_w2$id)
# HRS_ds_ahead_w2$retired <- car::recode(HRS_ahead_w2$R2SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")
HRS_ds_ahead_w2$retired <- rep(999,length((HRS_ahead_w2$id)))
HRS_ds_ahead_w2$retired[which(!is.na(HRS_ahead_w2$R2RETYR))] <- 1

# Continuous variable harmonization
HRS_ahead_w2$month <- car::recode(HRS_ahead_w2$R2RETMON, "NA = 999")
HRS_ahead_w2$year <- car::recode(HRS_ahead_w2$R2RETYR, "NA = 999")
HRS_ds_ahead_w2$age_retired <- comp_age(y_birth=HRS_ahead_w2$ybirth, m_birth=HRS_ahead_w2$mbirth , a_year=HRS_ahead_w2$year, a_month=HRS_ahead_w2$month, miss=miss_values_vector)
HRS_ds_ahead_w2$age_retired[which(HRS_ds_ahead_w2$retired==0)] <- 996


```


#### Statistics of the new harmonized variable

```{r descript ahead_w2, echo=F}

vbl <- HRS_ds_ahead_w2$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w2, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")


vbl <- HRS_ds_ahead_w2$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w2,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")


```


#### Validation

```{r crosstabulation ahead_w2, echo=F}








```



### Wave 3

#### Study-specific variable description

| **Name** | `R3SAYRET` | `R3RETMON` | `R3RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R3SAYRET:W3 R considers self retired`| `R3RETMON:W3 Month Retired if say retired` | `R3RETYR:W3 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w3`| `HRS-AHEAD-w3`| `HRS-AHEAD-w3`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w3, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w3','HRS.HRS-AHEAD-w3',variables=list('R3SAYRET','R3RETMON','R3RETYR'), missings = T)
HRS_ahead_w3 <- opal.execute(o,'HRS_ahead_w3')
load(paste0(datafolder,"ahead_w3/mbirth.RData"))
HRS_ahead_w3 <- left_join(HRS_ahead_w3,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w3/ybirth.RData"))
HRS_ahead_w3 <- left_join(HRS_ahead_w3,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w3, echo=F}

vbl <- HRS_ahead_w3$R3RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R3RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w3,!vbl %in% vbl_miss), aes(R3RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w3$R3RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R3RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w3,!vbl %in% vbl_miss), aes(R3RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w3$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w3,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w3$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w3,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w3$R3SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R3SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w3, aes(x=factor(R3SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`







To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w3}




# Categorical variable harmonization
HRS_ds_ahead_w3 <- tibble(id=HRS_ahead_w3$id)
HRS_ds_ahead_w3$retired <- car::recode(HRS_ahead_w3$R3SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w3 <- left_join(HRS_ahead_w3,HRS_ds_ahead_w2, by="id")
# Continuous variable harmonization
HRS_ahead_w3$month <- car::recode(HRS_ahead_w3$R3RETMON, "NA = 999")
HRS_ahead_w3$year <- car::recode(HRS_ahead_w3$R3RETYR, "NA = 999")
HRS_ds_ahead_w3$age_retired <- comp_age(y_birth=HRS_ahead_w3$ybirth, m_birth=HRS_ahead_w3$mbirth , a_year=HRS_ahead_w3$year, a_month=HRS_ahead_w3$month, miss=miss_values_vector)
HRS_ds_ahead_w3$age_retired[which(HRS_ds_ahead_w3$retired==1 & !is.na(HRS_ahead_w3$age_retired) & !HRS_ahead_w3$age_retired %in% miss_values_vector)] <- HRS_ahead_w3$age_retired[which(HRS_ds_ahead_w3$retired==1 & !is.na(HRS_ahead_w3$age_retired) & !HRS_ahead_w3$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w3$age_retired[which(HRS_ds_ahead_w3$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript ahead_w3, echo=F}

vbl <- HRS_ds_ahead_w3$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w3, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ahead_w3$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w3,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ahead_w3, echo=F, results='asis'}









```




### Wave 4

#### Study-specific variable description

| **Name** | `R4SAYRET` | `R4RETMON` | `R4RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R4SAYRET:W4 R considers self retired`| `R4RETMON:W4 Month Retired if say retired` | `R4RETYR:W4 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w4`| `HRS-AHEAD-w4`| `HRS-AHEAD-w4`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w4','HRS.HRS-AHEAD-w4',variables=list('R4SAYRET','R4RETMON','R4RETYR'), missings = T)
HRS_ahead_w4 <- opal.execute(o,'HRS_ahead_w4')
load(paste0(datafolder,"ahead_w4/mbirth.RData"))
HRS_ahead_w4 <- left_join(HRS_ahead_w4,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w4/ybirth.RData"))
HRS_ahead_w4 <- left_join(HRS_ahead_w4,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w4, echo=F}

vbl <- HRS_ahead_w4$R4RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w4,!vbl %in% vbl_miss), aes(R4RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w4$R4RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w4,!vbl %in% vbl_miss), aes(R4RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w4$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w4,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w4$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w4,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w4$R4SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R4SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w4, aes(x=factor(R4SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w4}




# Categorical variable harmonization
HRS_ds_ahead_w4 <- tibble(id=HRS_ahead_w4$id)
HRS_ds_ahead_w4$retired <- car::recode(HRS_ahead_w4$R4SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w4 <- left_join(HRS_ahead_w4,HRS_ds_ahead_w3, by="id")
# Continuous variable harmonization
HRS_ahead_w4$month <- car::recode(HRS_ahead_w4$R4RETMON, "NA = 999")
HRS_ahead_w4$year <- car::recode(HRS_ahead_w4$R4RETYR, "NA = 999")
HRS_ds_ahead_w4$age_retired <- comp_age(y_birth=HRS_ahead_w4$ybirth, m_birth=HRS_ahead_w4$mbirth , a_year=HRS_ahead_w4$year, a_month=HRS_ahead_w4$month, miss=miss_values_vector)
HRS_ds_ahead_w4$age_retired[which(HRS_ds_ahead_w4$retired==1 & !is.na(HRS_ahead_w4$age_retired) & !HRS_ahead_w4$age_retired %in% miss_values_vector)] <- HRS_ahead_w4$age_retired[which(HRS_ds_ahead_w4$retired==1 & !is.na(HRS_ahead_w4$age_retired) & !HRS_ahead_w4$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w4$age_retired[which(HRS_ds_ahead_w4$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ahead_w4, echo=F}

vbl <- HRS_ds_ahead_w4$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w4, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ahead_w4$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w4,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ahead_w4, echo=F, results='asis'}









```




### Wave 5

#### Study-specific variable description

| **Name** | `R5SAYRET` | `R5RETMON` | `R5RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R5SAYRET:W5 R considers self retired`| `R5RETMON:W5 Month Retired if say retired` | `R5RETYR:W5 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w5`| `HRS-AHEAD-w5`| `HRS-AHEAD-w5`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w5','HRS.HRS-AHEAD-w5',variables=list('R5SAYRET','R5RETMON','R5RETYR'), missings = T)
HRS_ahead_w5 <- opal.execute(o,'HRS_ahead_w5')
load(paste0(datafolder,"ahead_w5/mbirth.RData"))
HRS_ahead_w5 <- left_join(HRS_ahead_w5,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w5/ybirth.RData"))
HRS_ahead_w5 <- left_join(HRS_ahead_w5,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w5, echo=F}

vbl <- HRS_ahead_w5$R5RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w5,!vbl %in% vbl_miss), aes(R5RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w5$R5RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w5,!vbl %in% vbl_miss), aes(R5RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w5$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w5,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w5$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w5,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w5$R5SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R5SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w5, aes(x=factor(R5SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w5}




# Categorical variable harmonization
HRS_ds_ahead_w5 <- tibble(id=HRS_ahead_w5$id)
HRS_ds_ahead_w5$retired <- car::recode(HRS_ahead_w5$R5SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w5 <- left_join(HRS_ahead_w5,HRS_ds_ahead_w4, by="id")
# Continuous variable harmonization
HRS_ahead_w5$month <- car::recode(HRS_ahead_w5$R5RETMON, "NA = 999")
HRS_ahead_w5$year <- car::recode(HRS_ahead_w5$R5RETYR, "NA = 999")
HRS_ds_ahead_w5$age_retired <- comp_age(y_birth=HRS_ahead_w5$ybirth, m_birth=HRS_ahead_w5$mbirth , a_year=HRS_ahead_w5$year, a_month=HRS_ahead_w5$month, miss=miss_values_vector)
HRS_ds_ahead_w5$age_retired[which(HRS_ds_ahead_w5$retired==1 & !is.na(HRS_ahead_w5$age_retired) & !HRS_ahead_w5$age_retired %in% miss_values_vector)] <- HRS_ahead_w5$age_retired[which(HRS_ds_ahead_w5$retired==1 & !is.na(HRS_ahead_w5$age_retired) & !HRS_ahead_w5$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w5$age_retired[which(HRS_ds_ahead_w5$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript ahead_w5, echo=F}

vbl <- HRS_ds_ahead_w5$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w5, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")






vbl <- HRS_ds_ahead_w5$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w5,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")




```


#### Validation

```{r crosstabulation ahead_w5, echo=F, results='asis'}









```



### Wave 6

#### Study-specific variable description

| **Name** | `R6SAYRET` | `R6RETMON` | `R6RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R6SAYRET:W6 R considers self retired`| `R6RETMON:W6 Month Retired if say retired` | `R6RETYR:W6 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w6`| `HRS-AHEAD-w6`| `HRS-AHEAD-w6`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w6','HRS.HRS-AHEAD-w6',variables=list('R6SAYRET','R6RETMON','R6RETYR'), missings = T)
HRS_ahead_w6 <- opal.execute(o,'HRS_ahead_w6')
load(paste0(datafolder,"ahead_w6/mbirth.RData"))
HRS_ahead_w6 <- left_join(HRS_ahead_w6,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w6/ybirth.RData"))
HRS_ahead_w6 <- left_join(HRS_ahead_w6,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w6, echo=F}

vbl <- HRS_ahead_w6$R6RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w6,!vbl %in% vbl_miss), aes(R6RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w6$R6RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w6,!vbl %in% vbl_miss), aes(R6RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w6$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w6,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w6$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w6,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w6$R6SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R6SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w6, aes(x=factor(R6SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w6}




# Categorical variable harmonization
HRS_ds_ahead_w6 <- tibble(id=HRS_ahead_w6$id)
HRS_ds_ahead_w6$retired <- car::recode(HRS_ahead_w6$R6SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w6 <- left_join(HRS_ahead_w6,HRS_ds_ahead_w5, by="id")
# Continuous variable harmonization
HRS_ahead_w6$month <- car::recode(HRS_ahead_w6$R6RETMON, "NA = 999")
HRS_ahead_w6$year <- car::recode(HRS_ahead_w6$R6RETYR, "NA = 999")
HRS_ds_ahead_w6$age_retired <- comp_age(y_birth=HRS_ahead_w6$ybirth, m_birth=HRS_ahead_w6$mbirth , a_year=HRS_ahead_w6$year, a_month=HRS_ahead_w6$month, miss=miss_values_vector)
HRS_ds_ahead_w6$age_retired[which(HRS_ds_ahead_w6$retired==1 & !is.na(HRS_ahead_w6$age_retired) & !HRS_ahead_w6$age_retired %in% miss_values_vector)] <- HRS_ahead_w6$age_retired[which(HRS_ds_ahead_w6$retired==1 & !is.na(HRS_ahead_w6$age_retired) & !HRS_ahead_w6$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w6$age_retired[which(HRS_ds_ahead_w6$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ahead_w6, echo=F}

vbl <- HRS_ds_ahead_w6$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w6, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_ahead_w6$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w6,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation ahead_w6, echo=F, results='asis'}









```



### Wave 7

#### Study-specific variable description

| **Name** | `R7SAYRET` | `R7RETMON` | `R7RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R7SAYRET:W7 R considers self retired`| `R7RETMON:W7 Month Retired if say retired` | `R7RETYR:W7 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w7`| `HRS-AHEAD-w7`| `HRS-AHEAD-w7`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w7','HRS.HRS-AHEAD-w7',variables=list('R7SAYRET','R7RETMON','R7RETYR'), missings = T)
HRS_ahead_w7 <- opal.execute(o,'HRS_ahead_w7')
load(paste0(datafolder,"ahead_w7/mbirth.RData"))
HRS_ahead_w7 <- left_join(HRS_ahead_w7,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w7/ybirth.RData"))
HRS_ahead_w7 <- left_join(HRS_ahead_w7,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w7, echo=F}

vbl <- HRS_ahead_w7$R7RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w7,!vbl %in% vbl_miss), aes(R7RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w7$R7RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w7,!vbl %in% vbl_miss), aes(R7RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w7$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w7,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w7$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w7,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w7$R7SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R7SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w7, aes(x=factor(R7SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")



```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w7}




# Categorical variable harmonization
HRS_ds_ahead_w7 <- tibble(id=HRS_ahead_w7$id)
HRS_ds_ahead_w7$retired <- car::recode(HRS_ahead_w7$R7SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w7 <- left_join(HRS_ahead_w7,HRS_ds_ahead_w6, by="id")
# Continuous variable harmonization
HRS_ahead_w7$month <- car::recode(HRS_ahead_w7$R7RETMON, "NA = 999")
HRS_ahead_w7$year <- car::recode(HRS_ahead_w7$R7RETYR, "NA = 999")
HRS_ds_ahead_w7$age_retired <- comp_age(y_birth=HRS_ahead_w7$ybirth, m_birth=HRS_ahead_w7$mbirth , a_year=HRS_ahead_w7$year, a_month=HRS_ahead_w7$month, miss=miss_values_vector)
HRS_ds_ahead_w7$age_retired[which(HRS_ds_ahead_w7$retired==1 & !is.na(HRS_ahead_w7$age_retired) & !HRS_ahead_w7$age_retired %in% miss_values_vector)] <- HRS_ahead_w7$age_retired[which(HRS_ds_ahead_w7$retired==1 & !is.na(HRS_ahead_w7$age_retired) & !HRS_ahead_w7$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w7$age_retired[which(HRS_ds_ahead_w7$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript ahead_w7, echo=F}

vbl <- HRS_ds_ahead_w7$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w7, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ahead_w7$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w7,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ahead_w7, echo=F, results='asis'}









```




### Wave 8

#### Study-specific variable description

| **Name** | `R8SAYRET` | `R8RETMON` | `R8RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R8SAYRET:W8 R considers self retired`| `R8RETMON:W8 Month Retired if say retired` | `R8RETYR:W8 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w8`| `HRS-AHEAD-w8`| `HRS-AHEAD-w8`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w8','HRS.HRS-AHEAD-w8',variables=list('R8SAYRET','R8RETMON','R8RETYR'), missings = T)
HRS_ahead_w8 <- opal.execute(o,'HRS_ahead_w8')
load(paste0(datafolder,"ahead_w8/mbirth.RData"))
HRS_ahead_w8 <- left_join(HRS_ahead_w8,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w8/ybirth.RData"))
HRS_ahead_w8 <- left_join(HRS_ahead_w8,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w8, echo=F}

vbl <- HRS_ahead_w8$R8RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w8,!vbl %in% vbl_miss), aes(R8RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w8$R8RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w8,!vbl %in% vbl_miss), aes(R8RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w8$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w8,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w8$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w8,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w8$R8SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R8SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w8, aes(x=factor(R8SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")



```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w8}




# Categorical variable harmonization
HRS_ds_ahead_w8 <- tibble(id=HRS_ahead_w8$id)
HRS_ds_ahead_w8$retired <- car::recode(HRS_ahead_w8$R8SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w8 <- left_join(HRS_ahead_w8,HRS_ds_ahead_w7, by="id")
# Continuous variable harmonization
HRS_ahead_w8$month <- car::recode(HRS_ahead_w8$R8RETMON, "NA = 999")
HRS_ahead_w8$year <- car::recode(HRS_ahead_w8$R8RETYR, "NA = 999")
HRS_ds_ahead_w8$age_retired <- comp_age(y_birth=HRS_ahead_w8$ybirth, m_birth=HRS_ahead_w8$mbirth , a_year=HRS_ahead_w8$year, a_month=HRS_ahead_w8$month, miss=miss_values_vector)
HRS_ds_ahead_w8$age_retired[which(HRS_ds_ahead_w8$retired==1 & !is.na(HRS_ahead_w8$age_retired) & !HRS_ahead_w8$age_retired %in% miss_values_vector)] <- HRS_ahead_w8$age_retired[which(HRS_ds_ahead_w8$retired==1 & !is.na(HRS_ahead_w8$age_retired) & !HRS_ahead_w8$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w8$age_retired[which(HRS_ds_ahead_w8$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript ahead_w8, echo=F}

vbl <- HRS_ds_ahead_w8$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w8, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ahead_w8$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w8,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ahead_w8, echo=F, results='asis'}









```



### Wave 9

#### Study-specific variable description

| **Name** | `R9SAYRET` | `R9RETMON` | `R9RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R9SAYRET:W9 R considers self retired`| `R9RETMON:W9 Month Retired if say retired` | `R9RETYR:W9 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w9`| `HRS-AHEAD-w9`| `HRS-AHEAD-w9`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w9','HRS.HRS-AHEAD-w9',variables=list('R9SAYRET','R9RETMON','R9RETYR'), missings = T)
HRS_ahead_w9 <- opal.execute(o,'HRS_ahead_w9')
load(paste0(datafolder,"ahead_w9/mbirth.RData"))
HRS_ahead_w9 <- left_join(HRS_ahead_w9,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w9/ybirth.RData"))
HRS_ahead_w9 <- left_join(HRS_ahead_w9,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w9, echo=F}

vbl <- HRS_ahead_w9$R9RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w9,!vbl %in% vbl_miss), aes(R9RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w9$R9RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w9,!vbl %in% vbl_miss), aes(R9RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w9$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w9,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w9$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w9,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w9$R9SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R9SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w9, aes(x=factor(R9SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w9}




# Categorical variable harmonization
HRS_ds_ahead_w9 <- tibble(id=HRS_ahead_w9$id)
HRS_ds_ahead_w9$retired <- car::recode(HRS_ahead_w9$R9SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w9 <- left_join(HRS_ahead_w9,HRS_ds_ahead_w8, by="id")
# Continuous variable harmonization
HRS_ahead_w9$month <- car::recode(HRS_ahead_w9$R9RETMON, "NA = 999")
HRS_ahead_w9$year <- car::recode(HRS_ahead_w9$R9RETYR, "NA = 999")
HRS_ds_ahead_w9$age_retired <- comp_age(y_birth=HRS_ahead_w9$ybirth, m_birth=HRS_ahead_w9$mbirth , a_year=HRS_ahead_w9$year, a_month=HRS_ahead_w9$month, miss=miss_values_vector)
HRS_ds_ahead_w9$age_retired[which(HRS_ds_ahead_w9$retired==1 & !is.na(HRS_ahead_w9$age_retired) & !HRS_ahead_w9$age_retired %in% miss_values_vector)] <- HRS_ahead_w9$age_retired[which(HRS_ds_ahead_w9$retired==1 & !is.na(HRS_ahead_w9$age_retired) & !HRS_ahead_w9$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w9$age_retired[which(HRS_ds_ahead_w9$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ahead_w9, echo=F}

vbl <- HRS_ds_ahead_w9$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w9, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ahead_w9$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w9,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ahead_w9, echo=F, results='asis'}









```



### Wave 10

#### Study-specific variable description

| **Name** | `R10SAYRET` | `R10RETMON` | `R10RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R10SAYRET:W10 R considers self retired`| `R10RETMON:W10 Month Retired if say retired` | `R10RETYR:W10 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w10`| `HRS-AHEAD-w10`| `HRS-AHEAD-w10`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w10','HRS.HRS-AHEAD-w10',variables=list('R10SAYRET','R10RETMON','R10RETYR'), missings = T)
HRS_ahead_w10 <- opal.execute(o,'HRS_ahead_w10')
load(paste0(datafolder,"ahead_w10/mbirth.RData"))
HRS_ahead_w10 <- left_join(HRS_ahead_w10,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w10/ybirth.RData"))
HRS_ahead_w10 <- left_join(HRS_ahead_w10,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w10, echo=F}

vbl <- HRS_ahead_w10$R10RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w10,!vbl %in% vbl_miss), aes(R10RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w10$R10RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w10,!vbl %in% vbl_miss), aes(R10RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w10$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w10,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w10$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w10,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w10$R10SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R10SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w10, aes(x=factor(R10SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w10}




# Categorical variable harmonization
HRS_ds_ahead_w10 <- tibble(id=HRS_ahead_w10$id)
HRS_ds_ahead_w10$retired <- car::recode(HRS_ahead_w10$R10SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w10 <- left_join(HRS_ahead_w10,HRS_ds_ahead_w9, by="id")
# Continuous variable harmonization
HRS_ahead_w10$month <- car::recode(HRS_ahead_w10$R10RETMON, "NA = 999")
HRS_ahead_w10$year <- car::recode(HRS_ahead_w10$R10RETYR, "NA = 999")
HRS_ds_ahead_w10$age_retired <- comp_age(y_birth=HRS_ahead_w10$ybirth, m_birth=HRS_ahead_w10$mbirth , a_year=HRS_ahead_w10$year, a_month=HRS_ahead_w10$month, miss=miss_values_vector)
HRS_ds_ahead_w10$age_retired[which(HRS_ds_ahead_w10$retired==1 & !is.na(HRS_ahead_w10$age_retired) & !HRS_ahead_w10$age_retired %in% miss_values_vector)] <- HRS_ahead_w10$age_retired[which(HRS_ds_ahead_w10$retired==1 & !is.na(HRS_ahead_w10$age_retired) & !HRS_ahead_w10$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w10$age_retired[which(HRS_ds_ahead_w10$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ahead_w10, echo=F}

vbl <- HRS_ds_ahead_w10$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w10, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")






vbl <- HRS_ds_ahead_w10$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w10,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")




```


#### Validation

```{r crosstabulation ahead_w10, echo=F, results='asis'}









```




### Wave 11

#### Study-specific variable description

| **Name** | `R11SAYRET` | `R11RETMON` | `R11RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R11SAYRET:W11 R considers self retired`| `R11RETMON:W11 Month Retired if say retired` | `R11RETYR:W11 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-AHEAD-w11`| `HRS-AHEAD-w11`| `HRS-AHEAD-w11`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ahead_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w11','HRS.HRS-AHEAD-w11',variables=list('R11SAYRET','R11RETMON','R11RETYR'), missings = T)
HRS_ahead_w11 <- opal.execute(o,'HRS_ahead_w11')
load(paste0(datafolder,"ahead_w11/mbirth.RData"))
HRS_ahead_w11 <- left_join(HRS_ahead_w11,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ahead_w11/ybirth.RData"))
HRS_ahead_w11 <- left_join(HRS_ahead_w11,ybirth,by="id")
rm(ybirth)












```

```{r local ahead_w11, echo=F}

vbl <- HRS_ahead_w11$R11RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w11,!vbl %in% vbl_miss), aes(R11RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w11$R11RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w11,!vbl %in% vbl_miss), aes(R11RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w11$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w11,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ahead_w11$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ahead_w11,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ahead_w11$R11SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R11SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w11, aes(x=factor(R11SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ahead_w11}




# Categorical variable harmonization
HRS_ds_ahead_w11 <- tibble(id=HRS_ahead_w11$id)
HRS_ds_ahead_w11$retired <- car::recode(HRS_ahead_w11$R11SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ahead_w11 <- left_join(HRS_ahead_w11,HRS_ds_ahead_w10, by="id")
# Continuous variable harmonization
HRS_ahead_w11$month <- car::recode(HRS_ahead_w11$R11RETMON, "NA = 999")
HRS_ahead_w11$year <- car::recode(HRS_ahead_w11$R11RETYR, "NA = 999")
HRS_ds_ahead_w11$age_retired <- comp_age(y_birth=HRS_ahead_w11$ybirth, m_birth=HRS_ahead_w11$mbirth , a_year=HRS_ahead_w11$year, a_month=HRS_ahead_w11$month, miss=miss_values_vector)
HRS_ds_ahead_w11$age_retired[which(HRS_ds_ahead_w11$retired==1 & !is.na(HRS_ahead_w11$age_retired) & !HRS_ahead_w11$age_retired %in% miss_values_vector)] <- HRS_ahead_w11$age_retired[which(HRS_ds_ahead_w11$retired==1 & !is.na(HRS_ahead_w11$age_retired) & !HRS_ahead_w11$age_retired %in% miss_values_vector)]
HRS_ds_ahead_w11$age_retired[which(HRS_ds_ahead_w11$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ahead_w11, echo=F}

vbl <- HRS_ds_ahead_w11$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w11, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ahead_w11$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ahead_w11,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ahead_w11, echo=F, results='asis'}









```



## CODA

### Wave 4

#### Study-specific variable description

| **Name** | `R4SAYRET` | `R4RETMON` | `R4RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R4SAYRET:W4 R considers self retired`| `R4RETMON:W4 Month Retired if say retired` | `R4RETYR:W4 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w4`| `HRS-CODA-w4`| `HRS-CODA-w4`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w4','HRS.HRS-CODA-w4',variables=list('R4SAYRET','R4RETMON','R4RETYR'), missings = T)
HRS_coda_w4 <- opal.execute(o,'HRS_coda_w4')
load(paste0(datafolder,"coda_w4/mbirth.RData"))
HRS_coda_w4 <- left_join(HRS_coda_w4,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w4/ybirth.RData"))
HRS_coda_w4 <- left_join(HRS_coda_w4,ybirth,by="id")
rm(ybirth)

```

```{r local coda_w4, echo=F}

vbl <- HRS_coda_w4$R4RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w4,!vbl %in% vbl_miss), aes(R4RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w4$R4RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w4,!vbl %in% vbl_miss), aes(R4RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w4$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w4,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w4$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w4,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w4$R4SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R4SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w4, aes(x=factor(R4SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `change 0,2 into 0`
* `change 3 into 996`
* `NA into 999`



To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w4}

# Categorical variable harmonization
HRS_ds_coda_w4 <- tibble(id=HRS_coda_w4$id)
HRS_ds_coda_w4$retired <- car::recode(HRS_coda_w4$R4SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

# Continuous variable harmonization
HRS_coda_w4$month <- car::recode(HRS_coda_w4$R4RETMON, "NA = 999")
HRS_coda_w4$year <- car::recode(HRS_coda_w4$R4RETYR, "NA = 999")
HRS_ds_coda_w4$age_retired <- comp_age(y_birth=HRS_coda_w4$ybirth, m_birth=HRS_coda_w4$mbirth , a_year=HRS_coda_w4$year, a_month=HRS_coda_w4$month, miss=miss_values_vector)
HRS_ds_coda_w4$age_retired[which(HRS_ds_coda_w4$retired==0)] <- 996


```


#### Statistics of the new harmonized variable

```{r descript coda_w4, echo=F}

vbl <- HRS_ds_coda_w4$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w4, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")


vbl <- HRS_ds_coda_w4$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w4,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")


```


#### Validation

```{r crosstabulation coda_w4, echo=F}








```



### Wave 5

#### Study-specific variable description

| **Name** | `R5SAYRET` | `R5RETMON` | `R5RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R5SAYRET:W5 R considers self retired`| `R5RETMON:W5 Month Retired if say retired` | `R5RETYR:W5 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w5`| `HRS-CODA-w5`| `HRS-CODA-w5`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w5','HRS.HRS-CODA-w5',variables=list('R5SAYRET','R5RETMON','R5RETYR'), missings = T)
HRS_coda_w5 <- opal.execute(o,'HRS_coda_w5')
load(paste0(datafolder,"coda_w5/mbirth.RData"))
HRS_coda_w5 <- left_join(HRS_coda_w5,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w5/ybirth.RData"))
HRS_coda_w5 <- left_join(HRS_coda_w5,ybirth,by="id")
rm(ybirth)












```

```{r local coda_w5, echo=F}

vbl <- HRS_coda_w5$R5RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w5,!vbl %in% vbl_miss), aes(R5RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w5$R5RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w5,!vbl %in% vbl_miss), aes(R5RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w5$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w5,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w5$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w5,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w5$R5SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R5SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w5, aes(x=factor(R5SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`







To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w5}




# Categorical variable harmonization
HRS_ds_coda_w5 <- tibble(id=HRS_coda_w5$id)
HRS_ds_coda_w5$retired <- car::recode(HRS_coda_w5$R5SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_coda_w5 <- left_join(HRS_coda_w5,HRS_ds_coda_w4, by="id")
# Continuous variable harmonization
HRS_coda_w5$month <- car::recode(HRS_coda_w5$R5RETMON, "NA = 999")
HRS_coda_w5$year <- car::recode(HRS_coda_w5$R5RETYR, "NA = 999")
HRS_ds_coda_w5$age_retired <- comp_age(y_birth=HRS_coda_w5$ybirth, m_birth=HRS_coda_w5$mbirth , a_year=HRS_coda_w5$year, a_month=HRS_coda_w5$month, miss=miss_values_vector)
HRS_ds_coda_w5$age_retired[which(HRS_ds_coda_w5$retired==1 & !is.na(HRS_coda_w5$age_retired) & !HRS_coda_w5$age_retired %in% miss_values_vector)] <- HRS_coda_w5$age_retired[which(HRS_ds_coda_w5$retired==1 & !is.na(HRS_coda_w5$age_retired) & !HRS_coda_w5$age_retired %in% miss_values_vector)]
HRS_ds_coda_w5$age_retired[which(HRS_ds_coda_w5$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript coda_w5, echo=F}

vbl <- HRS_ds_coda_w5$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w5, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_coda_w5$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w5,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation coda_w5, echo=F, results='asis'}









```




### Wave 6

#### Study-specific variable description

| **Name** | `R6SAYRET` | `R6RETMON` | `R6RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R6SAYRET:W6 R considers self retired`| `R6RETMON:W6 Month Retired if say retired` | `R6RETYR:W6 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w6`| `HRS-CODA-w6`| `HRS-CODA-w6`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w6','HRS.HRS-CODA-w6',variables=list('R6SAYRET','R6RETMON','R6RETYR'), missings = T)
HRS_coda_w6 <- opal.execute(o,'HRS_coda_w6')
load(paste0(datafolder,"coda_w6/mbirth.RData"))
HRS_coda_w6 <- left_join(HRS_coda_w6,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w6/ybirth.RData"))
HRS_coda_w6 <- left_join(HRS_coda_w6,ybirth,by="id")
rm(ybirth)












```

```{r local coda_w6, echo=F}

vbl <- HRS_coda_w6$R6RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w6,!vbl %in% vbl_miss), aes(R6RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w6$R6RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w6,!vbl %in% vbl_miss), aes(R6RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w6$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w6,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w6$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w6,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w6$R6SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R6SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w6, aes(x=factor(R6SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w6}




# Categorical variable harmonization
HRS_ds_coda_w6 <- tibble(id=HRS_coda_w6$id)
HRS_ds_coda_w6$retired <- car::recode(HRS_coda_w6$R6SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_coda_w6 <- left_join(HRS_coda_w6,HRS_ds_coda_w5, by="id")
# Continuous variable harmonization
HRS_coda_w6$month <- car::recode(HRS_coda_w6$R6RETMON, "NA = 999")
HRS_coda_w6$year <- car::recode(HRS_coda_w6$R6RETYR, "NA = 999")
HRS_ds_coda_w6$age_retired <- comp_age(y_birth=HRS_coda_w6$ybirth, m_birth=HRS_coda_w6$mbirth , a_year=HRS_coda_w6$year, a_month=HRS_coda_w6$month, miss=miss_values_vector)
HRS_ds_coda_w6$age_retired[which(HRS_ds_coda_w6$retired==1 & !is.na(HRS_coda_w6$age_retired) & !HRS_coda_w6$age_retired %in% miss_values_vector)] <- HRS_coda_w6$age_retired[which(HRS_ds_coda_w6$retired==1 & !is.na(HRS_coda_w6$age_retired) & !HRS_coda_w6$age_retired %in% miss_values_vector)]
HRS_ds_coda_w6$age_retired[which(HRS_ds_coda_w6$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript coda_w6, echo=F}

vbl <- HRS_ds_coda_w6$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w6, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_coda_w6$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w6,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation coda_w6, echo=F, results='asis'}









```




### Wave 7

#### Study-specific variable description

| **Name** | `R7SAYRET` | `R7RETMON` | `R7RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R7SAYRET:W7 R considers self retired`| `R7RETMON:W7 Month Retired if say retired` | `R7RETYR:W7 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w7`| `HRS-CODA-w7`| `HRS-CODA-w7`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w7','HRS.HRS-CODA-w7',variables=list('R7SAYRET','R7RETMON','R7RETYR'), missings = T)
HRS_coda_w7 <- opal.execute(o,'HRS_coda_w7')
load(paste0(datafolder,"coda_w7/mbirth.RData"))
HRS_coda_w7 <- left_join(HRS_coda_w7,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w7/ybirth.RData"))
HRS_coda_w7 <- left_join(HRS_coda_w7,ybirth,by="id")
rm(ybirth)












```

```{r local coda_w7, echo=F}

vbl <- HRS_coda_w7$R7RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w7,!vbl %in% vbl_miss), aes(R7RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w7$R7RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w7,!vbl %in% vbl_miss), aes(R7RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w7$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w7,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w7$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w7,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w7$R7SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R7SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w7, aes(x=factor(R7SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w7}




# Categorical variable harmonization
HRS_ds_coda_w7 <- tibble(id=HRS_coda_w7$id)
HRS_ds_coda_w7$retired <- car::recode(HRS_coda_w7$R7SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_coda_w7 <- left_join(HRS_coda_w7,HRS_ds_coda_w6, by="id")
# Continuous variable harmonization
HRS_coda_w7$month <- car::recode(HRS_coda_w7$R7RETMON, "NA = 999")
HRS_coda_w7$year <- car::recode(HRS_coda_w7$R7RETYR, "NA = 999")
HRS_ds_coda_w7$age_retired <- comp_age(y_birth=HRS_coda_w7$ybirth, m_birth=HRS_coda_w7$mbirth , a_year=HRS_coda_w7$year, a_month=HRS_coda_w7$month, miss=miss_values_vector)
HRS_ds_coda_w7$age_retired[which(HRS_ds_coda_w7$retired==1 & !is.na(HRS_coda_w7$age_retired) & !HRS_coda_w7$age_retired %in% miss_values_vector)] <- HRS_coda_w7$age_retired[which(HRS_ds_coda_w7$retired==1 & !is.na(HRS_coda_w7$age_retired) & !HRS_coda_w7$age_retired %in% miss_values_vector)]
HRS_ds_coda_w7$age_retired[which(HRS_ds_coda_w7$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript coda_w7, echo=F}

vbl <- HRS_ds_coda_w7$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w7, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_coda_w7$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w7,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation coda_w7, echo=F, results='asis'}









```



### Wave 8

#### Study-specific variable description

| **Name** | `R8SAYRET` | `R8RETMON` | `R8RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R8SAYRET:W8 R considers self retired`| `R8RETMON:W8 Month Retired if say retired` | `R8RETYR:W8 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w8`| `HRS-CODA-w8`| `HRS-CODA-w8`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w8','HRS.HRS-CODA-w8',variables=list('R8SAYRET','R8RETMON','R8RETYR'), missings = T)
HRS_coda_w8 <- opal.execute(o,'HRS_coda_w8')
load(paste0(datafolder,"coda_w8/mbirth.RData"))
HRS_coda_w8 <- left_join(HRS_coda_w8,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w8/ybirth.RData"))
HRS_coda_w8 <- left_join(HRS_coda_w8,ybirth,by="id")
rm(ybirth)












```

```{r local coda_w8, echo=F}

vbl <- HRS_coda_w8$R8RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w8,!vbl %in% vbl_miss), aes(R8RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w8$R8RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w8,!vbl %in% vbl_miss), aes(R8RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w8$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w8,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w8$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w8,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w8$R8SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R8SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w8, aes(x=factor(R8SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w8}




# Categorical variable harmonization
HRS_ds_coda_w8 <- tibble(id=HRS_coda_w8$id)
HRS_ds_coda_w8$retired <- car::recode(HRS_coda_w8$R8SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_coda_w8 <- left_join(HRS_coda_w8,HRS_ds_coda_w7, by="id")
# Continuous variable harmonization
HRS_coda_w8$month <- car::recode(HRS_coda_w8$R8RETMON, "NA = 999")
HRS_coda_w8$year <- car::recode(HRS_coda_w8$R8RETYR, "NA = 999")
HRS_ds_coda_w8$age_retired <- comp_age(y_birth=HRS_coda_w8$ybirth, m_birth=HRS_coda_w8$mbirth , a_year=HRS_coda_w8$year, a_month=HRS_coda_w8$month, miss=miss_values_vector)
HRS_ds_coda_w8$age_retired[which(HRS_ds_coda_w8$retired==1 & !is.na(HRS_coda_w8$age_retired) & !HRS_coda_w8$age_retired %in% miss_values_vector)] <- HRS_coda_w8$age_retired[which(HRS_ds_coda_w8$retired==1 & !is.na(HRS_coda_w8$age_retired) & !HRS_coda_w8$age_retired %in% miss_values_vector)]
HRS_ds_coda_w8$age_retired[which(HRS_ds_coda_w8$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript coda_w8, echo=F}

vbl <- HRS_ds_coda_w8$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w8, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_coda_w8$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w8,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation coda_w8, echo=F, results='asis'}









```



### Wave 9

#### Study-specific variable description

| **Name** | `R9SAYRET` | `R9RETMON` | `R9RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R9SAYRET:W9 R considers self retired`| `R9RETMON:W9 Month Retired if say retired` | `R9RETYR:W9 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w9`| `HRS-CODA-w9`| `HRS-CODA-w9`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w9','HRS.HRS-CODA-w9',variables=list('R9SAYRET','R9RETMON','R9RETYR'), missings = T)
HRS_coda_w9 <- opal.execute(o,'HRS_coda_w9')
load(paste0(datafolder,"coda_w9/mbirth.RData"))
HRS_coda_w9 <- left_join(HRS_coda_w9,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w9/ybirth.RData"))
HRS_coda_w9 <- left_join(HRS_coda_w9,ybirth,by="id")
rm(ybirth)












```

```{r local coda_w9, echo=F}

vbl <- HRS_coda_w9$R9RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w9,!vbl %in% vbl_miss), aes(R9RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w9$R9RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w9,!vbl %in% vbl_miss), aes(R9RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w9$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w9,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w9$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w9,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w9$R9SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R9SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w9, aes(x=factor(R9SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w9}




# Categorical variable harmonization
HRS_ds_coda_w9 <- tibble(id=HRS_coda_w9$id)
HRS_ds_coda_w9$retired <- car::recode(HRS_coda_w9$R9SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_coda_w9 <- left_join(HRS_coda_w9,HRS_ds_coda_w8, by="id")
# Continuous variable harmonization
HRS_coda_w9$month <- car::recode(HRS_coda_w9$R9RETMON, "NA = 999")
HRS_coda_w9$year <- car::recode(HRS_coda_w9$R9RETYR, "NA = 999")
HRS_ds_coda_w9$age_retired <- comp_age(y_birth=HRS_coda_w9$ybirth, m_birth=HRS_coda_w9$mbirth , a_year=HRS_coda_w9$year, a_month=HRS_coda_w9$month, miss=miss_values_vector)
HRS_ds_coda_w9$age_retired[which(HRS_ds_coda_w9$retired==1 & !is.na(HRS_coda_w9$age_retired) & !HRS_coda_w9$age_retired %in% miss_values_vector)] <- HRS_coda_w9$age_retired[which(HRS_ds_coda_w9$retired==1 & !is.na(HRS_coda_w9$age_retired) & !HRS_coda_w9$age_retired %in% miss_values_vector)]
HRS_ds_coda_w9$age_retired[which(HRS_ds_coda_w9$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript coda_w9, echo=F}

vbl <- HRS_ds_coda_w9$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w9, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_coda_w9$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w9,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation coda_w9, echo=F, results='asis'}









```




### Wave 10

#### Study-specific variable description

| **Name** | `R10SAYRET` | `R10RETMON` | `R10RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R10SAYRET:W10 R considers self retired`| `R10RETMON:W10 Month Retired if say retired` | `R10RETYR:W10 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w10`| `HRS-CODA-w10`| `HRS-CODA-w10`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w10','HRS.HRS-CODA-w10',variables=list('R10SAYRET','R10RETMON','R10RETYR'), missings = T)
HRS_coda_w10 <- opal.execute(o,'HRS_coda_w10')
load(paste0(datafolder,"coda_w10/mbirth.RData"))
HRS_coda_w10 <- left_join(HRS_coda_w10,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w10/ybirth.RData"))
HRS_coda_w10 <- left_join(HRS_coda_w10,ybirth,by="id")
rm(ybirth)












```

```{r local coda_w10, echo=F}

vbl <- HRS_coda_w10$R10RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w10,!vbl %in% vbl_miss), aes(R10RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w10$R10RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w10,!vbl %in% vbl_miss), aes(R10RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w10$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w10,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w10$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w10,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w10$R10SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R10SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w10, aes(x=factor(R10SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w10}




# Categorical variable harmonization
HRS_ds_coda_w10 <- tibble(id=HRS_coda_w10$id)
HRS_ds_coda_w10$retired <- car::recode(HRS_coda_w10$R10SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_coda_w10 <- left_join(HRS_coda_w10,HRS_ds_coda_w9, by="id")
# Continuous variable harmonization
HRS_coda_w10$month <- car::recode(HRS_coda_w10$R10RETMON, "NA = 999")
HRS_coda_w10$year <- car::recode(HRS_coda_w10$R10RETYR, "NA = 999")
HRS_ds_coda_w10$age_retired <- comp_age(y_birth=HRS_coda_w10$ybirth, m_birth=HRS_coda_w10$mbirth , a_year=HRS_coda_w10$year, a_month=HRS_coda_w10$month, miss=miss_values_vector)
HRS_ds_coda_w10$age_retired[which(HRS_ds_coda_w10$retired==1 & !is.na(HRS_coda_w10$age_retired) & !HRS_coda_w10$age_retired %in% miss_values_vector)] <- HRS_coda_w10$age_retired[which(HRS_ds_coda_w10$retired==1 & !is.na(HRS_coda_w10$age_retired) & !HRS_coda_w10$age_retired %in% miss_values_vector)]
HRS_ds_coda_w10$age_retired[which(HRS_ds_coda_w10$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript coda_w10, echo=F}

vbl <- HRS_ds_coda_w10$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w10, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_coda_w10$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w10,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation coda_w10, echo=F, results='asis'}









```



### Wave 11

#### Study-specific variable description

| **Name** | `R11SAYRET` | `R11RETMON` | `R11RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R11SAYRET:W11 R considers self retired`| `R11RETMON:W11 Month Retired if say retired` | `R11RETYR:W11 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-CODA-w11`| `HRS-CODA-w11`| `HRS-CODA-w11`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign coda_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w11','HRS.HRS-CODA-w11',variables=list('R11SAYRET','R11RETMON','R11RETYR'), missings = T)
HRS_coda_w11 <- opal.execute(o,'HRS_coda_w11')
load(paste0(datafolder,"coda_w11/mbirth.RData"))
HRS_coda_w11 <- left_join(HRS_coda_w11,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"coda_w11/ybirth.RData"))
HRS_coda_w11 <- left_join(HRS_coda_w11,ybirth,by="id")
rm(ybirth)












```

```{r local coda_w11, echo=F}

vbl <- HRS_coda_w11$R11RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w11,!vbl %in% vbl_miss), aes(R11RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w11$R11RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w11,!vbl %in% vbl_miss), aes(R11RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w11$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w11,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_coda_w11$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_coda_w11,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_coda_w11$R11SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R11SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w11, aes(x=factor(R11SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo coda_w11}




# Categorical variable harmonization
HRS_ds_coda_w11 <- tibble(id=HRS_coda_w11$id)
HRS_ds_coda_w11$retired <- car::recode(HRS_coda_w11$R11SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_coda_w11 <- left_join(HRS_coda_w11,HRS_ds_coda_w10, by="id")
# Continuous variable harmonization
HRS_coda_w11$month <- car::recode(HRS_coda_w11$R11RETMON, "NA = 999")
HRS_coda_w11$year <- car::recode(HRS_coda_w11$R11RETYR, "NA = 999")
HRS_ds_coda_w11$age_retired <- comp_age(y_birth=HRS_coda_w11$ybirth, m_birth=HRS_coda_w11$mbirth , a_year=HRS_coda_w11$year, a_month=HRS_coda_w11$month, miss=miss_values_vector)
HRS_ds_coda_w11$age_retired[which(HRS_ds_coda_w11$retired==1 & !is.na(HRS_coda_w11$age_retired) & !HRS_coda_w11$age_retired %in% miss_values_vector)] <- HRS_coda_w11$age_retired[which(HRS_ds_coda_w11$retired==1 & !is.na(HRS_coda_w11$age_retired) & !HRS_coda_w11$age_retired %in% miss_values_vector)]
HRS_ds_coda_w11$age_retired[which(HRS_ds_coda_w11$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript coda_w11, echo=F}

vbl <- HRS_ds_coda_w11$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w11, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_coda_w11$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_coda_w11,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation coda_w11, echo=F, results='asis'}









```



## WB

### Wave 4

#### Study-specific variable description

| **Name** | `R4SAYRET` | `R4RETMON` | `R4RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R4SAYRET:W4 R considers self retired`| `R4RETMON:W4 Month Retired if say retired` | `R4RETYR:W4 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w4`| `HRS-WB-w4`| `HRS-WB-w4`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w4','HRS.HRS-WB-w4',variables=list('R4SAYRET','R4RETMON','R4RETYR'), missings = T)
HRS_wb_w4 <- opal.execute(o,'HRS_wb_w4')
load(paste0(datafolder,"wb_w4/mbirth.RData"))
HRS_wb_w4 <- left_join(HRS_wb_w4,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w4/ybirth.RData"))
HRS_wb_w4 <- left_join(HRS_wb_w4,ybirth,by="id")
rm(ybirth)

```

```{r local wb_w4, echo=F}

vbl <- HRS_wb_w4$R4RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w4,!vbl %in% vbl_miss), aes(R4RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w4$R4RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R4RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w4,!vbl %in% vbl_miss), aes(R4RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w4$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w4,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w4$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w4,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w4$R4SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R4SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w4, aes(x=factor(R4SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `change 0,2 into 0`
* `change 3 into 996`
* `NA into 999`



To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w4}

# Categorical variable harmonization
HRS_ds_wb_w4 <- tibble(id=HRS_wb_w4$id)
HRS_ds_wb_w4$retired <- car::recode(HRS_wb_w4$R4SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

# Continuous variable harmonization
HRS_wb_w4$month <- car::recode(HRS_wb_w4$R4RETMON, "NA = 999")
HRS_wb_w4$year <- car::recode(HRS_wb_w4$R4RETYR, "NA = 999")
HRS_ds_wb_w4$age_retired <- comp_age(y_birth=HRS_wb_w4$ybirth, m_birth=HRS_wb_w4$mbirth , a_year=HRS_wb_w4$year, a_month=HRS_wb_w4$month, miss=miss_values_vector)
HRS_ds_wb_w4$age_retired[which(HRS_ds_wb_w4$retired==0)] <- 996


```


#### Statistics of the new harmonized variable

```{r descript wb_w4, echo=F}

vbl <- HRS_ds_wb_w4$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w4, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")


vbl <- HRS_ds_wb_w4$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w4,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")


```


#### Validation

```{r crosstabulation wb_w4, echo=F}








```



### Wave 5

#### Study-specific variable description

| **Name** | `R5SAYRET` | `R5RETMON` | `R5RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R5SAYRET:W5 R considers self retired`| `R5RETMON:W5 Month Retired if say retired` | `R5RETYR:W5 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w5`| `HRS-WB-w5`| `HRS-WB-w5`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w5','HRS.HRS-WB-w5',variables=list('R5SAYRET','R5RETMON','R5RETYR'), missings = T)
HRS_wb_w5 <- opal.execute(o,'HRS_wb_w5')
load(paste0(datafolder,"wb_w5/mbirth.RData"))
HRS_wb_w5 <- left_join(HRS_wb_w5,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w5/ybirth.RData"))
HRS_wb_w5 <- left_join(HRS_wb_w5,ybirth,by="id")
rm(ybirth)












```

```{r local wb_w5, echo=F}

vbl <- HRS_wb_w5$R5RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w5,!vbl %in% vbl_miss), aes(R5RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w5$R5RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R5RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w5,!vbl %in% vbl_miss), aes(R5RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w5$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w5,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w5$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w5,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w5$R5SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R5SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w5, aes(x=factor(R5SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`







To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w5}




# Categorical variable harmonization
HRS_ds_wb_w5 <- tibble(id=HRS_wb_w5$id)
HRS_ds_wb_w5$retired <- car::recode(HRS_wb_w5$R5SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_wb_w5 <- left_join(HRS_wb_w5,HRS_ds_wb_w4, by="id")
# Continuous variable harmonization
HRS_wb_w5$month <- car::recode(HRS_wb_w5$R5RETMON, "NA = 999")
HRS_wb_w5$year <- car::recode(HRS_wb_w5$R5RETYR, "NA = 999")
HRS_ds_wb_w5$age_retired <- comp_age(y_birth=HRS_wb_w5$ybirth, m_birth=HRS_wb_w5$mbirth , a_year=HRS_wb_w5$year, a_month=HRS_wb_w5$month, miss=miss_values_vector)
HRS_ds_wb_w5$age_retired[which(HRS_ds_wb_w5$retired==1 & !is.na(HRS_wb_w5$age_retired) & !HRS_wb_w5$age_retired %in% miss_values_vector)] <- HRS_wb_w5$age_retired[which(HRS_ds_wb_w5$retired==1 & !is.na(HRS_wb_w5$age_retired) & !HRS_wb_w5$age_retired %in% miss_values_vector)]
HRS_ds_wb_w5$age_retired[which(HRS_ds_wb_w5$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript wb_w5, echo=F}

vbl <- HRS_ds_wb_w5$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w5, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_wb_w5$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w5,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation wb_w5, echo=F, results='asis'}









```




### Wave 6

#### Study-specific variable description

| **Name** | `R6SAYRET` | `R6RETMON` | `R6RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R6SAYRET:W6 R considers self retired`| `R6RETMON:W6 Month Retired if say retired` | `R6RETYR:W6 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w6`| `HRS-WB-w6`| `HRS-WB-w6`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w6','HRS.HRS-WB-w6',variables=list('R6SAYRET','R6RETMON','R6RETYR'), missings = T)
HRS_wb_w6 <- opal.execute(o,'HRS_wb_w6')
load(paste0(datafolder,"wb_w6/mbirth.RData"))
HRS_wb_w6 <- left_join(HRS_wb_w6,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w6/ybirth.RData"))
HRS_wb_w6 <- left_join(HRS_wb_w6,ybirth,by="id")
rm(ybirth)












```

```{r local wb_w6, echo=F}

vbl <- HRS_wb_w6$R6RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w6,!vbl %in% vbl_miss), aes(R6RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w6$R6RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R6RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w6,!vbl %in% vbl_miss), aes(R6RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w6$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w6,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w6$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w6,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w6$R6SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R6SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w6, aes(x=factor(R6SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w6}




# Categorical variable harmonization
HRS_ds_wb_w6 <- tibble(id=HRS_wb_w6$id)
HRS_ds_wb_w6$retired <- car::recode(HRS_wb_w6$R6SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_wb_w6 <- left_join(HRS_wb_w6,HRS_ds_wb_w5, by="id")
# Continuous variable harmonization
HRS_wb_w6$month <- car::recode(HRS_wb_w6$R6RETMON, "NA = 999")
HRS_wb_w6$year <- car::recode(HRS_wb_w6$R6RETYR, "NA = 999")
HRS_ds_wb_w6$age_retired <- comp_age(y_birth=HRS_wb_w6$ybirth, m_birth=HRS_wb_w6$mbirth , a_year=HRS_wb_w6$year, a_month=HRS_wb_w6$month, miss=miss_values_vector)
HRS_ds_wb_w6$age_retired[which(HRS_ds_wb_w6$retired==1 & !is.na(HRS_wb_w6$age_retired) & !HRS_wb_w6$age_retired %in% miss_values_vector)] <- HRS_wb_w6$age_retired[which(HRS_ds_wb_w6$retired==1 & !is.na(HRS_wb_w6$age_retired) & !HRS_wb_w6$age_retired %in% miss_values_vector)]
HRS_ds_wb_w6$age_retired[which(HRS_ds_wb_w6$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript wb_w6, echo=F}

vbl <- HRS_ds_wb_w6$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w6, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")






vbl <- HRS_ds_wb_w6$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w6,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")




```


#### Validation

```{r crosstabulation wb_w6, echo=F, results='asis'}









```




### Wave 7

#### Study-specific variable description

| **Name** | `R7SAYRET` | `R7RETMON` | `R7RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R7SAYRET:W7 R considers self retired`| `R7RETMON:W7 Month Retired if say retired` | `R7RETYR:W7 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w7`| `HRS-WB-w7`| `HRS-WB-w7`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w7','HRS.HRS-WB-w7',variables=list('R7SAYRET','R7RETMON','R7RETYR'), missings = T)
HRS_wb_w7 <- opal.execute(o,'HRS_wb_w7')
load(paste0(datafolder,"wb_w7/mbirth.RData"))
HRS_wb_w7 <- left_join(HRS_wb_w7,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w7/ybirth.RData"))
HRS_wb_w7 <- left_join(HRS_wb_w7,ybirth,by="id")
rm(ybirth)












```

```{r local wb_w7, echo=F}

vbl <- HRS_wb_w7$R7RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w7,!vbl %in% vbl_miss), aes(R7RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w7$R7RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w7,!vbl %in% vbl_miss), aes(R7RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w7$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w7,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w7$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w7,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w7$R7SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R7SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w7, aes(x=factor(R7SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w7}




# Categorical variable harmonization
HRS_ds_wb_w7 <- tibble(id=HRS_wb_w7$id)
HRS_ds_wb_w7$retired <- car::recode(HRS_wb_w7$R7SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_wb_w7 <- left_join(HRS_wb_w7,HRS_ds_wb_w6, by="id")
# Continuous variable harmonization
HRS_wb_w7$month <- car::recode(HRS_wb_w7$R7RETMON, "NA = 999")
HRS_wb_w7$year <- car::recode(HRS_wb_w7$R7RETYR, "NA = 999")
HRS_ds_wb_w7$age_retired <- comp_age(y_birth=HRS_wb_w7$ybirth, m_birth=HRS_wb_w7$mbirth , a_year=HRS_wb_w7$year, a_month=HRS_wb_w7$month, miss=miss_values_vector)
HRS_ds_wb_w7$age_retired[which(HRS_ds_wb_w7$retired==1 & !is.na(HRS_wb_w7$age_retired) & !HRS_wb_w7$age_retired %in% miss_values_vector)] <- HRS_wb_w7$age_retired[which(HRS_ds_wb_w7$retired==1 & !is.na(HRS_wb_w7$age_retired) & !HRS_wb_w7$age_retired %in% miss_values_vector)]
HRS_ds_wb_w7$age_retired[which(HRS_ds_wb_w7$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript wb_w7, echo=F}

vbl <- HRS_ds_wb_w7$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w7, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_wb_w7$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w7,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation wb_w7, echo=F, results='asis'}









```



### Wave 8

#### Study-specific variable description

| **Name** | `R8SAYRET` | `R8RETMON` | `R8RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R8SAYRET:W8 R considers self retired`| `R8RETMON:W8 Month Retired if say retired` | `R8RETYR:W8 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w8`| `HRS-WB-w8`| `HRS-WB-w8`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w8','HRS.HRS-WB-w8',variables=list('R8SAYRET','R8RETMON','R8RETYR'), missings = T)
HRS_wb_w8 <- opal.execute(o,'HRS_wb_w8')
load(paste0(datafolder,"wb_w8/mbirth.RData"))
HRS_wb_w8 <- left_join(HRS_wb_w8,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w8/ybirth.RData"))
HRS_wb_w8 <- left_join(HRS_wb_w8,ybirth,by="id")
rm(ybirth)












```

```{r local wb_w8, echo=F}

vbl <- HRS_wb_w8$R8RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w8,!vbl %in% vbl_miss), aes(R8RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w8$R8RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w8,!vbl %in% vbl_miss), aes(R8RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w8$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w8,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w8$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w8,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w8$R8SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R8SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w8, aes(x=factor(R8SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w8}




# Categorical variable harmonization
HRS_ds_wb_w8 <- tibble(id=HRS_wb_w8$id)
HRS_ds_wb_w8$retired <- car::recode(HRS_wb_w8$R8SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_wb_w8 <- left_join(HRS_wb_w8,HRS_ds_wb_w7, by="id")
# Continuous variable harmonization
HRS_wb_w8$month <- car::recode(HRS_wb_w8$R8RETMON, "NA = 999")
HRS_wb_w8$year <- car::recode(HRS_wb_w8$R8RETYR, "NA = 999")
HRS_ds_wb_w8$age_retired <- comp_age(y_birth=HRS_wb_w8$ybirth, m_birth=HRS_wb_w8$mbirth , a_year=HRS_wb_w8$year, a_month=HRS_wb_w8$month, miss=miss_values_vector)
HRS_ds_wb_w8$age_retired[which(HRS_ds_wb_w8$retired==1 & !is.na(HRS_wb_w8$age_retired) & !HRS_wb_w8$age_retired %in% miss_values_vector)] <- HRS_wb_w8$age_retired[which(HRS_ds_wb_w8$retired==1 & !is.na(HRS_wb_w8$age_retired) & !HRS_wb_w8$age_retired %in% miss_values_vector)]
HRS_ds_wb_w8$age_retired[which(HRS_ds_wb_w8$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript wb_w8, echo=F}

vbl <- HRS_ds_wb_w8$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w8, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_wb_w8$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w8,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation wb_w8, echo=F, results='asis'}









```



### Wave 9

#### Study-specific variable description

| **Name** | `R9SAYRET` | `R9RETMON` | `R9RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R9SAYRET:W9 R considers self retired`| `R9RETMON:W9 Month Retired if say retired` | `R9RETYR:W9 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w9`| `HRS-WB-w9`| `HRS-WB-w9`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w9','HRS.HRS-WB-w9',variables=list('R9SAYRET','R9RETMON','R9RETYR'), missings = T)
HRS_wb_w9 <- opal.execute(o,'HRS_wb_w9')
load(paste0(datafolder,"wb_w9/mbirth.RData"))
HRS_wb_w9 <- left_join(HRS_wb_w9,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w9/ybirth.RData"))
HRS_wb_w9 <- left_join(HRS_wb_w9,ybirth,by="id")
rm(ybirth)












```

```{r local wb_w9, echo=F}

vbl <- HRS_wb_w9$R9RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w9,!vbl %in% vbl_miss), aes(R9RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w9$R9RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w9,!vbl %in% vbl_miss), aes(R9RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w9$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w9,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w9$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w9,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w9$R9SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R9SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w9, aes(x=factor(R9SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w9}




# Categorical variable harmonization
HRS_ds_wb_w9 <- tibble(id=HRS_wb_w9$id)
HRS_ds_wb_w9$retired <- car::recode(HRS_wb_w9$R9SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_wb_w9 <- left_join(HRS_wb_w9,HRS_ds_wb_w8, by="id")
# Continuous variable harmonization
HRS_wb_w9$month <- car::recode(HRS_wb_w9$R9RETMON, "NA = 999")
HRS_wb_w9$year <- car::recode(HRS_wb_w9$R9RETYR, "NA = 999")
HRS_ds_wb_w9$age_retired <- comp_age(y_birth=HRS_wb_w9$ybirth, m_birth=HRS_wb_w9$mbirth , a_year=HRS_wb_w9$year, a_month=HRS_wb_w9$month, miss=miss_values_vector)
HRS_ds_wb_w9$age_retired[which(HRS_ds_wb_w9$retired==1 & !is.na(HRS_wb_w9$age_retired) & !HRS_wb_w9$age_retired %in% miss_values_vector)] <- HRS_wb_w9$age_retired[which(HRS_ds_wb_w9$retired==1 & !is.na(HRS_wb_w9$age_retired) & !HRS_wb_w9$age_retired %in% miss_values_vector)]
HRS_ds_wb_w9$age_retired[which(HRS_ds_wb_w9$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript wb_w9, echo=F}

vbl <- HRS_ds_wb_w9$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w9, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_wb_w9$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w9,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation wb_w9, echo=F, results='asis'}









```




### Wave 10

#### Study-specific variable description

| **Name** | `R10SAYRET` | `R10RETMON` | `R10RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R10SAYRET:W10 R considers self retired`| `R10RETMON:W10 Month Retired if say retired` | `R10RETYR:W10 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w10`| `HRS-WB-w10`| `HRS-WB-w10`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w10','HRS.HRS-WB-w10',variables=list('R10SAYRET','R10RETMON','R10RETYR'), missings = T)
HRS_wb_w10 <- opal.execute(o,'HRS_wb_w10')
load(paste0(datafolder,"wb_w10/mbirth.RData"))
HRS_wb_w10 <- left_join(HRS_wb_w10,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w10/ybirth.RData"))
HRS_wb_w10 <- left_join(HRS_wb_w10,ybirth,by="id")
rm(ybirth)












```

```{r local wb_w10, echo=F}

vbl <- HRS_wb_w10$R10RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w10,!vbl %in% vbl_miss), aes(R10RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w10$R10RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w10,!vbl %in% vbl_miss), aes(R10RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w10$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w10,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w10$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w10,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w10$R10SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R10SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w10, aes(x=factor(R10SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w10}




# Categorical variable harmonization
HRS_ds_wb_w10 <- tibble(id=HRS_wb_w10$id)
HRS_ds_wb_w10$retired <- car::recode(HRS_wb_w10$R10SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_wb_w10 <- left_join(HRS_wb_w10,HRS_ds_wb_w9, by="id")
# Continuous variable harmonization
HRS_wb_w10$month <- car::recode(HRS_wb_w10$R10RETMON, "NA = 999")
HRS_wb_w10$year <- car::recode(HRS_wb_w10$R10RETYR, "NA = 999")
HRS_ds_wb_w10$age_retired <- comp_age(y_birth=HRS_wb_w10$ybirth, m_birth=HRS_wb_w10$mbirth , a_year=HRS_wb_w10$year, a_month=HRS_wb_w10$month, miss=miss_values_vector)
HRS_ds_wb_w10$age_retired[which(HRS_ds_wb_w10$retired==1 & !is.na(HRS_wb_w10$age_retired) & !HRS_wb_w10$age_retired %in% miss_values_vector)] <- HRS_wb_w10$age_retired[which(HRS_ds_wb_w10$retired==1 & !is.na(HRS_wb_w10$age_retired) & !HRS_wb_w10$age_retired %in% miss_values_vector)]
HRS_ds_wb_w10$age_retired[which(HRS_ds_wb_w10$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript wb_w10, echo=F}

vbl <- HRS_ds_wb_w10$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w10, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_wb_w10$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w10,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation wb_w10, echo=F, results='asis'}









```



### Wave 11

#### Study-specific variable description

| **Name** | `R11SAYRET` | `R11RETMON` | `R11RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R11SAYRET:W11 R considers self retired`| `R11RETMON:W11 Month Retired if say retired` | `R11RETYR:W11 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-WB-w11`| `HRS-WB-w11`| `HRS-WB-w11`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign wb_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w11','HRS.HRS-WB-w11',variables=list('R11SAYRET','R11RETMON','R11RETYR'), missings = T)
HRS_wb_w11 <- opal.execute(o,'HRS_wb_w11')
load(paste0(datafolder,"wb_w11/mbirth.RData"))
HRS_wb_w11 <- left_join(HRS_wb_w11,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"wb_w11/ybirth.RData"))
HRS_wb_w11 <- left_join(HRS_wb_w11,ybirth,by="id")
rm(ybirth)












```

```{r local wb_w11, echo=F}

vbl <- HRS_wb_w11$R11RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w11,!vbl %in% vbl_miss), aes(R11RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w11$R11RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w11,!vbl %in% vbl_miss), aes(R11RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w11$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w11,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_wb_w11$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_wb_w11,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_wb_w11$R11SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R11SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w11, aes(x=factor(R11SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")



```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo wb_w11}




# Categorical variable harmonization
HRS_ds_wb_w11 <- tibble(id=HRS_wb_w11$id)
HRS_ds_wb_w11$retired <- car::recode(HRS_wb_w11$R11SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_wb_w11 <- left_join(HRS_wb_w11,HRS_ds_wb_w10, by="id")
# Continuous variable harmonization
HRS_wb_w11$month <- car::recode(HRS_wb_w11$R11RETMON, "NA = 999")
HRS_wb_w11$year <- car::recode(HRS_wb_w11$R11RETYR, "NA = 999")
HRS_ds_wb_w11$age_retired <- comp_age(y_birth=HRS_wb_w11$ybirth, m_birth=HRS_wb_w11$mbirth , a_year=HRS_wb_w11$year, a_month=HRS_wb_w11$month, miss=miss_values_vector)
HRS_ds_wb_w11$age_retired[which(HRS_ds_wb_w11$retired==1 & !is.na(HRS_wb_w11$age_retired) & !HRS_wb_w11$age_retired %in% miss_values_vector)] <- HRS_wb_w11$age_retired[which(HRS_ds_wb_w11$retired==1 & !is.na(HRS_wb_w11$age_retired) & !HRS_wb_w11$age_retired %in% miss_values_vector)]
HRS_ds_wb_w11$age_retired[which(HRS_ds_wb_w11$retired==0)] <- 996








```


#### Statistics of the new harmonized variable

```{r descript wb_w11, echo=F}

vbl <- HRS_ds_wb_w11$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w11, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_wb_w11$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_wb_w11,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation wb_w11, echo=F, results='asis'}









```



## EBB


### Wave 7

#### Study-specific variable description

| **Name** | `R7SAYRET` | `R7RETMON` | `R7RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R7SAYRET:W7 R considers self retired`| `R7RETMON:W7 Month Retired if say retired` | `R7RETYR:W7 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-EBB-w7`| `HRS-EBB-w7`| `HRS-EBB-w7`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ebb_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w7','HRS.HRS-EBB-w7',variables=list('R7SAYRET','R7RETMON','R7RETYR'), missings = T)
HRS_ebb_w7 <- opal.execute(o,'HRS_ebb_w7')
load(paste0(datafolder,"ebb_w7/mbirth.RData"))
HRS_ebb_w7 <- left_join(HRS_ebb_w7,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ebb_w7/ybirth.RData"))
HRS_ebb_w7 <- left_join(HRS_ebb_w7,ybirth,by="id")
rm(ybirth)

```

```{r local ebb_w7, echo=F}

vbl <- HRS_ebb_w7$R7RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w7,!vbl %in% vbl_miss), aes(R7RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w7$R7RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R7RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w7,!vbl %in% vbl_miss), aes(R7RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w7$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w7,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w7$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w7,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ebb_w7$R7SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R7SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w7, aes(x=factor(R7SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `change 0,2 into 0`
* `change 3 into 996`
* `NA into 999`



To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ebb_w7}

# Categorical variable harmonization
HRS_ds_ebb_w7 <- tibble(id=HRS_ebb_w7$id)
HRS_ds_ebb_w7$retired <- car::recode(HRS_ebb_w7$R7SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

# Continuous variable harmonization
HRS_ebb_w7$month <- car::recode(HRS_ebb_w7$R7RETMON, "NA = 999")
HRS_ebb_w7$year <- car::recode(HRS_ebb_w7$R7RETYR, "NA = 999")
HRS_ds_ebb_w7$age_retired <- comp_age(y_birth=HRS_ebb_w7$ybirth, m_birth=HRS_ebb_w7$mbirth , a_year=HRS_ebb_w7$year, a_month=HRS_ebb_w7$month, miss=miss_values_vector)
HRS_ds_ebb_w7$age_retired[which(HRS_ds_ebb_w7$retired==0)] <- 996


```


#### Statistics of the new harmonized variable

```{r descript ebb_w7, echo=F}

vbl <- HRS_ds_ebb_w7$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w7, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")


vbl <- HRS_ds_ebb_w7$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ebb_w7,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")


```


#### Validation

```{r crosstabulation ebb_w7, echo=F}








```



### Wave 8

#### Study-specific variable description

| **Name** | `R8SAYRET` | `R8RETMON` | `R8RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R8SAYRET:W8 R considers self retired`| `R8RETMON:W8 Month Retired if say retired` | `R8RETYR:W8 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-EBB-w8`| `HRS-EBB-w8`| `HRS-EBB-w8`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ebb_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w8','HRS.HRS-EBB-w8',variables=list('R8SAYRET','R8RETMON','R8RETYR'), missings = T)
HRS_ebb_w8 <- opal.execute(o,'HRS_ebb_w8')
load(paste0(datafolder,"ebb_w8/mbirth.RData"))
HRS_ebb_w8 <- left_join(HRS_ebb_w8,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ebb_w8/ybirth.RData"))
HRS_ebb_w8 <- left_join(HRS_ebb_w8,ybirth,by="id")
rm(ybirth)












```

```{r local ebb_w8, echo=F}

vbl <- HRS_ebb_w8$R8RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w8,!vbl %in% vbl_miss), aes(R8RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w8$R8RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R8RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w8,!vbl %in% vbl_miss), aes(R8RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w8$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w8,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w8$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w8,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ebb_w8$R8SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R8SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w8, aes(x=factor(R8SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`







To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ebb_w8}




# Categorical variable harmonization
HRS_ds_ebb_w8 <- tibble(id=HRS_ebb_w8$id)
HRS_ds_ebb_w8$retired <- car::recode(HRS_ebb_w8$R8SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ebb_w8 <- left_join(HRS_ebb_w8,HRS_ds_ebb_w7, by="id")
# Continuous variable harmonization
HRS_ebb_w8$month <- car::recode(HRS_ebb_w8$R8RETMON, "NA = 999")
HRS_ebb_w8$year <- car::recode(HRS_ebb_w8$R8RETYR, "NA = 999")
HRS_ds_ebb_w8$age_retired <- comp_age(y_birth=HRS_ebb_w8$ybirth, m_birth=HRS_ebb_w8$mbirth , a_year=HRS_ebb_w8$year, a_month=HRS_ebb_w8$month, miss=miss_values_vector)
HRS_ds_ebb_w8$age_retired[which(HRS_ds_ebb_w8$retired==1 & !is.na(HRS_ebb_w8$age_retired) & !HRS_ebb_w8$age_retired %in% miss_values_vector)] <- HRS_ebb_w8$age_retired[which(HRS_ds_ebb_w8$retired==1 & !is.na(HRS_ebb_w8$age_retired) & !HRS_ebb_w8$age_retired %in% miss_values_vector)]
HRS_ds_ebb_w8$age_retired[which(HRS_ds_ebb_w8$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ebb_w8, echo=F}

vbl <- HRS_ds_ebb_w8$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w8, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_ebb_w8$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ebb_w8,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation ebb_w8, echo=F, results='asis'}









```




### Wave 9

#### Study-specific variable description

| **Name** | `R9SAYRET` | `R9RETMON` | `R9RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R9SAYRET:W9 R considers self retired`| `R9RETMON:W9 Month Retired if say retired` | `R9RETYR:W9 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-EBB-w9`| `HRS-EBB-w9`| `HRS-EBB-w9`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ebb_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w9','HRS.HRS-EBB-w9',variables=list('R9SAYRET','R9RETMON','R9RETYR'), missings = T)
HRS_ebb_w9 <- opal.execute(o,'HRS_ebb_w9')
load(paste0(datafolder,"ebb_w9/mbirth.RData"))
HRS_ebb_w9 <- left_join(HRS_ebb_w9,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ebb_w9/ybirth.RData"))
HRS_ebb_w9 <- left_join(HRS_ebb_w9,ybirth,by="id")
rm(ybirth)












```

```{r local ebb_w9, echo=F}

vbl <- HRS_ebb_w9$R9RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w9,!vbl %in% vbl_miss), aes(R9RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w9$R9RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R9RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w9,!vbl %in% vbl_miss), aes(R9RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w9$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w9,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w9$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w9,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ebb_w9$R9SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R9SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w9, aes(x=factor(R9SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ebb_w9}




# Categorical variable harmonization
HRS_ds_ebb_w9 <- tibble(id=HRS_ebb_w9$id)
HRS_ds_ebb_w9$retired <- car::recode(HRS_ebb_w9$R9SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ebb_w9 <- left_join(HRS_ebb_w9,HRS_ds_ebb_w8, by="id")
# Continuous variable harmonization
HRS_ebb_w9$month <- car::recode(HRS_ebb_w9$R9RETMON, "NA = 999")
HRS_ebb_w9$year <- car::recode(HRS_ebb_w9$R9RETYR, "NA = 999")
HRS_ds_ebb_w9$age_retired <- comp_age(y_birth=HRS_ebb_w9$ybirth, m_birth=HRS_ebb_w9$mbirth , a_year=HRS_ebb_w9$year, a_month=HRS_ebb_w9$month, miss=miss_values_vector)
HRS_ds_ebb_w9$age_retired[which(HRS_ds_ebb_w9$retired==1 & !is.na(HRS_ebb_w9$age_retired) & !HRS_ebb_w9$age_retired %in% miss_values_vector)] <- HRS_ebb_w9$age_retired[which(HRS_ds_ebb_w9$retired==1 & !is.na(HRS_ebb_w9$age_retired) & !HRS_ebb_w9$age_retired %in% miss_values_vector)]
HRS_ds_ebb_w9$age_retired[which(HRS_ds_ebb_w9$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ebb_w9, echo=F}

vbl <- HRS_ds_ebb_w9$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w9, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")




vbl <- HRS_ds_ebb_w9$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ebb_w9,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")






```


#### Validation

```{r crosstabulation ebb_w9, echo=F, results='asis'}









```




### Wave 10

#### Study-specific variable description

| **Name** | `R10SAYRET` | `R10RETMON` | `R10RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R10SAYRET:W10 R considers self retired`| `R10RETMON:W10 Month Retired if say retired` | `R10RETYR:W10 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-EBB-w10`| `HRS-EBB-w10`| `HRS-EBB-w10`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ebb_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w10','HRS.HRS-EBB-w10',variables=list('R10SAYRET','R10RETMON','R10RETYR'), missings = T)
HRS_ebb_w10 <- opal.execute(o,'HRS_ebb_w10')
load(paste0(datafolder,"ebb_w10/mbirth.RData"))
HRS_ebb_w10 <- left_join(HRS_ebb_w10,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ebb_w10/ybirth.RData"))
HRS_ebb_w10 <- left_join(HRS_ebb_w10,ybirth,by="id")
rm(ybirth)












```

```{r local ebb_w10, echo=F}

vbl <- HRS_ebb_w10$R10RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w10,!vbl %in% vbl_miss), aes(R10RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w10$R10RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w10,!vbl %in% vbl_miss), aes(R10RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w10$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w10,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w10$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w10,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ebb_w10$R10SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R10SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w10, aes(x=factor(R10SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ebb_w10}




# Categorical variable harmonization
HRS_ds_ebb_w10 <- tibble(id=HRS_ebb_w10$id)
HRS_ds_ebb_w10$retired <- car::recode(HRS_ebb_w10$R10SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ebb_w10 <- left_join(HRS_ebb_w10,HRS_ds_ebb_w9, by="id")
# Continuous variable harmonization
HRS_ebb_w10$month <- car::recode(HRS_ebb_w10$R10RETMON, "NA = 999")
HRS_ebb_w10$year <- car::recode(HRS_ebb_w10$R10RETYR, "NA = 999")
HRS_ds_ebb_w10$age_retired <- comp_age(y_birth=HRS_ebb_w10$ybirth, m_birth=HRS_ebb_w10$mbirth , a_year=HRS_ebb_w10$year, a_month=HRS_ebb_w10$month, miss=miss_values_vector)
HRS_ds_ebb_w10$age_retired[which(HRS_ds_ebb_w10$retired==1 & !is.na(HRS_ebb_w10$age_retired) & !HRS_ebb_w10$age_retired %in% miss_values_vector)] <- HRS_ebb_w10$age_retired[which(HRS_ds_ebb_w10$retired==1 & !is.na(HRS_ebb_w10$age_retired) & !HRS_ebb_w10$age_retired %in% miss_values_vector)]
HRS_ds_ebb_w10$age_retired[which(HRS_ds_ebb_w10$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ebb_w10, echo=F}

vbl <- HRS_ds_ebb_w10$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w10, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ebb_w10$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ebb_w10,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ebb_w10, echo=F, results='asis'}









```



### Wave 11

#### Study-specific variable description

| **Name** | `R11SAYRET` | `R11RETMON` | `R11RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R11SAYRET:W11 R considers self retired`| `R11RETMON:W11 Month Retired if say retired` | `R11RETYR:W11 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-EBB-w11`| `HRS-EBB-w11`| `HRS-EBB-w11`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign ebb_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w11','HRS.HRS-EBB-w11',variables=list('R11SAYRET','R11RETMON','R11RETYR'), missings = T)
HRS_ebb_w11 <- opal.execute(o,'HRS_ebb_w11')
load(paste0(datafolder,"ebb_w11/mbirth.RData"))
HRS_ebb_w11 <- left_join(HRS_ebb_w11,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"ebb_w11/ybirth.RData"))
HRS_ebb_w11 <- left_join(HRS_ebb_w11,ybirth,by="id")
rm(ybirth)












```

```{r local ebb_w11, echo=F}

vbl <- HRS_ebb_w11$R11RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w11,!vbl %in% vbl_miss), aes(R11RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w11$R11RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w11,!vbl %in% vbl_miss), aes(R11RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w11$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w11,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_ebb_w11$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_ebb_w11,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_ebb_w11$R11SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R11SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w11, aes(x=factor(R11SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`








To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo ebb_w11}




# Categorical variable harmonization
HRS_ds_ebb_w11 <- tibble(id=HRS_ebb_w11$id)
HRS_ds_ebb_w11$retired <- car::recode(HRS_ebb_w11$R11SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_ebb_w11 <- left_join(HRS_ebb_w11,HRS_ds_ebb_w10, by="id")
# Continuous variable harmonization
HRS_ebb_w11$month <- car::recode(HRS_ebb_w11$R11RETMON, "NA = 999")
HRS_ebb_w11$year <- car::recode(HRS_ebb_w11$R11RETYR, "NA = 999")
HRS_ds_ebb_w11$age_retired <- comp_age(y_birth=HRS_ebb_w11$ybirth, m_birth=HRS_ebb_w11$mbirth , a_year=HRS_ebb_w11$year, a_month=HRS_ebb_w11$month, miss=miss_values_vector)
HRS_ds_ebb_w11$age_retired[which(HRS_ds_ebb_w11$retired==1 & !is.na(HRS_ebb_w11$age_retired) & !HRS_ebb_w11$age_retired %in% miss_values_vector)] <- HRS_ebb_w11$age_retired[which(HRS_ds_ebb_w11$retired==1 & !is.na(HRS_ebb_w11$age_retired) & !HRS_ebb_w11$age_retired %in% miss_values_vector)]
HRS_ds_ebb_w11$age_retired[which(HRS_ds_ebb_w11$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript ebb_w11, echo=F}

vbl <- HRS_ds_ebb_w11$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w11, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")





vbl <- HRS_ds_ebb_w11$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_ebb_w11,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")





```


#### Validation

```{r crosstabulation ebb_w11, echo=F, results='asis'}









```



## MBB


### Wave 10

#### Study-specific variable description

| **Name** | `R10SAYRET` | `R10RETMON` | `R10RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R10SAYRET:W10 R considers self retired`| `R10RETMON:W10 Month Retired if say retired` | `R10RETYR:W10 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-MBB-w10`| `HRS-MBB-w10`| `HRS-MBB-w10`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign mbb_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_mbb_w10','HRS.HRS-MBB-w10',variables=list('R10SAYRET','R10RETMON','R10RETYR'), missings = T)
HRS_mbb_w10 <- opal.execute(o,'HRS_mbb_w10')
load(paste0(datafolder,"mbb_w10/mbirth.RData"))
HRS_mbb_w10 <- left_join(HRS_mbb_w10,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"mbb_w10/ybirth.RData"))
HRS_mbb_w10 <- left_join(HRS_mbb_w10,ybirth,by="id")
rm(ybirth)

```

```{r local mbb_w10, echo=F}

vbl <- HRS_mbb_w10$R10RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w10,!vbl %in% vbl_miss), aes(R10RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_mbb_w10$R10RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R10RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w10,!vbl %in% vbl_miss), aes(R10RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_mbb_w10$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w10,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_mbb_w10$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w10,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_mbb_w10$R10SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R10SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w10, aes(x=factor(R10SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `change 0,2 into 0`
* `change 3 into 996`
* `NA into 999`



To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo mbb_w10}

# Categorical variable harmonization
HRS_ds_mbb_w10 <- tibble(id=HRS_mbb_w10$id)
HRS_ds_mbb_w10$retired <- car::recode(HRS_mbb_w10$R10SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

# Continuous variable harmonization
HRS_mbb_w10$month <- car::recode(HRS_mbb_w10$R10RETMON, "NA = 999")
HRS_mbb_w10$year <- car::recode(HRS_mbb_w10$R10RETYR, "NA = 999")
HRS_ds_mbb_w10$age_retired <- comp_age(y_birth=HRS_mbb_w10$ybirth, m_birth=HRS_mbb_w10$mbirth , a_year=HRS_mbb_w10$year, a_month=HRS_mbb_w10$month, miss=miss_values_vector)
HRS_ds_mbb_w10$age_retired[which(HRS_ds_mbb_w10$retired==0)] <- 996


```


#### Statistics of the new harmonized variable

```{r descript mbb_w10, echo=F}

vbl <- HRS_ds_mbb_w10$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_mbb_w10, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")


vbl <- HRS_ds_mbb_w10$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_mbb_w10,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")


```


#### Validation

```{r crosstabulation mbb_w10, echo=F}








```



### Wave 11

#### Study-specific variable description

| **Name** | `R11SAYRET` | `R11RETMON` | `R11RETYR` | `mbirth` | `ybirth` |
|-|-|-|-|-|-|
| **Label** | `R11SAYRET:W11 R considers self retired`| `R11RETMON:W11 Month Retired if say retired` | `R11RETYR:W11 Year Retired if say retired` | `month of birth` | `year of birth` |
| **Table name**  | `HRS-MBB-w11`| `HRS-MBB-w11`| `HRS-MBB-w11`| `mbirth` | `ybirth` |
| **Categories** | `0 = not ret`<br/>`1 = completely retired`<br/>`2 = partly retired`<br/>`3 = question irrelevant` |`continuous`|`continuous`|`continuous`|`continuous`|
| **Missings** | `NA`| `NA`| `NA`|`999 = Missing`|`999 = Missing`|
| **Description** |  |  |  |  |  |

```{r assign mbb_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_mbb_w11','HRS.HRS-MBB-w11',variables=list('R11SAYRET','R11RETMON','R11RETYR'), missings = T)
HRS_mbb_w11 <- opal.execute(o,'HRS_mbb_w11')
load(paste0(datafolder,"mbb_w11/mbirth.RData"))
HRS_mbb_w11 <- left_join(HRS_mbb_w11,mbirth,by="id")
rm(mbirth)
load(paste0(datafolder,"mbb_w11/ybirth.RData"))
HRS_mbb_w11 <- left_join(HRS_mbb_w11,ybirth,by="id")
rm(ybirth)












```

```{r local mbb_w11, echo=F}

vbl <- HRS_mbb_w11$R11RETMON
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETMON')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w11,!vbl %in% vbl_miss), aes(R11RETMON)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_mbb_w11$R11RETYR
vbl_miss <- NA
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'R11RETYR')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w11,!vbl %in% vbl_miss), aes(R11RETYR)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_mbb_w11$mbirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'mbirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w11,!vbl %in% vbl_miss), aes(mbirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")+scale_x_continuous(breaks=c(3,6,9,12))

vbl <- HRS_mbb_w11$ybirth
vbl_miss <- miss_values_vector
kable(Continuous_summary(var = vbl, missing_values = vbl_miss)[3], caption = 'ybirth')
pander(Continuous_summary(vbl, missing_values = vbl_miss)$summary, caption = "Summary")
ggplot(filter(HRS_mbb_w11,!vbl %in% vbl_miss), aes(ybirth)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


vbl <- HRS_mbb_w11$R11SAYRET
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = 'R11SAYRET')
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w11, aes(x=factor(R11SAYRET))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `retired` from the study-specific variable it has to be recoded as follows:

* `change 0,2 into 0`
* `keep up 1 into 1`
* `change 3 into 996`
* `otherwise into 999`







To compute `age_retired` from the study-specific variable it has to be recoded as follows:

* `age_retired = date of retirement - date of birth`

**R script:**

```{r harmo mbb_w11}




# Categorical variable harmonization
HRS_ds_mbb_w11 <- tibble(id=HRS_mbb_w11$id)
HRS_ds_mbb_w11$retired <- car::recode(HRS_mbb_w11$R11SAYRET, "c(0,2) = 0; 3 = 996; NA = 999")

HRS_mbb_w11 <- left_join(HRS_mbb_w11,HRS_ds_mbb_w10, by="id")
# Continuous variable harmonization
HRS_mbb_w11$month <- car::recode(HRS_mbb_w11$R11RETMON, "NA = 999")
HRS_mbb_w11$year <- car::recode(HRS_mbb_w11$R11RETYR, "NA = 999")
HRS_ds_mbb_w11$age_retired <- comp_age(y_birth=HRS_mbb_w11$ybirth, m_birth=HRS_mbb_w11$mbirth , a_year=HRS_mbb_w11$year, a_month=HRS_mbb_w11$month, miss=miss_values_vector)
HRS_ds_mbb_w11$age_retired[which(HRS_ds_mbb_w11$retired==1 & !is.na(HRS_mbb_w11$age_retired) & !HRS_mbb_w11$age_retired %in% miss_values_vector)] <- HRS_mbb_w11$age_retired[which(HRS_ds_mbb_w11$retired==1 & !is.na(HRS_mbb_w11$age_retired) & !HRS_mbb_w11$age_retired %in% miss_values_vector)]
HRS_ds_mbb_w11$age_retired[which(HRS_ds_mbb_w11$retired==0)] <- 996







```


#### Statistics of the new harmonized variable

```{r descript mbb_w11, echo=F}

vbl <- HRS_ds_mbb_w11$retired
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_mbb_w11, aes(x=factor(retired))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")






vbl <- HRS_ds_mbb_w11$age_retired
kable(Continuous_summary(var = vbl, missing_values = miss_values_vector)[3], caption = ds_label_age)
kable(Continuous_summary(vbl, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vbl, missing_values = miss_values_vector)$summary, caption = "Summary")
ggplot(filter(HRS_ds_mbb_w11,!vbl %in% miss_values_vector), aes(age_retired)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label_age) + ylab("Frequency")




```


#### Validation

```{r crosstabulation mbb_w11, echo=F, results='asis'}









```






## Summary of descriptive statistics of the harmonised variable accross populations and waves

Two tables are generated: 

1. Percentages of categories in each harmonised variable.

2. Frequencies and percentages of individuals with different trajectories. To avoid too large table, Only trajectories with percentages larger than 0.3 are shown.

**R script:**

```{r summ}

lb.hrs <- list(hrs_w1 = HRS_ds_hrs_w1, ahead_w2 = HRS_ds_ahead_w2, coda_w4 = HRS_ds_coda_w4, wb_w4 = HRS_ds_wb_w4, ebb_w7 = HRS_ds_ebb_w7, mbb_w10 = HRS_ds_mbb_w10)

lf.hrs <- list(hrs_w2 = HRS_ds_hrs_w2, hrs_w3 = HRS_ds_hrs_w3, hrs_w4 = HRS_ds_hrs_w4, hrs_w5 = HRS_ds_hrs_w5, hrs_w6 = HRS_ds_hrs_w6, hrs_w7 = HRS_ds_hrs_w7, hrs_w8 = HRS_ds_hrs_w8, hrs_w9 = HRS_ds_hrs_w9, hrs_w10 = HRS_ds_hrs_w10, hrs_w11 = HRS_ds_hrs_w11, ahead_w3 = HRS_ds_ahead_w3, ahead_w4 = HRS_ds_ahead_w4, ahead_w5 = HRS_ds_ahead_w5, ahead_w6 = HRS_ds_ahead_w6, ahead_w7 = HRS_ds_ahead_w7, ahead_w8 = HRS_ds_ahead_w8, ahead_w9 = HRS_ds_ahead_w9, ahead_w10 = HRS_ds_ahead_w10, ahead_w11 = HRS_ds_ahead_w11, coda_w5 = HRS_ds_coda_w5, coda_w6 = HRS_ds_coda_w6, coda_w7 = HRS_ds_coda_w7, coda_w8 = HRS_ds_coda_w8, coda_w9 = HRS_ds_coda_w9, coda_w10 = HRS_ds_coda_w10, coda_w11 = HRS_ds_coda_w11, wb_w5 = HRS_ds_wb_w5, wb_w6 = HRS_ds_wb_w6, wb_w7 = HRS_ds_wb_w7, wb_w8 = HRS_ds_wb_w8, wb_w9 = HRS_ds_wb_w9, wb_w10 = HRS_ds_wb_w10, wb_w11 = HRS_ds_wb_w11, ebb_w8 = HRS_ds_ebb_w8, ebb_w9 = HRS_ds_ebb_w9, ebb_w10 = HRS_ds_ebb_w10, ebb_w11 = HRS_ds_ebb_w11, mbb_w11 = HRS_ds_mbb_w11)

###################

for(name in names(lb.hrs)) {
  aux_object <- lb.hrs[[name]]
  label(lb.hrs[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label # Text value assigned at the DS description, at the top
  lb.hrs[[name]][[2]] <- labelled(lb.hrs[[name]][[2]], labels = cat_label)
  label(lb.hrs[[name]][[3]]) <- label(aux_object[[3]]) <- ds_label_age # Text value assigned at the DS description, at the top
  lb.hrs[[name]][[3]] <- labelled(lb.hrs[[name]][[3]], labels = cont_label)
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cat_label[1:2])
  m_name <- paste0("HRS_m_ds_",name)
  assign(m_name, aux_object)
  rm(aux_object)
}

for(name in names(lf.hrs)) {
  aux_object <- lf.hrs[[name]]
  label(lf.hrs[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label # Text value assigned at the DS description, at the top
  lf.hrs[[name]][[2]] <- labelled(lf.hrs[[name]][[2]], labels = cat_label)
  label(lf.hrs[[name]][[3]]) <- label(aux_object[[3]]) <- ds_label_age # Text value assigned at the DS description, at the top
  lf.hrs[[name]][[3]] <- labelled(lf.hrs[[name]][[3]], labels = cont_label)
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cat_label[1:2])
  m_name <- paste0("HRS_m_ds_",name)
  assign(m_name, aux_object)
  rm(aux_object)
}

##################################

mb.hrs <- list(hrs_w1 = HRS_m_ds_hrs_w1, ahead_w2 = HRS_m_ds_ahead_w2, coda_w4 = HRS_m_ds_coda_w4, wb_w4 = HRS_m_ds_wb_w4, ebb_w7 = HRS_m_ds_ebb_w7, mbb_w10 = HRS_m_ds_mbb_w10)

mf.hrs <- list(hrs_w2 = HRS_m_ds_hrs_w2, hrs_w3 = HRS_m_ds_hrs_w3, hrs_w4 = HRS_m_ds_hrs_w4, hrs_w5 = HRS_m_ds_hrs_w5, hrs_w6 = HRS_m_ds_hrs_w6, hrs_w7 = HRS_m_ds_hrs_w7, hrs_w8 = HRS_m_ds_hrs_w8, hrs_w9 = HRS_m_ds_hrs_w9, hrs_w10 = HRS_m_ds_hrs_w10, hrs_w11 = HRS_m_ds_hrs_w11, ahead_w3 = HRS_m_ds_ahead_w3, ahead_w4 = HRS_m_ds_ahead_w4, ahead_w5 = HRS_m_ds_ahead_w5, ahead_w6 = HRS_m_ds_ahead_w6, ahead_w7 = HRS_m_ds_ahead_w7, ahead_w8 = HRS_m_ds_ahead_w8, ahead_w9 = HRS_m_ds_ahead_w9, ahead_w10 = HRS_m_ds_ahead_w10, ahead_w11 = HRS_m_ds_ahead_w11, coda_w5 = HRS_m_ds_coda_w5, coda_w6 = HRS_m_ds_coda_w6, coda_w7 = HRS_m_ds_coda_w7, coda_w8 = HRS_m_ds_coda_w8, coda_w9 = HRS_m_ds_coda_w9, coda_w10 = HRS_m_ds_coda_w10, coda_w11 = HRS_m_ds_coda_w11, wb_w5 = HRS_m_ds_wb_w5, wb_w6 = HRS_m_ds_wb_w6, wb_w7 = HRS_m_ds_wb_w7, wb_w8 = HRS_m_ds_wb_w8, wb_w9 = HRS_m_ds_wb_w9, wb_w10 = HRS_m_ds_wb_w10, wb_w11 = HRS_m_ds_wb_w11, ebb_w8 = HRS_m_ds_ebb_w8, ebb_w9 = HRS_m_ds_ebb_w9, ebb_w10 = HRS_m_ds_ebb_w10, ebb_w11 = HRS_m_ds_ebb_w11, mbb_w11 = HRS_m_ds_mbb_w11)

#################################

# Table HRS
t.hrs <- frq(lb.hrs[[1]][2])[[1]][,c(1,2,4)] 
for (i in 1:10){
  t.hrs[3+i] <- frq(lf.hrs[[i]][2])[[1]][,4] 
}
t.hrs[13,] <- c("n", "sample size",  length(lb.hrs[[1]][[2]]), sapply(lf.hrs[1:10],function(wave) length(wave[[1]]))
           #  length(lf.hrs[[1]][[2]]), length(lf.hrs[[2]][[2]]), length(lf.hrs[[3]][[2]]), length(lf.hrs[[4]][[2]]), length(lf.hrs[[5]][[2]]), length(lf.hrs[[6]][[2]]), length(lf.hrs[[7]][[2]]), length(lf.hrs[[8]][[2]]), length(lf.hrs[[9]][[2]]), length(lf.hrs[[10]][[2]])
             )
names(t.hrs)<-c("val", "label", "w1", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.hrs)

dbb <- merge(HRS_m_ds_hrs_w1[,c("id","retired")], HRS_m_ds_hrs_w2[,c("id","retired")], by="id", suffixes = c(".w1",".w2"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w3[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w4[,c("id","retired")], by="id", suffixes = c(".w3",".w4"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w5[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w6[,c("id","retired")], by="id", suffixes = c(".w5",".w6"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w7[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w8[,c("id","retired")], by="id", suffixes = c(".w7",".w8"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w9[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w10[,c("id","retired")], by="id", suffixes = c(".w9",".w10"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w11[,c("id","retired")], by="id", all=T)
names(dbb) <- c("id", "w1", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],dbb[,9],dbb[,10],dbb[,11],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table AHEAD
t.ahead <- frq(lb.hrs[[2]][2])[[1]][,c(1,2,4)] 
for (i in 1:9){
  t.ahead[3+i] <- frq(lf.hrs[[i+10]][2])[[1]][,4] 
}
t.ahead[13,] <- c("n", "sample size", length(lb.hrs[[2]][[2]]), sapply(lf.hrs[11:19],function(wave) length(wave[[1]]))
#             length(lf.hrs[[11]][[2]]), length(lf.hrs[[12]][[2]]), length(lf.hrs[[13]][[2]]), length(lf.hrs[[14]][[2]]), length(lf.hrs[[15]][[2]]), length(lf.hrs[[16]][[2]]), length(lf.hrs[[17]][[2]]), length(lf.hrs[[18]][[2]]), length(lf.hrs[[19]][[2]])
             )
names(t.ahead)<-c("val", "label", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.ahead)

dbb <- merge(HRS_m_ds_ahead_w2[,c("id","retired")], HRS_m_ds_ahead_w3[,c("id","retired")], by="id", suffixes = c(".w2",".w3"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w4[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w5[,c("id","retired")], by="id", suffixes = c(".w4",".w5"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w6[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w7[,c("id","retired")], by="id", suffixes = c(".w6",".w7"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w8[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w9[,c("id","retired")], by="id", suffixes = c(".w8",".w9"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w10[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w11[,c("id","retired")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],dbb[,9],dbb[,10],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table CODA
t.coda <- frq(lb.hrs[[3]][2])[[1]][,c(1,2,4)] 
for (i in 1:7){
  t.coda[3+i] <- frq(lf.hrs[[19+i]][2])[[1]][,4] 
}
t.coda[13,] <- c("n", "sample size", length(lb.hrs[[3]][[2]]), sapply(lf.hrs[20:26],function(wave) length(wave[[1]]))
          #   length(lf.hrs[[20]][[2]]), length(lf.hrs[[21]][[2]]), length(lf.hrs[[22]][[2]]), length(lf.hrs[[23]][[2]]), length(lf.hrs[[24]][[2]]), length(lf.hrs[[25]][[2]]), length(lf.hrs[[26]][[2]])
             )
names(t.coda)<-c("val", "label", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.coda)

dbb <- merge(HRS_m_ds_coda_w4[,c("id","retired")], HRS_m_ds_coda_w5[,c("id","retired")], by="id", suffixes = c(".w4",".w5"), all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w6[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w7[,c("id","retired")], by="id", suffixes = c(".w6",".w7"), all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w8[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w9[,c("id","retired")], by="id", suffixes = c(".w8",".w9"), all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w10[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w11[,c("id","retired")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table WB
t.wb <- frq(lb.hrs[[4]][2])[[1]][,c(1,2,4)] 
for (i in 1:7){
  t.wb[3+i] <- frq(lf.hrs[[26+i]][2])[[1]][,4] 
}
t.wb[13,] <- c("n", "sample size", length(lb.hrs[[4]][[2]]), sapply(lf.hrs[27:33],function(wave) length(wave[[1]]))
#             length(lf.hrs[[27]][[2]]), length(lf.hrs[[28]][[2]]), length(lf.hrs[[29]][[2]]), length(lf.hrs[[30]][[2]]), length(lf.hrs[[31]][[2]]), length(lf.hrs[[32]][[2]]), length(lf.hrs[[33]][[2]])
             )
names(t.wb)<-c("val", "label", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.wb)

dbb <- merge(HRS_m_ds_wb_w4[,c("id","retired")], HRS_m_ds_wb_w5[,c("id","retired")], by="id", suffixes = c(".w4",".w5"), all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w6[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w7[,c("id","retired")], by="id", suffixes = c(".w6",".w7"), all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w8[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w9[,c("id","retired")], by="id", suffixes = c(".w8",".w9"), all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w10[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w11[,c("id","retired")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table EBB
t.ebb <- frq(lb.hrs[[5]][2])[[1]][,c(1,2,4)] 
for (i in 1:4){
  t.ebb[3+i] <- frq(lf.hrs[[33+i]][2])[[1]][,4] 
}
t.ebb[13,] <- c("n", "sample size", length(lb.hrs[[5]][[2]]), sapply(lf.hrs[34:37],function(wave) length(wave[[1]]))
#             length(lf.hrs[[34]][[2]]), length(lf.hrs[[35]][[2]]), length(lf.hrs[[36]][[2]]), length(lf.hrs[[37]][[2]])
             )
names(t.ebb)<-c("val", "label", "w7", "w8", "w9", "w10", "w11")
kable(t.ebb)

dbb <- merge(HRS_m_ds_ebb_w7[,c("id","retired")], HRS_m_ds_ebb_w8[,c("id","retired")], by="id", suffixes = c(".w7",".w8"), all=T)
dbb <- merge(dbb, HRS_m_ds_ebb_w9[,c("id","retired")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ebb_w10[,c("id","retired")], by="id", suffixes = c(".w9",".w10"), all=T)
dbb <- merge(dbb, HRS_m_ds_ebb_w11[,c("id","retired")], by="id", all=T)
names(dbb) <- c("id", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table MBB
t.mbb <- frq(lb.hrs[[6]][2])[[1]][,c(1,2,4)] 
for (i in 1:1){
  t.mbb[3+i] <- frq(lf.hrs[[37+i]][2])[[1]][,4] 
}
t.mbb[13,] <- c("n", "sample size", length(lb.hrs[[6]][[2]]), length(lf.hrs[[38]][[2]]))
names(t.mbb)<-c("val", "label", "w10", "w11")
kable(t.mbb)

dbb <- merge(HRS_m_ds_mbb_w10[,c("id","retired")], HRS_m_ds_mbb_w11[,c("id","retired")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

```



# Quality estimation

According to the original source ('randhrs_O.pdf'), `R_WORK` is derived from the question: "Are you currently working for pay?" It simply recodes this variable to a yes/no indicator and for missing values. In some waves a response of working but not for pay is allowed. This is generally treated as NOT working for pay. Nevertheless, in Wave 1 the first question may have a response of "working but not for pay".


<!-- ########################################################## --> 
<!-- # Save -->
```{r save, include=FALSE, echo=F}


for(name in names(lb.hrs)){
  retired <- lb.hrs[[name]]
  save(retired, file = paste0(datafolder,name,"/retired.RData"))
}

for(name in names(lf.hrs)) {
  retired <- lf.hrs[[name]]
  save(retired, file = paste0(datafolder,name,"/retired.RData"))
}


```
<!-- ########################################################## --> 






<!-- ########################################################## -->
<!--- # Close OPAL R Session -->
```{r closeRsession, echo=FALSE}
opal.logout(o)
```





