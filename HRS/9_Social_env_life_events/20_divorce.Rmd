---
title: "Divorce/Separation"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 


<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("../../setup_iago.r")
```
<!-- # Loading DS description -->
```{r main, child='../../_DS_Rmd/divorceDS.Rmd'}
```
```{r global, echo=F}
source('../../_DS_Rmd/divorceDS.R')
```


<!-- ########################################################## --> 

# Data process

## HRS
### Wave 1 

#### Study-specific variable description



| **Name** | `R1MSTAT`|
|-|-|
| **Label** |`R1MSTAT:W1 R Marital Status`|
| **Table name** |`HRS-HRS-w1`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |












```{r assign1 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w1_divorce','HRS.HRS-HRS-w1',variables=list('R1MSTAT'), missings = TRUE)
```

```{r local1 hrs, echo=F}
HRS_hrs_w1_divorce <- opal.execute(o,'HRS_hrs_w1_divorce')
vari <- HRS_hrs_w1_divorce$R1MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w1_divorce$R1MSTAT, missing_values = NA)
ggplot(HRS_hrs_w1_divorce, aes(x=factor(R1MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo1 hrs, echo=TRUE}
HRS_ds_hrs_w1 <- tibble(id=HRS_hrs_w1_divorce$id)
HRS_ds_hrs_w1$divorce <- car::recode(as.vector(HRS_hrs_w1_divorce$R1MSTAT), "4:6='1'; 1:3='0'; 7:8='0'; NA='999'")
HRS_ds_hrs_w1$divorce <- labelled(HRS_ds_hrs_w1$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1 hrs, echo=F}
vari <- HRS_ds_hrs_w1$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w1$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w1, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w1$divorce)
BeforeH <- table(HRS_hrs_w1_divorce$R1MSTAT, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(BeforeH[c(4,5)])
BeforeH1[[1]] <- sum(BeforeH[c(1,2,3,6,7)])
BeforeH1[[3]] <- BeforeH[[8]]
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("1:3&7:8->0","4:6->1","NA->999")
kable(C)
```




### Wave 2

#### Study-specific variable description



| **Name** | `R2MSTAT`|
|-|-|
| **Label** |`R2MSTAT:W2 R Marital Status`|
| **Table name** |`HRS-HRS-w2`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign2 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w2_divorce','HRS.HRS-HRS-w2',variables=list('R2MSTAT'), missings = TRUE)
```

```{r local2 hrs, echo=F}
HRS_hrs_w2_divorce <- opal.execute(o,'HRS_hrs_w2_divorce')
vari <- HRS_hrs_w2_divorce$R2MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w2_divorce$R2MSTAT, missing_values = NA)
ggplot(HRS_hrs_w2_divorce, aes(x=factor(R2MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if divorce=1 or R2MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo2 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R2MSTAT=new$R2MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w1 (divorce)
# new = HRS_hrs_w2_divorce (R2MSTAT)

HRS_hrs_w2_divorce_2 <- same_indiv(HRS_ds_hrs_w1, HRS_hrs_w2_divorce)

HRS_ds_hrs_w2 <- tibble(id=HRS_hrs_w2_divorce_2$id)

HRS_hrs_w2_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w2_divorce_2$divorce), "NA='-999'")
HRS_hrs_w2_divorce_2$R2MSTAT <- car::recode(as.vector(HRS_hrs_w2_divorce_2$R2MSTAT), "NA='-999'")

HRS_ds_hrs_w2$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w2_divorce_2[1])){
  if( HRS_hrs_w2_divorce_2$divorce[i] == 1 | HRS_hrs_w2_divorce_2$R2MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w2$divorce[i] = 1 }
  else if( HRS_hrs_w2_divorce_2$R2MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w2$divorce[i] = 0 }
}

HRS_ds_hrs_w2$divorce <- car::recode(as.vector(HRS_ds_hrs_w2$divorce), "NA='999'")
HRS_ds_hrs_w2$divorce <- labelled(HRS_ds_hrs_w2$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript2 hrs, echo=F}
vari <- HRS_ds_hrs_w2$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w2$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w2, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w2$divorce)
BeforeH <- table(HRS_hrs_w2_divorce_2$R2MSTAT, HRS_hrs_w2_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```


### Wave 3

#### Study-specific variable description



| **Name** | `R3MSTAT`|
|-|-|
| **Label** |`R3MSTAT:W3 R Marital Status`|
| **Table name** |`HRS-HRS-w3`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |














```{r assign3 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w3_divorce','HRS.HRS-HRS-w3',variables=list('R3MSTAT'), missings = TRUE)
```

```{r local3 hrs, echo=F}
HRS_hrs_w3_divorce <- opal.execute(o,'HRS_hrs_w3_divorce')
vari <- HRS_hrs_w3_divorce$R3MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w3_divorce$R3MSTAT, missing_values = NA)
ggplot(HRS_hrs_w3_divorce, aes(x=factor(R3MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R3MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo3 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R3MSTAT=new$R3MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w2 (divorce)
# new = HRS_hrs_w3_divorce (R3MSTAT)

HRS_hrs_w3_divorce_2 <- same_indiv(HRS_ds_hrs_w2, HRS_hrs_w3_divorce)

HRS_ds_hrs_w3 <- tibble(id=HRS_hrs_w3_divorce_2$id)

HRS_hrs_w3_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w3_divorce_2$divorce), "NA='-999'")
HRS_hrs_w3_divorce_2$R3MSTAT <- car::recode(as.vector(HRS_hrs_w3_divorce_2$R3MSTAT), "NA='-999'")

HRS_ds_hrs_w3$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w3_divorce_2[1])){
  if( HRS_hrs_w3_divorce_2$divorce[i] == 1 | HRS_hrs_w3_divorce_2$R3MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w3$divorce[i] = 1 }
  else if( HRS_hrs_w3_divorce_2$R3MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w3$divorce[i] = 0 }
}

HRS_ds_hrs_w3$divorce <- car::recode(as.vector(HRS_ds_hrs_w3$divorce), "NA='999'")
HRS_ds_hrs_w3$divorce <- labelled(HRS_ds_hrs_w3$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript3 hrs, echo=F}
vari <- HRS_ds_hrs_w3$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w3$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w3, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation3 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w3$divorce)
BeforeH <- table(HRS_hrs_w3_divorce_2$R3MSTAT, HRS_hrs_w3_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[5,c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,6,7),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```



### Wave 4

#### Study-specific variable description



| **Name** | `R4MSTAT`|
|-|-|
| **Label** |`R4MSTAT:W4 R Marital Status`|
| **Table name** |`HRS-HRS-w4`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |














```{r assign4 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w4_divorce','HRS.HRS-HRS-w4',variables=list('R4MSTAT'), missings = TRUE)
```

```{r local4 hrs, echo=F}
HRS_hrs_w4_divorce <- opal.execute(o,'HRS_hrs_w4_divorce')
vari <- HRS_hrs_w4_divorce$R4MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w4_divorce$R4MSTAT, missing_values = NA)
ggplot(HRS_hrs_w4_divorce, aes(x=factor(R4MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R4MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo4 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R4MSTAT=new$R4MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w3 (divorce)
# new = HRS_hrs_w4_divorce (R4MSTAT)

HRS_hrs_w4_divorce_2 <- same_indiv(HRS_ds_hrs_w3, HRS_hrs_w4_divorce)

HRS_ds_hrs_w4 <- tibble(id=HRS_hrs_w4_divorce_2$id)

HRS_hrs_w4_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w4_divorce_2$divorce), "NA='-999'")
HRS_hrs_w4_divorce_2$R4MSTAT <- car::recode(as.vector(HRS_hrs_w4_divorce_2$R4MSTAT), "NA='-999'")

HRS_ds_hrs_w4$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w4_divorce_2[1])){
  if( HRS_hrs_w4_divorce_2$divorce[i] == 1 | HRS_hrs_w4_divorce_2$R4MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w4$divorce[i] = 1 }
  else if( HRS_hrs_w4_divorce_2$R4MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w4$divorce[i] = 0 }
}

HRS_ds_hrs_w4$divorce <- car::recode(as.vector(HRS_ds_hrs_w4$divorce), "NA='999'")
HRS_ds_hrs_w4$divorce <- labelled(HRS_ds_hrs_w4$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript4 hrs, echo=F}
vari <- HRS_ds_hrs_w4$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w4$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w4, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation4 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w4$divorce)
BeforeH <- table(HRS_hrs_w4_divorce_2$R4MSTAT, HRS_hrs_w4_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```



### Wave 5

#### Study-specific variable description



| **Name** | `R5MSTAT`|
|-|-|
| **Label** |`R5MSTAT:W5 R Marital Status`|
| **Table name** |`HRS-HRS-w5`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |














```{r assign5 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w5_divorce','HRS.HRS-HRS-w5',variables=list('R5MSTAT'), missings = TRUE)
```

```{r local5 hrs, echo=F}
HRS_hrs_w5_divorce <- opal.execute(o,'HRS_hrs_w5_divorce')
vari <- HRS_hrs_w5_divorce$R5MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w5_divorce$R5MSTAT, missing_values = NA)
ggplot(HRS_hrs_w5_divorce, aes(x=factor(R5MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R5MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo5 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R5MSTAT=new$R5MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w4 (divorce)
# new = HRS_hrs_w5_divorce (R5MSTAT)

HRS_hrs_w5_divorce_2 <- same_indiv(HRS_ds_hrs_w4, HRS_hrs_w5_divorce)

HRS_ds_hrs_w5 <- tibble(id=HRS_hrs_w5_divorce_2$id)

HRS_hrs_w5_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w5_divorce_2$divorce), "NA='-999'")
HRS_hrs_w5_divorce_2$R5MSTAT <- car::recode(as.vector(HRS_hrs_w5_divorce_2$R5MSTAT), "NA='-999'")

HRS_ds_hrs_w5$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w5_divorce_2[1])){
  if( HRS_hrs_w5_divorce_2$divorce[i] == 1 | HRS_hrs_w5_divorce_2$R5MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w5$divorce[i] = 1 }
  else if( HRS_hrs_w5_divorce_2$R5MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w5$divorce[i] = 0 }
}

HRS_ds_hrs_w5$divorce <- car::recode(as.vector(HRS_ds_hrs_w5$divorce), "NA='999'")
HRS_ds_hrs_w5$divorce <- labelled(HRS_ds_hrs_w5$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript5 hrs, echo=F}
vari <- HRS_ds_hrs_w5$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w5$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w5, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation5 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w5$divorce)
BeforeH <- table(HRS_hrs_w5_divorce_2$R5MSTAT, HRS_hrs_w5_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 6

#### Study-specific variable description



| **Name** | `R6MSTAT`|
|-|-|
| **Label** |`R6MSTAT:W6 R Marital Status`|
| **Table name** |`HRS-HRS-w6`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign6 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w6_divorce','HRS.HRS-HRS-w6',variables=list('R6MSTAT'), missings = TRUE)
```

```{r local6 hrs, echo=F}
HRS_hrs_w6_divorce <- opal.execute(o,'HRS_hrs_w6_divorce')
vari <- HRS_hrs_w6_divorce$R6MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w6_divorce$R6MSTAT, missing_values = NA)
ggplot(HRS_hrs_w6_divorce, aes(x=factor(R6MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  


* `if divorce=1 or R6MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo6 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R6MSTAT=new$R6MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w5 (divorce)
# new = HRS_hrs_w6_divorce (R6MSTAT)

HRS_hrs_w6_divorce_2 <- same_indiv(HRS_ds_hrs_w5, HRS_hrs_w6_divorce)

HRS_ds_hrs_w6 <- tibble(id=HRS_hrs_w6_divorce_2$id)

HRS_hrs_w6_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w6_divorce_2$divorce), "NA='-999'")
HRS_hrs_w6_divorce_2$R6MSTAT <- car::recode(as.vector(HRS_hrs_w6_divorce_2$R6MSTAT), "NA='-999'")

HRS_ds_hrs_w6$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w6_divorce_2[1])){
  if( HRS_hrs_w6_divorce_2$divorce[i] == 1 | HRS_hrs_w6_divorce_2$R6MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w6$divorce[i] = 1 }
  else if( HRS_hrs_w6_divorce_2$R6MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w6$divorce[i] = 0 }
}

HRS_ds_hrs_w6$divorce <- car::recode(as.vector(HRS_ds_hrs_w6$divorce), "NA='999'")
HRS_ds_hrs_w6$divorce <- labelled(HRS_ds_hrs_w6$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript6 hrs, echo=F}
vari <- HRS_ds_hrs_w6$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w6$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w6, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w6$divorce)
BeforeH <- table(HRS_hrs_w6_divorce_2$R6MSTAT, HRS_hrs_w6_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 7

#### Study-specific variable description



| **Name** | `R7MSTAT`|
|-|-|
| **Label** |`R7MSTAT:W7 R Marital Status`|
| **Table name** |`HRS-HRS-w7`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    

    


```{r assign7 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w7_divorce','HRS.HRS-HRS-w7',variables=list('R7MSTAT'), missings = TRUE)
```

```{r local7 hrs, echo=F}
HRS_hrs_w7_divorce <- opal.execute(o,'HRS_hrs_w7_divorce')
vari <- HRS_hrs_w7_divorce$R7MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w7_divorce$R7MSTAT, missing_values = NA)
ggplot(HRS_hrs_w7_divorce, aes(x=factor(R7MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R7MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo7 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R7MSTAT=new$R7MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w6 (divorce)
# new = HRS_hrs_w7_divorce (R7MSTAT)

HRS_hrs_w7_divorce_2 <- same_indiv(HRS_ds_hrs_w6, HRS_hrs_w7_divorce)

HRS_ds_hrs_w7 <- tibble(id=HRS_hrs_w7_divorce_2$id)

HRS_hrs_w7_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w7_divorce_2$divorce), "NA='-999'")
HRS_hrs_w7_divorce_2$R7MSTAT <- car::recode(as.vector(HRS_hrs_w7_divorce_2$R7MSTAT), "NA='-999'")

HRS_ds_hrs_w7$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w7_divorce_2[1])){
  if( HRS_hrs_w7_divorce_2$divorce[i] == 1 | HRS_hrs_w7_divorce_2$R7MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w7$divorce[i] = 1 }
  else if( HRS_hrs_w7_divorce_2$R7MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w7$divorce[i] = 0 }
}

HRS_ds_hrs_w7$divorce <- car::recode(as.vector(HRS_ds_hrs_w7$divorce), "NA='999'")
HRS_ds_hrs_w7$divorce <- labelled(HRS_ds_hrs_w7$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript7 hrs, echo=F}
vari <- HRS_ds_hrs_w7$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w7$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w7, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation7 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w7$divorce)
BeforeH <- table(HRS_hrs_w7_divorce_2$R7MSTAT, HRS_hrs_w7_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```



### Wave 8

#### Study-specific variable description



| **Name** | `R8MSTAT`|
|-|-|
| **Label** |`R8MSTAT:W8 R Marital Status`|
| **Table name** |`HRS-HRS-w8`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign8 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w8_divorce','HRS.HRS-HRS-w8',variables=list('R8MSTAT'), missings = TRUE)
```

```{r local8 hrs, echo=F}
HRS_hrs_w8_divorce <- opal.execute(o,'HRS_hrs_w8_divorce')
vari <- HRS_hrs_w8_divorce$R8MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w8_divorce$R8MSTAT, missing_values = NA)
ggplot(HRS_hrs_w8_divorce, aes(x=factor(R8MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows: 

* `if divorce=1 or R8MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo8 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R8MSTAT=new$R8MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w7 (divorce)
# new = HRS_hrs_w8_divorce (R8MSTAT)

HRS_hrs_w8_divorce_2 <- same_indiv(HRS_ds_hrs_w7, HRS_hrs_w8_divorce)

HRS_ds_hrs_w8 <- tibble(id=HRS_hrs_w8_divorce_2$id)

HRS_hrs_w8_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w8_divorce_2$divorce), "NA='-999'")
HRS_hrs_w8_divorce_2$R8MSTAT <- car::recode(as.vector(HRS_hrs_w8_divorce_2$R8MSTAT), "NA='-999'")

HRS_ds_hrs_w8$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w8_divorce_2[1])){
  if( HRS_hrs_w8_divorce_2$divorce[i] == 1 | HRS_hrs_w8_divorce_2$R8MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w8$divorce[i] = 1 }
  else if( HRS_hrs_w8_divorce_2$R8MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w8$divorce[i] = 0 }
}

HRS_ds_hrs_w8$divorce <- car::recode(as.vector(HRS_ds_hrs_w8$divorce), "NA='999'")
HRS_ds_hrs_w8$divorce <- labelled(HRS_ds_hrs_w8$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript8 hrs, echo=F}
vari <- HRS_ds_hrs_w8$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w8$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w8, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation8 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w8$divorce)
BeforeH <- table(HRS_hrs_w8_divorce_2$R8MSTAT, HRS_hrs_w8_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```



### Wave 9

#### Study-specific variable description



| **Name** | `R9MSTAT`|
|-|-|
| **Label** |`R9MSTAT:W9 R Marital Status`|
| **Table name** |`HRS-HRS-w9`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign9 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w9_divorce','HRS.HRS-HRS-w9',variables=list('R9MSTAT'), missings = TRUE)
```

```{r local9 hrs, echo=F}
HRS_hrs_w9_divorce <- opal.execute(o,'HRS_hrs_w9_divorce')
vari <- HRS_hrs_w9_divorce$R9MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w9_divorce$R9MSTAT, missing_values = NA)
ggplot(HRS_hrs_w9_divorce, aes(x=factor(R9MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R9MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo9 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R9MSTAT=new$R9MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w8 (divorce)
# new = HRS_hrs_w9_divorce (R9MSTAT)

HRS_hrs_w9_divorce_2 <- same_indiv(HRS_ds_hrs_w8, HRS_hrs_w9_divorce)

HRS_ds_hrs_w9 <- tibble(id=HRS_hrs_w9_divorce_2$id)

HRS_hrs_w9_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w9_divorce_2$divorce), "NA='-999'")
HRS_hrs_w9_divorce_2$R9MSTAT <- car::recode(as.vector(HRS_hrs_w9_divorce_2$R9MSTAT), "NA='-999'")

HRS_ds_hrs_w9$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w9_divorce_2[1])){
  if( HRS_hrs_w9_divorce_2$divorce[i] == 1 | HRS_hrs_w9_divorce_2$R9MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w9$divorce[i] = 1 }
  else if( HRS_hrs_w9_divorce_2$R9MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w9$divorce[i] = 0 }
}

HRS_ds_hrs_w9$divorce <- car::recode(as.vector(HRS_ds_hrs_w9$divorce), "NA='999'")
HRS_ds_hrs_w9$divorce <- labelled(HRS_ds_hrs_w9$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript9 hrs, echo=F}
vari <- HRS_ds_hrs_w9$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w9$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w9, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation9 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w9$divorce)
BeforeH <- table(HRS_hrs_w9_divorce_2$R9MSTAT, HRS_hrs_w9_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```



### Wave 10

#### Study-specific variable description



| **Name** | `R10MSTAT`|
|-|-|
| **Label** |`R10MSTAT:W10 R Marital Status`|
| **Table name** |`HRS-HRS-w10`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign10 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w10_divorce','HRS.HRS-HRS-w10',variables=list('R10MSTAT'), missings = TRUE)
```

```{r local10 hrs, echo=F}
HRS_hrs_w10_divorce <- opal.execute(o,'HRS_hrs_w10_divorce')
vari <- HRS_hrs_w10_divorce$R10MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w10_divorce$R10MSTAT, missing_values = NA)
ggplot(HRS_hrs_w10_divorce, aes(x=factor(R10MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R10MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo10 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R10MSTAT=new$R10MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w9 (divorce)
# new = HRS_hrs_w10_divorce (R10MSTAT)

HRS_hrs_w10_divorce_2 <- same_indiv(HRS_ds_hrs_w9, HRS_hrs_w10_divorce)

HRS_ds_hrs_w10 <- tibble(id=HRS_hrs_w10_divorce_2$id)

HRS_hrs_w10_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w10_divorce_2$divorce), "NA='-999'")
HRS_hrs_w10_divorce_2$R10MSTAT <- car::recode(as.vector(HRS_hrs_w10_divorce_2$R10MSTAT), "NA='-999'")

HRS_ds_hrs_w10$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w10_divorce_2[1])){
  if( HRS_hrs_w10_divorce_2$divorce[i] == 1 | HRS_hrs_w10_divorce_2$R10MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w10$divorce[i] = 1 }
  else if( HRS_hrs_w10_divorce_2$R10MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w10$divorce[i] = 0 }
}

HRS_ds_hrs_w10$divorce <- car::recode(as.vector(HRS_ds_hrs_w10$divorce), "NA='999'")
HRS_ds_hrs_w10$divorce <- labelled(HRS_ds_hrs_w10$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript10 hrs, echo=F}
vari <- HRS_ds_hrs_w10$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w10$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w10, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w10$divorce)
BeforeH <- table(HRS_hrs_w10_divorce_2$R10MSTAT, HRS_hrs_w10_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```





### Wave 11

#### Study-specific variable description



| **Name** | `R11MSTAT`|
|-|-|
| **Label** |`R11MSTAT:W11 R Marital Status`|
| **Table name** |`HRS-HRS-w11`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    

    

```{r assign11 hrs, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w11_divorce','HRS.HRS-HRS-w11',variables=list('R11MSTAT'), missings = TRUE)
```

```{r local11 hrs, echo=F}
HRS_hrs_w11_divorce <- opal.execute(o,'HRS_hrs_w11_divorce')
vari <- HRS_hrs_w11_divorce$R11MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_hrs_w11_divorce$R11MSTAT, missing_values = NA)
ggplot(HRS_hrs_w11_divorce, aes(x=factor(R11MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R11MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo11 hrs, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R11MSTAT=new$R11MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_hrs_w10 (divorce)
# new = HRS_hrs_w11_divorce (R11MSTAT)

HRS_hrs_w11_divorce_2 <- same_indiv(HRS_ds_hrs_w10, HRS_hrs_w11_divorce)

HRS_ds_hrs_w11 <- tibble(id=HRS_hrs_w11_divorce_2$id)

HRS_hrs_w11_divorce_2$divorce <- car::recode(as.vector(HRS_hrs_w11_divorce_2$divorce), "NA='-999'")
HRS_hrs_w11_divorce_2$R11MSTAT <- car::recode(as.vector(HRS_hrs_w11_divorce_2$R11MSTAT), "NA='-999'")

HRS_ds_hrs_w11$divorce <- c(NA)   
for(i in 1:dim(HRS_hrs_w11_divorce_2[1])){
  if( HRS_hrs_w11_divorce_2$divorce[i] == 1 | HRS_hrs_w11_divorce_2$R11MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_hrs_w11$divorce[i] = 1 }
  else if( HRS_hrs_w11_divorce_2$R11MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_hrs_w11$divorce[i] = 0 }
}

HRS_ds_hrs_w11$divorce <- car::recode(as.vector(HRS_ds_hrs_w11$divorce), "NA='999'")
HRS_ds_hrs_w11$divorce <- labelled(HRS_ds_hrs_w11$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript11 hrs, echo=F}
vari <- HRS_ds_hrs_w11$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_hrs_w11$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_hrs_w11, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11 hrs, echo=F}
AfterH <- table(HRS_ds_hrs_w11$divorce)
BeforeH <- table(HRS_hrs_w11_divorce_2$R11MSTAT, HRS_hrs_w11_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```

## AHEAD 
 

### Wave 2

#### Study-specific variable description



| **Name** | `R2MSTAT`|
|-|-|
| **Label** |`R2MSTAT:W2 R Marital Status`|
| **Table name** |`HRS-AHEAD-w2`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |












```{r assign2 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w2_divorce','HRS.HRS-AHEAD-w2', variables=list('R2MSTAT'), missings = TRUE)
```

```{r local2 ahead, echo=F}
HRS_ahead_w2_divorce <- opal.execute(o,'HRS_ahead_w2_divorce')
vari <- HRS_ahead_w2_divorce$R2MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w2_divorce$R2MSTAT, missing_values = NA)
ggplot(HRS_ahead_w2_divorce, aes(x=factor(R2MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo2 ahead, echo=TRUE}
HRS_ds_ahead_w2 <- tibble(id=HRS_ahead_w2_divorce$id)
HRS_ds_ahead_w2$divorce <- car::recode(as.vector(HRS_ahead_w2_divorce$R2MSTAT), "4:6='1'; 1:3='0'; 7:8='0'; NA='999'")
HRS_ds_ahead_w2$divorce <- labelled(HRS_ds_ahead_w2$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript2 ahead, echo=F}
vari <- HRS_ds_ahead_w2$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w2$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w2, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w2$divorce)
BeforeH <- table(HRS_ahead_w2_divorce$R2MSTAT, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- BeforeH[[4]]
BeforeH1[[1]] <- sum(BeforeH[c(1,2,3,5,6)])
BeforeH1[[3]] <- BeforeH[[7]]
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("1:3&7:8->0","4:6->1","NA->999")
kable(C)
```




### Wave 3

#### Study-specific variable description



| **Name** | `R3MSTAT`|
|-|-|
| **Label** |`R3MSTAT:W3 R Marital Status`|
| **Table name** |`HRS-AHEAD-w3`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign3 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w3_divorce','HRS.HRS-AHEAD-w3',variables=list('R3MSTAT'), missings = TRUE)
```

```{r local3 ahead, echo=F}
HRS_ahead_w3_divorce <- opal.execute(o,'HRS_ahead_w3_divorce')
vari <- HRS_ahead_w3_divorce$R3MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w3_divorce$R3MSTAT, missing_values = NA)
ggplot(HRS_ahead_w3_divorce, aes(x=factor(R3MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R3MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo3 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R3MSTAT=new$R3MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w2 (divorce)
# new = HRS_ahead_w3_divorce (R3MSTAT)

HRS_ahead_w3_divorce_2 <- same_indiv(HRS_ds_ahead_w2, HRS_ahead_w3_divorce)

HRS_ds_ahead_w3 <- tibble(id=HRS_ahead_w3_divorce_2$id)

HRS_ahead_w3_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w3_divorce_2$divorce), "NA='-999'")
HRS_ahead_w3_divorce_2$R3MSTAT <- car::recode(as.vector(HRS_ahead_w3_divorce_2$R3MSTAT), "NA='-999'")

HRS_ds_ahead_w3$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w3_divorce_2[1])){
  if( HRS_ahead_w3_divorce_2$divorce[i] == 1 | HRS_ahead_w3_divorce_2$R3MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w3$divorce[i] = 1 }
  else if( HRS_ahead_w3_divorce_2$R3MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w3$divorce[i] = 0 }
}

HRS_ds_ahead_w3$divorce <- car::recode(as.vector(HRS_ds_ahead_w3$divorce), "NA='999'")
HRS_ds_ahead_w3$divorce <- labelled(HRS_ds_ahead_w3$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript3 ahead, echo=F}
vari <- HRS_ds_ahead_w3$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w3$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w3, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation3 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w3$divorce)
BeforeH <- table(HRS_ahead_w3_divorce_2$R3MSTAT, HRS_ahead_w3_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[5,c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,6,7),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```

 

### Wave 4

#### Study-specific variable description



| **Name** | `R4MSTAT`|
|-|-|
| **Label** |`R4MSTAT:W4 R Marital Status`|
| **Table name** |`HRS-AHEAD-w4`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign4 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w4_divorce','HRS.HRS-AHEAD-w4',variables=list('R4MSTAT'), missings = TRUE)
```

```{r local4 ahead, echo=F}
HRS_ahead_w4_divorce <- opal.execute(o,'HRS_ahead_w4_divorce')
vari <- HRS_ahead_w4_divorce$R4MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w4_divorce$R4MSTAT, missing_values = NA)
ggplot(HRS_ahead_w4_divorce, aes(x=factor(R4MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R4MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo4 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R4MSTAT=new$R4MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w3 (divorce)
# new = HRS_ahead_w4_divorce (R4MSTAT)

HRS_ahead_w4_divorce_2 <- same_indiv(HRS_ds_ahead_w3, HRS_ahead_w4_divorce)

HRS_ds_ahead_w4 <- tibble(id=HRS_ahead_w4_divorce_2$id)

HRS_ahead_w4_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w4_divorce_2$divorce), "NA='-999'")
HRS_ahead_w4_divorce_2$R4MSTAT <- car::recode(as.vector(HRS_ahead_w4_divorce_2$R4MSTAT), "NA='-999'")

HRS_ds_ahead_w4$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w4_divorce_2[1])){
  if( HRS_ahead_w4_divorce_2$divorce[i] == 1 | HRS_ahead_w4_divorce_2$R4MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w4$divorce[i] = 1 }
  else if( HRS_ahead_w4_divorce_2$R4MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w4$divorce[i] = 0 }
}

HRS_ds_ahead_w4$divorce <- car::recode(as.vector(HRS_ds_ahead_w4$divorce), "NA='999'")
HRS_ds_ahead_w4$divorce <- labelled(HRS_ds_ahead_w4$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript4 ahead, echo=F}
vari <- HRS_ds_ahead_w4$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w4$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w4, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation4 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w4$divorce)
BeforeH <- table(HRS_ahead_w4_divorce_2$R4MSTAT, HRS_ahead_w4_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 5

#### Study-specific variable description



| **Name** | `R5MSTAT`|
|-|-|
| **Label** |`R5MSTAT:W5 R Marital Status`|
| **Table name** |`HRS-AHEAD-w5`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign5 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w5_divorce','HRS.HRS-AHEAD-w5',variables=list('R5MSTAT'), missings = TRUE)
```

```{r local5 ahead, echo=F}
HRS_ahead_w5_divorce <- opal.execute(o,'HRS_ahead_w5_divorce')
vari <- HRS_ahead_w5_divorce$R5MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w5_divorce$R5MSTAT, missing_values = NA)
ggplot(HRS_ahead_w5_divorce, aes(x=factor(R5MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R5MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo5 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R5MSTAT=new$R5MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w4 (divorce)
# new = HRS_ahead_w5_divorce (R5MSTAT)

HRS_ahead_w5_divorce_2 <- same_indiv(HRS_ds_ahead_w4, HRS_ahead_w5_divorce)

HRS_ds_ahead_w5 <- tibble(id=HRS_ahead_w5_divorce_2$id)

HRS_ahead_w5_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w5_divorce_2$divorce), "NA='-999'")
HRS_ahead_w5_divorce_2$R5MSTAT <- car::recode(as.vector(HRS_ahead_w5_divorce_2$R5MSTAT), "NA='-999'")

HRS_ds_ahead_w5$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w5_divorce_2[1])){
  if( HRS_ahead_w5_divorce_2$divorce[i] == 1 | HRS_ahead_w5_divorce_2$R5MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w5$divorce[i] = 1 }
  else if( HRS_ahead_w5_divorce_2$R5MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w5$divorce[i] = 0 }
}

HRS_ds_ahead_w5$divorce <- car::recode(as.vector(HRS_ds_ahead_w5$divorce), "NA='999'")
HRS_ds_ahead_w5$divorce <- labelled(HRS_ds_ahead_w5$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript5 ahead, echo=F}
vari <- HRS_ds_ahead_w5$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w5$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w5, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation5 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w5$divorce)
BeforeH <- table(HRS_ahead_w5_divorce_2$R5MSTAT, HRS_ahead_w5_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 6

#### Study-specific variable description



| **Name** | `R6MSTAT`|
|-|-|
| **Label** |`R6MSTAT:W6 R Marital Status`|
| **Table name** |`HRS-AHEAD-w6`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign6 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w6_divorce','HRS.HRS-AHEAD-w6',variables=list('R6MSTAT'), missings = TRUE)
```

```{r local6 ahead, echo=F}
HRS_ahead_w6_divorce <- opal.execute(o,'HRS_ahead_w6_divorce')
vari <- HRS_ahead_w6_divorce$R6MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w6_divorce$R6MSTAT, missing_values = NA)
ggplot(HRS_ahead_w6_divorce, aes(x=factor(R6MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R6MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo6 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R6MSTAT=new$R6MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w5 (divorce)
# new = HRS_ahead_w6_divorce (R6MSTAT)

HRS_ahead_w6_divorce_2 <- same_indiv(HRS_ds_ahead_w5, HRS_ahead_w6_divorce)

HRS_ds_ahead_w6 <- tibble(id=HRS_ahead_w6_divorce_2$id)

HRS_ahead_w6_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w6_divorce_2$divorce), "NA='-999'")
HRS_ahead_w6_divorce_2$R6MSTAT <- car::recode(as.vector(HRS_ahead_w6_divorce_2$R6MSTAT), "NA='-999'")

HRS_ds_ahead_w6$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w6_divorce_2[1])){
  if( HRS_ahead_w6_divorce_2$divorce[i] == 1 | HRS_ahead_w6_divorce_2$R6MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w6$divorce[i] = 1 }
  else if( HRS_ahead_w6_divorce_2$R6MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w6$divorce[i] = 0 }
}

HRS_ds_ahead_w6$divorce <- car::recode(as.vector(HRS_ds_ahead_w6$divorce), "NA='999'")
HRS_ds_ahead_w6$divorce <- labelled(HRS_ds_ahead_w6$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript6 ahead, echo=F}
vari <- HRS_ds_ahead_w6$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w6$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w6, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w6$divorce)
BeforeH <- table(HRS_ahead_w6_divorce_2$R6MSTAT, HRS_ahead_w6_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 7

#### Study-specific variable description



| **Name** | `R7MSTAT`|
|-|-|
| **Label** |`R7MSTAT:W7 R Marital Status`|
| **Table name** |`HRS-AHEAD-w7`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign7 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w7_divorce','HRS.HRS-AHEAD-w7', variables=list('R7MSTAT'), missings = TRUE)
```

```{r local7 ahead, echo=F}
HRS_ahead_w7_divorce <- opal.execute(o,'HRS_ahead_w7_divorce')
vari <- HRS_ahead_w7_divorce$R7MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w7_divorce$R7MSTAT, missing_values = NA)
ggplot(HRS_ahead_w7_divorce, aes(x=factor(R7MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R7MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo7 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R7MSTAT=new$R7MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w6 (divorce)
# new = HRS_ahead_w7_divorce (R7MSTAT)

HRS_ahead_w7_divorce_2 <- same_indiv(HRS_ds_ahead_w6, HRS_ahead_w7_divorce)

HRS_ds_ahead_w7 <- tibble(id=HRS_ahead_w7_divorce_2$id)

HRS_ahead_w7_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w7_divorce_2$divorce), "NA='-999'")
HRS_ahead_w7_divorce_2$R7MSTAT <- car::recode(as.vector(HRS_ahead_w7_divorce_2$R7MSTAT), "NA='-999'")

HRS_ds_ahead_w7$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w7_divorce_2[1])){
  if( HRS_ahead_w7_divorce_2$divorce[i] == 1 | HRS_ahead_w7_divorce_2$R7MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w7$divorce[i] = 1 }
  else if( HRS_ahead_w7_divorce_2$R7MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w7$divorce[i] = 0 }
}

HRS_ds_ahead_w7$divorce <- car::recode(as.vector(HRS_ds_ahead_w7$divorce), "NA='999'")
HRS_ds_ahead_w7$divorce <- labelled(HRS_ds_ahead_w7$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript7 ahead, echo=F}
vari <- HRS_ds_ahead_w7$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w7$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w7, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation7 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w7$divorce)
BeforeH <- table(HRS_ahead_w7_divorce_2$R7MSTAT, HRS_ahead_w7_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 8

#### Study-specific variable description



| **Name** | `R8MSTAT`|
|-|-|
| **Label** |`R8MSTAT:W8 R Marital Status`|
| **Table name** |`HRS-AHEAD-w8`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |














```{r assign8 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w8_divorce','HRS.HRS-AHEAD-w8',variables=list('R8MSTAT'), missings = TRUE)
```

```{r local8 ahead, echo=F}
HRS_ahead_w8_divorce <- opal.execute(o,'HRS_ahead_w8_divorce')
vari <- HRS_ahead_w8_divorce$R8MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w8_divorce$R8MSTAT, missing_values = NA)
ggplot(HRS_ahead_w8_divorce, aes(x=factor(R8MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R8MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo8 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R8MSTAT=new$R8MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w7 (divorce)
# new = HRS_ahead_w4_divorce (R8MSTAT)

HRS_ahead_w8_divorce_2 <- same_indiv(HRS_ds_ahead_w7, HRS_ahead_w8_divorce)

HRS_ds_ahead_w8 <- tibble(id=HRS_ahead_w8_divorce_2$id)

HRS_ahead_w8_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w8_divorce_2$divorce), "NA='-999'")
HRS_ahead_w8_divorce_2$R8MSTAT <- car::recode(as.vector(HRS_ahead_w8_divorce_2$R8MSTAT), "NA='-999'")

HRS_ds_ahead_w8$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w8_divorce_2[1])){
  if( HRS_ahead_w8_divorce_2$divorce[i] == 1 | HRS_ahead_w8_divorce_2$R8MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w8$divorce[i] = 1 }
  else if( HRS_ahead_w8_divorce_2$R8MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w8$divorce[i] = 0 }
}

HRS_ds_ahead_w8$divorce <- car::recode(as.vector(HRS_ds_ahead_w8$divorce), "NA='999'")
HRS_ds_ahead_w8$divorce <- labelled(HRS_ds_ahead_w8$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript8 ahead, echo=F}
vari <- HRS_ds_ahead_w8$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w8$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w8, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation8 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w8$divorce)
BeforeH <- table(HRS_ahead_w8_divorce_2$R8MSTAT, HRS_ahead_w8_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 9

#### Study-specific variable description



| **Name** | `R9MSTAT`|
|-|-|
| **Label** |`R9MSTAT:W9 R Marital Status`|
| **Table name** |`HRS-AHEAD-w9`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |














```{r assign9 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w9_divorce','HRS.HRS-AHEAD-w9',variables=list('R9MSTAT'), missings = TRUE)
```

```{r local9 ahead, echo=F}
HRS_ahead_w9_divorce <- opal.execute(o,'HRS_ahead_w9_divorce')
vari <- HRS_ahead_w9_divorce$R9MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w9_divorce$R9MSTAT, missing_values = NA)
ggplot(HRS_ahead_w9_divorce, aes(x=factor(R9MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R9MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo9 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R9MSTAT=new$R9MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w8 (divorce)
# new = HRS_ahead_w9_divorce (R9MSTAT)

HRS_ahead_w9_divorce_2 <- same_indiv(HRS_ds_ahead_w8, HRS_ahead_w9_divorce)

HRS_ds_ahead_w9 <- tibble(id=HRS_ahead_w9_divorce_2$id)

HRS_ahead_w9_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w9_divorce_2$divorce), "NA='-999'")
HRS_ahead_w9_divorce_2$R9MSTAT <- car::recode(as.vector(HRS_ahead_w9_divorce_2$R9MSTAT), "NA='-999'")

HRS_ds_ahead_w9$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w9_divorce_2[1])){
  if( HRS_ahead_w9_divorce_2$divorce[i] == 1 | HRS_ahead_w9_divorce_2$R9MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w9$divorce[i] = 1 }
  else if( HRS_ahead_w9_divorce_2$R9MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w9$divorce[i] = 0 }
}

HRS_ds_ahead_w9$divorce <- car::recode(as.vector(HRS_ds_ahead_w9$divorce), "NA='999'")
HRS_ds_ahead_w9$divorce <- labelled(HRS_ds_ahead_w9$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript9 ahead, echo=F}
vari <- HRS_ds_ahead_w9$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w9$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w9, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation9 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w9$divorce)
BeforeH <- table(HRS_ahead_w9_divorce_2$R9MSTAT, HRS_ahead_w9_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```





### Wave 10

#### Study-specific variable description



| **Name** | `R10MSTAT`|
|-|-|
| **Label** |`R10MSTAT:W10 R Marital Status`|
| **Table name** |`HRS-AHEAD-w10`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign10 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w10_divorce','HRS.HRS-AHEAD-w10',variables=list('R10MSTAT'), missings = TRUE)
```

```{r local10 ahead, echo=F}
HRS_ahead_w10_divorce <- opal.execute(o,'HRS_ahead_w10_divorce')
vari <- HRS_ahead_w10_divorce$R10MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w10_divorce$R10MSTAT, missing_values = NA)
ggplot(HRS_ahead_w10_divorce, aes(x=factor(R10MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R10MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo10 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R10MSTAT=new$R10MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w9 (divorce)
# new = HRS_ahead_w10_divorce (R10MSTAT)

HRS_ahead_w10_divorce_2 <- same_indiv(HRS_ds_ahead_w9, HRS_ahead_w10_divorce)

HRS_ds_ahead_w10 <- tibble(id=HRS_ahead_w10_divorce_2$id)

HRS_ahead_w10_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w10_divorce_2$divorce), "NA='-999'")
HRS_ahead_w10_divorce_2$R10MSTAT <- car::recode(as.vector(HRS_ahead_w10_divorce_2$R10MSTAT), "NA='-999'")

HRS_ds_ahead_w10$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w10_divorce_2[1])){
  if( HRS_ahead_w10_divorce_2$divorce[i] == 1 | HRS_ahead_w10_divorce_2$R10MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w10$divorce[i] = 1 }
  else if( HRS_ahead_w10_divorce_2$R10MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w10$divorce[i] = 0 }
}

HRS_ds_ahead_w10$divorce <- car::recode(as.vector(HRS_ds_ahead_w10$divorce), "NA='999'")
HRS_ds_ahead_w10$divorce <- labelled(HRS_ds_ahead_w10$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript10 ahead, echo=F}
vari <- HRS_ds_ahead_w10$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w10$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w10, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w10$divorce)
BeforeH <- table(HRS_ahead_w10_divorce_2$R10MSTAT, HRS_ahead_w10_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```





### Wave 11

#### Study-specific variable description



| **Name** | `R11MSTAT`|
|-|-|
| **Label** |`R11MSTAT:W11 R Marital Status`|
| **Table name** |`HRS-AHEAD-w11`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    
    
    

```{r assign11 ahead, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w11_divorce','HRS.HRS-AHEAD-w11',variables=list('R11MSTAT'), missings = TRUE)
```

```{r local11 ahead, echo=F}
HRS_ahead_w11_divorce <- opal.execute(o,'HRS_ahead_w11_divorce')
vari <- HRS_ahead_w11_divorce$R11MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ahead_w11_divorce$R11MSTAT, missing_values = NA)
ggplot(HRS_ahead_w11_divorce, aes(x=factor(R11MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R11MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo11 ahead, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R11MSTAT=new$R11MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ahead_w10 (divorce)
# new = HRS_ahead_w11_divorce (R11MSTAT)

HRS_ahead_w11_divorce_2 <- same_indiv(HRS_ds_ahead_w10, HRS_ahead_w11_divorce)

HRS_ds_ahead_w11 <- tibble(id=HRS_ahead_w11_divorce_2$id)

HRS_ahead_w11_divorce_2$divorce <- car::recode(as.vector(HRS_ahead_w11_divorce_2$divorce), "NA='-999'")
HRS_ahead_w11_divorce_2$R11MSTAT <- car::recode(as.vector(HRS_ahead_w11_divorce_2$R11MSTAT), "NA='-999'")

HRS_ds_ahead_w11$divorce <- c(NA)   
for(i in 1:dim(HRS_ahead_w11_divorce_2[1])){
  if( HRS_ahead_w11_divorce_2$divorce[i] == 1 | HRS_ahead_w11_divorce_2$R11MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ahead_w11$divorce[i] = 1 }
  else if( HRS_ahead_w11_divorce_2$R11MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ahead_w11$divorce[i] = 0 }
}

HRS_ds_ahead_w11$divorce <- car::recode(as.vector(HRS_ds_ahead_w11$divorce), "NA='999'")
HRS_ds_ahead_w11$divorce <- labelled(HRS_ds_ahead_w11$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript11 ahead, echo=F}
vari <- HRS_ds_ahead_w11$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ahead_w11$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ahead_w11, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11 ahead, echo=F}
AfterH <- table(HRS_ds_ahead_w11$divorce)
BeforeH <- table(HRS_ahead_w11_divorce_2$R11MSTAT, HRS_ahead_w11_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```

## CODA


### Wave 4

#### Study-specific variable description



| **Name** | `R4MSTAT`|
|-|-|
| **Label** |`R4MSTAT:W4 R Marital Status`|
| **Table name** |`HRS-CODA-w4`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign4  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w4_divorce','HRS.HRS-CODA-w4',variables=list('R4MSTAT'), missings = TRUE)
```

```{r local4  coda, echo=F}
HRS_coda_w4_divorce <- opal.execute(o,'HRS_coda_w4_divorce')
vari <- HRS_coda_w4_divorce$R4MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w4_divorce$R4MSTAT, missing_values = NA)
ggplot(HRS_coda_w4_divorce, aes(x=factor(R4MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo4  coda, echo=TRUE}
HRS_ds_coda_w4 <- tibble(id=HRS_coda_w4_divorce$id)
HRS_ds_coda_w4$divorce <- car::recode(as.vector(HRS_coda_w4_divorce$R4MSTAT), "4:6='1'; 1:3='0'; 7:8='0'; NA='999'")
HRS_ds_coda_w4$divorce <- labelled(HRS_ds_coda_w4$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript4  coda, echo=F}
vari <- HRS_ds_coda_w4$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w4$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w4, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation4  coda, echo=F}
AfterH <- table(HRS_ds_coda_w4$divorce)
BeforeH <- table(HRS_coda_w4_divorce$R4MSTAT, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(BeforeH[c(4,5)])
BeforeH1[[1]] <- sum(BeforeH[c(1,2,3,6,7)])
BeforeH1[[3]] <- BeforeH[[8]]
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("1:3&7:8->0","4:6->1","NA->999")
kable(C)
```




### Wave 5

#### Study-specific variable description



| **Name** | `R5MSTAT`|
|-|-|
| **Label** |`R5MSTAT:W5 R Marital Status`|
| **Table name** |`HRS-CODA-w5`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign5  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w5_divorce','HRS.HRS-CODA-w5',variables=list('R5MSTAT'), missings = TRUE)
```

```{r local5  coda, echo=F}
HRS_coda_w5_divorce <- opal.execute(o,'HRS_coda_w5_divorce')
vari <- HRS_coda_w5_divorce$R5MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w5_divorce$R5MSTAT, missing_values = NA)
ggplot(HRS_coda_w5_divorce, aes(x=factor(R5MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R5MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo5  coda, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R5MSTAT=new$R5MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_coda_w4 (divorce)
# new = HRS_coda_w5_divorce (R5MSTAT)

HRS_coda_w5_divorce_2 <- same_indiv(HRS_ds_coda_w4, HRS_coda_w5_divorce)

HRS_ds_coda_w5 <- tibble(id=HRS_coda_w5_divorce_2$id)

HRS_coda_w5_divorce_2$divorce <- car::recode(as.vector(HRS_coda_w5_divorce_2$divorce), "NA='-999'")
HRS_coda_w5_divorce_2$R5MSTAT <- car::recode(as.vector(HRS_coda_w5_divorce_2$R5MSTAT), "NA='-999'")

HRS_ds_coda_w5$divorce <- c(NA)   
for(i in 1:dim(HRS_coda_w5_divorce_2[1])){
  if( HRS_coda_w5_divorce_2$divorce[i] == 1 | HRS_coda_w5_divorce_2$R5MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_coda_w5$divorce[i] = 1 }
  else if( HRS_coda_w5_divorce_2$R5MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_coda_w5$divorce[i] = 0 }
}

HRS_ds_coda_w5$divorce <- car::recode(as.vector(HRS_ds_coda_w5$divorce), "NA='999'")
HRS_ds_coda_w5$divorce <- labelled(HRS_ds_coda_w5$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript5  coda, echo=F}
vari <- HRS_ds_coda_w5$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w5$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w5, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation5  coda, echo=F}
AfterH <- table(HRS_ds_coda_w5$divorce)
BeforeH <- table(HRS_coda_w5_divorce_2$R5MSTAT, HRS_coda_w5_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 6

#### Study-specific variable description



| **Name** | `R6MSTAT`|
|-|-|
| **Label** |`R6MSTAT:W6 R Marital Status`|
| **Table name** |`HRS-CODA-w6`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign6  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w6_divorce','HRS.HRS-CODA-w6',variables=list('R6MSTAT'), missings = TRUE)
```

```{r local6  coda, echo=F}
HRS_coda_w6_divorce <- opal.execute(o,'HRS_coda_w6_divorce')
vari <- HRS_coda_w6_divorce$R6MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w6_divorce$R6MSTAT, missing_values = NA)
ggplot(HRS_coda_w6_divorce, aes(x=factor(R6MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R6MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo6  coda, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R6MSTAT=new$R6MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_coda_w5 (divorce)
# new = HRS_coda_w6_divorce (R6MSTAT)

HRS_coda_w6_divorce_2 <- same_indiv(HRS_ds_coda_w5, HRS_coda_w6_divorce)

HRS_ds_coda_w6 <- tibble(id=HRS_coda_w6_divorce_2$id)

HRS_coda_w6_divorce_2$divorce <- car::recode(as.vector(HRS_coda_w6_divorce_2$divorce), "NA='-999'")
HRS_coda_w6_divorce_2$R6MSTAT <- car::recode(as.vector(HRS_coda_w6_divorce_2$R6MSTAT), "NA='-999'")

HRS_ds_coda_w6$divorce <- c(NA)   
for(i in 1:dim(HRS_coda_w6_divorce_2[1])){
  if( HRS_coda_w6_divorce_2$divorce[i] == 1 | HRS_coda_w6_divorce_2$R6MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_coda_w6$divorce[i] = 1 }
  else if( HRS_coda_w6_divorce_2$R6MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_coda_w6$divorce[i] = 0 }
}

HRS_ds_coda_w6$divorce <- car::recode(as.vector(HRS_ds_coda_w6$divorce), "NA='999'")
HRS_ds_coda_w6$divorce <- labelled(HRS_ds_coda_w6$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript6  coda, echo=F}
vari <- HRS_ds_coda_w6$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w6$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w6, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6  coda, echo=F}
AfterH <- table(HRS_ds_coda_w6$divorce)
BeforeH <- table(HRS_coda_w6_divorce_2$R6MSTAT, HRS_coda_w6_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```



### Wave 7

#### Study-specific variable description



| **Name** | `R7MSTAT`|
|-|-|
| **Label** |`R7MSTAT:W7 R Marital Status`|
| **Table name** |`HRS-CODA-w7`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign7  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w7_divorce','HRS.HRS-CODA-w7',variables=list('R7MSTAT'), missings = TRUE)
```

```{r local7  coda, echo=F}
HRS_coda_w7_divorce <- opal.execute(o,'HRS_coda_w7_divorce')
vari <- HRS_coda_w7_divorce$R7MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w7_divorce$R7MSTAT, missing_values = NA)
ggplot(HRS_coda_w7_divorce, aes(x=factor(R7MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R7MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo7  coda, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R7MSTAT=new$R7MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_coda_w6 (divorce)
# new = HRS_coda_w7_divorce (R7MSTAT)

HRS_coda_w7_divorce_2 <- same_indiv(HRS_ds_coda_w6, HRS_coda_w7_divorce)

HRS_ds_coda_w7 <- tibble(id=HRS_coda_w7_divorce_2$id)

HRS_coda_w7_divorce_2$divorce <- car::recode(as.vector(HRS_coda_w7_divorce_2$divorce), "NA='-999'")
HRS_coda_w7_divorce_2$R7MSTAT <- car::recode(as.vector(HRS_coda_w7_divorce_2$R7MSTAT), "NA='-999'")

HRS_ds_coda_w7$divorce <- c(NA)   
for(i in 1:dim(HRS_coda_w7_divorce_2[1])){
  if( HRS_coda_w7_divorce_2$divorce[i] == 1 | HRS_coda_w7_divorce_2$R7MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_coda_w7$divorce[i] = 1 }
  else if( HRS_coda_w7_divorce_2$R7MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_coda_w7$divorce[i] = 0 }
}

HRS_ds_coda_w7$divorce <- car::recode(as.vector(HRS_ds_coda_w7$divorce), "NA='999'")
HRS_ds_coda_w7$divorce <- labelled(HRS_ds_coda_w7$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript7  coda, echo=F}
vari <- HRS_ds_coda_w7$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w7$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w7, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation7  coda, echo=F}
AfterH <- table(HRS_ds_coda_w7$divorce)
BeforeH <- table(HRS_coda_w7_divorce_2$R7MSTAT, HRS_coda_w7_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 8

#### Study-specific variable description



| **Name** | `R8MSTAT`|
|-|-|
| **Label** |`R8MSTAT:W8 R Marital Status`|
| **Table name** |`HRS-CODA-w8`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign8  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w8_divorce','HRS.HRS-CODA-w8',variables=list('R8MSTAT'), missings = TRUE)
```

```{r local8  coda, echo=F}
HRS_coda_w8_divorce <- opal.execute(o,'HRS_coda_w8_divorce')
vari <- HRS_coda_w8_divorce$R8MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w8_divorce$R8MSTAT, missing_values = NA)
ggplot(HRS_coda_w8_divorce, aes(x=factor(R8MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R8MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo8  coda, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R8MSTAT=new$R8MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_coda_w7 (divorce)
# new = HRS_coda_w8_divorce (R8MSTAT)

HRS_coda_w8_divorce_2 <- same_indiv(HRS_ds_coda_w7, HRS_coda_w8_divorce)

HRS_ds_coda_w8 <- tibble(id=HRS_coda_w8_divorce_2$id)

HRS_coda_w8_divorce_2$divorce <- car::recode(as.vector(HRS_coda_w8_divorce_2$divorce), "NA='-999'")
HRS_coda_w8_divorce_2$R8MSTAT <- car::recode(as.vector(HRS_coda_w8_divorce_2$R8MSTAT), "NA='-999'")

HRS_ds_coda_w8$divorce <- c(NA)   
for(i in 1:dim(HRS_coda_w8_divorce_2[1])){
  if( HRS_coda_w8_divorce_2$divorce[i] == 1 | HRS_coda_w8_divorce_2$R8MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_coda_w8$divorce[i] = 1 }
  else if( HRS_coda_w8_divorce_2$R8MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_coda_w8$divorce[i] = 0 }
}

HRS_ds_coda_w8$divorce <- car::recode(as.vector(HRS_ds_coda_w8$divorce), "NA='999'")
HRS_ds_coda_w8$divorce <- labelled(HRS_ds_coda_w8$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript8  coda, echo=F}
vari <- HRS_ds_coda_w8$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w8$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w8, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation8  coda, echo=F}
AfterH <- table(HRS_ds_coda_w8$divorce)
BeforeH <- table(HRS_coda_w8_divorce_2$R8MSTAT, HRS_coda_w8_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 9

#### Study-specific variable description



| **Name** | `R9MSTAT`|
|-|-|
| **Label** |`R9MSTAT:W9 R Marital Status`|
| **Table name** |`HRS-CODA-w9`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    




```{r assign9  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w9_divorce','HRS.HRS-CODA-w9',variables=list('R9MSTAT'), missings = TRUE)
```

```{r local9  coda, echo=F}
HRS_coda_w9_divorce <- opal.execute(o,'HRS_coda_w9_divorce')
vari <- HRS_coda_w9_divorce$R9MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w9_divorce$R9MSTAT, missing_values = NA)
ggplot(HRS_coda_w9_divorce, aes(x=factor(R9MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R9MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo9  coda, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R9MSTAT=new$R9MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_coda_w8 (divorce)
# new = HRS_coda_w9_divorce (R9MSTAT)

HRS_coda_w9_divorce_2 <- same_indiv(HRS_ds_coda_w8, HRS_coda_w9_divorce)

HRS_ds_coda_w9 <- tibble(id=HRS_coda_w9_divorce_2$id)

HRS_coda_w9_divorce_2$divorce <- car::recode(as.vector(HRS_coda_w9_divorce_2$divorce), "NA='-999'")
HRS_coda_w9_divorce_2$R9MSTAT <- car::recode(as.vector(HRS_coda_w9_divorce_2$R9MSTAT), "NA='-999'")

HRS_ds_coda_w9$divorce <- c(NA)   
for(i in 1:dim(HRS_coda_w9_divorce_2[1])){
  if( HRS_coda_w9_divorce_2$divorce[i] == 1 | HRS_coda_w9_divorce_2$R9MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_coda_w9$divorce[i] = 1 }
  else if( HRS_coda_w9_divorce_2$R9MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_coda_w9$divorce[i] = 0 }
}

HRS_ds_coda_w9$divorce <- car::recode(as.vector(HRS_ds_coda_w9$divorce), "NA='999'")
HRS_ds_coda_w9$divorce <- labelled(HRS_ds_coda_w9$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript9  coda, echo=F}
vari <- HRS_ds_coda_w9$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w9$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w9, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation9  coda, echo=F}
AfterH <- table(HRS_ds_coda_w9$divorce)
BeforeH <- table(HRS_coda_w9_divorce_2$R9MSTAT, HRS_coda_w9_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```





### Wave 10

#### Study-specific variable description



| **Name** | `R10MSTAT`|
|-|-|
| **Label** |`R10MSTAT:W10 R Marital Status`|
| **Table name** |`HRS-CODA-w10`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign10  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w10_divorce','HRS.HRS-CODA-w10',variables=list('R10MSTAT'), missings = TRUE)
```

```{r local10  coda, echo=F}
HRS_coda_w10_divorce <- opal.execute(o,'HRS_coda_w10_divorce')
vari <- HRS_coda_w10_divorce$R10MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w10_divorce$R10MSTAT, missing_values = NA)
ggplot(HRS_coda_w10_divorce, aes(x=factor(R10MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R10MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo10  coda, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R10MSTAT=new$R10MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_coda_w9 (divorce)
# new = HRS_coda_w10_divorce (R10MSTAT)

HRS_coda_w10_divorce_2 <- same_indiv(HRS_ds_coda_w9, HRS_coda_w10_divorce)

HRS_ds_coda_w10 <- tibble(id=HRS_coda_w10_divorce_2$id)

HRS_coda_w10_divorce_2$divorce <- car::recode(as.vector(HRS_coda_w10_divorce_2$divorce), "NA='-999'")
HRS_coda_w10_divorce_2$R10MSTAT <- car::recode(as.vector(HRS_coda_w10_divorce_2$R10MSTAT), "NA='-999'")

HRS_ds_coda_w10$divorce <- c(NA)   
for(i in 1:dim(HRS_coda_w10_divorce_2[1])){
  if( HRS_coda_w10_divorce_2$divorce[i] == 1 | HRS_coda_w10_divorce_2$R10MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_coda_w10$divorce[i] = 1 }
  else if( HRS_coda_w10_divorce_2$R10MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_coda_w10$divorce[i] = 0 }
}

HRS_ds_coda_w10$divorce <- car::recode(as.vector(HRS_ds_coda_w10$divorce), "NA='999'")
HRS_ds_coda_w10$divorce <- labelled(HRS_ds_coda_w10$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript10  coda, echo=F}
vari <- HRS_ds_coda_w10$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w10$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w10, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10  coda, echo=F}
AfterH <- table(HRS_ds_coda_w10$divorce)
BeforeH <- table(HRS_coda_w10_divorce_2$R10MSTAT, HRS_coda_w10_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```





### Wave 11

#### Study-specific variable description



| **Name** | `R11MSTAT`|
|-|-|
| **Label** |`R11MSTAT:W11 R Marital Status`|
| **Table name** |`HRS-CODA-w11`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    

    

```{r assign11  coda, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w11_divorce','HRS.HRS-CODA-w11',variables=list('R11MSTAT'), missings = TRUE)
```

```{r local11  coda, echo=F}
HRS_coda_w11_divorce <- opal.execute(o,'HRS_coda_w11_divorce')
vari <- HRS_coda_w11_divorce$R11MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_coda_w11_divorce$R11MSTAT, missing_values = NA)
ggplot(HRS_coda_w11_divorce, aes(x=factor(R11MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R11MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo11  coda, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R11MSTAT=new$R11MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_coda_w10 (divorce)
# new = HRS_coda_w11_divorce (R11MSTAT)

HRS_coda_w11_divorce_2 <- same_indiv(HRS_ds_coda_w10, HRS_coda_w11_divorce)

HRS_ds_coda_w11 <- tibble(id=HRS_coda_w11_divorce_2$id)

HRS_coda_w11_divorce_2$divorce <- car::recode(as.vector(HRS_coda_w11_divorce_2$divorce), "NA='-999'")
HRS_coda_w11_divorce_2$R11MSTAT <- car::recode(as.vector(HRS_coda_w11_divorce_2$R11MSTAT), "NA='-999'")

HRS_ds_coda_w11$divorce <- c(NA)   
for(i in 1:dim(HRS_coda_w11_divorce_2[1])){
  if( HRS_coda_w11_divorce_2$divorce[i] == 1 | HRS_coda_w11_divorce_2$R11MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_coda_w11$divorce[i] = 1 }
  else if( HRS_coda_w11_divorce_2$R11MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_coda_w11$divorce[i] = 0 }
}

HRS_ds_coda_w11$divorce <- car::recode(as.vector(HRS_ds_coda_w11$divorce), "NA='999'")
HRS_ds_coda_w11$divorce <- labelled(HRS_ds_coda_w11$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript11  coda, echo=F}
vari <- HRS_ds_coda_w11$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_coda_w11$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_coda_w11, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11  coda, echo=F}
AfterH <- table(HRS_ds_coda_w11$divorce)
BeforeH <- table(HRS_coda_w11_divorce_2$R11MSTAT, HRS_coda_w11_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```

## WB


### Wave 4

#### Study-specific variable description



| **Name** | `R4MSTAT`|
|-|-|
| **Label** |`R4MSTAT:W4 R Marital Status`|
| **Table name** |`HRS-WB-w4`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |












```{r assign4  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w4_divorce','HRS.HRS-WB-w4',variables=list('R4MSTAT'), missings = TRUE)
```

```{r local4  wb, echo=F}
HRS_wb_w4_divorce <- opal.execute(o,'HRS_wb_w4_divorce')
vari <- HRS_wb_w4_divorce$R4MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w4_divorce$R4MSTAT, missing_values = NA)
ggplot(HRS_wb_w4_divorce, aes(x=factor(R4MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo4  wb, echo=TRUE}
HRS_ds_wb_w4 <- tibble(id=HRS_wb_w4_divorce$id)
HRS_ds_wb_w4$divorce <- car::recode(as.vector(HRS_wb_w4_divorce$R4MSTAT), "4:6='1'; 1:3='0'; 7:8='0'; NA='999'")
HRS_ds_wb_w4$divorce <- labelled(HRS_ds_wb_w4$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript4  wb, echo=F}
vari <- HRS_ds_wb_w4$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w4$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w4, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation4  wb, echo=F}
AfterH <- table(HRS_ds_wb_w4$divorce)
BeforeH <- table(HRS_wb_w4_divorce$R4MSTAT, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(BeforeH[c(4,5)])
BeforeH1[[1]] <- sum(BeforeH[c(1,2,3,6,7)])
BeforeH1[[3]] <- BeforeH[[8]]
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("1:3&7:8->0","4:6->1","NA->999")
kable(C)
```




### Wave 5

#### Study-specific variable description



| **Name** | `R5MSTAT`|
|-|-|
| **Label** |`R5MSTAT:W5 R Marital Status`|
| **Table name** |`HRS-WB-w5`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign5  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w5_divorce','HRS.HRS-WB-w5',variables=list('R5MSTAT'), missings = TRUE)
```

```{r local5  wb, echo=F}
HRS_wb_w5_divorce <- opal.execute(o,'HRS_wb_w5_divorce')
vari <- HRS_wb_w5_divorce$R5MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w5_divorce$R5MSTAT, missing_values = NA)
ggplot(HRS_wb_w5_divorce, aes(x=factor(R5MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R5MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo5  wb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R5MSTAT=new$R5MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_wb_w4 (divorce)
# new = HRS_wb_w5_divorce (R5MSTAT)

HRS_wb_w5_divorce_2 <- same_indiv(HRS_ds_wb_w4, HRS_wb_w5_divorce)

HRS_ds_wb_w5 <- tibble(id=HRS_wb_w5_divorce_2$id)

HRS_wb_w5_divorce_2$divorce <- car::recode(as.vector(HRS_wb_w5_divorce_2$divorce), "NA='-999'")
HRS_wb_w5_divorce_2$R5MSTAT <- car::recode(as.vector(HRS_wb_w5_divorce_2$R5MSTAT), "NA='-999'")

HRS_ds_wb_w5$divorce <- c(NA)   
for(i in 1:dim(HRS_wb_w5_divorce_2[1])){
  if( HRS_wb_w5_divorce_2$divorce[i] == 1 | HRS_wb_w5_divorce_2$R5MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_wb_w5$divorce[i] = 1 }
  else if( HRS_wb_w5_divorce_2$R5MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_wb_w5$divorce[i] = 0 }
}

HRS_ds_wb_w5$divorce <- car::recode(as.vector(HRS_ds_wb_w5$divorce), "NA='999'")
HRS_ds_wb_w5$divorce <- labelled(HRS_ds_wb_w5$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript5  wb, echo=F}
vari <- HRS_ds_wb_w5$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w5$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w5, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue")+ xlab("Experience of divorce/separation") + ylab("Frequency")
```

##### Validation
```{r crosstabulation5  wb, echo=F}
AfterH <- table(HRS_ds_wb_w5$divorce)
BeforeH <- table(HRS_wb_w5_divorce_2$R5MSTAT, HRS_wb_w5_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 6

#### Study-specific variable description



| **Name** | `R6MSTAT`|
|-|-|
| **Label** |`R6MSTAT:W6 R Marital Status`|
| **Table name** |`HRS-WB-w6`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |














```{r assign6  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w6_divorce','HRS.HRS-WB-w6',variables=list('R6MSTAT'), missings = TRUE)
```

```{r local6  wb, echo=F}
HRS_wb_w6_divorce <- opal.execute(o,'HRS_wb_w6_divorce')
vari <- HRS_wb_w6_divorce$R6MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w6_divorce$R6MSTAT, missing_values = NA)
ggplot(HRS_wb_w6_divorce, aes(x=factor(R6MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R6MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo6  wb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R6MSTAT=new$R6MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_wb_w5 (divorce)
# new = HRS_wb_w6_divorce (R6MSTAT)

HRS_wb_w6_divorce_2 <- same_indiv(HRS_ds_wb_w5, HRS_wb_w6_divorce)

HRS_ds_wb_w6 <- tibble(id=HRS_wb_w6_divorce_2$id)

HRS_wb_w6_divorce_2$divorce <- car::recode(as.vector(HRS_wb_w6_divorce_2$divorce), "NA='-999'")
HRS_wb_w6_divorce_2$R6MSTAT <- car::recode(as.vector(HRS_wb_w6_divorce_2$R6MSTAT), "NA='-999'")

HRS_ds_wb_w6$divorce <- c(NA)   
for(i in 1:dim(HRS_wb_w6_divorce_2[1])){
  if( HRS_wb_w6_divorce_2$divorce[i] == 1 | HRS_wb_w6_divorce_2$R6MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_wb_w6$divorce[i] = 1 }
  else if( HRS_wb_w6_divorce_2$R6MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_wb_w6$divorce[i] = 0 }
}

HRS_ds_wb_w6$divorce <- car::recode(as.vector(HRS_ds_wb_w6$divorce), "NA='999'")
HRS_ds_wb_w6$divorce <- labelled(HRS_ds_wb_w6$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript6  wb, echo=F}
vari <- HRS_ds_wb_w6$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w6$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w6, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6  wb, echo=F}
AfterH <- table(HRS_ds_wb_w6$divorce)
BeforeH <- table(HRS_wb_w6_divorce_2$R6MSTAT, HRS_wb_w6_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 7

#### Study-specific variable description



| **Name** | `R7MSTAT`|
|-|-|
| **Label** |`R7MSTAT:W7 R Marital Status`|
| **Table name** |`HRS-WB-w7`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign7  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w7_divorce','HRS.HRS-WB-w7',variables=list('R7MSTAT'), missings = TRUE)
```

```{r local7  wb, echo=F}
HRS_wb_w7_divorce <- opal.execute(o,'HRS_wb_w7_divorce')
vari <- HRS_wb_w7_divorce$R7MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w7_divorce$R7MSTAT, missing_values = NA)
ggplot(HRS_wb_w7_divorce, aes(x=factor(R7MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R7MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo7  wb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R7MSTAT=new$R7MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_wb_w6 (divorce)
# new = HRS_wb_w7_divorce (R7MSTAT)

HRS_wb_w7_divorce_2 <- same_indiv(HRS_ds_wb_w6, HRS_wb_w7_divorce)

HRS_ds_wb_w7 <- tibble(id=HRS_wb_w7_divorce_2$id)

HRS_wb_w7_divorce_2$divorce <- car::recode(as.vector(HRS_wb_w7_divorce_2$divorce), "NA='-999'")
HRS_wb_w7_divorce_2$R7MSTAT <- car::recode(as.vector(HRS_wb_w7_divorce_2$R7MSTAT), "NA='-999'")

HRS_ds_wb_w7$divorce <- c(NA)   
for(i in 1:dim(HRS_wb_w7_divorce_2[1])){
  if( HRS_wb_w7_divorce_2$divorce[i] == 1 | HRS_wb_w7_divorce_2$R7MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_wb_w7$divorce[i] = 1 }
  else if( HRS_wb_w7_divorce_2$R7MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_wb_w7$divorce[i] = 0 }
}

HRS_ds_wb_w7$divorce <- car::recode(as.vector(HRS_ds_wb_w7$divorce), "NA='999'")
HRS_ds_wb_w7$divorce <- labelled(HRS_ds_wb_w7$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```



#### Statistical description of the new harmonised variable
```{r descript7  wb, echo=F}
vari <- HRS_ds_wb_w7$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w7$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w7, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation7  wb, echo=F}
AfterH <- table(HRS_ds_wb_w7$divorce)
BeforeH <- table(HRS_wb_w7_divorce_2$R7MSTAT, HRS_wb_w7_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 8

#### Study-specific variable description



| **Name** | `R8MSTAT`|
|-|-|
| **Label** |`R8MSTAT:W8 R Marital Status`|
| **Table name** |`HRS-WB-w8`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign8  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w8_divorce','HRS.HRS-WB-w8',variables=list('R8MSTAT'), missings = TRUE)
```

```{r local8  wb, echo=F}
HRS_wb_w8_divorce <- opal.execute(o,'HRS_wb_w8_divorce')
vari <- HRS_wb_w8_divorce$R8MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w8_divorce$R8MSTAT, missing_values = NA)
ggplot(HRS_wb_w8_divorce, aes(x=factor(R8MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R8MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo8  wb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R8MSTAT=new$R8MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_wb_w7 (divorce)
# new = HRS_wb_w8_divorce (R8MSTAT)

HRS_wb_w8_divorce_2 <- same_indiv(HRS_ds_wb_w7, HRS_wb_w8_divorce)

HRS_ds_wb_w8 <- tibble(id=HRS_wb_w8_divorce_2$id)

HRS_wb_w8_divorce_2$divorce <- car::recode(as.vector(HRS_wb_w8_divorce_2$divorce), "NA='-999'")
HRS_wb_w8_divorce_2$R8MSTAT <- car::recode(as.vector(HRS_wb_w8_divorce_2$R8MSTAT), "NA='-999'")

HRS_ds_wb_w8$divorce <- c(NA)   
for(i in 1:dim(HRS_wb_w8_divorce_2[1])){
  if( HRS_wb_w8_divorce_2$divorce[i] == 1 | HRS_wb_w8_divorce_2$R8MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_wb_w8$divorce[i] = 1 }
  else if( HRS_wb_w8_divorce_2$R8MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_wb_w8$divorce[i] = 0 }
}

HRS_ds_wb_w8$divorce <- car::recode(as.vector(HRS_ds_wb_w8$divorce), "NA='999'")
HRS_ds_wb_w8$divorce <- labelled(HRS_ds_wb_w8$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript8  wb, echo=F}
vari <- HRS_ds_wb_w8$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w8$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w8, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation8  wb, echo=F}
AfterH <- table(HRS_ds_wb_w8$divorce)
BeforeH <- table(HRS_wb_w8_divorce_2$R8MSTAT, HRS_wb_w8_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 9

#### Study-specific variable description



| **Name** | `R9MSTAT`|
|-|-|
| **Label** |`R9MSTAT:W9 R Marital Status`|
| **Table name** |`HRS-WB-w9`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign9  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w9_divorce','HRS.HRS-WB-w9',variables=list('R9MSTAT'), missings = TRUE)
```

```{r local9  wb, echo=F}
HRS_wb_w9_divorce <- opal.execute(o,'HRS_wb_w9_divorce')
vari <- HRS_wb_w9_divorce$R9MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w9_divorce$R9MSTAT, missing_values = NA)
ggplot(HRS_wb_w9_divorce, aes(x=factor(R9MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R9MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo9  wb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R9MSTAT=new$R9MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_wb_w8 (divorce)
# new = HRS_wb_w9_divorce (R9MSTAT)

HRS_wb_w9_divorce_2 <- same_indiv(HRS_ds_wb_w8, HRS_wb_w9_divorce)

HRS_ds_wb_w9 <- tibble(id=HRS_wb_w9_divorce_2$id)

HRS_wb_w9_divorce_2$divorce <- car::recode(as.vector(HRS_wb_w9_divorce_2$divorce), "NA='-999'")
HRS_wb_w9_divorce_2$R9MSTAT <- car::recode(as.vector(HRS_wb_w9_divorce_2$R9MSTAT), "NA='-999'")

HRS_ds_wb_w9$divorce <- c(NA)   
for(i in 1:dim(HRS_wb_w9_divorce_2[1])){
  if( HRS_wb_w9_divorce_2$divorce[i] == 1 | HRS_wb_w9_divorce_2$R9MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_wb_w9$divorce[i] = 1 }
  else if( HRS_wb_w9_divorce_2$R9MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_wb_w9$divorce[i] = 0 }
}

HRS_ds_wb_w9$divorce <- car::recode(as.vector(HRS_ds_wb_w9$divorce), "NA='999'")
HRS_ds_wb_w9$divorce <- labelled(HRS_ds_wb_w9$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript9  wb, echo=F}
vari <- HRS_ds_wb_w9$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w9$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w9, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation9  wb, echo=F}
AfterH <- table(HRS_ds_wb_w9$divorce)
BeforeH <- table(HRS_wb_w9_divorce_2$R9MSTAT, HRS_wb_w9_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,7,8),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```



### Wave 10

#### Study-specific variable description



| **Name** | `R10MSTAT`|
|-|-|
| **Label** |`R10MSTAT:W10 R Marital Status`|
| **Table name** |`HRS-WB-w10`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign10  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w10_divorce','HRS.HRS-WB-w10',variables=list('R10MSTAT'), missings = TRUE)
```

```{r local10  wb, echo=F}
HRS_wb_w10_divorce <- opal.execute(o,'HRS_wb_w10_divorce')
vari <- HRS_wb_w10_divorce$R10MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w10_divorce$R10MSTAT, missing_values = NA)
ggplot(HRS_wb_w10_divorce, aes(x=factor(R10MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R10MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo10  wb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R10MSTAT=new$R10MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_wb_w9 (divorce)
# new = HRS_wb_w10_divorce (R10MSTAT)

HRS_wb_w10_divorce_2 <- same_indiv(HRS_ds_wb_w9, HRS_wb_w10_divorce)

HRS_ds_wb_w10 <- tibble(id=HRS_wb_w10_divorce_2$id)

HRS_wb_w10_divorce_2$divorce <- car::recode(as.vector(HRS_wb_w10_divorce_2$divorce), "NA='-999'")
HRS_wb_w10_divorce_2$R10MSTAT <- car::recode(as.vector(HRS_wb_w10_divorce_2$R10MSTAT), "NA='-999'")

HRS_ds_wb_w10$divorce <- c(NA)   
for(i in 1:dim(HRS_wb_w10_divorce_2[1])){
  if( HRS_wb_w10_divorce_2$divorce[i] == 1 | HRS_wb_w10_divorce_2$R10MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_wb_w10$divorce[i] = 1 }
  else if( HRS_wb_w10_divorce_2$R10MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_wb_w10$divorce[i] = 0 }
}

HRS_ds_wb_w10$divorce <- car::recode(as.vector(HRS_ds_wb_w10$divorce), "NA='999'")
HRS_ds_wb_w10$divorce <- labelled(HRS_ds_wb_w10$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript10  wb, echo=F}
vari <- HRS_ds_wb_w10$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w10$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w10, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10  wb, echo=F}
AfterH <- table(HRS_ds_wb_w10$divorce)
BeforeH <- table(HRS_wb_w10_divorce_2$R10MSTAT, HRS_wb_w10_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```





### Wave 11

#### Study-specific variable description



| **Name** | `R11MSTAT`|
|-|-|
| **Label** |`R11MSTAT:W11 R Marital Status`|
| **Table name** |`HRS-WB-w11`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign11  wb, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w11_divorce','HRS.HRS-WB-w11',variables=list('R11MSTAT'), missings = TRUE)
```

```{r local11  wb, echo=F}
HRS_wb_w11_divorce <- opal.execute(o,'HRS_wb_w11_divorce')
vari <- HRS_wb_w11_divorce$R11MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_wb_w11_divorce$R11MSTAT, missing_values = NA)
ggplot(HRS_wb_w11_divorce, aes(x=factor(R11MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R11MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo11  wb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R11MSTAT=new$R11MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_wb_w10 (divorce)
# new = HRS_wb_w11_divorce (R11MSTAT)

HRS_wb_w11_divorce_2 <- same_indiv(HRS_ds_wb_w10, HRS_wb_w11_divorce)

HRS_ds_wb_w11 <- tibble(id=HRS_wb_w11_divorce_2$id)

HRS_wb_w11_divorce_2$divorce <- car::recode(as.vector(HRS_wb_w11_divorce_2$divorce), "NA='-999'")
HRS_wb_w11_divorce_2$R11MSTAT <- car::recode(as.vector(HRS_wb_w11_divorce_2$R11MSTAT), "NA='-999'")

HRS_ds_wb_w11$divorce <- c(NA)   
for(i in 1:dim(HRS_wb_w11_divorce_2[1])){
  if( HRS_wb_w11_divorce_2$divorce[i] == 1 | HRS_wb_w11_divorce_2$R11MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_wb_w11$divorce[i] = 1 }
  else if( HRS_wb_w11_divorce_2$R11MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_wb_w11$divorce[i] = 0 }
}

HRS_ds_wb_w11$divorce <- car::recode(as.vector(HRS_ds_wb_w11$divorce), "NA='999'")
HRS_ds_wb_w11$divorce <- labelled(HRS_ds_wb_w11$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```


#### Statistical description of the new harmonised variable
```{r descript11  wb, echo=F}
vari <- HRS_ds_wb_w11$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_wb_w11$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_wb_w11, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11  wb, echo=F}
AfterH <- table(HRS_ds_wb_w11$divorce)
BeforeH <- table(HRS_wb_w11_divorce_2$R11MSTAT, HRS_wb_w11_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```

## EBB
  

### Wave 7

#### Study-specific variable description



| **Name** | `R7MSTAT`|
|-|-|
| **Label** |`R7MSTAT:W7 R Marital Status`|
| **Table name** |`HRS-EBB-w7`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |












```{r assign7  ebb, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w7_divorce','HRS.HRS-EBB-w7',variables=list('R7MSTAT'), missings = TRUE)
```

```{r local7  ebb, echo=F}
HRS_ebb_w7_divorce <- opal.execute(o,'HRS_ebb_w7_divorce')
vari <- HRS_ebb_w7_divorce$R7MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ebb_w7_divorce$R7MSTAT, missing_values = NA)
ggplot(HRS_ebb_w7_divorce, aes(x=factor(R7MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo7  ebb, echo=TRUE}
HRS_ds_ebb_w7 <- tibble(id=HRS_ebb_w7_divorce$id)
HRS_ds_ebb_w7$divorce <- car::recode(as.vector(HRS_ebb_w7_divorce$R7MSTAT), "4:6='1'; 1:3='0'; 7:8='0'; NA='999'")
HRS_ds_ebb_w7$divorce <- labelled(HRS_ds_ebb_w7$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript7  ebb, echo=F}
vari <- HRS_ds_ebb_w7$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ebb_w7$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ebb_w7, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation7  ebb, echo=F}
AfterH <- table(HRS_ds_ebb_w7$divorce)
BeforeH <- table(HRS_ebb_w7_divorce$R7MSTAT, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(BeforeH[c(4,5)])
BeforeH1[[1]] <- sum(BeforeH[c(1,2,3,6,7)])
BeforeH1[[3]] <- BeforeH[[8]]
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("1:3&7:8->0","4:6->1","NA->999")
kable(C)
```



### Wave 8

#### Study-specific variable description



| **Name** | `R8MSTAT`|
|-|-|
| **Label** |`R8MSTAT:W8 R Marital Status`|
| **Table name** |`HRS-EBB-w8`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |














```{r assign8  ebb, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w8_divorce','HRS.HRS-EBB-w8',variables=list('R8MSTAT'), missings = TRUE)
```

```{r local8  ebb, echo=F}
HRS_ebb_w8_divorce <- opal.execute(o,'HRS_ebb_w8_divorce')
vari <- HRS_ebb_w8_divorce$R8MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ebb_w8_divorce$R8MSTAT, missing_values = NA)
ggplot(HRS_ebb_w8_divorce, aes(x=factor(R8MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R8MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo8  ebb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R8MSTAT=new$R8MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ebb_w7 (divorce)
# new = HRS_ebb_w8_divorce (R8MSTAT)

HRS_ebb_w8_divorce_2 <- same_indiv(HRS_ds_ebb_w7, HRS_ebb_w8_divorce)

HRS_ds_ebb_w8 <- tibble(id=HRS_ebb_w8_divorce_2$id)

HRS_ebb_w8_divorce_2$divorce <- car::recode(as.vector(HRS_ebb_w8_divorce_2$divorce), "NA='-999'")
HRS_ebb_w8_divorce_2$R8MSTAT <- car::recode(as.vector(HRS_ebb_w8_divorce_2$R8MSTAT), "NA='-999'")

HRS_ds_ebb_w8$divorce <- c(NA)   
for(i in 1:dim(HRS_ebb_w8_divorce_2[1])){
  if( HRS_ebb_w8_divorce_2$divorce[i] == 1 | HRS_ebb_w8_divorce_2$R8MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ebb_w8$divorce[i] = 1 }
  else if( HRS_ebb_w8_divorce_2$R8MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ebb_w8$divorce[i] = 0 }
}

HRS_ds_ebb_w8$divorce <- car::recode(as.vector(HRS_ds_ebb_w8$divorce), "NA='999'")
HRS_ds_ebb_w8$divorce <- labelled(HRS_ds_ebb_w8$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript8  ebb, echo=F}
vari <- HRS_ds_ebb_w8$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ebb_w8$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ebb_w8, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation8  ebb, echo=F}
AfterH <- table(HRS_ds_ebb_w8$divorce)
BeforeH <- table(HRS_ebb_w8_divorce_2$R8MSTAT, HRS_ebb_w8_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 9

#### Study-specific variable description



| **Name** | `R9MSTAT`|
|-|-|
| **Label** |`R9MSTAT:W9 R Marital Status`|
| **Table name** |`HRS-EBB-w9`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    



```{r assign9  ebb, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w9_divorce','HRS.HRS-EBB-w9',variables=list('R9MSTAT'), missings = TRUE)
```

```{r local9  ebb, echo=F}
HRS_ebb_w9_divorce <- opal.execute(o,'HRS_ebb_w9_divorce')
vari <- HRS_ebb_w9_divorce$R9MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ebb_w9_divorce$R9MSTAT, missing_values = NA)
ggplot(HRS_ebb_w9_divorce, aes(x=factor(R9MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R9MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo9  ebb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R9MSTAT=new$R9MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ebb_w8 (divorce)
# new = HRS_ebb_w9_divorce (R9MSTAT)

HRS_ebb_w9_divorce_2 <- same_indiv(HRS_ds_ebb_w8, HRS_ebb_w9_divorce)

HRS_ds_ebb_w9 <- tibble(id=HRS_ebb_w9_divorce_2$id)

HRS_ebb_w9_divorce_2$divorce <- car::recode(as.vector(HRS_ebb_w9_divorce_2$divorce), "NA='-999'")
HRS_ebb_w9_divorce_2$R9MSTAT <- car::recode(as.vector(HRS_ebb_w9_divorce_2$R9MSTAT), "NA='-999'")

HRS_ds_ebb_w9$divorce <- c(NA)   
for(i in 1:dim(HRS_ebb_w9_divorce_2[1])){
  if( HRS_ebb_w9_divorce_2$divorce[i] == 1 | HRS_ebb_w9_divorce_2$R9MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ebb_w9$divorce[i] = 1 }
  else if( HRS_ebb_w9_divorce_2$R9MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ebb_w9$divorce[i] = 0 }
}

HRS_ds_ebb_w9$divorce <- car::recode(as.vector(HRS_ds_ebb_w9$divorce), "NA='999'")
HRS_ds_ebb_w9$divorce <- labelled(HRS_ds_ebb_w9$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript9  ebb, echo=F}
vari <- HRS_ds_ebb_w9$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ebb_w9$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ebb_w9, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation9  ebb, echo=F}
AfterH <- table(HRS_ds_ebb_w9$divorce)
BeforeH <- table(HRS_ebb_w9_divorce_2$R9MSTAT, HRS_ebb_w9_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```





### Wave 10

#### Study-specific variable description



| **Name** | `R10MSTAT`|
|-|-|
| **Label** |`R10MSTAT:W10 R Marital Status`|
| **Table name** |`HRS-EBB-w10`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |












```{r assign10  ebb, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w10_divorce','HRS.HRS-EBB-w10',variables=list('R10MSTAT'), missings = TRUE)
```

```{r local10  ebb, echo=F}
HRS_ebb_w10_divorce <- opal.execute(o,'HRS_ebb_w10_divorce')
vari <- HRS_ebb_w10_divorce$R10MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ebb_w10_divorce$R10MSTAT, missing_values = NA)
ggplot(HRS_ebb_w10_divorce, aes(x=factor(R10MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R10MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo10  ebb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R10MSTAT=new$R10MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ebb_w9 (divorce)
# new = HRS_ebb_w10_divorce (R10MSTAT)

HRS_ebb_w10_divorce_2 <- same_indiv(HRS_ds_ebb_w9, HRS_ebb_w10_divorce)

HRS_ds_ebb_w10 <- tibble(id=HRS_ebb_w10_divorce_2$id)

HRS_ebb_w10_divorce_2$divorce <- car::recode(as.vector(HRS_ebb_w10_divorce_2$divorce), "NA='-999'")
HRS_ebb_w10_divorce_2$R10MSTAT <- car::recode(as.vector(HRS_ebb_w10_divorce_2$R10MSTAT), "NA='-999'")

HRS_ds_ebb_w10$divorce <- c(NA)   
for(i in 1:dim(HRS_ebb_w10_divorce_2[1])){
  if( HRS_ebb_w10_divorce_2$divorce[i] == 1 | HRS_ebb_w10_divorce_2$R10MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ebb_w10$divorce[i] = 1 }
  else if( HRS_ebb_w10_divorce_2$R10MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ebb_w10$divorce[i] = 0 }
}

HRS_ds_ebb_w10$divorce <- car::recode(as.vector(HRS_ds_ebb_w10$divorce), "NA='999'")
HRS_ds_ebb_w10$divorce <- labelled(HRS_ds_ebb_w10$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript10  ebb, echo=F}
vari <- HRS_ds_ebb_w10$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ebb_w10$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ebb_w10, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10  ebb, echo=F}
AfterH <- table(HRS_ds_ebb_w10$divorce)
BeforeH <- table(HRS_ebb_w10_divorce_2$R10MSTAT, HRS_ebb_w10_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```




### Wave 11

#### Study-specific variable description



| **Name** | `R11MSTAT`|
|-|-|
| **Label** |`R11MSTAT:W11 R Marital Status`|
| **Table name** |`HRS-EBB-w11`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    

    

```{r assign11  ebb, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w11_divorce','HRS.HRS-EBB-w11', variables=list('R11MSTAT'), missings = TRUE)
```

```{r local11  ebb, echo=F}
HRS_ebb_w11_divorce <- opal.execute(o,'HRS_ebb_w11_divorce')
vari <- HRS_ebb_w11_divorce$R11MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_ebb_w11_divorce$R11MSTAT, missing_values = NA)
ggplot(HRS_ebb_w11_divorce, aes(x=factor(R11MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R11MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo11  ebb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R11MSTAT=new$R11MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_ebb_w10 (divorce)
# new = HRS_ebb_w11_divorce (R11MSTAT)

HRS_ebb_w11_divorce_2 <- same_indiv(HRS_ds_ebb_w10, HRS_ebb_w11_divorce)

HRS_ds_ebb_w11 <- tibble(id=HRS_ebb_w11_divorce_2$id)

HRS_ebb_w11_divorce_2$divorce <- car::recode(as.vector(HRS_ebb_w11_divorce_2$divorce), "NA='-999'")
HRS_ebb_w11_divorce_2$R11MSTAT <- car::recode(as.vector(HRS_ebb_w11_divorce_2$R11MSTAT), "NA='-999'")

HRS_ds_ebb_w11$divorce <- c(NA)   
for(i in 1:dim(HRS_ebb_w11_divorce_2[1])){
  if( HRS_ebb_w11_divorce_2$divorce[i] == 1 | HRS_ebb_w11_divorce_2$R11MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_ebb_w11$divorce[i] = 1 }
  else if( HRS_ebb_w11_divorce_2$R11MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_ebb_w11$divorce[i] = 0 }
}

HRS_ds_ebb_w11$divorce <- car::recode(as.vector(HRS_ds_ebb_w11$divorce), "NA='999'")
HRS_ds_ebb_w11$divorce <- labelled(HRS_ds_ebb_w11$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript11  ebb, echo=F}
vari <- HRS_ds_ebb_w11$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_ebb_w11$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_ebb_w11, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11  ebb, echo=F}
AfterH <- table(HRS_ds_ebb_w11$divorce)
BeforeH <- table(HRS_ebb_w11_divorce_2$R11MSTAT, HRS_ebb_w11_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```

## MBB

### Wave 10

#### Study-specific variable description



| **Name** | `R10MSTAT`|
|-|-|
| **Label** |`R10MSTAT:W10 R Marital Status`|
| **Table name** |`HRS-MBB-w10`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    
    


```{r assign10  mbb, echo=F}
opal.assign.table.tibble(o, 'HRS_mbb_w10_divorce','HRS.HRS-MBB-w10',variables=list('R10MSTAT'), missings = TRUE)
```

```{r local10  mbb, echo=F}
HRS_mbb_w10_divorce <- opal.execute(o,'HRS_mbb_w10_divorce')
vari <- HRS_mbb_w10_divorce$R10MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_mbb_w10_divorce$R10MSTAT, missing_values = NA)
ggplot(HRS_mbb_w10_divorce, aes(x=factor(R10MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo10  mbb, echo=TRUE}
HRS_ds_mbb_w10 <- tibble(id=HRS_mbb_w10_divorce$id)
HRS_ds_mbb_w10$divorce <- car::recode(as.vector(HRS_mbb_w10_divorce$R10MSTAT), "4:6='1'; 1:3='0'; 7:8='0'; NA='999'")
HRS_ds_mbb_w10$divorce <- labelled(HRS_ds_mbb_w10$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript10  mbb, echo=F}
vari <- HRS_ds_mbb_w10$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_mbb_w10$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_mbb_w10, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10  mbb, echo=F}
AfterH <- table(HRS_ds_mbb_w10$divorce)
BeforeH <- table(HRS_mbb_w10_divorce$R10MSTAT, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(BeforeH[c(4,5)])
BeforeH1[[1]] <- sum(BeforeH[c(1,2,3,6,7)])
BeforeH1[[3]] <- BeforeH[[8]]
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("1:3&7:8->0","4:6->1","NA->999")
kable(C)
```




### Wave 11

#### Study-specific variable description



| **Name** | `R11MSTAT`|
|-|-|
| **Label** |`R11MSTAT:W11 R Marital Status`|
| **Table name** |`HRS-MBB-w11`|
| **Categories** |`1 = Married`<br/>`2 = Married, spouse absent`<br/>`3 = Partnered`<br/>`4 = Separated`<br/>`5 = Divorced`<br/>`6 = Separated/Divorced`<br/>`7 = Widowed`<br/>`8 = Never Married`|
| **Missings** |`NA`|
| **Description** |  |










    

    

```{r assign11  mbb, echo=F}
opal.assign.table.tibble(o, 'HRS_mbb_w11_divorce','HRS.HRS-MBB-w11',variables=list('R11MSTAT'), missings = TRUE)
```

```{r local11  mbb, echo=F}
HRS_mbb_w11_divorce <- opal.execute(o,'HRS_mbb_w11_divorce')
vari <- HRS_mbb_w11_divorce$R11MSTAT
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = HRS_mbb_w11_divorce$R11MSTAT, missing_values = NA)
ggplot(HRS_mbb_w11_divorce, aes(x=factor(R11MSTAT))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Marital Status") + ylab("Frequency")
```

#### Harmonisation algorithm
To recode the harmonize variable from the study-specific variable it has to be recoded as follows:  

* `if divorce=1 or R11MSTAT in 4,5,6 into 1`
* `1,2,3,7,8 into 0`
* `NA into 999`

**R script:**

```{r harmo11  mbb, echo=TRUE}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, R11MSTAT=new$R11MSTAT, divorce=new_2$divorce) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = HRS_ds_mbb_w10 (divorce)
# new = HRS_mbb_w11_divorce (R11MSTAT)

HRS_mbb_w11_divorce_2 <- same_indiv(HRS_ds_mbb_w10, HRS_mbb_w11_divorce)

HRS_ds_mbb_w11 <- tibble(id=HRS_mbb_w11_divorce_2$id)

HRS_mbb_w11_divorce_2$divorce <- car::recode(as.vector(HRS_mbb_w11_divorce_2$divorce), "NA='-999'")
HRS_mbb_w11_divorce_2$R11MSTAT <- car::recode(as.vector(HRS_mbb_w11_divorce_2$R11MSTAT), "NA='-999'")

HRS_ds_mbb_w11$divorce <- c(NA)   
for(i in 1:dim(HRS_mbb_w11_divorce_2[1])){
  if( HRS_mbb_w11_divorce_2$divorce[i] == 1 | HRS_mbb_w11_divorce_2$R11MSTAT[i] %in% c(4,5,6)  ) { HRS_ds_mbb_w11$divorce[i] = 1 }
  else if( HRS_mbb_w11_divorce_2$R11MSTAT[i] %in% c(1,2,3,7,8) ) { HRS_ds_mbb_w11$divorce[i] = 0 }
}

HRS_ds_mbb_w11$divorce <- car::recode(as.vector(HRS_ds_mbb_w11$divorce), "NA='999'")
HRS_ds_mbb_w11$divorce <- labelled(HRS_ds_mbb_w11$divorce, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript11  mbb, echo=F}
vari <- HRS_ds_mbb_w11$divorce
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = HRS_ds_mbb_w11$divorce, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(HRS_ds_mbb_w11, aes(x=factor(divorce))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of divorce/separation") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11  mbb, echo=F}
AfterH <- table(HRS_ds_mbb_w11$divorce)
BeforeH <- table(HRS_mbb_w11_divorce_2$R11MSTAT, HRS_mbb_w11_divorce_2$divorce, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[2]] <- sum(sum(BeforeH[c(5,6,7),c(1,3)]), sum(BeforeH[,2]))
BeforeH1[[1]] <- sum(BeforeH[c(2,3,4,8,9),c(1,3)])
BeforeH1[[3]] <- sum(BeforeH[1,c(1,3)])
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("0","1","NA->999")
kable(C)
```






```{r final, echo=F}

l.hrs <- list(hrs_w1 = HRS_ds_hrs_w1, hrs_w2 = HRS_ds_hrs_w2, hrs_w3 = HRS_ds_hrs_w3, hrs_w4 = HRS_ds_hrs_w4, hrs_w5 = HRS_ds_hrs_w5, hrs_w6 = HRS_ds_hrs_w6, hrs_w7 = HRS_ds_hrs_w7, hrs_w8 = HRS_ds_hrs_w8, hrs_w9 = HRS_ds_hrs_w9, hrs_w10 = HRS_ds_hrs_w10, hrs_w11 = HRS_ds_hrs_w11, ahead_w2 = HRS_ds_ahead_w2, ahead_w3 = HRS_ds_ahead_w3, ahead_w4 = HRS_ds_ahead_w4, ahead_w5 = HRS_ds_ahead_w5, ahead_w6 = HRS_ds_ahead_w6, ahead_w7 = HRS_ds_ahead_w7, ahead_w8 = HRS_ds_ahead_w8, ahead_w9 = HRS_ds_ahead_w9, ahead_w10 = HRS_ds_ahead_w10, ahead_w11 = HRS_ds_ahead_w11, coda_w4 = HRS_ds_coda_w4, coda_w5 = HRS_ds_coda_w5, coda_w6 = HRS_ds_coda_w6, coda_w7 = HRS_ds_coda_w7, coda_w8 = HRS_ds_coda_w8, coda_w9 = HRS_ds_coda_w9, coda_w10 = HRS_ds_coda_w10, coda_w11 = HRS_ds_coda_w11, wb_w4 = HRS_ds_wb_w4, wb_w5 = HRS_ds_wb_w5, wb_w6 = HRS_ds_wb_w6, wb_w7 = HRS_ds_wb_w7, wb_w8 = HRS_ds_wb_w8, wb_w9 = HRS_ds_wb_w9, wb_w10 = HRS_ds_wb_w10, wb_w11 = HRS_ds_wb_w11, ebb_w7 = HRS_ds_ebb_w7, ebb_w8 = HRS_ds_ebb_w8, ebb_w9 = HRS_ds_ebb_w9, ebb_w10 = HRS_ds_ebb_w10, ebb_w11 = HRS_ds_ebb_w11, mbb_w10 = HRS_ds_mbb_w10, mbb_w11 = HRS_ds_mbb_w11)

for(name in names(l.hrs)) {
  m_name <- paste0("HRS_m_ds_",name)
  aux_object <- l.hrs[[name]]
  label(l.hrs[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label # Text value assigned at the DS description, at the top
  l.hrs[[name]][[2]] <- labelled(l.hrs[[name]][[2]], labels = cat_label)
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cat_label[1:2])
  assign(m_name, aux_object)
  rm(aux_object)
}

```




## Summary of descriptive statistics of the harmonised variable `divorce` accross populations and waves

Two tables are generated: 

1. Percentages of categories in each harmonised variable.

2. Frequencies and percentages of individuals with different trajectories. To avoid too large table, Only trajectories with percentages larger than 0.3 are shown.


**R script:**

```{r summ}

# Table HRS
l.hds <- l.hrs[grep("hrs_w",names(l.hrs))]
t.hds <- frq(l.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]][2])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", sapply(l.hds,function(wave) length(wave[[1]]))
             )
names(t.hds)<-c("val", "label",substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))
kable(t.hds)

dbb <- get(paste0("HRS_m_ds_",names(l.hds)[1]))[,c("id","divorce")]
for(ind in 2:length(l.hds)){
  dbb <- merge(dbb, get(paste0("HRS_m_ds_",names(l.hds)[ind]))[,c("id","divorce")], by = "id", suffixes = c("", paste0(".",names(l.hds)[ind])), all = T)
}
names(dbb) <- c("id", substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))

v.dbb <- dbb[,2]
for(ind in 2:length(l.hds)){
  v.dbb <- paste(v.dbb,dbb[,ind+1],sep="")
}
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])



# Table AHEAD
l.hds <- l.hrs[grep("ahead_w",names(l.hrs))]
t.hds <- frq(l.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]][2])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", sapply(l.hds,function(wave) length(wave[[1]]))
             )
names(t.hds)<-c("val", "label",substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))
kable(t.hds)

dbb <- get(paste0("HRS_m_ds_",names(l.hds)[1]))[,c("id","divorce")]
for(ind in 2:length(l.hds)){
  dbb <- merge(dbb, get(paste0("HRS_m_ds_",names(l.hds)[ind]))[,c("id","divorce")], by = "id", suffixes = c("", paste0(".",names(l.hds)[ind])), all = T)
}
names(dbb) <- c("id", substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))

v.dbb <- dbb[,2]
for(ind in 2:length(l.hds)){
  v.dbb <- paste(v.dbb,dbb[,ind+1],sep="")
}
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])



# Table CODA
l.hds <- l.hrs[grep("coda_w",names(l.hrs))]
t.hds <- frq(l.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]][2])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", sapply(l.hds,function(wave) length(wave[[1]]))
             )
names(t.hds)<-c("val", "label",substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))
kable(t.hds)

dbb <- get(paste0("HRS_m_ds_",names(l.hds)[1]))[,c("id","divorce")]
for(ind in 2:length(l.hds)){
  dbb <- merge(dbb, get(paste0("HRS_m_ds_",names(l.hds)[ind]))[,c("id","divorce")], by = "id", suffixes = c("", paste0(".",names(l.hds)[ind])), all = T)
}
names(dbb) <- c("id", substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))

v.dbb <- dbb[,2]
for(ind in 2:length(l.hds)){
  v.dbb <- paste(v.dbb,dbb[,ind+1],sep="")
}
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])


# Table WB
l.hds <- l.hrs[grep("wb_w",names(l.hrs))]
t.hds <- frq(l.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]][2])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", sapply(l.hds,function(wave) length(wave[[1]]))
             )
names(t.hds)<-c("val", "label",substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))
kable(t.hds)

dbb <- get(paste0("HRS_m_ds_",names(l.hds)[1]))[,c("id","divorce")]
for(ind in 2:length(l.hds)){
  dbb <- merge(dbb, get(paste0("HRS_m_ds_",names(l.hds)[ind]))[,c("id","divorce")], by = "id", suffixes = c("", paste0(".",names(l.hds)[ind])), all = T)
}
names(dbb) <- c("id", substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))

v.dbb <- dbb[,2]
for(ind in 2:length(l.hds)){
  v.dbb <- paste(v.dbb,dbb[,ind+1],sep="")
}
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])


# Table EBB
l.hds <- l.hrs[grep("ebb_w",names(l.hrs))]
t.hds <- frq(l.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]][2])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", sapply(l.hds,function(wave) length(wave[[1]]))
             )
names(t.hds)<-c("val", "label",substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))
kable(t.hds)

dbb <- get(paste0("HRS_m_ds_",names(l.hds)[1]))[,c("id","divorce")]
for(ind in 2:length(l.hds)){
  dbb <- merge(dbb, get(paste0("HRS_m_ds_",names(l.hds)[ind]))[,c("id","divorce")], by = "id", suffixes = c("", paste0(".",names(l.hds)[ind])), all = T)
}
names(dbb) <- c("id", substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))

v.dbb <- dbb[,2]
for(ind in 2:length(l.hds)){
  v.dbb <- paste(v.dbb,dbb[,ind+1],sep="")
}
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])


# Table MBB
l.hds <- l.hrs[grep("mbb_w",names(l.hrs))]
t.hds <- frq(l.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]][2])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", sapply(l.hds,function(wave) length(wave[[1]]))
             )
names(t.hds)<-c("val", "label",substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))
kable(t.hds)

dbb <- get(paste0("HRS_m_ds_",names(l.hds)[1]))[,c("id","divorce")]
for(ind in 2:length(l.hds)){
  dbb <- merge(dbb, get(paste0("HRS_m_ds_",names(l.hds)[ind]))[,c("id","divorce")], by = "id", suffixes = c("", paste0(".",names(l.hds)[ind])), all = T)
}
names(dbb) <- c("id", substr(names(l.hds),regexpr("_w[0-9]",names(l.hds))+1,nchar(names(l.hds))))

v.dbb <- dbb[,2]
for(ind in 2:length(l.hds)){
  v.dbb <- paste(v.dbb,dbb[,ind+1],sep="")
}
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

```









 
```{r save, echo=FALSE}
divorce <- HRS_ds_ahead_w2
save(divorce, file = "../RData/ahead_w2/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w3
save(divorce, file = "../RData/ahead_w3/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w4
save(divorce, file = "../RData/ahead_w4/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w5
save(divorce, file = "../RData/ahead_w5/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w6
save(divorce, file = "../RData/ahead_w6/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w7
save(divorce, file = "../RData/ahead_w7/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w8
save(divorce, file = "../RData/ahead_w8/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w9
save(divorce, file = "../RData/ahead_w9/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w10
save(divorce, file = "../RData/ahead_w10/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ahead_w11
save(divorce, file = "../RData/ahead_w11/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w4
save(divorce, file = "../RData/coda_w4/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w5
save(divorce, file = "../RData/coda_w5/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w6
save(divorce, file = "../RData/coda_w6/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w7
save(divorce, file = "../RData/coda_w7/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w8
save(divorce, file = "../RData/coda_w8/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w9
save(divorce, file = "../RData/coda_w9/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w10
save(divorce, file = "../RData/coda_w10/divorce.RData")
rm(divorce)

divorce <- HRS_ds_coda_w11
save(divorce, file = "../RData/coda_w11/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ebb_w7
save(divorce, file = "../RData/ebb_w7/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ebb_w8
save(divorce, file = "../RData/ebb_w8/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ebb_w9
save(divorce, file = "../RData/ebb_w9/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ebb_w10
save(divorce, file = "../RData/ebb_w10/divorce.RData")
rm(divorce)

divorce <- HRS_ds_ebb_w11
save(divorce, file = "../RData/ebb_w11/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w1
save(divorce, file = "../RData/hrs_w1/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w2
save(divorce, file = "../RData/hrs_w2/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w3
save(divorce, file = "../RData/hrs_w3/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w4
save(divorce, file = "../RData/hrs_w4/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w5
save(divorce, file = "../RData/hrs_w5/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w6
save(divorce, file = "../RData/hrs_w6/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w7
save(divorce, file = "../RData/hrs_w7/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w8
save(divorce, file = "../RData/hrs_w8/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w9
save(divorce, file = "../RData/hrs_w9/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w10
save(divorce, file = "../RData/hrs_w10/divorce.RData")
rm(divorce)

divorce <- HRS_ds_hrs_w11
save(divorce, file = "../RData/hrs_w11/divorce.RData")
rm(divorce)

divorce <- HRS_ds_mbb_w10
save(divorce, file = "../RData/mbb_w10/divorce.RData")
rm(divorce)

divorce <- HRS_ds_mbb_w11
save(divorce, file = "../RData/mbb_w11/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w4
save(divorce, file = "../RData/wb_w4/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w5
save(divorce, file = "../RData/wb_w5/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w6
save(divorce, file = "../RData/wb_w6/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w7
save(divorce, file = "../RData/wb_w7/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w8
save(divorce, file = "../RData/wb_w8/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w9
save(divorce, file = "../RData/wb_w9/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w10
save(divorce, file = "../RData/wb_w10/divorce.RData")
rm(divorce)

divorce <- HRS_ds_wb_w11
save(divorce, file = "../RData/wb_w11/divorce.RData")
rm(divorce)


```

# Quality estimation
```{r closeRsession, echo=FALSE} 
opal.logout(o)
```

