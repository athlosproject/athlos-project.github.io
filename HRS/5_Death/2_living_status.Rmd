---
title: "Living Status"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---
  
<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("../../setup.r")
load("ID_issue_ls.Rdata")
ID_issue_ls$cohort <- substr(ID_issue_ls$athlos_id, 4,5)
ID_issue_ls$cohort <- car::recode(ID_issue_ls$cohort, "'01'='hrs'; '02'='ahead';  '03'='coda'; '04'='ebb'; '05'='mbb'; '06'='wb'")
source("../../helpfunctions.r")


```
<!-- ########################################################## --> 
<!-- # Loading DS description -->
```{r main, child='../../_DS_Rmd/living_statusDS.Rmd'}
```
```{r global, echo=F}
source('../../_DS_Rmd/living_statusDS.R')
```




# Data process

## HRS

### Wave 1 

#### Study-specific variable description

| **Name** | `R1IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w1`|`HRS-HRS-w1`|`HRS-HRS-w1`|`HRS-HRS-w1_date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |



```{r assign_hrs1, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w1_ls','HRS.HRS-HRS-w1', variables=list('R1IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w1_ls <- opal.execute(o,'HRS_hrs_w1_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w1_di','HRS.HRS-HRS-w1_date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w1_di <- opal.execute(o,'HRS_hrs_w1_di')

HRS_hrs_w1_ls <- HRS_hrs_w1_ls %>% left_join(HRS_hrs_w1_di, by = "id")


```

**R script:**

```{r preharm hrs_w1, echo=T}

HRS_hrs_w1_ls$yinter <- format(HRS_hrs_w1_ls$dinterview, '%Y')

HRS_hrs_w1_ls$minter <- as.numeric(format(HRS_hrs_w1_ls$dinterview, '%m'))

HRS_hrs_w1_ls <- HRS_hrs_w1_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 1*2+1990),1,0))

```

```{r local_hrs1, echo=F}

vari <- HRS_hrs_w1_ls$R1IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R1IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w1_ls, aes(factor(R1IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Interview Status") + ylab("Frequency")

vbl <- HRS_hrs_w1_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w1_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w1_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w1_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w1_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w1_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w1_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w1_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w1_ls[["R1IWSTAT"]], HRS_hrs_w1_ls[["dead"]], useNA = "ifany"), caption = "Cross R1IWSTAT data with death date data")



```

#### Harmonisation algorithm

Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead)

* Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive)
* Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died)
* Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout)
* Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_hrs1}
HRS_ds_hrs_w1 <- tibble(id=HRS_hrs_w1_ls$id)
HRS_ds_hrs_w1$living_status <- car::recode(HRS_hrs_w1_ls$R1IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w1$living_status[which(HRS_hrs_w1_ls$dead == 1)] <- 1



HRS_ds_hrs_w1$living_status <- labelled(HRS_ds_hrs_w1$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2,"Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs1, echo=F}
vari <- HRS_ds_hrs_w1$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w1, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs1, echo=F, results='asis'}
kable(table(HRS_hrs_w1_ls$R1IWSTAT, HRS_ds_hrs_w1$living_status, useNA = "ifany"), align='c', caption ='R1IWSTAT vs living_status')
#newT <- full_join( HRS_hrs_w1_ls, HRS_ds_hrs_w1, by="id")
#flat_table(newT, living_status, R1IWSTAT)
```

```{r importOPAL_hrs1, echo=F}



```


### Wave 2 

#### Study-specific variable description

| **Name** | `R2IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w2`|`HRS-HRS-w2`|`HRS-HRS-w2`|`HRS-HRS-w2-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_hrs2, echo=F}
opal.assign.table.tibble(o,'HRS_hrs_w2_ls','HRS.HRS-HRS-w2', variables=list('R2IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w2_ls <- opal.execute(o,'HRS_hrs_w2_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w2_di','HRS.HRS-HRS-w2-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w2_di <- opal.execute(o,'HRS_hrs_w2_di')

HRS_hrs_w2_ls <- HRS_hrs_w2_ls %>% left_join(HRS_hrs_w2_di, by = "id")


```

**R script:**

```{r preharm hrs_w2, echo=T}

HRS_hrs_w2_ls$yinter <- format(HRS_hrs_w2_ls$dinterview, '%Y')

HRS_hrs_w2_ls$minter <- as.numeric(format(HRS_hrs_w2_ls$dinterview, '%m'))

HRS_hrs_w2_ls <- HRS_hrs_w2_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 2*2+1990),1,0))


```

```{r local_hrs2, echo=F}

vari <- HRS_hrs_w2_ls$R2IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R2IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w2_ls, aes(factor(R2IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Interview Status") + ylab("Frequency")

vbl <- HRS_hrs_w2_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w2_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w2_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w2_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w2_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w2_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w2_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w2_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w2_ls[["R2IWSTAT"]], HRS_hrs_w2_ls[["dead"]], useNA = "ifany"), caption = "Cross R2IWSTAT data with death date data")

kable(HRS_hrs_w2_ls %>% filter(R2IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==2,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")

```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead)

* Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive)
* Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died)
* Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout)
* Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r local_alg2, echo=F}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==2 & ID_issue_ls$cohort=='hrs')]
ids_death_w1 <- HRS_ds_hrs_w1$id[HRS_ds_hrs_w1$living_status == 1]

HRS_ds_hrs_w2 <- tibble(id=HRS_hrs_w2_ls$id)
HRS_ds_hrs_w2$living_status <- car::recode(HRS_hrs_w2_ls$R2IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w2$living_status[which(HRS_hrs_w2_ls$dead == 1)] <- 1


HRS_ds_hrs_w2$living_status[HRS_ds_hrs_w2$id %in%  ids_death_w1] <- 1
HRS_ds_hrs_w2$living_status[which(HRS_ds_hrs_w2$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w2$living_status <- labelled(HRS_ds_hrs_w2$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2,"Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs2, echo=F}
vari <- HRS_ds_hrs_w2$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w2, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs2, echo=F, results='asis'}
kable(table(HRS_hrs_w2_ls$R2IWSTAT, HRS_ds_hrs_w2$living_status, useNA = "ifany"), align='c', caption ='R2IWSTAT vs living_status')
```

```{r importOPAL_hrs2, echo=F}



```


### Wave 3 

#### Study-specific variable description

| **Name** | `R3IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w3`|`HRS-HRS-w3`|`HRS-HRS-w3`|`HRS-HRS-w3-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |



```{r assign_hrs3, echo=F}
opal.assign.table.tibble(o,'HRS_hrs_w3_ls','HRS.HRS-HRS-w3', variables=list('R3IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w3_ls <- opal.execute(o,'HRS_hrs_w3_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w3_di','HRS.HRS-HRS-w3-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w3_di <- opal.execute(o,'HRS_hrs_w3_di')

HRS_hrs_w3_ls <- HRS_hrs_w3_ls %>% left_join(HRS_hrs_w3_di, by = "id")


```

**R script:**

```{r preharm hrs_w3, echo=T}

HRS_hrs_w3_ls$yinter <- format(HRS_hrs_w3_ls$dinterview, '%Y')

HRS_hrs_w3_ls$minter <- as.numeric(format(HRS_hrs_w3_ls$dinterview, '%m'))

HRS_hrs_w3_ls <- HRS_hrs_w3_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 3*2+1990),1,0))


```

```{r local_hrs3, echo=F}

vari <- HRS_hrs_w3_ls$R3IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R3IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w3_ls, aes(factor(R3IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Interview Status") + ylab("Frequency")

vbl <- HRS_hrs_w3_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w3_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w3_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w3_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w3_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w3_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w3_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w3_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w3_ls[["R3IWSTAT"]], HRS_hrs_w3_ls[["dead"]], useNA = "ifany"), caption = "Cross R3IWSTAT data with death date data")

kable(HRS_hrs_w3_ls %>% filter(R3IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==3,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead)

* Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive)
* Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died)
* Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout)
* Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_hrs3}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==3 & ID_issue_ls$cohort=='hrs')]
ids_death_w2 <- HRS_ds_hrs_w2$id[HRS_ds_hrs_w2$living_status == 1]

HRS_ds_hrs_w3 <- tibble(id=HRS_hrs_w3_ls$id)
HRS_ds_hrs_w3$living_status <- car::recode(HRS_hrs_w3_ls$R3IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w3$living_status[which(HRS_hrs_w3_ls$dead == 1)] <- 1


HRS_ds_hrs_w3$living_status[HRS_ds_hrs_w3$id %in%  ids_death_w2] <- 1
HRS_ds_hrs_w3$living_status[which(HRS_ds_hrs_w3$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w3$living_status <- labelled(HRS_ds_hrs_w3$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2,"Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs3, echo=F}
vari <- HRS_ds_hrs_w3$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w3, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs3, echo=F, results='asis'}
kable(table(HRS_hrs_w3_ls$R3IWSTAT, HRS_ds_hrs_w3$living_status, useNA = "ifany"), align='c', caption ='R3IWSTAT vs living_status')
```


```{r importOPAL_hrs3, echo=F}



```


### Wave 4 

#### Study-specific variable description

| **Name** | `R4IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w4`|`HRS-HRS-w4`|`HRS-HRS-w4`|`HRS-HRS-w4-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_hrs4, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w4_ls','HRS.HRS-HRS-w4',   variables=list('R4IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w4_ls <- opal.execute(o,'HRS_hrs_w4_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w4_di','HRS.HRS-HRS-w4-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w4_di <- opal.execute(o,'HRS_hrs_w4_di')

HRS_hrs_w4_ls <- HRS_hrs_w4_ls %>% left_join(HRS_hrs_w4_di, by = "id")


```

**R script:**

```{r preharm hrs_w4, echo=T}

HRS_hrs_w4_ls$yinter <- format(HRS_hrs_w4_ls$dinterview, '%Y')

HRS_hrs_w4_ls$minter <- as.numeric(format(HRS_hrs_w4_ls$dinterview, '%m'))

HRS_hrs_w4_ls <- HRS_hrs_w4_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 4*2+1990),1,0))


                      
```

```{r local_hrs4, echo=F}

vari <- HRS_hrs_w4_ls$R4IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R4IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w4_ls, aes(factor(R4IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w4_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w4_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w4_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w4_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w4_ls[["R4IWSTAT"]], HRS_hrs_w4_ls[["dead"]], useNA = "ifany"), caption = "Cross R4IWSTAT data with death date data")

kable(HRS_hrs_w4_ls %>% filter(R4IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==4,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm

Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.

**R script:**

```{r harmo_hrs4}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==4 & ID_issue_ls$cohort=='hrs')]
ids_death_w3 <- HRS_ds_hrs_w3$id[HRS_ds_hrs_w3$living_status == 1]

HRS_ds_hrs_w4 <- tibble(id=HRS_hrs_w4_ls$id)
HRS_ds_hrs_w4$living_status <- car::recode(HRS_hrs_w4_ls$R4IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w4$living_status[which(HRS_hrs_w4_ls$dead == 1)] <- 1


HRS_ds_hrs_w4$living_status[HRS_ds_hrs_w4$id %in%  ids_death_w3] <- 1
HRS_ds_hrs_w4$living_status[which(HRS_ds_hrs_w4$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w4$living_status <- labelled(HRS_ds_hrs_w4$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs4, echo=F}
vari <- HRS_ds_hrs_w4$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w4, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs4, echo=F, results='asis'}
kable(table(HRS_hrs_w4_ls$R4IWSTAT, HRS_ds_hrs_w4$living_status, useNA = "ifany"), align='c', caption ='R4IWSTAT vs living_status')
```

```{r importOPAL_hrs4, echo=F}



```


### Wave 5

#### Study-specific variable description

| **Name** | `R5IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w5`|`HRS-HRS-w5`|`HRS-HRS-w5`|`HRS-HRS-w5-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_hrs5, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w5_ls','HRS.HRS-HRS-w5', variables=list('R5IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w5_ls <- opal.execute(o,'HRS_hrs_w5_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w5_di','HRS.HRS-HRS-w5-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w5_di <- opal.execute(o,'HRS_hrs_w5_di')

HRS_hrs_w5_ls <- HRS_hrs_w5_ls %>% left_join(HRS_hrs_w5_di, by = "id")


```

**R script:**

```{r preharm hrs_w5, echo=T}

HRS_hrs_w5_ls$yinter <- format(HRS_hrs_w5_ls$dinterview, '%Y')

HRS_hrs_w5_ls$minter <- as.numeric(format(HRS_hrs_w5_ls$dinterview, '%m'))

HRS_hrs_w5_ls <- HRS_hrs_w5_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 5*2+1990),1,0))


                        
```

```{r local_hrs5, echo=F}

vari <- HRS_hrs_w5_ls$R5IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R5IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w5_ls, aes(factor(R5IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w5_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w5_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w5_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w5_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w5_ls[["R5IWSTAT"]], HRS_hrs_w5_ls[["dead"]], useNA = "ifany"), caption = "Cross R5IWSTAT data with death date data")

kable(HRS_hrs_w5_ls %>% filter(R5IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==5,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_hrs5}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==5 & ID_issue_ls$cohort=='hrs')]
ids_death_w4 <- HRS_ds_hrs_w4$id[which(HRS_ds_hrs_w4$living_status == 1)]

HRS_ds_hrs_w5 <- tibble(id=HRS_hrs_w5_ls$id)
HRS_ds_hrs_w5$living_status <- car::recode(HRS_hrs_w5_ls$R5IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w5$living_status[which(HRS_hrs_w5_ls$dead == 1)] <- 1


HRS_ds_hrs_w5$living_status[which(HRS_ds_hrs_w5$id %in%  ids_death_w4)] <- 1
HRS_ds_hrs_w5$living_status[which(HRS_ds_hrs_w5$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w5$living_status <- labelled(HRS_ds_hrs_w5$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs5, echo=F}
vari <- HRS_ds_hrs_w5$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w5, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs5, echo=F, results='asis'}
kable(table(HRS_hrs_w5_ls$R5IWSTAT, HRS_ds_hrs_w5$living_status, useNA = "ifany"), align='c', caption ='R5IWSTAT vs living_status')
```


```{r importOPAL_hrs5, echo=F}



```






### Wave 6

#### Study-specific variable description



| **Name** | `R6IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w6`|`HRS-HRS-w6`|`HRS-HRS-w6`|`HRS-HRS-w6-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_hrs6, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w6_ls','HRS.HRS-HRS-w6', variables=list('R6IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w6_ls <- opal.execute(o,'HRS_hrs_w6_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w6_di','HRS.HRS-HRS-w6-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w6_di <- opal.execute(o,'HRS_hrs_w6_di')

HRS_hrs_w6_ls <- HRS_hrs_w6_ls %>% left_join(HRS_hrs_w6_di, by = "id")


```

**R script:**

```{r preharm hrs_w6, echo=T}

HRS_hrs_w6_ls$yinter <- format(HRS_hrs_w6_ls$dinterview, '%Y')

HRS_hrs_w6_ls$minter <- as.numeric(format(HRS_hrs_w6_ls$dinterview, '%m'))

HRS_hrs_w6_ls <- HRS_hrs_w6_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 6*2+1990),1,0))


                        
```

```{r local_hrs6, echo=F}

vari <- HRS_hrs_w6_ls$R6IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R6IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w6_ls, aes(factor(R6IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w6_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w6_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w6_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w6_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w6_ls[["R6IWSTAT"]], HRS_hrs_w6_ls[["dead"]], useNA = "ifany"), caption = "Cross R6IWSTAT data with death date data")

kable(HRS_hrs_w6_ls %>% filter(R6IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==6,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_hrs6}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==6 & ID_issue_ls$cohort=='hrs')]
ids_death_w5 <- HRS_ds_hrs_w5$id[HRS_ds_hrs_w5$living_status == 1]

HRS_ds_hrs_w6 <- tibble(id=HRS_hrs_w6_ls$id)
HRS_ds_hrs_w6$living_status <- car::recode(HRS_hrs_w6_ls$R6IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w6$living_status[which(HRS_hrs_w6_ls$dead == 1)] <- 1


HRS_ds_hrs_w6$living_status[HRS_ds_hrs_w6$id %in%  ids_death_w5] <- 1
HRS_ds_hrs_w6$living_status[which(HRS_ds_hrs_w6$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w6$living_status <- labelled(HRS_ds_hrs_w6$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs6, echo=F}
vari <- HRS_ds_hrs_w6$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w6, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs6, echo=F, results='asis'}
kable(table(HRS_hrs_w6_ls$R6IWSTAT, HRS_ds_hrs_w6$living_status, useNA = "ifany"), align='c', caption ='R6IWSTAT vs living_status')
```

```{r importOPAL_hrs6, echo=F}



```


### Wave 7

#### Study-specific variable description

| **Name** | `R7IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w7`|`HRS-HRS-w7`|`HRS-HRS-w7`|`HRS-HRS-w7-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |



```{r assign_hrs7, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w7_ls','HRS.HRS-HRS-w7', variables=list('R7IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w7_ls <- opal.execute(o,'HRS_hrs_w7_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w7_di','HRS.HRS-HRS-w7-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w7_di <- opal.execute(o,'HRS_hrs_w7_di')

HRS_hrs_w7_ls <- HRS_hrs_w7_ls %>% left_join(HRS_hrs_w7_di, by = "id")


```

**R script:**

```{r preharm hrs_w7, echo=T}

HRS_hrs_w7_ls$yinter <- format(HRS_hrs_w7_ls$dinterview, '%Y')

HRS_hrs_w7_ls$minter <- as.numeric(format(HRS_hrs_w7_ls$dinterview, '%m'))

HRS_hrs_w7_ls <- HRS_hrs_w7_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 7*2+1990),1,0))


                        
```

```{r local_hrs7, echo=F}

vari <- HRS_hrs_w7_ls$R7IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R7IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w7_ls, aes(factor(R7IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w7_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w7_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w7_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w7_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w7_ls[["R7IWSTAT"]], HRS_hrs_w7_ls[["dead"]], useNA = "ifany"), caption = "Cross R7IWSTAT data with death date data")

kable(HRS_hrs_w7_ls %>% filter(R7IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==7,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_hrs7}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==7 & ID_issue_ls$cohort=='hrs')]
ids_death_w6 <- HRS_ds_hrs_w6$id[HRS_ds_hrs_w6$living_status == 1]

HRS_ds_hrs_w7 <- tibble(id=HRS_hrs_w7_ls$id)
HRS_ds_hrs_w7$living_status <- car::recode(HRS_hrs_w7_ls$R7IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w7$living_status[which(HRS_hrs_w7_ls$dead == 1)] <- 1


HRS_ds_hrs_w7$living_status[HRS_ds_hrs_w7$id %in%  ids_death_w6] <- 1
HRS_ds_hrs_w7$living_status[which(HRS_ds_hrs_w7$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w7$living_status <- labelled(HRS_ds_hrs_w7$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs7, echo=F}
vari <- HRS_ds_hrs_w7$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w7, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs7, echo=F, results='asis'}
kable(table(HRS_hrs_w7_ls$R7IWSTAT, HRS_ds_hrs_w7$living_status, useNA = "ifany"), align='c', caption ='R7IWSTAT vs living_status')
```

```{r importOPAL_hrs7, echo=F}



```

### Wave 8

#### Study-specific variable description

| **Name** | `R8IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w8`|`HRS-HRS-w8`|`HRS-HRS-w8`|`HRS-HRS-w8-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_hrs8, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w8_ls','HRS.HRS-HRS-w8', variables=list('R8IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w8_ls <- opal.execute(o,'HRS_hrs_w8_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w8_di','HRS.HRS-HRS-w8-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w8_di <- opal.execute(o,'HRS_hrs_w8_di')

HRS_hrs_w8_ls <- HRS_hrs_w8_ls %>% left_join(HRS_hrs_w8_di, by = "id")


```

**R script:**

```{r preharm hrs_w8, echo=T}

HRS_hrs_w8_ls$yinter <- format(HRS_hrs_w8_ls$dinterview, '%Y')

HRS_hrs_w8_ls$minter <- as.numeric(format(HRS_hrs_w8_ls$dinterview, '%m'))

HRS_hrs_w8_ls <- HRS_hrs_w8_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 8*2+1990),1,0))


                        
```

```{r local_hrs8, echo=F}

vari <- HRS_hrs_w8_ls$R8IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R8IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w8_ls, aes(factor(R8IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w8_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w8_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w8_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w8_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w8_ls[["R8IWSTAT"]], HRS_hrs_w8_ls[["dead"]], useNA = "ifany"), caption = "Cross R8IWSTAT data with death date data")

kable(HRS_hrs_w8_ls %>% filter(R8IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==8,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_hrs8}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==8 & ID_issue_ls$cohort=='hrs')]
ids_death_w7 <- HRS_ds_hrs_w7$id[HRS_ds_hrs_w7$living_status == 1]

HRS_ds_hrs_w8 <- tibble(id=HRS_hrs_w8_ls$id)
HRS_ds_hrs_w8$living_status <- car::recode(HRS_hrs_w8_ls$R8IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w8$living_status[which(HRS_hrs_w8_ls$dead == 1)] <- 1


HRS_ds_hrs_w8$living_status[HRS_ds_hrs_w8$id %in%  ids_death_w7] <- 1
HRS_ds_hrs_w8$living_status[which(HRS_ds_hrs_w8$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w8$living_status <- labelled(HRS_ds_hrs_w8$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs8, echo=F}
vari <- HRS_ds_hrs_w8$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w8, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs8, echo=F, results='asis'}
kable(table(HRS_hrs_w8_ls$R8IWSTAT, HRS_ds_hrs_w8$living_status, useNA = "ifany"), align='c', caption ='R8IWSTAT vs living_status')
```

```{r importOPAL_hrs8, echo=F}



```


### Wave 9

#### Study-specific variable description



| **Name** | `R9IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w9`|`HRS-HRS-w9`|`HRS-HRS-w9`|`HRS-HRS-w9-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_hrs9, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w9_ls','HRS.HRS-HRS-w9',variables=list('R9IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w9_ls <- opal.execute(o,'HRS_hrs_w9_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w9_di','HRS.HRS-HRS-w9-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w9_di <- opal.execute(o,'HRS_hrs_w9_di')

HRS_hrs_w9_ls <- HRS_hrs_w9_ls %>% left_join(HRS_hrs_w9_di, by = "id")


```

**R script:**

```{r preharm hrs_w9, echo=T}

HRS_hrs_w9_ls$yinter <- format(HRS_hrs_w9_ls$dinterview, '%Y')

HRS_hrs_w9_ls$minter <- as.numeric(format(HRS_hrs_w9_ls$dinterview, '%m'))

HRS_hrs_w9_ls <- HRS_hrs_w9_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 9*2+1990),1,0))


                         
```

```{r local_hrs9, echo=F}

vari <- HRS_hrs_w9_ls$R9IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R9IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w9_ls, aes(factor(R9IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w9_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w9_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w9_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w9_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w9_ls[["R9IWSTAT"]], HRS_hrs_w9_ls[["dead"]], useNA = "ifany"), caption = "Cross R9IWSTAT data with death date data")

kable(HRS_hrs_w9_ls %>% filter(R9IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==9,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_hrs9}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==9 & ID_issue_ls$cohort=='hrs')]
ids_death_w8 <- HRS_ds_hrs_w8$id[HRS_ds_hrs_w8$living_status == 1]

HRS_ds_hrs_w9 <- tibble(id=HRS_hrs_w9_ls$id)
HRS_ds_hrs_w9$living_status <- car::recode(HRS_hrs_w9_ls$R9IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w9$living_status[which(HRS_hrs_w9_ls$dead == 1)] <- 1


HRS_ds_hrs_w9$living_status[HRS_ds_hrs_w9$id %in%  ids_death_w8] <- 1
HRS_ds_hrs_w9$living_status[which(HRS_ds_hrs_w9$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w9$living_status <- labelled(HRS_ds_hrs_w9$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs9, echo=F}
vari <- HRS_ds_hrs_w9$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w9, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs9, echo=F, results='asis'}
kable(table(HRS_hrs_w9_ls$R9IWSTAT, HRS_ds_hrs_w9$living_status, useNA = "ifany"), align='c', caption ='R9IWSTAT vs living_status')
```

```{r importOPAL_hrs9, echo=F}



```


### Wave 10

#### Study-specific variable description

| **Name** | `R10IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w10`|`HRS-HRS-w10`|`HRS-HRS-w10`|`HRS-HRS-w10-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_hrs10, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w10_ls','HRS.HRS-HRS-w10', variables=list('R10IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w10_ls <- opal.execute(o,'HRS_hrs_w10_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w10_di','HRS.HRS-HRS-w10-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w10_di <- opal.execute(o,'HRS_hrs_w10_di')

HRS_hrs_w10_ls <- HRS_hrs_w10_ls %>% left_join(HRS_hrs_w10_di, by = "id")


```

**R script:**

```{r preharm hrs_w10, echo=T}

HRS_hrs_w10_ls$yinter <- format(HRS_hrs_w10_ls$dinterview, '%Y')

HRS_hrs_w10_ls$minter <- as.numeric(format(HRS_hrs_w10_ls$dinterview, '%m'))

HRS_hrs_w10_ls <- HRS_hrs_w10_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 10*2+1990),1,0))


```

```{r local_hrs10, echo=F}

vari <- HRS_hrs_w10_ls$R10IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R10IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w10_ls, aes(factor(R10IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w10_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w10_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w10_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w10_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w10_ls[["R10IWSTAT"]], HRS_hrs_w10_ls[["dead"]], useNA = "ifany"), caption = "Cross R10IWSTAT data with death date data")

kable(HRS_hrs_w10_ls %>% filter(R10IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==10,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_hrs10}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==10 & ID_issue_ls$cohort=='hrs')]
ids_death_w9 <- HRS_ds_hrs_w9$id[HRS_ds_hrs_w9$living_status == 1]

HRS_ds_hrs_w10 <- tibble(id=HRS_hrs_w10_ls$id)
HRS_ds_hrs_w10$living_status <- car::recode(HRS_hrs_w10_ls$R10IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w10$living_status[which(HRS_hrs_w10_ls$dead == 1)] <- 1


HRS_ds_hrs_w10$living_status[HRS_ds_hrs_w10$id %in%  ids_death_w9] <- 1
HRS_ds_hrs_w10$living_status[which(HRS_ds_hrs_w10$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w10$living_status <- labelled(HRS_ds_hrs_w10$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs10, echo=F}
vari <- HRS_ds_hrs_w10$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w10, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs10, echo=F, results='asis'}
kable(table(HRS_hrs_w10_ls$R10IWSTAT, HRS_ds_hrs_w10$living_status, useNA = "ifany"), align='c', caption ='R10IWSTAT vs living_status')
```

```{r importOPAL_hrs10, echo=F}



```


### Wave 11

#### Study-specific variable description

| **Name** | `R11IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-HRS-w11`|`HRS-HRS-w11`|`HRS-HRS-w11`|`HRS-HRS-w11-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |



```{r assign_hrs11, echo=F}
opal.assign.table.tibble(o, 'HRS_hrs_w11_ls','HRS.HRS-HRS-w11', variables=list('R11IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_hrs_w11_ls <- opal.execute(o,'HRS_hrs_w11_ls')

opal.assign.table.tibble(o, 'HRS_hrs_w11_di','HRS.HRS-HRS-w11-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_hrs_w11_di <- opal.execute(o,'HRS_hrs_w11_di')

HRS_hrs_w11_ls <- HRS_hrs_w11_ls %>% left_join(HRS_hrs_w11_di, by = "id")


```

**R script:**

```{r preharm hrs_w11, echo=T}

HRS_hrs_w11_ls$yinter <- format(HRS_hrs_w11_ls$dinterview, '%Y')

HRS_hrs_w11_ls$minter <- as.numeric(format(HRS_hrs_w11_ls$dinterview, '%m'))

HRS_hrs_w11_ls <- HRS_hrs_w11_ls %>%
  mutate(dead = if_else(!is.na(RADYEAR),1,0))


                        
```


```{r local_hrs11, echo=F}

vari <- HRS_hrs_w11_ls$R11IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R11IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w11_ls, aes(factor(R11IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_hrs_w11_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w11_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_hrs_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_hrs_w11_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_hrs_w11_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_hrs_w11_ls[["R11IWSTAT"]], HRS_hrs_w11_ls[["dead"]], useNA = "ifany"), caption = "Cross R11IWSTAT data with death date data")

kable(HRS_hrs_w11_ls %>% filter(R11IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==11,cohort=='hrs') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_hrs11}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==11 & ID_issue_ls$cohort=='hrs')]
ids_death_w10 <- HRS_ds_hrs_w10$id[HRS_ds_hrs_w10$living_status == 1]

HRS_ds_hrs_w11 <- tibble(id=HRS_hrs_w11_ls$id)
HRS_ds_hrs_w11$living_status <- car::recode(HRS_hrs_w11_ls$R11IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_hrs_w11$living_status[which(HRS_hrs_w11_ls$dead == 1)] <- 1


HRS_ds_hrs_w11$living_status[HRS_ds_hrs_w11$id %in%  ids_death_w10] <- 1
HRS_ds_hrs_w11$living_status[which(HRS_ds_hrs_w11$id %in% ids_issue_ls)] <- 1
HRS_ds_hrs_w11$living_status <- labelled(HRS_ds_hrs_w11$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_hrs11, echo=F}
vari <- HRS_ds_hrs_w11$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w11, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_hrs11, echo=F, results='asis'}
kable(table(HRS_hrs_w11_ls$R11IWSTAT, HRS_ds_hrs_w11$living_status, useNA = "ifany"), align='c', caption ='R11IWSTAT vs living_status')
```

```{r importOPAL_hrs11, echo=F}



```



## AHEAD

### Wave 2 

#### Study-specific variable description

| **Name** | `R2IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w2`|`HRS-AHEAD-w2`|`HRS-AHEAD-w2`|`HRS-AHEAD-w2-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead2, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w2_ls','HRS.HRS-AHEAD-w2', variables=list('R2IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w2_ls <- opal.execute(o,'HRS_ahead_w2_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w2_di','HRS.HRS-AHEAD-w2-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w2_di <- opal.execute(o,'HRS_ahead_w2_di')

HRS_ahead_w2_ls <- HRS_ahead_w2_ls %>% left_join(HRS_ahead_w2_di, by = "id")


```

**R script:**

```{r preharm ahead_w2, echo=T}

HRS_ahead_w2_ls$yinter <- format(HRS_ahead_w2_ls$dinterview, '%Y')

HRS_ahead_w2_ls$minter <- as.numeric(format(HRS_ahead_w2_ls$dinterview, '%m'))

HRS_ahead_w2_ls <- HRS_ahead_w2_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 2*2+1990),1,0))
# Even there are id's of wave 2 interviewed in 1993, there is no RADYEAR == 1993 among missings yintw

```

```{r local_ahead2, echo=F}

vari <- HRS_ahead_w2_ls$R2IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R2IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w2_ls, aes(factor(R2IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w2_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w2_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w2_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w2_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w2_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w2_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w2_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w2_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w2_ls[["R2IWSTAT"]], HRS_ahead_w2_ls[["dead"]], useNA = "ifany"), caption = "Cross R2IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ahead2}
HRS_ds_ahead_w2 <- tibble(id=HRS_ahead_w2_ls$id)
HRS_ds_ahead_w2$living_status <- car::recode(HRS_ahead_w2_ls$R2IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w2$living_status[which(HRS_ahead_w2_ls$dead == 1)] <- 1


HRS_ds_ahead_w2$living_status <- labelled(HRS_ds_ahead_w2$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead2, echo=F}
vari <- HRS_ds_ahead_w2$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w2, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead2, echo=F, results='asis'}
kable(table(HRS_ahead_w2_ls$R2IWSTAT, HRS_ds_ahead_w2$living_status, useNA = "ifany"), align='c', caption ='R2IWSTAT vs living_status')
```

```{r importOPAL_ahead2, echo=F}



```


### Wave 3 

#### Study-specific variable description

| **Name** | `R3IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w3`|`HRS-AHEAD-w3`|`HRS-AHEAD-w3`|`HRS-AHEAD-w3-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead3, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w3_ls','HRS.HRS-AHEAD-w3', variables=list('R3IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w3_ls <- opal.execute(o,'HRS_ahead_w3_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w3_di','HRS.HRS-AHEAD-w3-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w3_di <- opal.execute(o,'HRS_ahead_w3_di')

HRS_ahead_w3_ls <- HRS_ahead_w3_ls %>% left_join(HRS_ahead_w3_di, by = "id")


```

**R script:**

```{r preharm ahead_w3, echo=T}

HRS_ahead_w3_ls$yinter <- format(HRS_ahead_w3_ls$dinterview, '%Y')

HRS_ahead_w3_ls$minter <- as.numeric(format(HRS_ahead_w3_ls$dinterview, '%m'))

HRS_ahead_w3_ls <- HRS_ahead_w3_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 3*2+1990 - 1),1,0)) 
  # 1 year is subtracted, since AHEAD-wave 3 interviews were in 1995-1996, and could be interviewed id's with missing yintw and RADYEAR == 1995


```

```{r local_ahead3, echo=F}

vari <- HRS_ahead_w3_ls$R3IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R3IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w3_ls, aes(factor(R3IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w3_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w3_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w3_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w3_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w3_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w3_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w3_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w3_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w3_ls[["R3IWSTAT"]], HRS_ahead_w3_ls[["dead"]], useNA = "ifany"), caption = "Cross R3IWSTAT data with death date data")

kable(HRS_ahead_w3_ls %>% filter(R3IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==2,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_ahead3}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==2 & ID_issue_ls$cohort=='ahead')]
ids_death_w2 <- HRS_ds_ahead_w2$id[HRS_ds_ahead_w2$living_status == 1]

HRS_ds_ahead_w3 <- tibble(id=HRS_ahead_w3_ls$id)
HRS_ds_ahead_w3$living_status <- car::recode(HRS_ahead_w3_ls$R3IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w3$living_status[which(HRS_ahead_w3_ls$dead == 1)] <- 1


HRS_ds_ahead_w3$living_status[HRS_ds_ahead_w3$id %in%  ids_death_w2] <- 1
HRS_ds_ahead_w3$living_status[which(HRS_ds_ahead_w3$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w3$living_status <- labelled(HRS_ds_ahead_w3$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead3, echo=F}
vari <- HRS_ds_ahead_w3$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w3, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead3, echo=F, results='asis'}
kable(table(HRS_ahead_w3_ls$R3IWSTAT, HRS_ds_ahead_w3$living_status, useNA = "ifany"), align='c', caption ='R3IWSTAT vs living_status')
```

```{r importOPAL_ahead3, echo=F}



```


### Wave 4 

#### Study-specific variable description

| **Name** | `R4IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w4`|`HRS-AHEAD-w4`|`HRS-AHEAD-w4`|`HRS-AHEAD-w4-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead4, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w4_ls','HRS.HRS-AHEAD-w4', variables=list('R4IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w4_ls <- opal.execute(o,'HRS_ahead_w4_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w4_di','HRS.HRS-AHEAD-w4-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w4_di <- opal.execute(o,'HRS_ahead_w4_di')

HRS_ahead_w4_ls <- HRS_ahead_w4_ls %>% left_join(HRS_ahead_w4_di, by = "id")


```

**R script:**

```{r preharm ahead_w4, echo=T}

HRS_ahead_w4_ls$yinter <- format(HRS_ahead_w4_ls$dinterview, '%Y')

HRS_ahead_w4_ls$minter <- as.numeric(format(HRS_ahead_w4_ls$dinterview, '%m'))

HRS_ahead_w4_ls <- HRS_ahead_w4_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 4*2+1990),1,0))


                        
```

```{r local_ahead4, echo=F}

vari <- HRS_ahead_w4_ls$R4IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R4IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w4_ls, aes(factor(R4IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w4_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w4_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w4_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w4_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w4_ls[["R4IWSTAT"]], HRS_ahead_w4_ls[["dead"]], useNA = "ifany"), caption = "Cross R4IWSTAT data with death date data")

kable(HRS_ahead_w4_ls %>% filter(R4IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==3,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ahead4}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==3 & ID_issue_ls$cohort=='ahead')]
ids_death_w3 <- HRS_ds_ahead_w3$id[HRS_ds_ahead_w3$living_status == 1]

HRS_ds_ahead_w4 <- tibble(id=HRS_ahead_w4_ls$id)
HRS_ds_ahead_w4$living_status <- car::recode(HRS_ahead_w4_ls$R4IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w4$living_status[which(HRS_ahead_w4_ls$dead == 1)] <- 1


HRS_ds_ahead_w4$living_status[HRS_ds_ahead_w4$id %in%  ids_death_w3] <- 1
HRS_ds_ahead_w4$living_status[which(HRS_ds_ahead_w4$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w4$living_status <- labelled(HRS_ds_ahead_w4$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead4, echo=F}
vari <- HRS_ds_ahead_w4$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w4, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead4, echo=F, results='asis'}
kable(table(HRS_ahead_w4_ls$R4IWSTAT, HRS_ds_ahead_w4$living_status, useNA = "ifany"), align='c', caption ='R4IWSTAT vs living_status')
```


```{r importOPAL_ahead4, echo=F}



```


### Wave 5 

#### Study-specific variable description

| **Name** | `R5IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w5`|`HRS-AHEAD-w5`|`HRS-AHEAD-w5`|`HRS-AHEAD-w5-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead5, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w5_ls','HRS.HRS-AHEAD-w5',  variables=list('R5IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w5_ls <- opal.execute(o,'HRS_ahead_w5_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w5_di','HRS.HRS-AHEAD-w5-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w5_di <- opal.execute(o,'HRS_ahead_w5_di')

HRS_ahead_w5_ls <- HRS_ahead_w5_ls %>% left_join(HRS_ahead_w5_di, by = "id")


```

**R script:**

```{r preharm ahead_w5, echo=T}

HRS_ahead_w5_ls$yinter <- format(HRS_ahead_w5_ls$dinterview, '%Y')

HRS_ahead_w5_ls$minter <- as.numeric(format(HRS_ahead_w5_ls$dinterview, '%m'))

HRS_ahead_w5_ls <- HRS_ahead_w5_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 5*2+1990),1,0))


```

```{r local_ahead5, echo=F}

vari <- HRS_ahead_w5_ls$R5IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R5IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w5_ls, aes(factor(R5IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w5_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w5_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w5_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w5_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w5_ls[["R5IWSTAT"]], HRS_ahead_w5_ls[["dead"]], useNA = "ifany"), caption = "Cross R5IWSTAT data with death date data")

kable(HRS_ahead_w5_ls %>% filter(R5IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==4,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_ahead5}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==4 & ID_issue_ls$cohort=='ahead')]
ids_death_w4 <- HRS_ds_ahead_w4$id[HRS_ds_ahead_w4$living_status == 1]

HRS_ds_ahead_w5 <- tibble(id=HRS_ahead_w5_ls$id)
HRS_ds_ahead_w5$living_status <- car::recode(HRS_ahead_w5_ls$R5IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w5$living_status[which(HRS_ahead_w5_ls$dead == 1)] <- 1


HRS_ds_ahead_w5$living_status[HRS_ds_ahead_w5$id %in%  ids_death_w4] <- 1
HRS_ds_ahead_w5$living_status[which(HRS_ds_ahead_w5$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w5$living_status <- labelled(HRS_ds_ahead_w5$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead5, echo=F}
vari <- HRS_ds_ahead_w5$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w5, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead5, echo=F, results='asis'}
kable(table(HRS_ahead_w5_ls$R5IWSTAT, HRS_ds_ahead_w5$living_status, useNA = "ifany"), align='c', caption ='R5IWSTAT vs living_status')
```

```{r importOPAL_ahead5, echo=F}



```



### Wave 6 

#### Study-specific variable description

| **Name** | `R6IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w6`|`HRS-AHEAD-w6`|`HRS-AHEAD-w6`|`HRS-AHEAD-w6-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead6, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w6_ls','HRS.HRS-AHEAD-w6', variables=list('R6IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w6_ls <- opal.execute(o,'HRS_ahead_w6_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w6_di','HRS.HRS-AHEAD-w6-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w6_di <- opal.execute(o,'HRS_ahead_w6_di')

HRS_ahead_w6_ls <- HRS_ahead_w6_ls %>% left_join(HRS_ahead_w6_di, by = "id")


```

**R script:**

```{r preharm ahead_w6, echo=T}

HRS_ahead_w6_ls$yinter <- format(HRS_ahead_w6_ls$dinterview, '%Y')

HRS_ahead_w6_ls$minter <- as.numeric(format(HRS_ahead_w6_ls$dinterview, '%m'))

HRS_ahead_w6_ls <- HRS_ahead_w6_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 6*2+1990),1,0))


```

```{r local_ahead6, echo=F}

vari <- HRS_ahead_w6_ls$R6IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R6IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w6_ls, aes(factor(R6IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w6_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w6_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w6_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w6_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w6_ls[["R6IWSTAT"]], HRS_ahead_w6_ls[["dead"]], useNA = "ifany"), caption = "Cross R6IWSTAT data with death date data")

kable(HRS_ahead_w6_ls %>% filter(R6IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==5,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ahead6}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==5 & ID_issue_ls$cohort=='ahead')]
ids_death_w5 <- HRS_ds_ahead_w5$id[HRS_ds_ahead_w5$living_status == 1]

HRS_ds_ahead_w6 <- tibble(id=HRS_ahead_w6_ls$id)
HRS_ds_ahead_w6$living_status <- car::recode(HRS_ahead_w6_ls$R6IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w6$living_status[which(HRS_ahead_w6_ls$dead == 1)] <- 1


HRS_ds_ahead_w6$living_status[HRS_ds_ahead_w6$id %in%  ids_death_w5] <- 1
HRS_ds_ahead_w6$living_status[which(HRS_ds_ahead_w6$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w6$living_status <- labelled(HRS_ds_ahead_w6$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead6, echo=F}
vari <- HRS_ds_ahead_w6$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w6, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead6, echo=F, results='asis'}
kable(table(HRS_ahead_w6_ls$R6IWSTAT, HRS_ds_ahead_w6$living_status, useNA = "ifany"), align='c', caption ='R6IWSTAT vs living_status')
```

```{r importOPAL_ahead6, echo=F}



```



### Wave 7 

#### Study-specific variable description

| **Name** | `R7IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w7`|`HRS-AHEAD-w7`|`HRS-AHEAD-w7`|`HRS-AHEAD-w7-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead7, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w7_ls','HRS.HRS-AHEAD-w7', variables=list('R7IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w7_ls <- opal.execute(o,'HRS_ahead_w7_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w7_di','HRS.HRS-AHEAD-w7-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w7_di <- opal.execute(o,'HRS_ahead_w7_di')

HRS_ahead_w7_ls <- HRS_ahead_w7_ls %>% left_join(HRS_ahead_w7_di, by = "id")


```

**R script:**

```{r preharm ahead_w7, echo=T}

HRS_ahead_w7_ls$yinter <- format(HRS_ahead_w7_ls$dinterview, '%Y')

HRS_ahead_w7_ls$minter <- as.numeric(format(HRS_ahead_w7_ls$dinterview, '%m'))

HRS_ahead_w7_ls <- HRS_ahead_w7_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 7*2+1990),1,0))


```

```{r local_ahead7, echo=F}

vari <- HRS_ahead_w7_ls$R7IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R7IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w7_ls, aes(factor(R7IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w7_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w7_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w7_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w7_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w7_ls[["R7IWSTAT"]], HRS_ahead_w7_ls[["dead"]], useNA = "ifany"), caption = "Cross R7IWSTAT data with death date data")

kable(HRS_ahead_w7_ls %>% filter(R7IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==6,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ahead7}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==6 & ID_issue_ls$cohort=='ahead')]
ids_death_w6 <- HRS_ds_ahead_w6$id[HRS_ds_ahead_w6$living_status == 1]

HRS_ds_ahead_w7 <- tibble(id=HRS_ahead_w7_ls$id)
HRS_ds_ahead_w7$living_status <- car::recode(HRS_ahead_w7_ls$R7IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w7$living_status[which(HRS_ahead_w7_ls$dead == 1)] <- 1


HRS_ds_ahead_w7$living_status[HRS_ds_ahead_w7$id %in%  ids_death_w6] <- 1
HRS_ds_ahead_w7$living_status[which(HRS_ds_ahead_w7$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w7$living_status <- labelled(HRS_ds_ahead_w7$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead7, echo=F}
vari <- HRS_ds_ahead_w7$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w7, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead7, echo=F, results='asis'}
kable(table(HRS_ahead_w7_ls$R7IWSTAT, HRS_ds_ahead_w7$living_status, useNA = "ifany"), align='c', caption ='R7IWSTAT vs living_status')
```

```{r importOPAL_ahead7, echo=F}



```




### Wave 8 

#### Study-specific variable description

| **Name** | `R8IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w8`|`HRS-AHEAD-w8`|`HRS-AHEAD-w8`|`HRS-AHEAD-w8-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead8, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w8_ls','HRS.HRS-AHEAD-w8',  variables=list('R8IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w8_ls <- opal.execute(o,'HRS_ahead_w8_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w8_di','HRS.HRS-AHEAD-w8-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w8_di <- opal.execute(o,'HRS_ahead_w8_di')

HRS_ahead_w8_ls <- HRS_ahead_w8_ls %>% left_join(HRS_ahead_w8_di, by = "id")


```

**R script:**

```{r preharm ahead_w8, echo=T}

HRS_ahead_w8_ls$yinter <- format(HRS_ahead_w8_ls$dinterview, '%Y')

HRS_ahead_w8_ls$minter <- as.numeric(format(HRS_ahead_w8_ls$dinterview, '%m'))

HRS_ahead_w8_ls <- HRS_ahead_w8_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 8*2+1990),1,0))


```

```{r local_ahead8, echo=F}

vari <- HRS_ahead_w8_ls$R8IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R8IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w8_ls, aes(factor(R8IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w8_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w8_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w8_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w8_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w8_ls[["R8IWSTAT"]], HRS_ahead_w8_ls[["dead"]], useNA = "ifany"), caption = "Cross R8IWSTAT data with death date data")

kable(HRS_ahead_w8_ls %>% filter(R8IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==7,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ahead8}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==7 & ID_issue_ls$cohort=='ahead')]
ids_death_w7 <- HRS_ds_ahead_w7$id[HRS_ds_ahead_w7$living_status == 1]

HRS_ds_ahead_w8 <- tibble(id=HRS_ahead_w8_ls$id)
HRS_ds_ahead_w8$living_status <- car::recode(HRS_ahead_w8_ls$R8IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w8$living_status[which(HRS_ahead_w8_ls$dead == 1)] <- 1


HRS_ds_ahead_w8$living_status[HRS_ds_ahead_w8$id %in%  ids_death_w7] <- 1
HRS_ds_ahead_w8$living_status[which(HRS_ds_ahead_w8$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w8$living_status <- labelled(HRS_ds_ahead_w8$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead8, echo=F}
vari <- HRS_ds_ahead_w8$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w8, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead8, echo=F, results='asis'}
kable(table(HRS_ahead_w8_ls$R8IWSTAT, HRS_ds_ahead_w8$living_status, useNA = "ifany"), align='c', caption ='R8IWSTAT vs living_status')
```


```{r importOPAL_ahead8, echo=F}



```


### Wave 9 

#### Study-specific variable description

| **Name** | `R9IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w9`|`HRS-AHEAD-w9`|`HRS-AHEAD-w9`|`HRS-AHEAD-w9-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead9, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w9_ls','HRS.HRS-AHEAD-w9', variables=list('R9IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w9_ls <- opal.execute(o,'HRS_ahead_w9_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w9_di','HRS.HRS-AHEAD-w9-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w9_di <- opal.execute(o,'HRS_ahead_w9_di')

HRS_ahead_w9_ls <- HRS_ahead_w9_ls %>% left_join(HRS_ahead_w9_di, by = "id")


```

**R script:**

```{r preharm ahead_w9, echo=T}

HRS_ahead_w9_ls$yinter <- format(HRS_ahead_w9_ls$dinterview, '%Y')

HRS_ahead_w9_ls$minter <- as.numeric(format(HRS_ahead_w9_ls$dinterview, '%m'))

HRS_ahead_w9_ls <- HRS_ahead_w9_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 9*2+1990),1,0))


```

```{r local_ahead9, echo=F}

vari <- HRS_ahead_w9_ls$R9IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R9IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w9_ls, aes(factor(R9IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w9_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w9_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w9_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w9_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w9_ls[["R9IWSTAT"]], HRS_ahead_w9_ls[["dead"]], useNA = "ifany"), caption = "Cross R9IWSTAT data with death date data")

kable(HRS_ahead_w9_ls %>% filter(R9IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==8,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_ahead9}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==8 & ID_issue_ls$cohort=='ahead')]
ids_death_w8 <- HRS_ds_ahead_w8$id[HRS_ds_ahead_w8$living_status == 1]

HRS_ds_ahead_w9 <- tibble(id=HRS_ahead_w9_ls$id)
HRS_ds_ahead_w9$living_status <- car::recode(HRS_ahead_w9_ls$R9IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w9$living_status[which(HRS_ahead_w9_ls$dead == 1)] <- 1


HRS_ds_ahead_w9$living_status[HRS_ds_ahead_w9$id %in%  ids_death_w8] <- 1
HRS_ds_ahead_w9$living_status[which(HRS_ds_ahead_w9$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w9$living_status <- labelled(HRS_ds_ahead_w9$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead9, echo=F}
vari <- HRS_ds_ahead_w9$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w9, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead9, echo=F, results='asis'}
kable(table(HRS_ahead_w9_ls$R9IWSTAT, HRS_ds_ahead_w9$living_status, useNA = "ifany"), align='c', caption ='R9IWSTAT vs living_status')
```


```{r importOPAL_ahead9, echo=F}



```


### Wave 10 

#### Study-specific variable description

| **Name** | `R10IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w10`|`HRS-AHEAD-w10`|`HRS-AHEAD-w10`|`HRS-AHEAD-w10-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ahead10, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w10_ls','HRS.HRS-AHEAD-w10', variables=list('R10IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w10_ls <- opal.execute(o,'HRS_ahead_w10_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w10_di','HRS.HRS-AHEAD-w10-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w10_di <- opal.execute(o,'HRS_ahead_w10_di')

HRS_ahead_w10_ls <- HRS_ahead_w10_ls %>% left_join(HRS_ahead_w10_di, by = "id")


```

**R script:**

```{r preharm ahead_w10, echo=T}

HRS_ahead_w10_ls$yinter <- format(HRS_ahead_w10_ls$dinterview, '%Y')

HRS_ahead_w10_ls$minter <- as.numeric(format(HRS_ahead_w10_ls$dinterview, '%m'))

HRS_ahead_w10_ls <- HRS_ahead_w10_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 10*2+1990),1,0))


```

```{r local_ahead10, echo=F}

vari <- HRS_ahead_w10_ls$R10IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R10IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w10_ls, aes(factor(R10IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w10_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w10_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w10_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w10_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w10_ls[["R10IWSTAT"]], HRS_ahead_w10_ls[["dead"]], useNA = "ifany"), caption = "Cross R10IWSTAT data with death date data")

kable(HRS_ahead_w10_ls %>% filter(R10IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==9,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ahead10}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==9 & ID_issue_ls$cohort=='ahead')]
ids_death_w9 <- HRS_ds_ahead_w9$id[HRS_ds_ahead_w9$living_status == 1]

HRS_ds_ahead_w10 <- tibble(id=HRS_ahead_w10_ls$id)
HRS_ds_ahead_w10$living_status <- car::recode(HRS_ahead_w10_ls$R10IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w10$living_status[which(HRS_ahead_w10_ls$dead == 1)] <- 1


HRS_ds_ahead_w10$living_status[HRS_ds_ahead_w10$id %in%  ids_death_w9] <- 1
HRS_ds_ahead_w10$living_status[which(HRS_ds_ahead_w10$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w10$living_status <- labelled(HRS_ds_ahead_w10$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead10, echo=F}
vari <- HRS_ds_ahead_w10$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w10, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead10, echo=F, results='asis'}
kable(table(HRS_ahead_w10_ls$R10IWSTAT, HRS_ds_ahead_w10$living_status, useNA = "ifany"), align='c', caption ='R10IWSTAT vs living_status')
```

```{r importOPAL_ahead10, echo=F}



```

### Wave 11 

#### Study-specific variable description

| **Name** | `R11IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-AHEAD-w11`|`HRS-AHEAD-w11`|`HRS-AHEAD-w11`|`HRS-AHEAD-w11-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |

```{r assign_ahead11, echo=F}
opal.assign.table.tibble(o, 'HRS_ahead_w11_ls','HRS.HRS-AHEAD-w11', variables=list('R11IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ahead_w11_ls <- opal.execute(o,'HRS_ahead_w11_ls')

opal.assign.table.tibble(o, 'HRS_ahead_w11_di','HRS.HRS-AHEAD-w11-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ahead_w11_di <- opal.execute(o,'HRS_ahead_w11_di')

HRS_ahead_w11_ls <- HRS_ahead_w11_ls %>% left_join(HRS_ahead_w11_di, by = "id")


```

**R script:**

```{r preharm ahead_w11, echo=T}

HRS_ahead_w11_ls$yinter <- format(HRS_ahead_w11_ls$dinterview, '%Y')

HRS_ahead_w11_ls$minter <- as.numeric(format(HRS_ahead_w11_ls$dinterview, '%m'))

HRS_ahead_w11_ls <- HRS_ahead_w11_ls %>%
  mutate(dead = if_else(!is.na(RADYEAR),1,0))


```

```{r local_ahead11, echo=F}

vari <- HRS_ahead_w11_ls$R11IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R11IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w11_ls, aes(factor(R11IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ahead_w11_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w11_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ahead_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ahead_w11_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ahead_w11_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ahead_w11_ls[["R11IWSTAT"]], HRS_ahead_w11_ls[["dead"]], useNA = "ifany"), caption = "Cross R11IWSTAT data with death date data")

kable(HRS_ahead_w11_ls %>% filter(R11IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==10,cohort=='ahead') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ahead11}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==10 & ID_issue_ls$cohort=='ahead')]
ids_death_w10 <- HRS_ds_ahead_w10$id[HRS_ds_ahead_w10$living_status == 1]

HRS_ds_ahead_w11 <- tibble(id=HRS_ahead_w11_ls$id)
HRS_ds_ahead_w11$living_status <- car::recode(HRS_ahead_w11_ls$R11IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ahead_w11$living_status[which(HRS_ahead_w11_ls$dead == 1)] <- 1


HRS_ds_ahead_w11$living_status[HRS_ds_ahead_w11$id %in%  ids_death_w10] <- 1
HRS_ds_ahead_w11$living_status[which(HRS_ds_ahead_w11$id %in% ids_issue_ls)] <- 1
HRS_ds_ahead_w11$living_status <- labelled(HRS_ds_ahead_w11$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ahead11, echo=F}
vari <- HRS_ds_ahead_w11$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w11, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ahead11, echo=F, results='asis'}
kable(table(HRS_ahead_w11_ls$R11IWSTAT, HRS_ds_ahead_w11$living_status, useNA = "ifany"), align='c', caption ='R11IWSTAT vs living_status')
```

```{r importOPAL_ahead11, echo=F}



```



## CODA

### Wave 4 

#### Study-specific variable description

| **Name** | `R4IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w4`|`HRS-CODA-w4`|`HRS-CODA-w4`|`HRS-CODA-w4-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |

```{r assign_coda4, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w4_ls','HRS.HRS-CODA-w4', variables=list('R4IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w4_ls <- opal.execute(o,'HRS_coda_w4_ls')

opal.assign.table.tibble(o, 'HRS_coda_w4_di','HRS.HRS-CODA-w4-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w4_di <- opal.execute(o,'HRS_coda_w4_di')

HRS_coda_w4_ls <- HRS_coda_w4_ls %>% left_join(HRS_coda_w4_di, by = "id")


```

**R script:**

```{r preharm coda_w4, echo=T}

HRS_coda_w4_ls$yinter <- format(HRS_coda_w4_ls$dinterview, '%Y')

HRS_coda_w4_ls$minter <- as.numeric(format(HRS_coda_w4_ls$dinterview, '%m'))

HRS_coda_w4_ls <- HRS_coda_w4_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 4*2+1990),1,0))


```

```{r local_coda4, echo=F}

vari <- HRS_coda_w4_ls$R4IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R4IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w4_ls, aes(factor(R4IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w4_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w4_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w4_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w4_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w4_ls[["R4IWSTAT"]], HRS_coda_w4_ls[["dead"]], useNA = "ifany"), caption = "Cross R4IWSTAT data with death date data")




```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.

**R script:**

```{r harmo_coda4}
HRS_ds_coda_w4 <- tibble(id=HRS_coda_w4_ls$id)
HRS_ds_coda_w4$living_status <- car::recode(HRS_coda_w4_ls$R4IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w4$living_status[which(HRS_coda_w4_ls$dead == 1)] <- 1


HRS_ds_coda_w4$living_status <- labelled(HRS_ds_coda_w4$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_coda4, echo=F}
vari <- HRS_ds_coda_w4$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w4, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda4, echo=F, results='asis'}
kable(table(HRS_coda_w4_ls$R4IWSTAT, HRS_ds_coda_w4$living_status, useNA = "ifany"), align='c', caption ='R4IWSTAT vs living_status')
```

```{r importOPAL_coda4, echo=F}



```


### Wave 5 

#### Study-specific variable description

| **Name** | `R5IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w5`|`HRS-CODA-w5`|`HRS-CODA-w5`|`HRS-CODA-w5-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |

```{r assign_coda5, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w5_ls','HRS.HRS-CODA-w5', variables=list('R5IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w5_ls <- opal.execute(o,'HRS_coda_w5_ls')

opal.assign.table.tibble(o, 'HRS_coda_w5_di','HRS.HRS-CODA-w5-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w5_di <- opal.execute(o,'HRS_coda_w5_di')

HRS_coda_w5_ls <- HRS_coda_w5_ls %>% left_join(HRS_coda_w5_di, by = "id")


```

**R script:**

```{r preharm coda_w5, echo=T}

HRS_coda_w5_ls$yinter <- format(HRS_coda_w5_ls$dinterview, '%Y')

HRS_coda_w5_ls$minter <- as.numeric(format(HRS_coda_w5_ls$dinterview, '%m'))

HRS_coda_w5_ls <- HRS_coda_w5_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 5*2+1990),1,0))


```

```{r local_coda5, echo=F}

vari <- HRS_coda_w5_ls$R5IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R5IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w5_ls, aes(factor(R5IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w5_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w5_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w5_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w5_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w5_ls[["R5IWSTAT"]], HRS_coda_w5_ls[["dead"]], useNA = "ifany"), caption = "Cross R5IWSTAT data with death date data")

kable(HRS_coda_w5_ls %>% filter(R5IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==2,cohort=='coda') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_coda5}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==2 & ID_issue_ls$cohort=='coda')]
ids_death_w4 <- HRS_ds_coda_w4$id[HRS_ds_coda_w4$living_status == 1]

HRS_ds_coda_w5 <- tibble(id=HRS_coda_w5_ls$id)
HRS_ds_coda_w5$living_status <- car::recode(HRS_coda_w5_ls$R5IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w5$living_status[which(HRS_coda_w5_ls$dead == 1)] <- 1


HRS_ds_coda_w5$living_status[HRS_ds_coda_w5$id %in%  ids_death_w4] <- 1
HRS_ds_coda_w5$living_status[which(HRS_ds_coda_w5$id %in% ids_issue_ls)] <- 1
HRS_ds_coda_w5$living_status <- labelled(HRS_ds_coda_w5$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_coda5, echo=F}
vari <- HRS_ds_coda_w5$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w5, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda5, echo=F, results='asis'}
kable(table(HRS_coda_w5_ls$R5IWSTAT, HRS_ds_coda_w5$living_status, useNA = "ifany"), align='c', caption ='R5IWSTAT vs living_status')
```

```{r importOPAL_coda5, echo=F}



```


### Wave 6 

#### Study-specific variable description

| **Name** | `R6IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w6`|`HRS-CODA-w6`|`HRS-CODA-w6`|`HRS-CODA-w6-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_coda6, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w6_ls','HRS.HRS-CODA-w6', variables=list('R6IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w6_ls <- opal.execute(o,'HRS_coda_w6_ls')

opal.assign.table.tibble(o, 'HRS_coda_w6_di','HRS.HRS-CODA-w6-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w6_di <- opal.execute(o,'HRS_coda_w6_di')

HRS_coda_w6_ls <- HRS_coda_w6_ls %>% left_join(HRS_coda_w6_di, by = "id")


```

**R script:**

```{r preharm coda_w6, echo=T}

HRS_coda_w6_ls$yinter <- format(HRS_coda_w6_ls$dinterview, '%Y')

HRS_coda_w6_ls$minter <- as.numeric(format(HRS_coda_w6_ls$dinterview, '%m'))

HRS_coda_w6_ls <- HRS_coda_w6_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 6*2+1990),1,0))


```

```{r local_coda6, echo=F}

vari <- HRS_coda_w6_ls$R6IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R6IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w6_ls, aes(factor(R6IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w6_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w6_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w6_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w6_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w6_ls[["R6IWSTAT"]], HRS_coda_w6_ls[["dead"]], useNA = "ifany"), caption = "Cross R6IWSTAT data with death date data")

kable(HRS_coda_w6_ls %>% filter(R6IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==3,cohort=='coda') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_coda6}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==3 & ID_issue_ls$cohort=='coda')]
ids_death_w5 <- HRS_ds_coda_w5$id[HRS_ds_coda_w5$living_status == 1]

HRS_ds_coda_w6 <- tibble(id=HRS_coda_w6_ls$id)
HRS_ds_coda_w6$living_status <- car::recode(HRS_coda_w6_ls$R6IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w6$living_status[which(HRS_coda_w6_ls$dead == 1)] <- 1


HRS_ds_coda_w6$living_status[HRS_ds_coda_w6$id %in%  ids_death_w5] <- 1
HRS_ds_coda_w6$living_status[which(HRS_ds_coda_w6$id %in% ids_issue_ls)] <- 1
HRS_ds_coda_w6$living_status <- labelled(HRS_ds_coda_w6$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_coda6, echo=F}
vari <- HRS_ds_coda_w6$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w6, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda6, echo=F, results='asis'}
kable(table(HRS_coda_w6_ls$R6IWSTAT, HRS_ds_coda_w6$living_status, useNA = "ifany"), align='c', caption ='R6IWSTAT vs living_status')
```

```{r importOPAL_coda6, echo=F}



```


### Wave 7 

#### Study-specific variable description

| **Name** | `R7IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w7`|`HRS-CODA-w7`|`HRS-CODA-w7`|`HRS-CODA-w7-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |

```{r assign_coda7, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w7_ls','HRS.HRS-CODA-w7', variables=list('R7IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w7_ls <- opal.execute(o,'HRS_coda_w7_ls')

opal.assign.table.tibble(o, 'HRS_coda_w7_di','HRS.HRS-CODA-w7-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w7_di <- opal.execute(o,'HRS_coda_w7_di')

HRS_coda_w7_ls <- HRS_coda_w7_ls %>% left_join(HRS_coda_w7_di, by = "id")


```

**R script:**

```{r preharm coda_w7, echo=T}

HRS_coda_w7_ls$yinter <- format(HRS_coda_w7_ls$dinterview, '%Y')

HRS_coda_w7_ls$minter <- as.numeric(format(HRS_coda_w7_ls$dinterview, '%m'))

HRS_coda_w7_ls <- HRS_coda_w7_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 7*2+1990),1,0))


```

```{r local_coda7, echo=F}

vari <- HRS_coda_w7_ls$R7IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R7IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w7_ls, aes(factor(R7IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w7_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w7_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w7_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w7_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w7_ls[["R7IWSTAT"]], HRS_coda_w7_ls[["dead"]], useNA = "ifany"), caption = "Cross R7IWSTAT data with death date data")

kable(HRS_coda_w7_ls %>% filter(R7IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==4,cohort=='coda') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_coda7}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==4 & ID_issue_ls$cohort=='coda')]
ids_death_w6 <- HRS_ds_coda_w6$id[HRS_ds_coda_w6$living_status == 1]

HRS_ds_coda_w7 <- tibble(id=HRS_coda_w7_ls$id)
HRS_ds_coda_w7$living_status <- car::recode(HRS_coda_w7_ls$R7IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w7$living_status[which(HRS_coda_w7_ls$dead == 1)] <- 1


HRS_ds_coda_w7$living_status[HRS_ds_coda_w7$id %in%  ids_death_w6] <- 1
HRS_ds_coda_w7$living_status[which(HRS_ds_coda_w7$id %in% ids_issue_ls)] <- 1
HRS_ds_coda_w7$living_status <- labelled(HRS_ds_coda_w7$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_coda7, echo=F}
vari <- HRS_ds_coda_w7$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w7, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda7, echo=F, results='asis'}
kable(table(HRS_coda_w7_ls$R7IWSTAT, HRS_ds_coda_w7$living_status, useNA = "ifany"), align='c', caption ='R7IWSTAT vs living_status')
```

```{r importOPAL_coda7, echo=F}



```


### Wave 8 

#### Study-specific variable description

| **Name** | `R8IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w8`|`HRS-CODA-w8`|`HRS-CODA-w8`|`HRS-CODA-w8-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_coda8, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w8_ls','HRS.HRS-CODA-w8', variables=list('R8IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w8_ls <- opal.execute(o,'HRS_coda_w8_ls')

opal.assign.table.tibble(o, 'HRS_coda_w8_di','HRS.HRS-CODA-w8-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w8_di <- opal.execute(o,'HRS_coda_w8_di')

HRS_coda_w8_ls <- HRS_coda_w8_ls %>% left_join(HRS_coda_w8_di, by = "id")


```

**R script:**

```{r preharm coda_w8, echo=T}

HRS_coda_w8_ls$yinter <- format(HRS_coda_w8_ls$dinterview, '%Y')

HRS_coda_w8_ls$minter <- as.numeric(format(HRS_coda_w8_ls$dinterview, '%m'))

HRS_coda_w8_ls <- HRS_coda_w8_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 8*2+1990),1,0))


                        
```

```{r local_coda8, echo=F}

vari <- HRS_coda_w8_ls$R8IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R8IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w8_ls, aes(factor(R8IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w8_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w8_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w8_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w8_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w8_ls[["R8IWSTAT"]], HRS_coda_w8_ls[["dead"]], useNA = "ifany"), caption = "Cross R8IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_coda8}
ids_death_w7 <- HRS_ds_coda_w7$id[HRS_ds_coda_w7$living_status == 1]

HRS_ds_coda_w8 <- tibble(id=HRS_coda_w8_ls$id)
HRS_ds_coda_w8$living_status <- car::recode(HRS_coda_w8_ls$R8IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w8$living_status[which(HRS_coda_w8_ls$dead == 1)] <- 1


HRS_ds_coda_w8$living_status[HRS_ds_coda_w8$id %in%  ids_death_w7] <- 1
HRS_ds_coda_w8$living_status <- labelled(HRS_ds_coda_w8$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_coda8, echo=F}
vari <- HRS_ds_coda_w8$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w8, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda8, echo=F, results='asis'}
kable(table(HRS_coda_w8_ls$R8IWSTAT, HRS_ds_coda_w8$living_status, useNA = "ifany"), align='c', caption ='R8IWSTAT vs living_status')
```

```{r importOPAL_coda8, echo=F}



```


### Wave 9 

#### Study-specific variable description

| **Name** | `R9IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w9`|`HRS-CODA-w9`|`HRS-CODA-w9`|`HRS-CODA-w9-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_coda9, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w9_ls','HRS.HRS-CODA-w9', variables=list('R9IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w9_ls <- opal.execute(o,'HRS_coda_w9_ls')

opal.assign.table.tibble(o, 'HRS_coda_w9_di','HRS.HRS-CODA-w9-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w9_di <- opal.execute(o,'HRS_coda_w9_di')

HRS_coda_w9_ls <- HRS_coda_w9_ls %>% left_join(HRS_coda_w9_di, by = "id")


```

**R script:**

```{r preharm coda_w9, echo=T}

HRS_coda_w9_ls$yinter <- format(HRS_coda_w9_ls$dinterview, '%Y')

HRS_coda_w9_ls$minter <- as.numeric(format(HRS_coda_w9_ls$dinterview, '%m'))

HRS_coda_w9_ls <- HRS_coda_w9_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 9*2+1990),1,0))


```

```{r local_coda9, echo=F}

vari <- HRS_coda_w9_ls$R9IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R9IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w9_ls, aes(factor(R9IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w9_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w9_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w9_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w9_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w9_ls[["R9IWSTAT"]], HRS_coda_w9_ls[["dead"]], useNA = "ifany"), caption = "Cross R9IWSTAT data with death date data")

kable(HRS_coda_w9_ls %>% filter(R9IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==6,cohort=='coda') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_coda9}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==6 & ID_issue_ls$cohort=='coda')]
ids_death_w8 <- HRS_ds_coda_w8$id[HRS_ds_coda_w8$living_status == 1]

HRS_ds_coda_w9 <- tibble(id=HRS_coda_w9_ls$id)
HRS_ds_coda_w9$living_status <- car::recode(HRS_coda_w9_ls$R9IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w9$living_status[which(HRS_coda_w9_ls$dead == 1)] <- 1


HRS_ds_coda_w9$living_status[HRS_ds_coda_w9$id %in%  ids_death_w8] <- 1
HRS_ds_coda_w9$living_status[which(HRS_ds_coda_w9$id %in% ids_issue_ls)] <- 1
HRS_ds_coda_w9$living_status <- labelled(HRS_ds_coda_w9$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_coda9, echo=F}
vari <- HRS_ds_coda_w9$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w9, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda9, echo=F, results='asis'}
kable(table(HRS_coda_w9_ls$R9IWSTAT, HRS_ds_coda_w9$living_status, useNA = "ifany"), align='c', caption ='R9IWSTAT vs living_status')
```

```{r importOPAL_coda9, echo=F}



```

### Wave 10 

#### Study-specific variable description

| **Name** | `R10IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w10`|`HRS-CODA-w10`|`HRS-CODA-w10`|`HRS-CODA-w10-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_coda10, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w10_ls','HRS.HRS-CODA-w10', variables=list('R10IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w10_ls <- opal.execute(o,'HRS_coda_w10_ls')

opal.assign.table.tibble(o, 'HRS_coda_w10_di','HRS.HRS-CODA-w10-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w10_di <- opal.execute(o,'HRS_coda_w10_di')

HRS_coda_w10_ls <- HRS_coda_w10_ls %>% left_join(HRS_coda_w10_di, by = "id")


```

**R script:**

```{r preharm coda_w10, echo=T}

HRS_coda_w10_ls$yinter <- format(HRS_coda_w10_ls$dinterview, '%Y')

HRS_coda_w10_ls$minter <- as.numeric(format(HRS_coda_w10_ls$dinterview, '%m'))

HRS_coda_w10_ls <- HRS_coda_w10_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 10*2+1990),1,0))


```

```{r local_coda10, echo=F}

vari <- HRS_coda_w10_ls$R10IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R10IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w10_ls, aes(factor(R10IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w10_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w10_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w10_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w10_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w10_ls[["R10IWSTAT"]], HRS_coda_w10_ls[["dead"]], useNA = "ifany"), caption = "Cross R10IWSTAT data with death date data")

kable(HRS_coda_w10_ls %>% filter(R10IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==7,cohort=='coda') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_coda10}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==7 & ID_issue_ls$cohort=='coda')]
ids_death_w9 <- HRS_ds_coda_w9$id[HRS_ds_coda_w9$living_status == 1]

HRS_ds_coda_w10 <- tibble(id=HRS_coda_w10_ls$id)
HRS_ds_coda_w10$living_status <- car::recode(HRS_coda_w10_ls$R10IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w10$living_status[which(HRS_coda_w10_ls$dead == 1)] <- 1


HRS_ds_coda_w10$living_status[HRS_ds_coda_w10$id %in%  ids_death_w9] <- 1
HRS_ds_coda_w10$living_status[which(HRS_ds_coda_w10$id %in% ids_issue_ls)] <- 1
HRS_ds_coda_w10$living_status <- labelled(HRS_ds_coda_w10$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_coda10, echo=F}
vari <- HRS_ds_coda_w10$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w10, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda10, echo=F, results='asis'}
kable(table(HRS_coda_w10_ls$R10IWSTAT, HRS_ds_coda_w10$living_status, useNA = "ifany"), align='c', caption ='R10IWSTAT vs living_status')
```

```{r importOPAL_coda10, echo=F}



```


### Wave 11 

#### Study-specific variable description

| **Name** | `R11IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-CODA-w11`|`HRS-CODA-w11`|`HRS-CODA-w11`|`HRS-CODA-w11-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_coda11, echo=F}
opal.assign.table.tibble(o, 'HRS_coda_w11_ls','HRS.HRS-CODA-w11', variables=list('R11IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_coda_w11_ls <- opal.execute(o,'HRS_coda_w11_ls')

opal.assign.table.tibble(o, 'HRS_coda_w11_di','HRS.HRS-CODA-w11-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_coda_w11_di <- opal.execute(o,'HRS_coda_w11_di')

HRS_coda_w11_ls <- HRS_coda_w11_ls %>% left_join(HRS_coda_w11_di, by = "id")


```

**R script:**

```{r preharm coda_w11, echo=T}

HRS_coda_w11_ls$yinter <- format(HRS_coda_w11_ls$dinterview, '%Y')

HRS_coda_w11_ls$minter <- as.numeric(format(HRS_coda_w11_ls$dinterview, '%m'))

HRS_coda_w11_ls <- HRS_coda_w11_ls %>%
  mutate(dead = if_else(!is.na(RADYEAR),1,0))


```

```{r local_coda11, echo=F}

vari <- HRS_coda_w11_ls$R11IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R11IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w11_ls, aes(factor(R11IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_coda_w11_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w11_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_coda_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_coda_w11_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_coda_w11_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_coda_w11_ls[["R11IWSTAT"]], HRS_coda_w11_ls[["dead"]], useNA = "ifany"), caption = "Cross R11IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_coda11}
ids_death_w10 <- HRS_ds_coda_w10$id[HRS_ds_coda_w10$living_status == 1]

HRS_ds_coda_w11 <- tibble(id=HRS_coda_w11_ls$id)
HRS_ds_coda_w11$living_status <- car::recode(HRS_coda_w11_ls$R11IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_coda_w11$living_status[which(HRS_coda_w11_ls$dead == 1)] <- 1


HRS_ds_coda_w11$living_status[HRS_ds_coda_w11$id %in%  ids_death_w10] <- 1
HRS_ds_coda_w11$living_status <- labelled(HRS_ds_coda_w11$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_coda11, echo=F}
vari <- HRS_ds_coda_w11$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w11, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_coda11, echo=F, results='asis'}
kable(table(HRS_coda_w11_ls$R11IWSTAT, HRS_ds_coda_w11$living_status, useNA = "ifany"), align='c', caption ='R11IWSTAT vs living_status')
```

```{r importOPAL_coda11, echo=F}



```




## WB

### Wave 4  

#### Study-specific variable description

| **Name** | `R4IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w4`|`HRS-WB-w4`|`HRS-WB-w4`|`HRS-WB-w4-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |

```{r assign_wb4, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w4_ls','HRS.HRS-WB-w4', variables=list('R4IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w4_ls <- opal.execute(o,'HRS_wb_w4_ls')

opal.assign.table.tibble(o, 'HRS_wb_w4_di','HRS.HRS-WB-w4-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w4_di <- opal.execute(o,'HRS_wb_w4_di')

HRS_wb_w4_ls <- HRS_wb_w4_ls %>% left_join(HRS_wb_w4_di, by = "id")


```

**R script:**

```{r preharm wb_w4, echo=T}

HRS_wb_w4_ls$yinter <- format(HRS_wb_w4_ls$dinterview, '%Y')

HRS_wb_w4_ls$minter <- as.numeric(format(HRS_wb_w4_ls$dinterview, '%m'))

HRS_wb_w4_ls <- HRS_wb_w4_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 4*2+1990),1,0))


```

```{r local_wb4, echo=F}

vari <- HRS_wb_w4_ls$R4IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R4IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w4_ls, aes(factor(R4IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w4_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w4_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w4_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w4_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w4_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w4_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w4_ls[["R4IWSTAT"]], HRS_wb_w4_ls[["dead"]], useNA = "ifany"), caption = "Cross R4IWSTAT data with death date data")




```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.

**R script:**

```{r harmo_wb4}
HRS_ds_wb_w4 <- tibble(id=HRS_wb_w4_ls$id)
HRS_ds_wb_w4$living_status <- car::recode(HRS_wb_w4_ls$R4IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w4$living_status[which(HRS_wb_w4_ls$dead == 1)] <- 1


HRS_ds_wb_w4$living_status <- labelled(HRS_ds_wb_w4$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_wb4, echo=F}
vari <- HRS_ds_wb_w4$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w4, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb4, echo=F, results='asis'}
kable(table(HRS_wb_w4_ls$R4IWSTAT, HRS_ds_wb_w4$living_status, useNA = "ifany"), align='c', caption ='R4IWSTAT vs living_status')
```

```{r importOPAL_wb4, echo=F}



```


### Wave 5  

#### Study-specific variable description

| **Name** | `R5IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w5`|`HRS-WB-w5`|`HRS-WB-w5`|`HRS-WB-w5-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_wb5, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w5_ls','HRS.HRS-WB-w5', variables=list('R5IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w5_ls <- opal.execute(o,'HRS_wb_w5_ls')

opal.assign.table.tibble(o, 'HRS_wb_w5_di','HRS.HRS-WB-w5-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w5_di <- opal.execute(o,'HRS_wb_w5_di')

HRS_wb_w5_ls <- HRS_wb_w5_ls %>% left_join(HRS_wb_w5_di, by = "id")


```

**R script:**

```{r preharm wb_w5, echo=T}

HRS_wb_w5_ls$yinter <- format(HRS_wb_w5_ls$dinterview, '%Y')

HRS_wb_w5_ls$minter <- as.numeric(format(HRS_wb_w5_ls$dinterview, '%m'))

HRS_wb_w5_ls <- HRS_wb_w5_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 5*2+1990),1,0))


```

```{r local_wb5, echo=F}

vari <- HRS_wb_w5_ls$R5IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R5IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w5_ls, aes(factor(R5IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w5_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w5_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w5_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w5_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w5_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w5_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w5_ls[["R5IWSTAT"]], HRS_wb_w5_ls[["dead"]], useNA = "ifany"), caption = "Cross R5IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_wb5}
ids_death_w4 <- HRS_ds_wb_w4$id[HRS_ds_wb_w4$living_status == 1]

HRS_ds_wb_w5 <- tibble(id=HRS_wb_w5_ls$id)
HRS_ds_wb_w5$living_status <- car::recode(HRS_wb_w5_ls$R5IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w5$living_status[which(HRS_wb_w5_ls$dead == 1)] <- 1


HRS_ds_wb_w5$living_status[HRS_ds_wb_w5$id %in%  ids_death_w4] <- 1
HRS_ds_wb_w5$living_status <- labelled(HRS_ds_wb_w5$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_wb5, echo=F}
vari <- HRS_ds_wb_w5$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w5, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb5, echo=F, results='asis'}
kable(table(HRS_wb_w5_ls$R5IWSTAT, HRS_ds_wb_w5$living_status, useNA = "ifany"), align='c', caption ='R5IWSTAT vs living_status')
```

```{r importOPAL_wb5, echo=F}



```


### Wave 6  

#### Study-specific variable description

| **Name** | `R6IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w6`|`HRS-WB-w6`|`HRS-WB-w6`|`HRS-WB-w6-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_wb6, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w6_ls','HRS.HRS-WB-w6', variables=list('R6IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w6_ls <- opal.execute(o,'HRS_wb_w6_ls')

opal.assign.table.tibble(o, 'HRS_wb_w6_di','HRS.HRS-WB-w6-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w6_di <- opal.execute(o,'HRS_wb_w6_di')

HRS_wb_w6_ls <- HRS_wb_w6_ls %>% left_join(HRS_wb_w6_di, by = "id")


```

**R script:**

```{r preharm wb_w6, echo=T}

HRS_wb_w6_ls$yinter <- format(HRS_wb_w6_ls$dinterview, '%Y')

HRS_wb_w6_ls$minter <- as.numeric(format(HRS_wb_w6_ls$dinterview, '%m'))

HRS_wb_w6_ls <- HRS_wb_w6_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 6*2+1990),1,0))


```

```{r local_wb6, echo=F}

vari <- HRS_wb_w6_ls$R6IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R6IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w6_ls, aes(factor(R6IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w6_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w6_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w6_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w6_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w6_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w6_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w6_ls[["R6IWSTAT"]], HRS_wb_w6_ls[["dead"]], useNA = "ifany"), caption = "Cross R6IWSTAT data with death date data")

kable(HRS_wb_w6_ls %>% filter(R6IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==3,cohort=='wb') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.

**R script:**

```{r harmo_wb6}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==3 & ID_issue_ls$cohort=='wb')]
ids_death_w5 <- HRS_ds_wb_w5$id[HRS_ds_wb_w5$living_status == 1]

HRS_ds_wb_w6 <- tibble(id=HRS_wb_w6_ls$id)
HRS_ds_wb_w6$living_status <- car::recode(HRS_wb_w6_ls$R6IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w6$living_status[which(HRS_wb_w6_ls$dead == 1)] <- 1


HRS_ds_wb_w6$living_status[HRS_ds_wb_w6$id %in%  ids_death_w5] <- 1
HRS_ds_wb_w6$living_status[which(HRS_ds_wb_w6$id %in% ids_issue_ls)] <- 1
HRS_ds_wb_w6$living_status <- labelled(HRS_ds_wb_w6$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_wb6, echo=F}
vari <- HRS_ds_wb_w6$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w6, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb6, echo=F, results='asis'}
kable(table(HRS_wb_w6_ls$R6IWSTAT, HRS_ds_wb_w6$living_status, useNA = "ifany"), align='c', caption ='R6IWSTAT vs living_status')
```

```{r importOPAL_wb6, echo=F}



```


### Wave 7  

#### Study-specific variable description

| **Name** | `R7IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w7`|`HRS-WB-w7`|`HRS-WB-w7`|`HRS-WB-w7-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_wb7, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w7_ls','HRS.HRS-WB-w7', variables=list('R7IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w7_ls <- opal.execute(o,'HRS_wb_w7_ls')

opal.assign.table.tibble(o, 'HRS_wb_w7_di','HRS.HRS-WB-w7-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w7_di <- opal.execute(o,'HRS_wb_w7_di')

HRS_wb_w7_ls <- HRS_wb_w7_ls %>% left_join(HRS_wb_w7_di, by = "id")


```

**R script:**

```{r preharm wb_w7, echo=T}

HRS_wb_w7_ls$yinter <- format(HRS_wb_w7_ls$dinterview, '%Y')

HRS_wb_w7_ls$minter <- as.numeric(format(HRS_wb_w7_ls$dinterview, '%m'))

HRS_wb_w7_ls <- HRS_wb_w7_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 7*2+1990),1,0))


```

```{r local_wb7, echo=F}

vari <- HRS_wb_w7_ls$R7IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R7IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w7_ls, aes(factor(R7IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w7_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w7_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w7_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w7_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w7_ls[["R7IWSTAT"]], HRS_wb_w7_ls[["dead"]], useNA = "ifany"), caption = "Cross R7IWSTAT data with death date data")

kable(HRS_wb_w7_ls %>% filter(R7IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==4,cohort=='wb') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_wb7}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==4 & ID_issue_ls$cohort=='wb')]
ids_death_w6 <- HRS_ds_wb_w6$id[HRS_ds_wb_w6$living_status == 1]

HRS_ds_wb_w7 <- tibble(id=HRS_wb_w7_ls$id)
HRS_ds_wb_w7$living_status <- car::recode(HRS_wb_w7_ls$R7IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w7$living_status[which(HRS_wb_w7_ls$dead == 1)] <- 1


HRS_ds_wb_w7$living_status[HRS_ds_wb_w7$id %in%  ids_death_w6] <- 1
HRS_ds_wb_w7$living_status[which(HRS_ds_wb_w7$id %in% ids_issue_ls)] <- 1
HRS_ds_wb_w7$living_status <- labelled(HRS_ds_wb_w7$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_wb7, echo=F}
vari <- HRS_ds_wb_w7$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w7, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb7, echo=F, results='asis'}
kable(table(HRS_wb_w7_ls$R7IWSTAT, HRS_ds_wb_w7$living_status, useNA = "ifany"), align='c', caption ='R7IWSTAT vs living_status')
```

```{r importOPAL_wb7, echo=F}



```



### Wave 8  

#### Study-specific variable description

| **Name** | `R8IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w8`|`HRS-WB-w8`|`HRS-WB-w8`|`HRS-WB-w8-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_wb8, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w8_ls','HRS.HRS-WB-w8', variables=list('R8IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w8_ls <- opal.execute(o,'HRS_wb_w8_ls')

opal.assign.table.tibble(o, 'HRS_wb_w8_di','HRS.HRS-WB-w8-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w8_di <- opal.execute(o,'HRS_wb_w8_di')

HRS_wb_w8_ls <- HRS_wb_w8_ls %>% left_join(HRS_wb_w8_di, by = "id")


```

**R script:**

```{r preharm wb_w8, echo=T}

HRS_wb_w8_ls$yinter <- format(HRS_wb_w8_ls$dinterview, '%Y')

HRS_wb_w8_ls$minter <- as.numeric(format(HRS_wb_w8_ls$dinterview, '%m'))

HRS_wb_w8_ls <- HRS_wb_w8_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 8*2+1990),1,0))


```

```{r local_wb8, echo=F}

vari <- HRS_wb_w8_ls$R8IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R8IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w8_ls, aes(factor(R8IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w8_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w8_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w8_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w8_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w8_ls[["R8IWSTAT"]], HRS_wb_w8_ls[["dead"]], useNA = "ifany"), caption = "Cross R8IWSTAT data with death date data")

kable(HRS_wb_w8_ls %>% filter(R8IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==5,cohort=='wb') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_wb8}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==5 & ID_issue_ls$cohort=='wb')]
ids_death_w7 <- HRS_ds_wb_w7$id[HRS_ds_wb_w7$living_status == 1]

HRS_ds_wb_w8 <- tibble(id=HRS_wb_w8_ls$id)
HRS_ds_wb_w8$living_status <- car::recode(HRS_wb_w8_ls$R8IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w8$living_status[which(HRS_wb_w8_ls$dead == 1)] <- 1


HRS_ds_wb_w8$living_status[HRS_ds_wb_w8$id %in%  ids_death_w7] <- 1
HRS_ds_wb_w8$living_status[which(HRS_ds_wb_w8$id %in% ids_issue_ls)] <- 1
HRS_ds_wb_w8$living_status <- labelled(HRS_ds_wb_w8$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_wb8, echo=F}
vari <- HRS_ds_wb_w8$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w8, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb8, echo=F, results='asis'}
kable(table(HRS_wb_w8_ls$R8IWSTAT, HRS_ds_wb_w8$living_status, useNA = "ifany"), align='c', caption ='R8IWSTAT vs living_status')
```

```{r importOPAL_wb8, echo=F}



```



### Wave 9  

#### Study-specific variable description

| **Name** | `R9IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w9`|`HRS-WB-w9`|`HRS-WB-w9`|`HRS-WB-w9-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_wb9, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w9_ls','HRS.HRS-WB-w9', variables=list('R9IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w9_ls <- opal.execute(o,'HRS_wb_w9_ls')

opal.assign.table.tibble(o, 'HRS_wb_w9_di','HRS.HRS-WB-w9-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w9_di <- opal.execute(o,'HRS_wb_w9_di')

HRS_wb_w9_ls <- HRS_wb_w9_ls %>% left_join(HRS_wb_w9_di, by = "id")


```

**R script:**

```{r preharm wb_w9, echo=T}

HRS_wb_w9_ls$yinter <- format(HRS_wb_w9_ls$dinterview, '%Y')

HRS_wb_w9_ls$minter <- as.numeric(format(HRS_wb_w9_ls$dinterview, '%m'))

HRS_wb_w9_ls <- HRS_wb_w9_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 9*2+1990),1,0))


```

```{r local_wb9, echo=F}

vari <- HRS_wb_w9_ls$R9IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R9IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w9_ls, aes(factor(R9IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w9_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w9_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w9_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w9_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w9_ls[["R9IWSTAT"]], HRS_wb_w9_ls[["dead"]], useNA = "ifany"), caption = "Cross R9IWSTAT data with death date data")

kable(HRS_wb_w9_ls %>% filter(R9IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==6,cohort=='wb') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_wb9}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==6 & ID_issue_ls$cohort=='wb')]
ids_death_w8 <- HRS_ds_wb_w8$id[HRS_ds_wb_w8$living_status == 1]

HRS_ds_wb_w9 <- tibble(id=HRS_wb_w9_ls$id)
HRS_ds_wb_w9$living_status <- car::recode(HRS_wb_w9_ls$R9IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w9$living_status[which(HRS_wb_w9_ls$dead == 1)] <- 1


HRS_ds_wb_w9$living_status[HRS_ds_wb_w9$id %in%  ids_death_w8] <- 1
HRS_ds_wb_w9$living_status[which(HRS_ds_wb_w9$id %in% ids_issue_ls)] <- 1
HRS_ds_wb_w9$living_status <- labelled(HRS_ds_wb_w9$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_wb9, echo=F}
vari <- HRS_ds_wb_w9$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w9, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb9, echo=F, results='asis'}
kable(table(HRS_wb_w9_ls$R9IWSTAT, HRS_ds_wb_w9$living_status, useNA = "ifany"), align='c', caption ='R9IWSTAT vs living_status')
```

```{r importOPAL_wb9, echo=F}



```



### Wave 10  

#### Study-specific variable description

| **Name** | `R10IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w10`|`HRS-WB-w10`|`HRS-WB-w10`|`HRS-WB-w10-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_wb10, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w10_ls','HRS.HRS-WB-w10', variables=list('R10IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w10_ls <- opal.execute(o,'HRS_wb_w10_ls')

opal.assign.table.tibble(o, 'HRS_wb_w10_di','HRS.HRS-WB-w10-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w10_di <- opal.execute(o,'HRS_wb_w10_di')

HRS_wb_w10_ls <- HRS_wb_w10_ls %>% left_join(HRS_wb_w10_di, by = "id")


```

**R script:**

```{r preharm wb_w10, echo=T}

HRS_wb_w10_ls$yinter <- format(HRS_wb_w10_ls$dinterview, '%Y')

HRS_wb_w10_ls$minter <- as.numeric(format(HRS_wb_w10_ls$dinterview, '%m'))

HRS_wb_w10_ls <- HRS_wb_w10_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 10*2+1990),1,0))


```

```{r local_wb10, echo=F}

vari <- HRS_wb_w10_ls$R10IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R10IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w10_ls, aes(factor(R10IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w10_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w10_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w10_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w10_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w10_ls[["R10IWSTAT"]], HRS_wb_w10_ls[["dead"]], useNA = "ifany"), caption = "Cross R10IWSTAT data with death date data")

kable(HRS_wb_w10_ls %>% filter(R10IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==7,cohort=='wb') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_wb10}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==7 & ID_issue_ls$cohort=='wb')]
ids_death_w9 <- HRS_ds_wb_w9$id[HRS_ds_wb_w9$living_status == 1]

HRS_ds_wb_w10 <- tibble(id=HRS_wb_w10_ls$id)
HRS_ds_wb_w10$living_status <- car::recode(HRS_wb_w10_ls$R10IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w10$living_status[which(HRS_wb_w10_ls$dead == 1)] <- 1


HRS_ds_wb_w10$living_status[HRS_ds_wb_w10$id %in%  ids_death_w9] <- 1
HRS_ds_wb_w10$living_status[which(HRS_ds_wb_w10$id %in% ids_issue_ls)] <- 1
HRS_ds_wb_w10$living_status <- labelled(HRS_ds_wb_w10$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_wb10, echo=F}
vari <- HRS_ds_wb_w10$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w10, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb10, echo=F, results='asis'}
kable(table(HRS_wb_w10_ls$R10IWSTAT, HRS_ds_wb_w10$living_status, useNA = "ifany"), align='c', caption ='R10IWSTAT vs living_status')
```

```{r importOPAL_wb10, echo=F}



```


### Wave 11  

#### Study-specific variable description

| **Name** | `R11IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-WB-w11`|`HRS-WB-w11`|`HRS-WB-w11`|`HRS-WB-w11-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_wb11, echo=F}
opal.assign.table.tibble(o, 'HRS_wb_w11_ls','HRS.HRS-WB-w11', variables=list('R11IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_wb_w11_ls <- opal.execute(o,'HRS_wb_w11_ls')

opal.assign.table.tibble(o, 'HRS_wb_w11_di','HRS.HRS-WB-w11-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_wb_w11_di <- opal.execute(o,'HRS_wb_w11_di')

HRS_wb_w11_ls <- HRS_wb_w11_ls %>% left_join(HRS_wb_w11_di, by = "id")


```

**R script:**

```{r preharm wb_w11, echo=T}

HRS_wb_w11_ls$yinter <- format(HRS_wb_w11_ls$dinterview, '%Y')

HRS_wb_w11_ls$minter <- as.numeric(format(HRS_wb_w11_ls$dinterview, '%m'))

HRS_wb_w11_ls <- HRS_wb_w11_ls %>%
  mutate(dead = if_else(!is.na(RADYEAR),1,0))


```

```{r local_wb11, echo=F}

vari <- HRS_wb_w11_ls$R11IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R11IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w11_ls, aes(factor(R11IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_wb_w11_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w11_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_wb_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_wb_w11_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_wb_w11_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_wb_w11_ls[["R11IWSTAT"]], HRS_wb_w11_ls[["dead"]], useNA = "ifany"), caption = "Cross R11IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_wb11}
ids_death_w10 <- HRS_ds_wb_w10$id[HRS_ds_wb_w10$living_status == 1]

HRS_ds_wb_w11 <- tibble(id=HRS_wb_w11_ls$id)
HRS_ds_wb_w11$living_status <- car::recode(HRS_wb_w11_ls$R11IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_wb_w11$living_status[which(HRS_wb_w11_ls$dead == 1)] <- 1


HRS_ds_wb_w11$living_status[HRS_ds_wb_w11$id %in%  ids_death_w10] <- 1
HRS_ds_wb_w11$living_status <- labelled(HRS_ds_wb_w11$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_wb11, echo=F}
vari <- HRS_ds_wb_w11$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w11, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_wb11, echo=F, results='asis'}
kable(table(HRS_wb_w11_ls$R11IWSTAT, HRS_ds_wb_w11$living_status, useNA = "ifany"), align='c', caption ='R11IWSTAT vs living_status')
```

```{r importOPAL_wb11, echo=F}



```




## EBB

### Wave 7  

#### Study-specific variable description

| **Name** | `R7IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-EBB-w7`|`HRS-EBB-w7`|`HRS-EBB-w7`|`HRS-EBB-w7-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |

```{r assign_ebb7, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w7_ls','HRS.HRS-EBB-w7', variables=list('R7IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ebb_w7_ls <- opal.execute(o,'HRS_ebb_w7_ls')

opal.assign.table.tibble(o, 'HRS_ebb_w7_di','HRS.HRS-EBB-w7-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ebb_w7_di <- opal.execute(o,'HRS_ebb_w7_di')

HRS_ebb_w7_ls <- HRS_ebb_w7_ls %>% left_join(HRS_ebb_w7_di, by = "id")


```

**R script:**

```{r preharm ebb_w7, echo=T}

HRS_ebb_w7_ls$yinter <- format(HRS_ebb_w7_ls$dinterview, '%Y')

HRS_ebb_w7_ls$minter <- as.numeric(format(HRS_ebb_w7_ls$dinterview, '%m'))

HRS_ebb_w7_ls <- HRS_ebb_w7_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 7*2+1990),1,0))


```

```{r local_ebb7, echo=F}

vari <- HRS_ebb_w7_ls$R7IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R7IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w7_ls, aes(factor(R7IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ebb_w7_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w7_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w7_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w7_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ebb_w7_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w7_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ebb_w7_ls[["R7IWSTAT"]], HRS_ebb_w7_ls[["dead"]], useNA = "ifany"), caption = "Cross R7IWSTAT data with death date data")




```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.

**R script:**

```{r harmo_ebb7}
HRS_ds_ebb_w7 <- tibble(id=HRS_ebb_w7_ls$id)
HRS_ds_ebb_w7$living_status <- car::recode(HRS_ebb_w7_ls$R7IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ebb_w7$living_status[which(HRS_ebb_w7_ls$dead == 1)] <- 1


HRS_ds_ebb_w7$living_status <- labelled(HRS_ds_ebb_w7$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ebb7, echo=F}
vari <- HRS_ds_ebb_w7$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w7, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ebb7, echo=F, results='asis'}
kable(table(HRS_ebb_w7_ls$R7IWSTAT, HRS_ds_ebb_w7$living_status, useNA = "ifany"), align='c', caption ='R7IWSTAT vs living_status')
```

```{r importOPAL_ebb7, echo=F}



```


### Wave 8  

#### Study-specific variable description

| **Name** | `R8IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-EBB-w8`|`HRS-EBB-w8`|`HRS-EBB-w8`|`HRS-EBB-w8-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ebb8, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w8_ls','HRS.HRS-EBB-w8', variables=list('R8IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ebb_w8_ls <- opal.execute(o,'HRS_ebb_w8_ls')

opal.assign.table.tibble(o, 'HRS_ebb_w8_di','HRS.HRS-EBB-w8-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ebb_w8_di <- opal.execute(o,'HRS_ebb_w8_di')

HRS_ebb_w8_ls <- HRS_ebb_w8_ls %>% left_join(HRS_ebb_w8_di, by = "id")


```

**R script:**

```{r preharm ebb_w8, echo=T}

HRS_ebb_w8_ls$yinter <- format(HRS_ebb_w8_ls$dinterview, '%Y')

HRS_ebb_w8_ls$minter <- as.numeric(format(HRS_ebb_w8_ls$dinterview, '%m'))

HRS_ebb_w8_ls <- HRS_ebb_w8_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 8*2+1990),1,0))


```

```{r local_ebb8, echo=F}

vari <- HRS_ebb_w8_ls$R8IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R8IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w8_ls, aes(factor(R8IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ebb_w8_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w8_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w8_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w8_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ebb_w8_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w8_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ebb_w8_ls[["R8IWSTAT"]], HRS_ebb_w8_ls[["dead"]], useNA = "ifany"), caption = "Cross R8IWSTAT data with death date data")

kable(HRS_ebb_w8_ls %>% filter(R8IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==2,cohort=='ebb') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ebb8}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==2 & ID_issue_ls$cohort=='ebb')]
ids_death_w7 <- HRS_ds_ebb_w7$id[HRS_ds_ebb_w7$living_status == 1]

HRS_ds_ebb_w8 <- tibble(id=HRS_ebb_w8_ls$id)
HRS_ds_ebb_w8$living_status <- car::recode(HRS_ebb_w8_ls$R8IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ebb_w8$living_status[which(HRS_ebb_w8_ls$dead == 1)] <- 1


HRS_ds_ebb_w8$living_status[HRS_ds_ebb_w8$id %in%  ids_death_w7] <- 1
HRS_ds_ebb_w8$living_status[which(HRS_ds_ebb_w8$id %in% ids_issue_ls)] <- 1
HRS_ds_ebb_w8$living_status <- labelled(HRS_ds_ebb_w8$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_ebb8, echo=F}
vari <- HRS_ds_ebb_w8$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w8, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ebb8, echo=F, results='asis'}
kable(table(HRS_ebb_w8_ls$R8IWSTAT, HRS_ds_ebb_w8$living_status, useNA = "ifany"), align='c', caption ='R8IWSTAT vs living_status')
```

```{r importOPAL_ebb8, echo=F}



```


### Wave 9  

#### Study-specific variable description

| **Name** | `R9IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-EBB-w9`|`HRS-EBB-w9`|`HRS-EBB-w9`|`HRS-EBB-w9-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ebb9, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w9_ls','HRS.HRS-EBB-w9', variables=list('R9IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ebb_w9_ls <- opal.execute(o,'HRS_ebb_w9_ls')

opal.assign.table.tibble(o, 'HRS_ebb_w9_di','HRS.HRS-EBB-w9-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ebb_w9_di <- opal.execute(o,'HRS_ebb_w9_di')

HRS_ebb_w9_ls <- HRS_ebb_w9_ls %>% left_join(HRS_ebb_w9_di, by = "id")


```

**R script:**

```{r preharm ebb_w9, echo=T}

HRS_ebb_w9_ls$yinter <- format(HRS_ebb_w9_ls$dinterview, '%Y')

HRS_ebb_w9_ls$minter <- as.numeric(format(HRS_ebb_w9_ls$dinterview, '%m'))

HRS_ebb_w9_ls <- HRS_ebb_w9_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 9*2+1990),1,0))


```

```{r local_ebb9, echo=F}

vari <- HRS_ebb_w9_ls$R9IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R9IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w9_ls, aes(factor(R9IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ebb_w9_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w9_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w9_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w9_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ebb_w9_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w9_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ebb_w9_ls[["R9IWSTAT"]], HRS_ebb_w9_ls[["dead"]], useNA = "ifany"), caption = "Cross R9IWSTAT data with death date data")

kable(HRS_ebb_w9_ls %>% filter(R9IWSTAT %in% c(1,2,4),dead==1) %>% mutate(in_issue_ls = id %in% (ID_issue_ls %>% filter(wave==3,cohort=='ebb') %>% pull(id))) %>% select(id, in_issue_ls), caption = "Individuals with paradoxical data were already recategorized as dead, since they are in the ID_issue_ls database")


```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.


**R script:**

```{r harmo_ebb9}
ids_issue_ls <- ID_issue_ls$id[which(ID_issue_ls$wave==3 & ID_issue_ls$cohort=='ebb')]
ids_death_w8 <- HRS_ds_ebb_w8$id[HRS_ds_ebb_w8$living_status == 1]

HRS_ds_ebb_w9 <- tibble(id=HRS_ebb_w9_ls$id)
HRS_ds_ebb_w9$living_status <- car::recode(HRS_ebb_w9_ls$R9IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ebb_w9$living_status[which(HRS_ebb_w9_ls$dead == 1)] <- 1


HRS_ds_ebb_w9$living_status[HRS_ds_ebb_w9$id %in%  ids_death_w8] <- 1
HRS_ds_ebb_w9$living_status[which(HRS_ds_ebb_w9$id %in% ids_issue_ls)] <- 1
HRS_ds_ebb_w9$living_status <- labelled(HRS_ds_ebb_w9$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ebb9, echo=F}
vari <- HRS_ds_ebb_w9$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w9, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ebb9, echo=F, results='asis'}
kable(table(HRS_ebb_w9_ls$R9IWSTAT, HRS_ds_ebb_w9$living_status, useNA = "ifany"), align='c', caption ='R9IWSTAT vs living_status')
```

```{r importOPAL_ebb9, echo=F}



```

### Wave 10  

#### Study-specific variable description

| **Name** | `R10IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-EBB-w10`|`HRS-EBB-w10`|`HRS-EBB-w10`|`HRS-EBB-w10-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ebb10, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w10_ls','HRS.HRS-EBB-w10', variables=list('R10IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ebb_w10_ls <- opal.execute(o,'HRS_ebb_w10_ls')

opal.assign.table.tibble(o, 'HRS_ebb_w10_di','HRS.HRS-EBB-w10-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ebb_w10_di <- opal.execute(o,'HRS_ebb_w10_di')

HRS_ebb_w10_ls <- HRS_ebb_w10_ls %>% left_join(HRS_ebb_w10_di, by = "id")


```

**R script:**

```{r preharm ebb_w10, echo=T}

HRS_ebb_w10_ls$yinter <- format(HRS_ebb_w10_ls$dinterview, '%Y')

HRS_ebb_w10_ls$minter <- as.numeric(format(HRS_ebb_w10_ls$dinterview, '%m'))

HRS_ebb_w10_ls <- HRS_ebb_w10_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 10*2+1990),1,0))


```

```{r local_ebb10, echo=F}

vari <- HRS_ebb_w10_ls$R10IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R10IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w10_ls, aes(factor(R10IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ebb_w10_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w10_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w10_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ebb_w10_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ebb_w10_ls[["R10IWSTAT"]], HRS_ebb_w10_ls[["dead"]], useNA = "ifany"), caption = "Cross R10IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_ebb10}
ids_death_w9 <- HRS_ds_ebb_w9$id[HRS_ds_ebb_w9$living_status == 1]

HRS_ds_ebb_w10 <- tibble(id=HRS_ebb_w10_ls$id)
HRS_ds_ebb_w10$living_status <- car::recode(HRS_ebb_w10_ls$R10IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ebb_w10$living_status[which(HRS_ebb_w10_ls$dead == 1)] <- 1


HRS_ds_ebb_w10$living_status[HRS_ds_ebb_w10$id %in%  ids_death_w9] <- 1
HRS_ds_ebb_w10$living_status <- labelled(HRS_ds_ebb_w10$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ebb10, echo=F}
vari <- HRS_ds_ebb_w10$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w10, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ebb10, echo=F, results='asis'}
kable(table(HRS_ebb_w10_ls$R10IWSTAT, HRS_ds_ebb_w10$living_status, useNA = "ifany"), align='c', caption ='R10IWSTAT vs living_status')
```

```{r importOPAL_ebb10, echo=F}



```


### Wave 11  

#### Study-specific variable description

| **Name** | `R11IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-EBB-w11`|`HRS-EBB-w11`|`HRS-EBB-w11`|`HRS-EBB-w11-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_ebb11, echo=F}
opal.assign.table.tibble(o, 'HRS_ebb_w11_ls','HRS.HRS-EBB-w11', variables=list('R11IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_ebb_w11_ls <- opal.execute(o,'HRS_ebb_w11_ls')

opal.assign.table.tibble(o, 'HRS_ebb_w11_di','HRS.HRS-EBB-w11-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_ebb_w11_di <- opal.execute(o,'HRS_ebb_w11_di')

HRS_ebb_w11_ls <- HRS_ebb_w11_ls %>% left_join(HRS_ebb_w11_di, by = "id")


```

**R script:**

```{r preharm ebb_w11, echo=T}

HRS_ebb_w11_ls$yinter <- format(HRS_ebb_w11_ls$dinterview, '%Y')

HRS_ebb_w11_ls$minter <- as.numeric(format(HRS_ebb_w11_ls$dinterview, '%m'))

HRS_ebb_w11_ls <- HRS_ebb_w11_ls %>%
  mutate(dead = if_else(!is.na(RADYEAR),1,0))


```

```{r local_ebb11, echo=F}

vari <- HRS_ebb_w11_ls$R11IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R11IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w11_ls, aes(factor(R11IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_ebb_w11_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w11_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_ebb_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_ebb_w11_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_ebb_w11_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_ebb_w11_ls[["R11IWSTAT"]], HRS_ebb_w11_ls[["dead"]], useNA = "ifany"), caption = "Cross R11IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.



**R script:**

```{r harmo_ebb11}
ids_death_w10 <- HRS_ds_ebb_w10$id[HRS_ds_ebb_w10$living_status == 1]

HRS_ds_ebb_w11 <- tibble(id=HRS_ebb_w11_ls$id)
HRS_ds_ebb_w11$living_status <- car::recode(HRS_ebb_w11_ls$R11IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_ebb_w11$living_status[which(HRS_ebb_w11_ls$dead == 1)] <- 1


HRS_ds_ebb_w11$living_status[HRS_ds_ebb_w11$id %in%  ids_death_w10] <- 1
HRS_ds_ebb_w11$living_status <- labelled(HRS_ds_ebb_w11$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_ebb11, echo=F}
vari <- HRS_ds_ebb_w11$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w11, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ebb11, echo=F, results='asis'}
kable(table(HRS_ebb_w11_ls$R11IWSTAT, HRS_ds_ebb_w11$living_status, useNA = "ifany"), align='c', caption ='R11IWSTAT vs living_status')
```

```{r importOPAL_ebb11, echo=F}



```





## MBB

### Wave 10  

#### Study-specific variable description

| **Name** | `R10IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-MBB-w10`|`HRS-MBB-w10`|`HRS-MBB-w10`|`HRS-MBB-w10-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |

```{r assign_mbb10, echo=F}
opal.assign.table.tibble(o, 'HRS_mbb_w10_ls','HRS.HRS-MBB-w10', variables=list('R10IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_mbb_w10_ls <- opal.execute(o,'HRS_mbb_w10_ls')

opal.assign.table.tibble(o, 'HRS_mbb_w10_di','HRS.HRS-MBB-w10-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_mbb_w10_di <- opal.execute(o,'HRS_mbb_w10_di')

HRS_mbb_w10_ls <- HRS_mbb_w10_ls %>% left_join(HRS_mbb_w10_di, by = "id")


```

**R script:**

```{r preharm mbb_w10, echo=T}

HRS_mbb_w10_ls$yinter <- format(HRS_mbb_w10_ls$dinterview, '%Y')

HRS_mbb_w10_ls$minter <- as.numeric(format(HRS_mbb_w10_ls$dinterview, '%m'))

HRS_mbb_w10_ls <- HRS_mbb_w10_ls %>%
  mutate(dead = if_else(RADYEAR < yinter | (RADYEAR == yinter & RADMONTH < minter) | (is.na(yinter) & RADYEAR < 10*2+1990),1,0))


```

```{r local_mbb10, echo=F}

vari <- HRS_mbb_w10_ls$R10IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R10IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w10_ls, aes(factor(R10IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_mbb_w10_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_mbb_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_mbb_w10_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_mbb_w10_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_mbb_w10_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_mbb_w10_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w10_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_mbb_w10_ls[["R10IWSTAT"]], HRS_mbb_w10_ls[["dead"]], useNA = "ifany"), caption = "Cross R10IWSTAT data with death date data")




```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.

**R script:**

```{r harmo_mbb10}
HRS_ds_mbb_w10 <- tibble(id=HRS_mbb_w10_ls$id)
HRS_ds_mbb_w10$living_status <- car::recode(HRS_mbb_w10_ls$R10IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_mbb_w10$living_status[which(HRS_mbb_w10_ls$dead == 1)] <- 1


HRS_ds_mbb_w10$living_status <- labelled(HRS_ds_mbb_w10$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_mbb10, echo=F}
vari <- HRS_ds_mbb_w10$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_mbb_w10, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_mbb10, echo=F, results='asis'}
kable(table(HRS_ebb_w11_ls$R11IWSTAT, HRS_ds_ebb_w11$living_status, useNA = "ifany"), align='c', caption ='R11IWSTAT vs living_status')
```

```{r importOPAL_mbb10, echo=F}



```


### Wave 11  

#### Study-specific variable description

| **Name** | `R11IWSTAT`|`RADYEAR`|`RADMONTH`|`dinterview`|
|-|-|-|-|-|
| **Label** | `R Interview Status` | `R death year` | `R death month` |  |
| **Table name** |`HRS-MBB-w11`|`HRS-MBB-w11`|`HRS-MBB-w11`|`HRS-MBB-w11-date_of_interview`|
| **Categories** |`0 = Inap.; 1 = Resp, alive; 2 = Resp, died after IW; 3 = Resp(proxy), died; 4 = NR, alive; 5 = NR, died this wv; 6 = NR, died prev wv; 7 = NR, dropped from samp`|`years`|`months`|`dates`|
| **Missings** |`9 = NR, DK if alive or died`|`NA`|`NA`|`NA`|
| **Description** |  |  |  |  |


```{r assign_mbb11, echo=F}
opal.assign.table.tibble(o, 'HRS_mbb_w11_ls','HRS.HRS-MBB-w11', variables=list('R11IWSTAT','RADYEAR','RADMONTH'), missings = TRUE)
HRS_mbb_w11_ls <- opal.execute(o,'HRS_mbb_w11_ls')

opal.assign.table.tibble(o, 'HRS_mbb_w11_di','HRS.HRS-MBB-w11-date_of_interview', variables=list('dinterview'), missings = TRUE)
HRS_mbb_w11_di <- opal.execute(o,'HRS_mbb_w11_di')

HRS_mbb_w11_ls <- HRS_mbb_w11_ls %>% left_join(HRS_mbb_w11_di, by = "id")


```

**R script:**

```{r preharm mbb_w11, echo=T}

HRS_mbb_w11_ls$yinter <- format(HRS_mbb_w11_ls$dinterview, '%Y')

HRS_mbb_w11_ls$minter <- as.numeric(format(HRS_mbb_w11_ls$dinterview, '%m'))

HRS_mbb_w11_ls <- HRS_mbb_w11_ls %>%
  mutate(dead = if_else(!is.na(RADYEAR),1,0))


```

```{r local_mbb11, echo=F}

vari <- HRS_mbb_w11_ls$R11IWSTAT
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = "R11IWSTAT")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w11_ls, aes(factor(R11IWSTAT))) + geom_histogram(stat="count", fill="steelblue") + xlab("Living Status") + ylab("Frequency")

vbl <- HRS_mbb_w11_ls[["RADYEAR"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_mbb_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_mbb_w11_ls[["RADMONTH"]]
kable(Continuous_summary(vbl, missing_values = NA)[3], caption = attr(vbl, "spss::shortName"))
pander(Continuous_summary(vbl, missing_values = NA)[["summary"]], caption = "Summary")
ggplot(HRS_mbb_w11_ls, aes(vbl)) + geom_histogram(stat="count", fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- HRS_mbb_w11_ls[["yinter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "yinter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")

vbl <- HRS_mbb_w11_ls[["minter"]]
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = "minter")

kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w11_ls, aes(x=factor(vbl))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Month of interview") + ylab("Frequency")

kable(table(HRS_mbb_w11_ls[["R11IWSTAT"]], HRS_mbb_w11_ls[["dead"]], useNA = "ifany"), caption = "Cross R11IWSTAT data with death date data")



```

#### Harmonisation algorithm
Values are recoded as follows:

* Values dead == 1 (death previous to this wave) are recoded as 1 (dead) 

 * Values 1 (Resp, alive), 2 (Resp, died after IW) or 4 (NoResp, alive) are recoded as value 0 (alive) 
 * Values 3 (Resp proxy, died), 5 (NR, died this wv) or 6 (NR, died prev wv) are recoded as value 1 (died) 
 * Values 7 (NR, dropped) or 9 (NR, DK if alive or died) are recoded as value 2 (dropout) 
 * Value 0 (Inappropriate) is recoded as value missing 996 (Not applicable) because these individuals are probably new spouses from following waves.

**R script:**

```{r harmo_mbb11}
ids_death_w10 <- HRS_ds_mbb_w10$id[HRS_ds_mbb_w10$living_status == 1]

HRS_ds_mbb_w11 <- tibble(id=HRS_mbb_w11_ls$id)
HRS_ds_mbb_w11$living_status <- car::recode(HRS_mbb_w11_ls$R11IWSTAT, "c(1,2,4)=0; c(3,5,6)=1; c(7,9)=2; 0=996")

HRS_ds_mbb_w11$living_status[which(HRS_mbb_w11_ls$dead == 1)] <- 1


HRS_ds_mbb_w11$living_status[HRS_ds_mbb_w11$id %in%  ids_death_w10] <- 1
HRS_ds_mbb_w11$living_status <- labelled(HRS_ds_mbb_w11$living_status, labels = c("Alive"=0, "Dead"=1, "Dropout"=2, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```


#### Statistics of the new harmonised variable
```{r descript_mbb11, echo=F}
vari <- HRS_ds_mbb_w11$living_status
kable(Categorical_summary(vari, missing_values = miss_values_vector)[3], caption = "living_status")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_mbb_w11, aes(x=factor(living_status))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Status") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_mbb11, echo=F, results='asis'}
kable(table(HRS_mbb_w11_ls$R11IWSTAT, HRS_ds_mbb_w11$living_status, useNA = "ifany"), align='c', caption ='R11IWSTAT vs living_status')
```

```{r importOPAL_mbb11, echo=F}



```















## Summary of descriptive statistics of the harmonised variable accross populations and waves

Two tables are generated: 

1. Percentages of categories in each harmonised variable.

2. Frequencies and percentages of individuals with different trajectories.



```{r summ, echo=F}

# All study waves and populations with abbreviated and descriptive names


hrw.hrw.cw <- list(hrs_w1 = c("hrs_w1","HRS w1"), hrs_w2 = c("hrs_w2","HRS w2"), hrs_w3 = c("hrs_w3","HRS w3"), hrs_w4 = c("hrs_w4","HRS w4"), hrs_w5 = c("hrs_w5","HRS w5"), hrs_w6 = c("hrs_w6","HRS w6"), hrs_w7 = c("hrs_w7","HRS w7"), hrs_w8 = c("hrs_w8","HRS w8"), hrs_w9 = c("hrs_w9","HRS w9"), hrs_w10 = c("hrs_w10","HRS w10"), hrs_w11 = c("hrs_w11","HRS w11"))

hrw.ahead.cw <- list(ahead_w2 = c("ahead_w2","AHEAD w2"), ahead_w3 = c("ahead_w3","AHEAD w3"), ahead_w4 = c("ahead_w4","AHEAD w4"), ahead_w5 = c("ahead_w5","AHEAD w5"), ahead_w6 = c("ahead_w6","AHEAD w6"), ahead_w7 = c("ahead_w7","AHEAD w7"), ahead_w8 = c("ahead_w8","AHEAD w8"), ahead_w9 = c("ahead_w9","AHEAD w9"), ahead_w10 = c("ahead_w10","AHEAD w10"), ahead_w11 = c("ahead_w11","AHEAD w11"))

hrw.coda.cw <- list(coda_w4 = c("coda_w4","CODA w4"), coda_w5 = c("coda_w5","CODA w5"), coda_w6 = c("coda_w6","CODA w6"), coda_w7 = c("coda_w7","CODA w7"), coda_w8 = c("coda_w8","CODA w8"), coda_w9 = c("coda_w9","CODA w9"), coda_w10 = c("coda_w10","CODA w10"), coda_w11 = c("coda_w11","CODA w11"))

hrw.wb.cw <- list(wb_w4 = c("wb_w4","WB w4"), wb_w5 = c("wb_w5","WB w5"), wb_w6 = c("wb_w6","WB w6"), wb_w7 = c("wb_w7","WB w7"), wb_w8 = c("wb_w8","WB w8"), wb_w9 = c("wb_w9","WB w9"), wb_w10 = c("wb_w10","WB w10"), wb_w11 = c("wb_w11","WB w11"))

hrw.ebb.cw <- list(ebb_w7 = c("ebb_w7","EBB w7"), ebb_w8 = c("ebb_w8","EBB w8"), ebb_w9 = c("ebb_w9","EBB w9"), ebb_w10 = c("ebb_w10","EBB w10"), ebb_w11 = c("ebb_w11","EBB w11"))

hrw.mbb.cw <- list(mbb_w10 = c("mbb_w10","MBB w10"), mbb_w11 = c("mbb_w11","MBB w11"))



# HRS

# Consider only harmonised waves
l.hds <- lapply(hrw.hrw.cw, function(wname) if(exists(paste0("HRS_ds_",wname[1]))){wname = list(get(paste0("HRS_ds_",wname[1])),wname[2])})
nullw <- which(sapply(l.hds, is.null))

if(length(nullw)!=0){
  l.hds <- l.hds[-nullw]
}

m.hds <- list()

lmlist <- list(lapply(l.hds,function(x)x[[1]]),m.hds)

if(length(l.hds)>0){
  # Labelling tibbles
  lmlist <- labelling(lmlist[[1]],lmlist[[2]])
  # Printing table of categories
  print(knitr::kable(summaries(lmlist[[1]],lmlist[[2]],lapply(l.hds,function(x)x[[2]])),caption=ds_label))
  # Printing table of trajectories
  f.dbb <- trajectories(lmlist[[2]],vbl_name=hd_vbl)
  print(knitr::kable(f.dbb))
  # Saving tibbles
  savingRD(lmlist[[1]],vbl_name=hd_vbl)
}






# AHEAD

# Consider only harmonised waves
l.hds <- lapply(hrw.ahead.cw, function(wname) if(exists(paste0("HRS_ds_",wname[1]))){wname = list(get(paste0("HRS_ds_",wname[1])),wname[2])})
nullw <- which(sapply(l.hds, is.null))

if(length(nullw)!=0){
  l.hds <- l.hds[-nullw]
}

m.hds <- list()

lmlist <- list(lapply(l.hds,function(x)x[[1]]),m.hds)

if(length(l.hds)>0){
  # Labelling tibbles
  lmlist <- labelling(lmlist[[1]],lmlist[[2]])
  # Printing table of categories
  print(knitr::kable(summaries(lmlist[[1]],lmlist[[2]],lapply(l.hds,function(x)x[[2]])),caption=ds_label))
  # Printing table of trajectories
  f.dbb <- trajectories(lmlist[[2]],vbl_name=hd_vbl)
  print(knitr::kable(f.dbb))
  # Saving tibbles
  savingRD(lmlist[[1]],vbl_name=hd_vbl)
}





# CODA

# Consider only harmonised waves
l.hds <- lapply(hrw.coda.cw, function(wname) if(exists(paste0("HRS_ds_",wname[1]))){wname = list(get(paste0("HRS_ds_",wname[1])),wname[2])})
nullw <- which(sapply(l.hds, is.null))

if(length(nullw)!=0){
  l.hds <- l.hds[-nullw]
}

m.hds <- list()

lmlist <- list(lapply(l.hds,function(x)x[[1]]),m.hds)

if(length(l.hds)>0){
  # Labelling tibbles
  lmlist <- labelling(lmlist[[1]],lmlist[[2]])
  # Printing table of categories
  print(knitr::kable(summaries(lmlist[[1]],lmlist[[2]],lapply(l.hds,function(x)x[[2]])),caption=ds_label))
  # Printing table of trajectories
  f.dbb <- trajectories(lmlist[[2]],vbl_name=hd_vbl)
  print(knitr::kable(f.dbb))
  # Saving tibbles
  savingRD(lmlist[[1]],vbl_name=hd_vbl)
}




# WB

# Consider only harmonised waves
l.hds <- lapply(hrw.wb.cw, function(wname) if(exists(paste0("HRS_ds_",wname[1]))){wname = list(get(paste0("HRS_ds_",wname[1])),wname[2])})
nullw <- which(sapply(l.hds, is.null))

if(length(nullw)!=0){
  l.hds <- l.hds[-nullw]
}

m.hds <- list()

lmlist <- list(lapply(l.hds,function(x)x[[1]]),m.hds)

if(length(l.hds)>0){
  # Labelling tibbles
  lmlist <- labelling(lmlist[[1]],lmlist[[2]])
  # Printing table of categories
  print(knitr::kable(summaries(lmlist[[1]],lmlist[[2]],lapply(l.hds,function(x)x[[2]])),caption=ds_label))
  # Printing table of trajectories
  f.dbb <- trajectories(lmlist[[2]],vbl_name=hd_vbl)
  print(knitr::kable(f.dbb))
  # Saving tibbles
  savingRD(lmlist[[1]],vbl_name=hd_vbl)
}



# EBB

# Consider only harmonised waves
l.hds <- lapply(hrw.ebb.cw, function(wname) if(exists(paste0("HRS_ds_",wname[1]))){wname = list(get(paste0("HRS_ds_",wname[1])),wname[2])})
nullw <- which(sapply(l.hds, is.null))

if(length(nullw)!=0){
  l.hds <- l.hds[-nullw]
}

m.hds <- list()

lmlist <- list(lapply(l.hds,function(x)x[[1]]),m.hds)

if(length(l.hds)>0){
  # Labelling tibbles
  lmlist <- labelling(lmlist[[1]],lmlist[[2]])
  # Printing table of categories
  print(knitr::kable(summaries(lmlist[[1]],lmlist[[2]],lapply(l.hds,function(x)x[[2]])),caption=ds_label))
  # Printing table of trajectories
  f.dbb <- trajectories(lmlist[[2]],vbl_name=hd_vbl)
  print(knitr::kable(f.dbb))
  # Saving tibbles
  savingRD(lmlist[[1]],vbl_name=hd_vbl)
}




# MBB

# Consider only harmonised waves
l.hds <- lapply(hrw.mbb.cw, function(wname) if(exists(paste0("HRS_ds_",wname[1]))){wname = list(get(paste0("HRS_ds_",wname[1])),wname[2])})
nullw <- which(sapply(l.hds, is.null))

if(length(nullw)!=0){
  l.hds <- l.hds[-nullw]
}

m.hds <- list()

lmlist <- list(lapply(l.hds,function(x)x[[1]]),m.hds)

if(length(l.hds)>0){
  # Labelling tibbles
  lmlist <- labelling(lmlist[[1]],lmlist[[2]])
  # Printing table of categories
  print(knitr::kable(summaries(lmlist[[1]],lmlist[[2]],lapply(l.hds,function(x)x[[2]])),caption=ds_label))
  # Printing table of trajectories
  f.dbb <- trajectories(lmlist[[2]],vbl_name=hd_vbl)
  print(knitr::kable(f.dbb))
  # Saving tibbles
  savingRD(lmlist[[1]],vbl_name=hd_vbl)
}


```







# Quality estimation

Results in validations throughout waves show, in each population, that there are few people who 
died in some wave and dropped out afterwards. This issue was already present in the original HRS 
variable and we have not fixed it yet. Meanwhile, we should consider that a previous death prevails 
upon a subsequent dropout.

Moreover, we found two errors:

* HRS sub-sample, individual with "id" = "63063010", was alive in wave 1, died in wave 2, and alive in waves 3 to 11.
* AHEAD sub-sample, individual with "id" = "202147020", was alive in waves 2 to 9, died in wave 10, and alive in wave 11.

These errors have not been corrected yet.

A general issue was detected. There are individuals that do not have date of interview and the value in the original Interview Status from HRS is 'NR, alive' but their date of interview is before the usual date of interview of the wave. Those individuals were recoded as 1 (dead).

```{r closeRsession, echo=FALSE}
opal.logout(o)
```
