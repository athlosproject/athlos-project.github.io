---
title: "Respiratory diseases"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 
<!-- # Installation, loading packages -->
```{r setup, include=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_iago.r")
```
<!-- ########################################################## --> 




# Description of DataSchema variable

The description of harmonised variable is the following:

* Short name: `h_respiratory`
* Variable label: `Chronic respiratory diseases such respiratory, CPD, COPD, bronchitis, emphysema`
* Variable description: `The participant has one or more of the following respiratory diseases: respiratory, chronic bronchitis, emphysema, chronic pulmonary disease, chronic obstructive pulmonary disease`
* Domain: `Diseases`
* Value type: `categorical`
* Category coding:

**Code** | **Category Label**
-------- | ------------------
0        | no respiratory disease
1        | yes, respiratory disease

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing



<!-- ########################################################## --> 
<!-- # Global variables -->
```{r global, include=FALSE, echo=F}
miss_values_vector <- c(991, 992, 993, 994, 995, 996, 997, 998, 999)
ds_label <- "Chronic respiratory diseases such respiratory, CPD, COPD, bronchitis, emphysema"
cat_label <- c("No" = 0, "Yes" = 1, "Missing" = 999, "Do not know" = 998, "Refuse" = 997, "Not applicable" = 996, "Does not answer" = 995, "Not attempt not done" = 994, "Disable to measure" = 993, "Impute" = 992, "CAPI interviewer error" = 991)
datafolder <- "../RData/"
#sing_idlist <- c()
```
<!-- ########################################################## --> 



# Data process




## HRS

### Wave 1

#### Study-specific variable description

| **Name** | `R1LUNGE` |
|-|-|
| **Label** | `R1LUNGE:W1 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w1`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA` |
| **Description** |  |

```{r assign hrs_w1, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w1','HRS.HRS-HRS-w1',variables=list('R1LUNGE'), missings = T)
HRS_hrs_w1 <- opal.execute(o,'HRS_hrs_w1')

```

```{r local hrs_w1, echo=F}

vbl <- HRS_hrs_w1$R1LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w1)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w1, aes(x=factor(R1LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `keep up 0 into 0`
* `NA into 999`



**R script:**

```{r harmo hrs_w1}

# Categorical variable harmonization
HRS_ds_hrs_w1 <- tibble(id=HRS_hrs_w1$id)
HRS_ds_hrs_w1$h_respiratory <- car::recode(HRS_hrs_w1$R1LUNGE, "NA=999")

# We build a global table in order to have updated the status of all the individuals through the different waves
HRS_ds_hrs <- HRS_ds_hrs_w1

```


#### Statistics of the new harmonized variable

```{r descript hrs_w1, echo=F}

vbl <- HRS_ds_hrs_w1$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w1, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation hrs_w1, echo=F}

AfterH <- table(HRS_ds_hrs_w1$h_respiratory, useNA = "ifany")
BeforeH <- table(HRS_hrs_w1$R1LUNGE, useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)
rm(HRS_hrs_w1)

```



### Wave 2

#### Study-specific variable description

| **Name** | `R2LUNGE` |
|-|-|
| **Label** | `R2LUNGE:W2 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w2`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |

```{r assign hrs_w2, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w2','HRS.HRS-HRS-w2',variables=list('R2LUNGE'), missings = T)
HRS_hrs_w2 <- opal.execute(o,'HRS_hrs_w2')

```

```{r local hrs_w2, echo=F}

vbl <- HRS_hrs_w2$R2LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w2, aes(x=factor(R2LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 into 1`
* `otherwise into 999`







**R script:**

```{r harmo hrs_w2}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w2 <- left_join(HRS_hrs_w2, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w2 <- tibble(id=HRS_hrs_w2$id)
HRS_ds_hrs_w2$h_respiratory <- rep(999,length(HRS_hrs_w2$id))
HRS_ds_hrs_w2$h_respiratory[which(((!is.na(HRS_hrs_w2$R2LUNGE)) & HRS_hrs_w2$R2LUNGE == 0) & (HRS_hrs_w2$h_respiratory != 1))] <- 0
HRS_ds_hrs_w2$h_respiratory[which(((!is.na(HRS_hrs_w2$R2LUNGE)) & HRS_hrs_w2$R2LUNGE == 1) | ((!is.na(HRS_hrs_w2$h_respiratory)) & (!is.na(HRS_hrs_w2$R2LUNGE)) & HRS_hrs_w2$h_respiratory == 1))] <- 1

# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w2,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w2$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)

```


#### Statistics of the new harmonized variable

```{r descript hrs_w2, echo=F}

vbl <- HRS_ds_hrs_w2$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w2, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation hrs_w2, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w2$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w2$R2LUNGE)) & HRS_hrs_w2$R2LUNGE == 0) & (HRS_hrs_w2$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w2$R2LUNGE)) & HRS_hrs_w2$R2LUNGE == 1) | ((!is.na(HRS_hrs_w2$h_respiratory)) & (!is.na(HRS_hrs_w2$R2LUNGE)) & HRS_hrs_w2$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w2$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w2)

```




### Wave 3

#### Study-specific variable description

| **Name** | `R3LUNGE` |
|-|-|-|-|-|
| **Label** | `R3LUNGE:W3 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w3`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w3, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w3','HRS.HRS-HRS-w3',variables=list('R3LUNGE'), missings = T)
HRS_hrs_w3 <- opal.execute(o,'HRS_hrs_w3')

```

```{r local hrs_w3, echo=F}

vbl <- HRS_hrs_w3$R3LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w3)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w3, aes(x=factor(R3LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w3}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w3 <- left_join(HRS_hrs_w3, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w3 <- tibble(id=HRS_hrs_w3$id)
HRS_ds_hrs_w3$h_respiratory <- rep(999,length(HRS_hrs_w3$id))
HRS_ds_hrs_w3$h_respiratory[which(((!is.na(HRS_hrs_w3$R3LUNGE)) & HRS_hrs_w3$R3LUNGE == 0) & (HRS_hrs_w3$h_respiratory != 1))] <- 0
HRS_ds_hrs_w3$h_respiratory[which(((!is.na(HRS_hrs_w3$R3LUNGE)) & HRS_hrs_w3$R3LUNGE == 1) | ((!is.na(HRS_hrs_w3$h_respiratory)) & (!is.na(HRS_hrs_w3$R3LUNGE)) & HRS_hrs_w3$h_respiratory == 1))] <- 1

# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w3,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w3$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)

```


#### Statistics of the new harmonized variable

```{r descript hrs_w3, echo=F}

vbl <- HRS_ds_hrs_w3$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w3, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation hrs_w3, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w3$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w3$R3LUNGE)) & HRS_hrs_w3$R3LUNGE == 0) & (HRS_hrs_w3$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w3$R3LUNGE)) & HRS_hrs_w3$R3LUNGE == 1) | ((!is.na(HRS_hrs_w3$h_respiratory)) & (!is.na(HRS_hrs_w3$R3LUNGE)) & HRS_hrs_w3$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w3$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w3)

```




### Wave 4

#### Study-specific variable description

| **Name** | `R4LUNGE` |
|-|-|-|-|-|
| **Label** | `R4LUNGE:W4 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w4`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w4','HRS.HRS-HRS-w4',variables=list('R4LUNGE'), missings = T)
HRS_hrs_w4 <- opal.execute(o,'HRS_hrs_w4')


```

```{r local hrs_w4, echo=F}

vbl <- HRS_hrs_w4$R4LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w4)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w4, aes(x=factor(R4LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w4}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w4 <- left_join(HRS_hrs_w4, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w4 <- tibble(id=HRS_hrs_w4$id)
HRS_ds_hrs_w4$h_respiratory <- rep(999,length(HRS_hrs_w4$id))
HRS_ds_hrs_w4$h_respiratory[which(((!is.na(HRS_hrs_w4$R4LUNGE)) & HRS_hrs_w4$R4LUNGE == 0) & (HRS_hrs_w4$h_respiratory != 1))] <- 0
HRS_ds_hrs_w4$h_respiratory[which(((!is.na(HRS_hrs_w4$R4LUNGE)) & HRS_hrs_w4$R4LUNGE == 1) | ((!is.na(HRS_hrs_w4$h_respiratory)) & (!is.na(HRS_hrs_w4$R4LUNGE)) & HRS_hrs_w4$h_respiratory == 1))] <- 1

# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w4,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w4$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)

```


#### Statistics of the new harmonized variable

```{r descript hrs_w4, echo=F}

vbl <- HRS_ds_hrs_w4$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w4, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation hrs_w4, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w4$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w4$R4LUNGE)) & HRS_hrs_w4$R4LUNGE == 0) & (HRS_hrs_w4$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w4$R4LUNGE)) & HRS_hrs_w4$R4LUNGE == 1) | ((!is.na(HRS_hrs_w4$h_respiratory)) & (!is.na(HRS_hrs_w4$R4LUNGE)) & HRS_hrs_w4$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w4$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w4)

```



### Wave 5

#### Study-specific variable description

| **Name** | `R5LUNGE` |
|-|-|-|-|-|
| **Label** | `R5LUNGE:W5 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w5`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w5','HRS.HRS-HRS-w5',variables=list('R5LUNGE'), missings = T)
HRS_hrs_w5 <- opal.execute(o,'HRS_hrs_w5')

```

```{r local hrs_w5, echo=F}

vbl <- HRS_hrs_w5$R5LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w5)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w5, aes(x=factor(R5LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w5}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w5 <- left_join(HRS_hrs_w5, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w5 <- tibble(id=HRS_hrs_w5$id)
HRS_ds_hrs_w5$h_respiratory <- rep(999,length(HRS_hrs_w5$id))
HRS_ds_hrs_w5$h_respiratory[which(((!is.na(HRS_hrs_w5$R5LUNGE)) & HRS_hrs_w5$R5LUNGE == 0) & (HRS_hrs_w5$h_respiratory != 1))] <- 0
HRS_ds_hrs_w5$h_respiratory[which(((!is.na(HRS_hrs_w5$R5LUNGE)) & HRS_hrs_w5$R5LUNGE == 1) | ((!is.na(HRS_hrs_w5$h_respiratory)) & (!is.na(HRS_hrs_w5$R5LUNGE)) & HRS_hrs_w5$h_respiratory == 1))] <- 1

# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w5,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w5$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)

```


#### Statistics of the new harmonized variable

```{r descript hrs_w5, echo=F}

vbl <- HRS_ds_hrs_w5$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w5, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation hrs_w5, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w5$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w5$R5LUNGE)) & HRS_hrs_w5$R5LUNGE == 0) & (HRS_hrs_w5$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w5$R5LUNGE)) & HRS_hrs_w5$R5LUNGE == 1) | ((!is.na(HRS_hrs_w5$h_respiratory)) & (!is.na(HRS_hrs_w5$R5LUNGE)) & HRS_hrs_w5$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w5$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w5)

```



### Wave 6

#### Study-specific variable description

| **Name** | `R6LUNGE` |
|-|-|-|-|-|
| **Label** | `R6LUNGE:W6 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w6`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w6','HRS.HRS-HRS-w6',variables=list('R6LUNGE'), missings = T)
HRS_hrs_w6 <- opal.execute(o,'HRS_hrs_w6')

```

```{r local hrs_w6, echo=F}

vbl <- HRS_hrs_w6$R6LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w6)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w6, aes(x=factor(R6LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w6}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w6 <- left_join(HRS_hrs_w6, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w6 <- tibble(id=HRS_hrs_w6$id)
HRS_ds_hrs_w6$h_respiratory <- rep(999,length(HRS_hrs_w6$id))
HRS_ds_hrs_w6$h_respiratory[which(((!is.na(HRS_hrs_w6$R6LUNGE)) & HRS_hrs_w6$R6LUNGE == 0) & (HRS_hrs_w6$h_respiratory != 1))] <- 0
HRS_ds_hrs_w6$h_respiratory[which(((!is.na(HRS_hrs_w6$R6LUNGE)) & HRS_hrs_w6$R6LUNGE == 1) | ((!is.na(HRS_hrs_w6$h_respiratory)) & (!is.na(HRS_hrs_w6$R6LUNGE)) & HRS_hrs_w6$h_respiratory == 1))] <- 1

# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w6,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w6$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)

```


#### Statistics of the new harmonized variable

```{r descript hrs_w6, echo=F}

vbl <- HRS_ds_hrs_w6$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w6, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation hrs_w6, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w6$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w6$R6LUNGE)) & HRS_hrs_w6$R6LUNGE == 0) & (HRS_hrs_w6$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w6$R6LUNGE)) & HRS_hrs_w6$R6LUNGE == 1) | ((!is.na(HRS_hrs_w6$h_respiratory)) & (!is.na(HRS_hrs_w6$R6LUNGE)) & HRS_hrs_w6$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w6$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w6)

```




### Wave 7

#### Study-specific variable description

| **Name** | `R7LUNGE` |
|-|-|-|-|-|
| **Label** | `R7LUNGE:W7 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w7`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w7','HRS.HRS-HRS-w7',variables=list('R7LUNGE'), missings = T)
HRS_hrs_w7 <- opal.execute(o,'HRS_hrs_w7')












```

```{r local hrs_w7, echo=F}

vbl <- HRS_hrs_w7$R7LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w7)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w7, aes(x=factor(R7LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w7}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w7 <- left_join(HRS_hrs_w7, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w7 <- tibble(id=HRS_hrs_w7$id)
HRS_ds_hrs_w7$h_respiratory <- rep(999,length(HRS_hrs_w7$id))
HRS_ds_hrs_w7$h_respiratory[which(((!is.na(HRS_hrs_w7$R7LUNGE)) & HRS_hrs_w7$R7LUNGE == 0) & (HRS_hrs_w7$h_respiratory != 1))] <- 0
HRS_ds_hrs_w7$h_respiratory[which(((!is.na(HRS_hrs_w7$R7LUNGE)) & HRS_hrs_w7$R7LUNGE == 1) | ((!is.na(HRS_hrs_w7$h_respiratory)) & (!is.na(HRS_hrs_w7$R7LUNGE)) & HRS_hrs_w7$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w7,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w7$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript hrs_w7, echo=F}

vbl <- HRS_ds_hrs_w7$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w7, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation hrs_w7, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w7$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w7$R7LUNGE)) & HRS_hrs_w7$R7LUNGE == 0) & (HRS_hrs_w7$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w7$R7LUNGE)) & HRS_hrs_w7$R7LUNGE == 1) | ((!is.na(HRS_hrs_w7$h_respiratory)) & (!is.na(HRS_hrs_w7$R7LUNGE)) & HRS_hrs_w7$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w7$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w7)

```



### Wave 8

#### Study-specific variable description

| **Name** | `R8LUNGE` |
|-|-|-|-|-|
| **Label** | `R8LUNGE:W8 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w8`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w8','HRS.HRS-HRS-w8',variables=list('R8LUNGE'), missings = T)
HRS_hrs_w8 <- opal.execute(o,'HRS_hrs_w8')












```

```{r local hrs_w8, echo=F}

vbl <- HRS_hrs_w8$R8LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w8)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w8, aes(x=factor(R8LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w8}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w8 <- left_join(HRS_hrs_w8, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w8 <- tibble(id=HRS_hrs_w8$id)
HRS_ds_hrs_w8$h_respiratory <- rep(999,length(HRS_hrs_w8$id))
HRS_ds_hrs_w8$h_respiratory[which(((!is.na(HRS_hrs_w8$R8LUNGE)) & HRS_hrs_w8$R8LUNGE == 0) & (HRS_hrs_w8$h_respiratory != 1))] <- 0
HRS_ds_hrs_w8$h_respiratory[which(((!is.na(HRS_hrs_w8$R8LUNGE)) & HRS_hrs_w8$R8LUNGE == 1) | ((!is.na(HRS_hrs_w8$h_respiratory)) & (!is.na(HRS_hrs_w8$R8LUNGE)) & HRS_hrs_w8$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w8,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w8$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript hrs_w8, echo=F}

vbl <- HRS_ds_hrs_w8$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w8, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation hrs_w8, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w8$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w8$R8LUNGE)) & HRS_hrs_w8$R8LUNGE == 0) & (HRS_hrs_w8$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w8$R8LUNGE)) & HRS_hrs_w8$R8LUNGE == 1) | ((!is.na(HRS_hrs_w8$h_respiratory)) & (!is.na(HRS_hrs_w8$R8LUNGE)) & HRS_hrs_w8$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w8$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w8)

```



### Wave 9

#### Study-specific variable description

| **Name** | `R9LUNGE` |
|-|-|-|-|-|
| **Label** | `R9LUNGE:W9 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w9`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w9','HRS.HRS-HRS-w9',variables=list('R9LUNGE'), missings = T)
HRS_hrs_w9 <- opal.execute(o,'HRS_hrs_w9')












```

```{r local hrs_w9, echo=F}

vbl <- HRS_hrs_w9$R9LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w9)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w9, aes(x=factor(R9LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w9}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w9 <- left_join(HRS_hrs_w9, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w9 <- tibble(id=HRS_hrs_w9$id)
HRS_ds_hrs_w9$h_respiratory <- rep(999,length(HRS_hrs_w9$id))
HRS_ds_hrs_w9$h_respiratory[which(((!is.na(HRS_hrs_w9$R9LUNGE)) & HRS_hrs_w9$R9LUNGE == 0) & (HRS_hrs_w9$h_respiratory != 1))] <- 0
HRS_ds_hrs_w9$h_respiratory[which(((!is.na(HRS_hrs_w9$R9LUNGE)) & HRS_hrs_w9$R9LUNGE == 1) | ((!is.na(HRS_hrs_w9$h_respiratory)) & (!is.na(HRS_hrs_w9$R9LUNGE)) & HRS_hrs_w9$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w9,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w9$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript hrs_w9, echo=F}

vbl <- HRS_ds_hrs_w9$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w9, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation hrs_w9, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w9$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w9$R9LUNGE)) & HRS_hrs_w9$R9LUNGE == 0) & (HRS_hrs_w9$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w9$R9LUNGE)) & HRS_hrs_w9$R9LUNGE == 1) | ((!is.na(HRS_hrs_w9$h_respiratory)) & (!is.na(HRS_hrs_w9$R9LUNGE)) & HRS_hrs_w9$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w9$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w9)

```




### Wave 10

#### Study-specific variable description

| **Name** | `R10LUNGE` |
|-|-|-|-|-|
| **Label** | `R10LUNGE:W10 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w10`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w10','HRS.HRS-HRS-w10',variables=list('R10LUNGE'), missings = T)
HRS_hrs_w10 <- opal.execute(o,'HRS_hrs_w10')












```

```{r local hrs_w10, echo=F}

vbl <- HRS_hrs_w10$R10LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w10)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w10, aes(x=factor(R10LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w10}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w10 <- left_join(HRS_hrs_w10, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w10 <- tibble(id=HRS_hrs_w10$id)
HRS_ds_hrs_w10$h_respiratory <- rep(999,length(HRS_hrs_w10$id))
HRS_ds_hrs_w10$h_respiratory[which(((!is.na(HRS_hrs_w10$R10LUNGE)) & HRS_hrs_w10$R10LUNGE == 0) & (HRS_hrs_w10$h_respiratory != 1))] <- 0
HRS_ds_hrs_w10$h_respiratory[which(((!is.na(HRS_hrs_w10$R10LUNGE)) & HRS_hrs_w10$R10LUNGE == 1) | ((!is.na(HRS_hrs_w10$h_respiratory)) & (!is.na(HRS_hrs_w10$R10LUNGE)) & HRS_hrs_w10$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_hrs[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_hrs_w10,log_vec=(HRS_ds_prov$id %in% HRS_ds_hrs_w10$id),col_end_index = 2, col_st_index = 3)
HRS_ds_hrs$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript hrs_w10, echo=F}

vbl <- HRS_ds_hrs_w10$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w10, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation hrs_w10, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w10$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w10$R10LUNGE)) & HRS_hrs_w10$R10LUNGE == 0) & (HRS_hrs_w10$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w10$R10LUNGE)) & HRS_hrs_w10$R10LUNGE == 1) | ((!is.na(HRS_hrs_w10$h_respiratory)) & (!is.na(HRS_hrs_w10$R10LUNGE)) & HRS_hrs_w10$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w10$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w10)

```



### Wave 11

#### Study-specific variable description

| **Name** | `R11LUNGE` |
|-|-|-|-|-|
| **Label** | `R11LUNGE:W11 R ever had lung disease`|
| **Table name**  | `HRS-HRS-w11`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|
| **Description** |  |  |  |  |

```{r assign hrs_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_hrs_w11','HRS.HRS-HRS-w11',variables=list('R11LUNGE'), missings = T)
HRS_hrs_w11 <- opal.execute(o,'HRS_hrs_w11')












```

```{r local hrs_w11, echo=F}

vbl <- HRS_hrs_w11$R11LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_hrs_w11)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_hrs_w11, aes(x=factor(R11LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R1LUNGE == 0 and R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 and R11LUNGE == 0 into 0`
* `R1LUNGE == 1 or R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 or R11LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo hrs_w11}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_hrs_w11 <- left_join(HRS_hrs_w11, HRS_ds_hrs, by = "id")

# Categorical variable harmonization
HRS_ds_hrs_w11 <- tibble(id=HRS_hrs_w11$id)
HRS_ds_hrs_w11$h_respiratory <- rep(999,length(HRS_hrs_w11$id))
HRS_ds_hrs_w11$h_respiratory[which(((!is.na(HRS_hrs_w11$R11LUNGE)) & HRS_hrs_w11$R11LUNGE == 0) & (HRS_hrs_w11$h_respiratory != 1))] <- 0
HRS_ds_hrs_w11$h_respiratory[which(((!is.na(HRS_hrs_w11$R11LUNGE)) & HRS_hrs_w11$R11LUNGE == 1) | ((!is.na(HRS_hrs_w11$h_respiratory)) & (!is.na(HRS_hrs_w11$R11LUNGE)) & HRS_hrs_w11$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
rm(HRS_ds_hrs)

```


#### Statistics of the new harmonized variable

```{r descript hrs_w11, echo=F}

vbl <- HRS_ds_hrs_w11$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_hrs_w11, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation hrs_w11, echo=F, results='asis'}

AfterH <- table(HRS_ds_hrs_w11$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_hrs_w11$R11LUNGE)) & HRS_hrs_w11$R11LUNGE == 0) & (HRS_hrs_w11$h_respiratory != 1)),
  sum(((!is.na(HRS_hrs_w11$R11LUNGE)) & HRS_hrs_w11$R11LUNGE == 1) | ((!is.na(HRS_hrs_w11$h_respiratory)) & (!is.na(HRS_hrs_w11$R11LUNGE)) & HRS_hrs_w11$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_hrs_w11$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_hrs_w11)

```



## AHEAD


### Wave 2

#### Study-specific variable description

| **Name** | `R2LUNGE` |
|-|-|
| **Label** | `R2LUNGE:W2 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w2`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA` |
| **Description** |  |

```{r assign ahead_w2, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w2','HRS.HRS-AHEAD-w2',variables=list('R2LUNGE'), missings = T)
HRS_ahead_w2 <- opal.execute(o,'HRS_ahead_w2')

```

```{r local ahead_w2, echo=F}

vbl <- HRS_ahead_w2$R2LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w2, aes(x=factor(R2LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `keep up 0 into 0`
* `NA into 999`



**R script:**

```{r harmo ahead_w2}

# Categorical variable harmonization
HRS_ds_ahead_w2 <- tibble(id=HRS_ahead_w2$id)
HRS_ds_ahead_w2$h_respiratory <- car::recode(HRS_ahead_w2$R2LUNGE, "NA=999")

# We build a global table in order to have updated the status of all the individuals through the different waves
HRS_ds_ahead <- HRS_ds_ahead_w2


```


#### Statistics of the new harmonized variable

```{r descript ahead_w2, echo=F}

vbl <- HRS_ds_ahead_w2$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w2, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation ahead_w2, echo=F}

AfterH <- table(HRS_ds_ahead_w2$h_respiratory, useNA = "ifany")
BeforeH <- table(HRS_ahead_w2$R2LUNGE, useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)
rm(HRS_ahead_w2)

```



### Wave 3

#### Study-specific variable description

| **Name** | `R3LUNGE` |
|-|-|-|-|-|
| **Label** | `R3LUNGE:W3 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w3`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w3, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w3','HRS.HRS-AHEAD-w3',variables=list('R3LUNGE'), missings = T)
HRS_ahead_w3 <- opal.execute(o,'HRS_ahead_w3')












```

```{r local ahead_w3, echo=F}

vbl <- HRS_ahead_w3$R3LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w3)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w3, aes(x=factor(R3LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 into 1`
* `otherwise into 999`







**R script:**

```{r harmo ahead_w3}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w3 <- left_join(HRS_ahead_w3, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w3 <- tibble(id=HRS_ahead_w3$id)
HRS_ds_ahead_w3$h_respiratory <- rep(999,length(HRS_ahead_w3$id))
HRS_ds_ahead_w3$h_respiratory[which(((!is.na(HRS_ahead_w3$R3LUNGE)) & HRS_ahead_w3$R3LUNGE == 0) & (HRS_ahead_w3$h_respiratory != 1))] <- 0
HRS_ds_ahead_w3$h_respiratory[which(((!is.na(HRS_ahead_w3$R3LUNGE)) & HRS_ahead_w3$R3LUNGE == 1) | ((!is.na(HRS_ahead_w3$h_respiratory)) & (!is.na(HRS_ahead_w3$R3LUNGE)) & HRS_ahead_w3$h_respiratory == 1))] <- 1






# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w3,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w3$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w3, echo=F}

vbl <- HRS_ds_ahead_w3$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w3, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w3, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w3$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w3$R3LUNGE)) & HRS_ahead_w3$R3LUNGE == 0) & (HRS_ahead_w3$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w3$R3LUNGE)) & HRS_ahead_w3$R3LUNGE == 1) | ((!is.na(HRS_ahead_w3$h_respiratory)) & (!is.na(HRS_ahead_w3$R3LUNGE)) & HRS_ahead_w3$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w3$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w3)

```




### Wave 4

#### Study-specific variable description

| **Name** | `R4LUNGE` |
|-|-|-|-|-|
| **Label** | `R4LUNGE:W4 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w4`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w4','HRS.HRS-AHEAD-w4',variables=list('R4LUNGE'), missings = T)
HRS_ahead_w4 <- opal.execute(o,'HRS_ahead_w4')












```

```{r local ahead_w4, echo=F}

vbl <- HRS_ahead_w4$R4LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w4)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w4, aes(x=factor(R4LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w4}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w4 <- left_join(HRS_ahead_w4, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w4 <- tibble(id=HRS_ahead_w4$id)
HRS_ds_ahead_w4$h_respiratory <- rep(999,length(HRS_ahead_w4$id))
HRS_ds_ahead_w4$h_respiratory[which(((!is.na(HRS_ahead_w4$R4LUNGE)) & HRS_ahead_w4$R4LUNGE == 0) & (HRS_ahead_w4$h_respiratory != 1))] <- 0
HRS_ds_ahead_w4$h_respiratory[which(((!is.na(HRS_ahead_w4$R4LUNGE)) & HRS_ahead_w4$R4LUNGE == 1) | ((!is.na(HRS_ahead_w4$h_respiratory)) & (!is.na(HRS_ahead_w4$R4LUNGE)) & HRS_ahead_w4$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w4,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w4$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w4, echo=F}

vbl <- HRS_ds_ahead_w4$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w4, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w4, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w4$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w4$R4LUNGE)) & HRS_ahead_w4$R4LUNGE == 0) & (HRS_ahead_w4$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w4$R4LUNGE)) & HRS_ahead_w4$R4LUNGE == 1) | ((!is.na(HRS_ahead_w4$h_respiratory)) & (!is.na(HRS_ahead_w4$R4LUNGE)) & HRS_ahead_w4$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w4$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w4)

```




### Wave 5

#### Study-specific variable description

| **Name** | `R5LUNGE` |
|-|-|-|-|-|
| **Label** | `R5LUNGE:W5 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w5`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w5','HRS.HRS-AHEAD-w5',variables=list('R5LUNGE'), missings = T)
HRS_ahead_w5 <- opal.execute(o,'HRS_ahead_w5')












```

```{r local ahead_w5, echo=F}

vbl <- HRS_ahead_w5$R5LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w5)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w5, aes(x=factor(R5LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w5}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w5 <- left_join(HRS_ahead_w5, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w5 <- tibble(id=HRS_ahead_w5$id)
HRS_ds_ahead_w5$h_respiratory <- rep(999,length(HRS_ahead_w5$id))
HRS_ds_ahead_w5$h_respiratory[which(((!is.na(HRS_ahead_w5$R5LUNGE)) & HRS_ahead_w5$R5LUNGE == 0) & (HRS_ahead_w5$h_respiratory != 1))] <- 0
HRS_ds_ahead_w5$h_respiratory[which(((!is.na(HRS_ahead_w5$R5LUNGE)) & HRS_ahead_w5$R5LUNGE == 1) | ((!is.na(HRS_ahead_w5$h_respiratory)) & (!is.na(HRS_ahead_w5$R5LUNGE)) & HRS_ahead_w5$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w5,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w5$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w5, echo=F}

vbl <- HRS_ds_ahead_w5$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w5, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w5, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w5$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w5$R5LUNGE)) & HRS_ahead_w5$R5LUNGE == 0) & (HRS_ahead_w5$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w5$R5LUNGE)) & HRS_ahead_w5$R5LUNGE == 1) | ((!is.na(HRS_ahead_w5$h_respiratory)) & (!is.na(HRS_ahead_w5$R5LUNGE)) & HRS_ahead_w5$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w5$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w5)

```



### Wave 6

#### Study-specific variable description

| **Name** | `R6LUNGE` |
|-|-|-|-|-|
| **Label** | `R6LUNGE:W6 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w6`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w6','HRS.HRS-AHEAD-w6',variables=list('R6LUNGE'), missings = T)
HRS_ahead_w6 <- opal.execute(o,'HRS_ahead_w6')












```

```{r local ahead_w6, echo=F}

vbl <- HRS_ahead_w6$R6LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w6)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w6, aes(x=factor(R6LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w6}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w6 <- left_join(HRS_ahead_w6, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w6 <- tibble(id=HRS_ahead_w6$id)
HRS_ds_ahead_w6$h_respiratory <- rep(999,length(HRS_ahead_w6$id))
HRS_ds_ahead_w6$h_respiratory[which(((!is.na(HRS_ahead_w6$R6LUNGE)) & HRS_ahead_w6$R6LUNGE == 0) & (HRS_ahead_w6$h_respiratory != 1))] <- 0
HRS_ds_ahead_w6$h_respiratory[which(((!is.na(HRS_ahead_w6$R6LUNGE)) & HRS_ahead_w6$R6LUNGE == 1) | ((!is.na(HRS_ahead_w6$h_respiratory)) & (!is.na(HRS_ahead_w6$R6LUNGE)) & HRS_ahead_w6$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w6,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w6$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w6, echo=F}

vbl <- HRS_ds_ahead_w6$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w6, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w6, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w6$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w6$R6LUNGE)) & HRS_ahead_w6$R6LUNGE == 0) & (HRS_ahead_w6$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w6$R6LUNGE)) & HRS_ahead_w6$R6LUNGE == 1) | ((!is.na(HRS_ahead_w6$h_respiratory)) & (!is.na(HRS_ahead_w6$R6LUNGE)) & HRS_ahead_w6$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w6$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w6)

```



### Wave 7

#### Study-specific variable description

| **Name** | `R7LUNGE` |
|-|-|-|-|-|
| **Label** | `R7LUNGE:W7 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w7`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w7','HRS.HRS-AHEAD-w7',variables=list('R7LUNGE'), missings = T)
HRS_ahead_w7 <- opal.execute(o,'HRS_ahead_w7')












```

```{r local ahead_w7, echo=F}

vbl <- HRS_ahead_w7$R7LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w7)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w7, aes(x=factor(R7LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w7}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w7 <- left_join(HRS_ahead_w7, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w7 <- tibble(id=HRS_ahead_w7$id)
HRS_ds_ahead_w7$h_respiratory <- rep(999,length(HRS_ahead_w7$id))
HRS_ds_ahead_w7$h_respiratory[which(((!is.na(HRS_ahead_w7$R7LUNGE)) & HRS_ahead_w7$R7LUNGE == 0) & (HRS_ahead_w7$h_respiratory != 1))] <- 0
HRS_ds_ahead_w7$h_respiratory[which(((!is.na(HRS_ahead_w7$R7LUNGE)) & HRS_ahead_w7$R7LUNGE == 1) | ((!is.na(HRS_ahead_w7$h_respiratory)) & (!is.na(HRS_ahead_w7$R7LUNGE)) & HRS_ahead_w7$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w7,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w7$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w7, echo=F}

vbl <- HRS_ds_ahead_w7$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w7, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w7, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w7$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w7$R7LUNGE)) & HRS_ahead_w7$R7LUNGE == 0) & (HRS_ahead_w7$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w7$R7LUNGE)) & HRS_ahead_w7$R7LUNGE == 1) | ((!is.na(HRS_ahead_w7$h_respiratory)) & (!is.na(HRS_ahead_w7$R7LUNGE)) & HRS_ahead_w7$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w7$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w7)

```




### Wave 8

#### Study-specific variable description

| **Name** | `R8LUNGE` |
|-|-|-|-|-|
| **Label** | `R8LUNGE:W8 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w8`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w8','HRS.HRS-AHEAD-w8',variables=list('R8LUNGE'), missings = T)
HRS_ahead_w8 <- opal.execute(o,'HRS_ahead_w8')












```

```{r local ahead_w8, echo=F}

vbl <- HRS_ahead_w8$R8LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w8)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w8, aes(x=factor(R8LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w8}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w8 <- left_join(HRS_ahead_w8, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w8 <- tibble(id=HRS_ahead_w8$id)
HRS_ds_ahead_w8$h_respiratory <- rep(999,length(HRS_ahead_w8$id))
HRS_ds_ahead_w8$h_respiratory[which(((!is.na(HRS_ahead_w8$R8LUNGE)) & HRS_ahead_w8$R8LUNGE == 0) & (HRS_ahead_w8$h_respiratory != 1))] <- 0
HRS_ds_ahead_w8$h_respiratory[which(((!is.na(HRS_ahead_w8$R8LUNGE)) & HRS_ahead_w8$R8LUNGE == 1) | ((!is.na(HRS_ahead_w8$h_respiratory)) & (!is.na(HRS_ahead_w8$R8LUNGE)) & HRS_ahead_w8$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w8,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w8$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w8, echo=F}

vbl <- HRS_ds_ahead_w8$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w8, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w8, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w8$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w8$R8LUNGE)) & HRS_ahead_w8$R8LUNGE == 0) & (HRS_ahead_w8$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w8$R8LUNGE)) & HRS_ahead_w8$R8LUNGE == 1) | ((!is.na(HRS_ahead_w8$h_respiratory)) & (!is.na(HRS_ahead_w8$R8LUNGE)) & HRS_ahead_w8$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w8$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w8)

```



### Wave 9

#### Study-specific variable description

| **Name** | `R9LUNGE` |
|-|-|-|-|-|
| **Label** | `R9LUNGE:W9 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w9`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w9','HRS.HRS-AHEAD-w9',variables=list('R9LUNGE'), missings = T)
HRS_ahead_w9 <- opal.execute(o,'HRS_ahead_w9')












```

```{r local ahead_w9, echo=F}

vbl <- HRS_ahead_w9$R9LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w9)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w9, aes(x=factor(R9LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w9}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w9 <- left_join(HRS_ahead_w9, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w9 <- tibble(id=HRS_ahead_w9$id)
HRS_ds_ahead_w9$h_respiratory <- rep(999,length(HRS_ahead_w9$id))
HRS_ds_ahead_w9$h_respiratory[which(((!is.na(HRS_ahead_w9$R9LUNGE)) & HRS_ahead_w9$R9LUNGE == 0) & (HRS_ahead_w9$h_respiratory != 1))] <- 0
HRS_ds_ahead_w9$h_respiratory[which(((!is.na(HRS_ahead_w9$R9LUNGE)) & HRS_ahead_w9$R9LUNGE == 1) | ((!is.na(HRS_ahead_w9$h_respiratory)) & (!is.na(HRS_ahead_w9$R9LUNGE)) & HRS_ahead_w9$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w9,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w9$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w9, echo=F}

vbl <- HRS_ds_ahead_w9$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w9, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w9, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w9$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w9$R9LUNGE)) & HRS_ahead_w9$R9LUNGE == 0) & (HRS_ahead_w9$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w9$R9LUNGE)) & HRS_ahead_w9$R9LUNGE == 1) | ((!is.na(HRS_ahead_w9$h_respiratory)) & (!is.na(HRS_ahead_w9$R9LUNGE)) & HRS_ahead_w9$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w9$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w9)

```



### Wave 10

#### Study-specific variable description

| **Name** | `R10LUNGE` |
|-|-|-|-|-|
| **Label** | `R10LUNGE:W10 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w10`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w10','HRS.HRS-AHEAD-w10',variables=list('R10LUNGE'), missings = T)
HRS_ahead_w10 <- opal.execute(o,'HRS_ahead_w10')












```

```{r local ahead_w10, echo=F}

vbl <- HRS_ahead_w10$R10LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w10)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w10, aes(x=factor(R10LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w10}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w10 <- left_join(HRS_ahead_w10, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w10 <- tibble(id=HRS_ahead_w10$id)
HRS_ds_ahead_w10$h_respiratory <- rep(999,length(HRS_ahead_w10$id))
HRS_ds_ahead_w10$h_respiratory[which(((!is.na(HRS_ahead_w10$R10LUNGE)) & HRS_ahead_w10$R10LUNGE == 0) & (HRS_ahead_w10$h_respiratory != 1))] <- 0
HRS_ds_ahead_w10$h_respiratory[which(((!is.na(HRS_ahead_w10$R10LUNGE)) & HRS_ahead_w10$R10LUNGE == 1) | ((!is.na(HRS_ahead_w10$h_respiratory)) & (!is.na(HRS_ahead_w10$R10LUNGE)) & HRS_ahead_w10$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ahead[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ahead_w10,log_vec=(HRS_ds_prov$id %in% HRS_ds_ahead_w10$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ahead$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ahead_w10, echo=F}

vbl <- HRS_ds_ahead_w10$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w10, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w10, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w10$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w10$R10LUNGE)) & HRS_ahead_w10$R10LUNGE == 0) & (HRS_ahead_w10$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w10$R10LUNGE)) & HRS_ahead_w10$R10LUNGE == 1) | ((!is.na(HRS_ahead_w10$h_respiratory)) & (!is.na(HRS_ahead_w10$R10LUNGE)) & HRS_ahead_w10$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w10$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w10)

```




### Wave 11

#### Study-specific variable description

| **Name** | `R11LUNGE` |
|-|-|-|-|-|
| **Label** | `R11LUNGE:W11 R ever had lung disease`|
| **Table name**  | `HRS-AHEAD-w11`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ahead_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_ahead_w11','HRS.HRS-AHEAD-w11',variables=list('R11LUNGE'), missings = T)
HRS_ahead_w11 <- opal.execute(o,'HRS_ahead_w11')












```

```{r local ahead_w11, echo=F}

vbl <- HRS_ahead_w11$R11LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ahead_w11)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ahead_w11, aes(x=factor(R11LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R2LUNGE == 0 and R3LUNGE == 0 and R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 and R11LUNGE == 0 into 0`
* `R2LUNGE == 1 or R3LUNGE == 1 or R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 or R11LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ahead_w11}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ahead_w11 <- left_join(HRS_ahead_w11, HRS_ds_ahead, by = "id")

# Categorical variable harmonization
HRS_ds_ahead_w11 <- tibble(id=HRS_ahead_w11$id)
HRS_ds_ahead_w11$h_respiratory <- rep(999,length(HRS_ahead_w11$id))
HRS_ds_ahead_w11$h_respiratory[which(((!is.na(HRS_ahead_w11$R11LUNGE)) & HRS_ahead_w11$R11LUNGE == 0) & (HRS_ahead_w11$h_respiratory != 1))] <- 0
HRS_ds_ahead_w11$h_respiratory[which(((!is.na(HRS_ahead_w11$R11LUNGE)) & HRS_ahead_w11$R11LUNGE == 1) | ((!is.na(HRS_ahead_w11$h_respiratory)) & (!is.na(HRS_ahead_w11$R11LUNGE)) & HRS_ahead_w11$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
rm(HRS_ds_ahead)

```


#### Statistics of the new harmonized variable

```{r descript ahead_w11, echo=F}

vbl <- HRS_ds_ahead_w11$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ahead_w11, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ahead_w11, echo=F, results='asis'}

AfterH <- table(HRS_ds_ahead_w11$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ahead_w11$R11LUNGE)) & HRS_ahead_w11$R11LUNGE == 0) & (HRS_ahead_w11$h_respiratory != 1)),
  sum(((!is.na(HRS_ahead_w11$R11LUNGE)) & HRS_ahead_w11$R11LUNGE == 1) | ((!is.na(HRS_ahead_w11$h_respiratory)) & (!is.na(HRS_ahead_w11$R11LUNGE)) & HRS_ahead_w11$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ahead_w11$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ahead_w11)

```



## CODA

### Wave 4

#### Study-specific variable description

| **Name** | `R4LUNGE` |
|-|-|
| **Label** | `R4LUNGE:W4 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w4`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA` |
| **Description** |  |

```{r assign coda_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w4','HRS.HRS-CODA-w4',variables=list('R4LUNGE'), missings = T)
HRS_coda_w4 <- opal.execute(o,'HRS_coda_w4')

```

```{r local coda_w4, echo=F}

vbl <- HRS_coda_w4$R4LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w4)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w4, aes(x=factor(R4LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `keep up 0 into 0`
* `NA into 999`



**R script:**

```{r harmo coda_w4}

# Categorical variable harmonization
HRS_ds_coda_w4 <- tibble(id=HRS_coda_w4$id)
HRS_ds_coda_w4$h_respiratory <- car::recode(HRS_coda_w4$R4LUNGE, "NA=999")

# We build a global table in order to have updated the status of all the individuals through the different waves
HRS_ds_coda <- HRS_ds_coda_w4


```


#### Statistics of the new harmonized variable

```{r descript coda_w4, echo=F}

vbl <- HRS_ds_coda_w4$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w4, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation coda_w4, echo=F}

AfterH <- table(HRS_ds_coda_w4$h_respiratory, useNA = "ifany")
BeforeH <- table(HRS_coda_w4$R4LUNGE, useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)
rm(HRS_coda_w4)

```



### Wave 5

#### Study-specific variable description

| **Name** | `R5LUNGE` |
|-|-|-|-|-|
| **Label** | `R5LUNGE:W5 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w5`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign coda_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w5','HRS.HRS-CODA-w5',variables=list('R5LUNGE'), missings = T)
HRS_coda_w5 <- opal.execute(o,'HRS_coda_w5')












```

```{r local coda_w5, echo=F}

vbl <- HRS_coda_w5$R5LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w5)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w5, aes(x=factor(R5LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 into 1`
* `otherwise into 999`







**R script:**

```{r harmo coda_w5}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_coda_w5 <- left_join(HRS_coda_w5, HRS_ds_coda, by = "id")

# Categorical variable harmonization
HRS_ds_coda_w5 <- tibble(id=HRS_coda_w5$id)
HRS_ds_coda_w5$h_respiratory <- rep(999,length(HRS_coda_w5$id))
HRS_ds_coda_w5$h_respiratory[which(((!is.na(HRS_coda_w5$R5LUNGE)) & HRS_coda_w5$R5LUNGE == 0) & (HRS_coda_w5$h_respiratory != 1))] <- 0
HRS_ds_coda_w5$h_respiratory[which(((!is.na(HRS_coda_w5$R5LUNGE)) & HRS_coda_w5$R5LUNGE == 1) | ((!is.na(HRS_coda_w5$h_respiratory)) & (!is.na(HRS_coda_w5$R5LUNGE)) & HRS_coda_w5$h_respiratory == 1))] <- 1






# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_coda[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_coda_w5,log_vec=(HRS_ds_prov$id %in% HRS_ds_coda_w5$id),col_end_index = 2, col_st_index = 3)
HRS_ds_coda$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript coda_w5, echo=F}

vbl <- HRS_ds_coda_w5$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w5, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation coda_w5, echo=F, results='asis'}

AfterH <- table(HRS_ds_coda_w5$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_coda_w5$R5LUNGE)) & HRS_coda_w5$R5LUNGE == 0) & (HRS_coda_w5$h_respiratory != 1)),
  sum(((!is.na(HRS_coda_w5$R5LUNGE)) & HRS_coda_w5$R5LUNGE == 1) | ((!is.na(HRS_coda_w5$h_respiratory)) & (!is.na(HRS_coda_w5$R5LUNGE)) & HRS_coda_w5$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_coda_w5$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_coda_w5)

```




### Wave 6

#### Study-specific variable description

| **Name** | `R6LUNGE` |
|-|-|-|-|-|
| **Label** | `R6LUNGE:W6 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w6`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign coda_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w6','HRS.HRS-CODA-w6',variables=list('R6LUNGE'), missings = T)
HRS_coda_w6 <- opal.execute(o,'HRS_coda_w6')












```

```{r local coda_w6, echo=F}

vbl <- HRS_coda_w6$R6LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w6)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w6, aes(x=factor(R6LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo coda_w6}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_coda_w6 <- left_join(HRS_coda_w6, HRS_ds_coda, by = "id")

# Categorical variable harmonization
HRS_ds_coda_w6 <- tibble(id=HRS_coda_w6$id)
HRS_ds_coda_w6$h_respiratory <- rep(999,length(HRS_coda_w6$id))
HRS_ds_coda_w6$h_respiratory[which(((!is.na(HRS_coda_w6$R6LUNGE)) & HRS_coda_w6$R6LUNGE == 0) & (HRS_coda_w6$h_respiratory != 1))] <- 0
HRS_ds_coda_w6$h_respiratory[which(((!is.na(HRS_coda_w6$R6LUNGE)) & HRS_coda_w6$R6LUNGE == 1) | ((!is.na(HRS_coda_w6$h_respiratory)) & (!is.na(HRS_coda_w6$R6LUNGE)) & HRS_coda_w6$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_coda[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_coda_w6,log_vec=(HRS_ds_prov$id %in% HRS_ds_coda_w6$id),col_end_index = 2, col_st_index = 3)
HRS_ds_coda$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript coda_w6, echo=F}

vbl <- HRS_ds_coda_w6$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w6, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation coda_w6, echo=F, results='asis'}

AfterH <- table(HRS_ds_coda_w6$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_coda_w6$R6LUNGE)) & HRS_coda_w6$R6LUNGE == 0) & (HRS_coda_w6$h_respiratory != 1)),
  sum(((!is.na(HRS_coda_w6$R6LUNGE)) & HRS_coda_w6$R6LUNGE == 1) | ((!is.na(HRS_coda_w6$h_respiratory)) & (!is.na(HRS_coda_w6$R6LUNGE)) & HRS_coda_w6$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_coda_w6$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_coda_w6)

```




### Wave 7

#### Study-specific variable description

| **Name** | `R7LUNGE` |
|-|-|-|-|-|
| **Label** | `R7LUNGE:W7 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w7`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign coda_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w7','HRS.HRS-CODA-w7',variables=list('R7LUNGE'), missings = T)
HRS_coda_w7 <- opal.execute(o,'HRS_coda_w7')












```

```{r local coda_w7, echo=F}

vbl <- HRS_coda_w7$R7LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w7)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w7, aes(x=factor(R7LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo coda_w7}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_coda_w7 <- left_join(HRS_coda_w7, HRS_ds_coda, by = "id")

# Categorical variable harmonization
HRS_ds_coda_w7 <- tibble(id=HRS_coda_w7$id)
HRS_ds_coda_w7$h_respiratory <- rep(999,length(HRS_coda_w7$id))
HRS_ds_coda_w7$h_respiratory[which(((!is.na(HRS_coda_w7$R7LUNGE)) & HRS_coda_w7$R7LUNGE == 0) & (HRS_coda_w7$h_respiratory != 1))] <- 0
HRS_ds_coda_w7$h_respiratory[which(((!is.na(HRS_coda_w7$R7LUNGE)) & HRS_coda_w7$R7LUNGE == 1) | ((!is.na(HRS_coda_w7$h_respiratory)) & (!is.na(HRS_coda_w7$R7LUNGE)) & HRS_coda_w7$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_coda[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_coda_w7,log_vec=(HRS_ds_prov$id %in% HRS_ds_coda_w7$id),col_end_index = 2, col_st_index = 3)
HRS_ds_coda$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript coda_w7, echo=F}

vbl <- HRS_ds_coda_w7$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w7, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation coda_w7, echo=F, results='asis'}

AfterH <- table(HRS_ds_coda_w7$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_coda_w7$R7LUNGE)) & HRS_coda_w7$R7LUNGE == 0) & (HRS_coda_w7$h_respiratory != 1)),
  sum(((!is.na(HRS_coda_w7$R7LUNGE)) & HRS_coda_w7$R7LUNGE == 1) | ((!is.na(HRS_coda_w7$h_respiratory)) & (!is.na(HRS_coda_w7$R7LUNGE)) & HRS_coda_w7$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_coda_w7$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_coda_w7)

```



### Wave 8

#### Study-specific variable description

| **Name** | `R8LUNGE` |
|-|-|-|-|-|
| **Label** | `R8LUNGE:W8 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w8`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign coda_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w8','HRS.HRS-CODA-w8',variables=list('R8LUNGE'), missings = T)
HRS_coda_w8 <- opal.execute(o,'HRS_coda_w8')












```

```{r local coda_w8, echo=F}

vbl <- HRS_coda_w8$R8LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w8)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w8, aes(x=factor(R8LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo coda_w8}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_coda_w8 <- left_join(HRS_coda_w8, HRS_ds_coda, by = "id")

# Categorical variable harmonization
HRS_ds_coda_w8 <- tibble(id=HRS_coda_w8$id)
HRS_ds_coda_w8$h_respiratory <- rep(999,length(HRS_coda_w8$id))
HRS_ds_coda_w8$h_respiratory[which(((!is.na(HRS_coda_w8$R8LUNGE)) & HRS_coda_w8$R8LUNGE == 0) & (HRS_coda_w8$h_respiratory != 1))] <- 0
HRS_ds_coda_w8$h_respiratory[which(((!is.na(HRS_coda_w8$R8LUNGE)) & HRS_coda_w8$R8LUNGE == 1) | ((!is.na(HRS_coda_w8$h_respiratory)) & (!is.na(HRS_coda_w8$R8LUNGE)) & HRS_coda_w8$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_coda[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_coda_w8,log_vec=(HRS_ds_prov$id %in% HRS_ds_coda_w8$id),col_end_index = 2, col_st_index = 3)
HRS_ds_coda$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript coda_w8, echo=F}

vbl <- HRS_ds_coda_w8$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w8, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation coda_w8, echo=F, results='asis'}

AfterH <- table(HRS_ds_coda_w8$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_coda_w8$R8LUNGE)) & HRS_coda_w8$R8LUNGE == 0) & (HRS_coda_w8$h_respiratory != 1)),
  sum(((!is.na(HRS_coda_w8$R8LUNGE)) & HRS_coda_w8$R8LUNGE == 1) | ((!is.na(HRS_coda_w8$h_respiratory)) & (!is.na(HRS_coda_w8$R8LUNGE)) & HRS_coda_w8$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_coda_w8$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_coda_w8)

```



### Wave 9

#### Study-specific variable description

| **Name** | `R9LUNGE` |
|-|-|-|-|-|
| **Label** | `R9LUNGE:W9 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w9`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign coda_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w9','HRS.HRS-CODA-w9',variables=list('R9LUNGE'), missings = T)
HRS_coda_w9 <- opal.execute(o,'HRS_coda_w9')












```

```{r local coda_w9, echo=F}

vbl <- HRS_coda_w9$R9LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w9)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w9, aes(x=factor(R9LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo coda_w9}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_coda_w9 <- left_join(HRS_coda_w9, HRS_ds_coda, by = "id")

# Categorical variable harmonization
HRS_ds_coda_w9 <- tibble(id=HRS_coda_w9$id)
HRS_ds_coda_w9$h_respiratory <- rep(999,length(HRS_coda_w9$id))
HRS_ds_coda_w9$h_respiratory[which(((!is.na(HRS_coda_w9$R9LUNGE)) & HRS_coda_w9$R9LUNGE == 0) & (HRS_coda_w9$h_respiratory != 1))] <- 0
HRS_ds_coda_w9$h_respiratory[which(((!is.na(HRS_coda_w9$R9LUNGE)) & HRS_coda_w9$R9LUNGE == 1) | ((!is.na(HRS_coda_w9$h_respiratory)) & (!is.na(HRS_coda_w9$R9LUNGE)) & HRS_coda_w9$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_coda[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_coda_w9,log_vec=(HRS_ds_prov$id %in% HRS_ds_coda_w9$id),col_end_index = 2, col_st_index = 3)
HRS_ds_coda$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript coda_w9, echo=F}

vbl <- HRS_ds_coda_w9$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w9, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation coda_w9, echo=F, results='asis'}

AfterH <- table(HRS_ds_coda_w9$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_coda_w9$R9LUNGE)) & HRS_coda_w9$R9LUNGE == 0) & (HRS_coda_w9$h_respiratory != 1)),
  sum(((!is.na(HRS_coda_w9$R9LUNGE)) & HRS_coda_w9$R9LUNGE == 1) | ((!is.na(HRS_coda_w9$h_respiratory)) & (!is.na(HRS_coda_w9$R9LUNGE)) & HRS_coda_w9$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_coda_w9$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_coda_w9)

```




### Wave 10

#### Study-specific variable description

| **Name** | `R10LUNGE` |
|-|-|-|-|-|
| **Label** | `R10LUNGE:W10 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w10`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign coda_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w10','HRS.HRS-CODA-w10',variables=list('R10LUNGE'), missings = T)
HRS_coda_w10 <- opal.execute(o,'HRS_coda_w10')












```

```{r local coda_w10, echo=F}

vbl <- HRS_coda_w10$R10LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w10)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w10, aes(x=factor(R10LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo coda_w10}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_coda_w10 <- left_join(HRS_coda_w10, HRS_ds_coda, by = "id")

# Categorical variable harmonization
HRS_ds_coda_w10 <- tibble(id=HRS_coda_w10$id)
HRS_ds_coda_w10$h_respiratory <- rep(999,length(HRS_coda_w10$id))
HRS_ds_coda_w10$h_respiratory[which(((!is.na(HRS_coda_w10$R10LUNGE)) & HRS_coda_w10$R10LUNGE == 0) & (HRS_coda_w10$h_respiratory != 1))] <- 0
HRS_ds_coda_w10$h_respiratory[which(((!is.na(HRS_coda_w10$R10LUNGE)) & HRS_coda_w10$R10LUNGE == 1) | ((!is.na(HRS_coda_w10$h_respiratory)) & (!is.na(HRS_coda_w10$R10LUNGE)) & HRS_coda_w10$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_coda[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_coda_w10,log_vec=(HRS_ds_prov$id %in% HRS_ds_coda_w10$id),col_end_index = 2, col_st_index = 3)
HRS_ds_coda$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript coda_w10, echo=F}

vbl <- HRS_ds_coda_w10$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w10, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation coda_w10, echo=F, results='asis'}

AfterH <- table(HRS_ds_coda_w10$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_coda_w10$R10LUNGE)) & HRS_coda_w10$R10LUNGE == 0) & (HRS_coda_w10$h_respiratory != 1)),
  sum(((!is.na(HRS_coda_w10$R10LUNGE)) & HRS_coda_w10$R10LUNGE == 1) | ((!is.na(HRS_coda_w10$h_respiratory)) & (!is.na(HRS_coda_w10$R10LUNGE)) & HRS_coda_w10$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_coda_w10$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_coda_w10)

```



### Wave 11

#### Study-specific variable description

| **Name** | `R11LUNGE` |
|-|-|-|-|-|
| **Label** | `R11LUNGE:W11 R ever had lung disease`|
| **Table name**  | `HRS-CODA-w11`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign coda_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_coda_w11','HRS.HRS-CODA-w11',variables=list('R11LUNGE'), missings = T)
HRS_coda_w11 <- opal.execute(o,'HRS_coda_w11')












```

```{r local coda_w11, echo=F}

vbl <- HRS_coda_w11$R11LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_coda_w11)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_coda_w11, aes(x=factor(R11LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 and R11LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 or R11LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo coda_w11}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_coda_w11 <- left_join(HRS_coda_w11, HRS_ds_coda, by = "id")

# Categorical variable harmonization
HRS_ds_coda_w11 <- tibble(id=HRS_coda_w11$id)
HRS_ds_coda_w11$h_respiratory <- rep(999,length(HRS_coda_w11$id))
HRS_ds_coda_w11$h_respiratory[which(((!is.na(HRS_coda_w11$R11LUNGE)) & HRS_coda_w11$R11LUNGE == 0) & (HRS_coda_w11$h_respiratory != 1))] <- 0
HRS_ds_coda_w11$h_respiratory[which(((!is.na(HRS_coda_w11$R11LUNGE)) & HRS_coda_w11$R11LUNGE == 1) | ((!is.na(HRS_coda_w11$h_respiratory)) & (!is.na(HRS_coda_w11$R11LUNGE)) & HRS_coda_w11$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
rm(HRS_ds_coda)

```


#### Statistics of the new harmonized variable

```{r descript coda_w11, echo=F}

vbl <- HRS_ds_coda_w11$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_coda_w11, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation coda_w11, echo=F, results='asis'}

AfterH <- table(HRS_ds_coda_w11$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_coda_w11$R11LUNGE)) & HRS_coda_w11$R11LUNGE == 0) & (HRS_coda_w11$h_respiratory != 1)),
  sum(((!is.na(HRS_coda_w11$R11LUNGE)) & HRS_coda_w11$R11LUNGE == 1) | ((!is.na(HRS_coda_w11$h_respiratory)) & (!is.na(HRS_coda_w11$R11LUNGE)) & HRS_coda_w11$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_coda_w11$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_coda_w11)

```



## WB

### Wave 4

#### Study-specific variable description

| **Name** | `R4LUNGE` |
|-|-|
| **Label** | `R4LUNGE:W4 R ever had lung disease`|
| **Table name**  | `HRS-WB-w4`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA` |
| **Description** |  |

```{r assign wb_w4, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w4','HRS.HRS-WB-w4',variables=list('R4LUNGE'), missings = T)
HRS_wb_w4 <- opal.execute(o,'HRS_wb_w4')

```

```{r local wb_w4, echo=F}

vbl <- HRS_wb_w4$R4LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w4)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w4, aes(x=factor(R4LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `keep up 0 into 0`
* `NA into 999`



**R script:**

```{r harmo wb_w4}

# Categorical variable harmonization
HRS_ds_wb_w4 <- tibble(id=HRS_wb_w4$id)
HRS_ds_wb_w4$h_respiratory <- car::recode(HRS_wb_w4$R4LUNGE, "NA=999")

# We build a global table in order to have updated the status of all the individuals through the different waves
HRS_ds_wb <- HRS_ds_wb_w4


```


#### Statistics of the new harmonized variable

```{r descript wb_w4, echo=F}

vbl <- HRS_ds_wb_w4$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w4, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation wb_w4, echo=F}

AfterH <- table(HRS_ds_wb_w4$h_respiratory, useNA = "ifany")
BeforeH <- table(HRS_wb_w4$R4LUNGE, useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)
rm(HRS_wb_w4)

```



### Wave 5

#### Study-specific variable description

| **Name** | `R5LUNGE` |
|-|-|-|-|-|
| **Label** | `R5LUNGE:W5 R ever had lung disease`|
| **Table name**  | `HRS-WB-w5`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign wb_w5, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w5','HRS.HRS-WB-w5',variables=list('R5LUNGE'), missings = T)
HRS_wb_w5 <- opal.execute(o,'HRS_wb_w5')












```

```{r local wb_w5, echo=F}

vbl <- HRS_wb_w5$R5LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w5)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w5, aes(x=factor(R5LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 into 1`
* `otherwise into 999`







**R script:**

```{r harmo wb_w5}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_wb_w5 <- left_join(HRS_wb_w5, HRS_ds_wb, by = "id")

# Categorical variable harmonization
HRS_ds_wb_w5 <- tibble(id=HRS_wb_w5$id)
HRS_ds_wb_w5$h_respiratory <- rep(999,length(HRS_wb_w5$id))
HRS_ds_wb_w5$h_respiratory[which(((!is.na(HRS_wb_w5$R5LUNGE)) & HRS_wb_w5$R5LUNGE == 0) & (HRS_wb_w5$h_respiratory != 1))] <- 0
HRS_ds_wb_w5$h_respiratory[which(((!is.na(HRS_wb_w5$R5LUNGE)) & HRS_wb_w5$R5LUNGE == 1) | ((!is.na(HRS_wb_w5$h_respiratory)) & (!is.na(HRS_wb_w5$R5LUNGE)) & HRS_wb_w5$h_respiratory == 1))] <- 1






# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_wb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_wb_w5,log_vec=(HRS_ds_prov$id %in% HRS_ds_wb_w5$id),col_end_index = 2, col_st_index = 3)
HRS_ds_wb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript wb_w5, echo=F}

vbl <- HRS_ds_wb_w5$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w5, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation wb_w5, echo=F, results='asis'}

AfterH <- table(HRS_ds_wb_w5$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_wb_w5$R5LUNGE)) & HRS_wb_w5$R5LUNGE == 0) & (HRS_wb_w5$h_respiratory != 1)),
  sum(((!is.na(HRS_wb_w5$R5LUNGE)) & HRS_wb_w5$R5LUNGE == 1) | ((!is.na(HRS_wb_w5$h_respiratory)) & (!is.na(HRS_wb_w5$R5LUNGE)) & HRS_wb_w5$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_wb_w5$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_wb_w5)

```




### Wave 6

#### Study-specific variable description

| **Name** | `R6LUNGE` |
|-|-|-|-|-|
| **Label** | `R6LUNGE:W6 R ever had lung disease`|
| **Table name**  | `HRS-WB-w6`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign wb_w6, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w6','HRS.HRS-WB-w6',variables=list('R6LUNGE'), missings = T)
HRS_wb_w6 <- opal.execute(o,'HRS_wb_w6')












```

```{r local wb_w6, echo=F}

vbl <- HRS_wb_w6$R6LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w6)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w6, aes(x=factor(R6LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo wb_w6}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_wb_w6 <- left_join(HRS_wb_w6, HRS_ds_wb, by = "id")

# Categorical variable harmonization
HRS_ds_wb_w6 <- tibble(id=HRS_wb_w6$id)
HRS_ds_wb_w6$h_respiratory <- rep(999,length(HRS_wb_w6$id))
HRS_ds_wb_w6$h_respiratory[which(((!is.na(HRS_wb_w6$R6LUNGE)) & HRS_wb_w6$R6LUNGE == 0) & (HRS_wb_w6$h_respiratory != 1))] <- 0
HRS_ds_wb_w6$h_respiratory[which(((!is.na(HRS_wb_w6$R6LUNGE)) & HRS_wb_w6$R6LUNGE == 1) | ((!is.na(HRS_wb_w6$h_respiratory)) & (!is.na(HRS_wb_w6$R6LUNGE)) & HRS_wb_w6$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_wb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_wb_w6,log_vec=(HRS_ds_prov$id %in% HRS_ds_wb_w6$id),col_end_index = 2, col_st_index = 3)
HRS_ds_wb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript wb_w6, echo=F}

vbl <- HRS_ds_wb_w6$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w6, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation wb_w6, echo=F, results='asis'}

AfterH <- table(HRS_ds_wb_w6$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_wb_w6$R6LUNGE)) & HRS_wb_w6$R6LUNGE == 0) & (HRS_wb_w6$h_respiratory != 1)),
  sum(((!is.na(HRS_wb_w6$R6LUNGE)) & HRS_wb_w6$R6LUNGE == 1) | ((!is.na(HRS_wb_w6$h_respiratory)) & (!is.na(HRS_wb_w6$R6LUNGE)) & HRS_wb_w6$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_wb_w6$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_wb_w6)

```




### Wave 7

#### Study-specific variable description

| **Name** | `R7LUNGE` |
|-|-|-|-|-|
| **Label** | `R7LUNGE:W7 R ever had lung disease`|
| **Table name**  | `HRS-WB-w7`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign wb_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w7','HRS.HRS-WB-w7',variables=list('R7LUNGE'), missings = T)
HRS_wb_w7 <- opal.execute(o,'HRS_wb_w7')












```

```{r local wb_w7, echo=F}

vbl <- HRS_wb_w7$R7LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w7)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w7, aes(x=factor(R7LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo wb_w7}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_wb_w7 <- left_join(HRS_wb_w7, HRS_ds_wb, by = "id")

# Categorical variable harmonization
HRS_ds_wb_w7 <- tibble(id=HRS_wb_w7$id)
HRS_ds_wb_w7$h_respiratory <- rep(999,length(HRS_wb_w7$id))
HRS_ds_wb_w7$h_respiratory[which(((!is.na(HRS_wb_w7$R7LUNGE)) & HRS_wb_w7$R7LUNGE == 0) & (HRS_wb_w7$h_respiratory != 1))] <- 0
HRS_ds_wb_w7$h_respiratory[which(((!is.na(HRS_wb_w7$R7LUNGE)) & HRS_wb_w7$R7LUNGE == 1) | ((!is.na(HRS_wb_w7$h_respiratory)) & (!is.na(HRS_wb_w7$R7LUNGE)) & HRS_wb_w7$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_wb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_wb_w7,log_vec=(HRS_ds_prov$id %in% HRS_ds_wb_w7$id),col_end_index = 2, col_st_index = 3)
HRS_ds_wb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript wb_w7, echo=F}

vbl <- HRS_ds_wb_w7$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w7, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation wb_w7, echo=F, results='asis'}

AfterH <- table(HRS_ds_wb_w7$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_wb_w7$R7LUNGE)) & HRS_wb_w7$R7LUNGE == 0) & (HRS_wb_w7$h_respiratory != 1)),
  sum(((!is.na(HRS_wb_w7$R7LUNGE)) & HRS_wb_w7$R7LUNGE == 1) | ((!is.na(HRS_wb_w7$h_respiratory)) & (!is.na(HRS_wb_w7$R7LUNGE)) & HRS_wb_w7$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_wb_w7$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_wb_w7)

```



### Wave 8

#### Study-specific variable description

| **Name** | `R8LUNGE` |
|-|-|-|-|-|
| **Label** | `R8LUNGE:W8 R ever had lung disease`|
| **Table name**  | `HRS-WB-w8`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign wb_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w8','HRS.HRS-WB-w8',variables=list('R8LUNGE'), missings = T)
HRS_wb_w8 <- opal.execute(o,'HRS_wb_w8')












```

```{r local wb_w8, echo=F}

vbl <- HRS_wb_w8$R8LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w8)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w8, aes(x=factor(R8LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo wb_w8}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_wb_w8 <- left_join(HRS_wb_w8, HRS_ds_wb, by = "id")

# Categorical variable harmonization
HRS_ds_wb_w8 <- tibble(id=HRS_wb_w8$id)
HRS_ds_wb_w8$h_respiratory <- rep(999,length(HRS_wb_w8$id))
HRS_ds_wb_w8$h_respiratory[which(((!is.na(HRS_wb_w8$R8LUNGE)) & HRS_wb_w8$R8LUNGE == 0) & (HRS_wb_w8$h_respiratory != 1))] <- 0
HRS_ds_wb_w8$h_respiratory[which(((!is.na(HRS_wb_w8$R8LUNGE)) & HRS_wb_w8$R8LUNGE == 1) | ((!is.na(HRS_wb_w8$h_respiratory)) & (!is.na(HRS_wb_w8$R8LUNGE)) & HRS_wb_w8$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_wb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_wb_w8,log_vec=(HRS_ds_prov$id %in% HRS_ds_wb_w8$id),col_end_index = 2, col_st_index = 3)
HRS_ds_wb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript wb_w8, echo=F}

vbl <- HRS_ds_wb_w8$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w8, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation wb_w8, echo=F, results='asis'}

AfterH <- table(HRS_ds_wb_w8$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_wb_w8$R8LUNGE)) & HRS_wb_w8$R8LUNGE == 0) & (HRS_wb_w8$h_respiratory != 1)),
  sum(((!is.na(HRS_wb_w8$R8LUNGE)) & HRS_wb_w8$R8LUNGE == 1) | ((!is.na(HRS_wb_w8$h_respiratory)) & (!is.na(HRS_wb_w8$R8LUNGE)) & HRS_wb_w8$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_wb_w8$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_wb_w8)

```



### Wave 9

#### Study-specific variable description

| **Name** | `R9LUNGE` |
|-|-|-|-|-|
| **Label** | `R9LUNGE:W9 R ever had lung disease`|
| **Table name**  | `HRS-WB-w9`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign wb_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w9','HRS.HRS-WB-w9',variables=list('R9LUNGE'), missings = T)
HRS_wb_w9 <- opal.execute(o,'HRS_wb_w9')












```

```{r local wb_w9, echo=F}

vbl <- HRS_wb_w9$R9LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w9)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w9, aes(x=factor(R9LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo wb_w9}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_wb_w9 <- left_join(HRS_wb_w9, HRS_ds_wb, by = "id")

# Categorical variable harmonization
HRS_ds_wb_w9 <- tibble(id=HRS_wb_w9$id)
HRS_ds_wb_w9$h_respiratory <- rep(999,length(HRS_wb_w9$id))
HRS_ds_wb_w9$h_respiratory[which(((!is.na(HRS_wb_w9$R9LUNGE)) & HRS_wb_w9$R9LUNGE == 0) & (HRS_wb_w9$h_respiratory != 1))] <- 0
HRS_ds_wb_w9$h_respiratory[which(((!is.na(HRS_wb_w9$R9LUNGE)) & HRS_wb_w9$R9LUNGE == 1) | ((!is.na(HRS_wb_w9$h_respiratory)) & (!is.na(HRS_wb_w9$R9LUNGE)) & HRS_wb_w9$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_wb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_wb_w9,log_vec=(HRS_ds_prov$id %in% HRS_ds_wb_w9$id),col_end_index = 2, col_st_index = 3)
HRS_ds_wb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript wb_w9, echo=F}

vbl <- HRS_ds_wb_w9$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w9, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation wb_w9, echo=F, results='asis'}

AfterH <- table(HRS_ds_wb_w9$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_wb_w9$R9LUNGE)) & HRS_wb_w9$R9LUNGE == 0) & (HRS_wb_w9$h_respiratory != 1)),
  sum(((!is.na(HRS_wb_w9$R9LUNGE)) & HRS_wb_w9$R9LUNGE == 1) | ((!is.na(HRS_wb_w9$h_respiratory)) & (!is.na(HRS_wb_w9$R9LUNGE)) & HRS_wb_w9$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_wb_w9$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_wb_w9)

```




### Wave 10

#### Study-specific variable description

| **Name** | `R10LUNGE` |
|-|-|-|-|-|
| **Label** | `R10LUNGE:W10 R ever had lung disease`|
| **Table name**  | `HRS-WB-w10`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign wb_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w10','HRS.HRS-WB-w10',variables=list('R10LUNGE'), missings = T)
HRS_wb_w10 <- opal.execute(o,'HRS_wb_w10')












```

```{r local wb_w10, echo=F}

vbl <- HRS_wb_w10$R10LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w10)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w10, aes(x=factor(R10LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo wb_w10}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_wb_w10 <- left_join(HRS_wb_w10, HRS_ds_wb, by = "id")

# Categorical variable harmonization
HRS_ds_wb_w10 <- tibble(id=HRS_wb_w10$id)
HRS_ds_wb_w10$h_respiratory <- rep(999,length(HRS_wb_w10$id))
HRS_ds_wb_w10$h_respiratory[which(((!is.na(HRS_wb_w10$R10LUNGE)) & HRS_wb_w10$R10LUNGE == 0) & (HRS_wb_w10$h_respiratory != 1))] <- 0
HRS_ds_wb_w10$h_respiratory[which(((!is.na(HRS_wb_w10$R10LUNGE)) & HRS_wb_w10$R10LUNGE == 1) | ((!is.na(HRS_wb_w10$h_respiratory)) & (!is.na(HRS_wb_w10$R10LUNGE)) & HRS_wb_w10$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_wb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_wb_w10,log_vec=(HRS_ds_prov$id %in% HRS_ds_wb_w10$id),col_end_index = 2, col_st_index = 3)
HRS_ds_wb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript wb_w10, echo=F}

vbl <- HRS_ds_wb_w10$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w10, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation wb_w10, echo=F, results='asis'}

AfterH <- table(HRS_ds_wb_w10$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_wb_w10$R10LUNGE)) & HRS_wb_w10$R10LUNGE == 0) & (HRS_wb_w10$h_respiratory != 1)),
  sum(((!is.na(HRS_wb_w10$R10LUNGE)) & HRS_wb_w10$R10LUNGE == 1) | ((!is.na(HRS_wb_w10$h_respiratory)) & (!is.na(HRS_wb_w10$R10LUNGE)) & HRS_wb_w10$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_wb_w10$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_wb_w10)

```



### Wave 11

#### Study-specific variable description

| **Name** | `R11LUNGE` |
|-|-|-|-|-|
| **Label** | `R11LUNGE:W11 R ever had lung disease`|
| **Table name**  | `HRS-WB-w11`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign wb_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_wb_w11','HRS.HRS-WB-w11',variables=list('R11LUNGE'), missings = T)
HRS_wb_w11 <- opal.execute(o,'HRS_wb_w11')












```

```{r local wb_w11, echo=F}

vbl <- HRS_wb_w11$R11LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_wb_w11)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_wb_w11, aes(x=factor(R11LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R4LUNGE == 0 and R5LUNGE == 0 and R6LUNGE == 0 and R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 and R11LUNGE == 0 into 0`
* `R4LUNGE == 1 or R5LUNGE == 1 or R6LUNGE == 1 or R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 or R11LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo wb_w11}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_wb_w11 <- left_join(HRS_wb_w11, HRS_ds_wb, by = "id")

# Categorical variable harmonization
HRS_ds_wb_w11 <- tibble(id=HRS_wb_w11$id)
HRS_ds_wb_w11$h_respiratory <- rep(999,length(HRS_wb_w11$id))
HRS_ds_wb_w11$h_respiratory[which(((!is.na(HRS_wb_w11$R11LUNGE)) & HRS_wb_w11$R11LUNGE == 0) & (HRS_wb_w11$h_respiratory != 1))] <- 0
HRS_ds_wb_w11$h_respiratory[which(((!is.na(HRS_wb_w11$R11LUNGE)) & HRS_wb_w11$R11LUNGE == 1) | ((!is.na(HRS_wb_w11$h_respiratory)) & (!is.na(HRS_wb_w11$R11LUNGE)) & HRS_wb_w11$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
rm(HRS_ds_wb)

```


#### Statistics of the new harmonized variable

```{r descript wb_w11, echo=F}

vbl <- HRS_ds_wb_w11$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_wb_w11, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation wb_w11, echo=F, results='asis'}

AfterH <- table(HRS_ds_wb_w11$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_wb_w11$R11LUNGE)) & HRS_wb_w11$R11LUNGE == 0) & (HRS_wb_w11$h_respiratory != 1)),
  sum(((!is.na(HRS_wb_w11$R11LUNGE)) & HRS_wb_w11$R11LUNGE == 1) | ((!is.na(HRS_wb_w11$h_respiratory)) & (!is.na(HRS_wb_w11$R11LUNGE)) & HRS_wb_w11$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_wb_w11$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_wb_w11)

```



## EBB


### Wave 7

#### Study-specific variable description

| **Name** | `R7LUNGE` |
|-|-|
| **Label** | `R7LUNGE:W7 R ever had lung disease`|
| **Table name**  | `HRS-EBB-w7`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA` |
| **Description** |  |

```{r assign ebb_w7, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w7','HRS.HRS-EBB-w7',variables=list('R7LUNGE'), missings = T)
HRS_ebb_w7 <- opal.execute(o,'HRS_ebb_w7')

```

```{r local ebb_w7, echo=F}

vbl <- HRS_ebb_w7$R7LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ebb_w7)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w7, aes(x=factor(R7LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `keep up 0 into 0`
* `NA into 999`



**R script:**

```{r harmo ebb_w7}

# Categorical variable harmonization
HRS_ds_ebb_w7 <- tibble(id=HRS_ebb_w7$id)
HRS_ds_ebb_w7$h_respiratory <- car::recode(HRS_ebb_w7$R7LUNGE, "NA=999")

# We build a global table in order to have updated the status of all the individuals through the different waves
HRS_ds_ebb <- HRS_ds_ebb_w7


```


#### Statistics of the new harmonized variable

```{r descript ebb_w7, echo=F}

vbl <- HRS_ds_ebb_w7$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w7, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation ebb_w7, echo=F}

AfterH <- table(HRS_ds_ebb_w7$h_respiratory, useNA = "ifany")
BeforeH <- table(HRS_ebb_w7$R7LUNGE, useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)
rm(HRS_ebb_w7)

```



### Wave 8

#### Study-specific variable description

| **Name** | `R8LUNGE` |
|-|-|-|-|-|
| **Label** | `R8LUNGE:W8 R ever had lung disease`|
| **Table name**  | `HRS-EBB-w8`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ebb_w8, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w8','HRS.HRS-EBB-w8',variables=list('R8LUNGE'), missings = T)
HRS_ebb_w8 <- opal.execute(o,'HRS_ebb_w8')












```

```{r local ebb_w8, echo=F}

vbl <- HRS_ebb_w8$R8LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ebb_w8)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w8, aes(x=factor(R8LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")


```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R7LUNGE == 0 and R8LUNGE == 0 into 0`
* `R7LUNGE == 1 or R8LUNGE == 1 into 1`
* `otherwise into 999`







**R script:**

```{r harmo ebb_w8}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ebb_w8 <- left_join(HRS_ebb_w8, HRS_ds_ebb, by = "id")

# Categorical variable harmonization
HRS_ds_ebb_w8 <- tibble(id=HRS_ebb_w8$id)
HRS_ds_ebb_w8$h_respiratory <- rep(999,length(HRS_ebb_w8$id))
HRS_ds_ebb_w8$h_respiratory[which(((!is.na(HRS_ebb_w8$R8LUNGE)) & HRS_ebb_w8$R8LUNGE == 0) & (HRS_ebb_w8$h_respiratory != 1))] <- 0
HRS_ds_ebb_w8$h_respiratory[which(((!is.na(HRS_ebb_w8$R8LUNGE)) & HRS_ebb_w8$R8LUNGE == 1) | ((!is.na(HRS_ebb_w8$h_respiratory)) & (!is.na(HRS_ebb_w8$R8LUNGE)) & HRS_ebb_w8$h_respiratory == 1))] <- 1






# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ebb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ebb_w8,log_vec=(HRS_ds_prov$id %in% HRS_ds_ebb_w8$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ebb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ebb_w8, echo=F}

vbl <- HRS_ds_ebb_w8$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w8, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ebb_w8, echo=F, results='asis'}

AfterH <- table(HRS_ds_ebb_w8$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ebb_w8$R8LUNGE)) & HRS_ebb_w8$R8LUNGE == 0) & (HRS_ebb_w8$h_respiratory != 1)),
  sum(((!is.na(HRS_ebb_w8$R8LUNGE)) & HRS_ebb_w8$R8LUNGE == 1) | ((!is.na(HRS_ebb_w8$h_respiratory)) & (!is.na(HRS_ebb_w8$R8LUNGE)) & HRS_ebb_w8$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ebb_w8$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ebb_w8)

```




### Wave 9

#### Study-specific variable description

| **Name** | `R9LUNGE` |
|-|-|-|-|-|
| **Label** | `R9LUNGE:W9 R ever had lung disease`|
| **Table name**  | `HRS-EBB-w9`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ebb_w9, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w9','HRS.HRS-EBB-w9',variables=list('R9LUNGE'), missings = T)
HRS_ebb_w9 <- opal.execute(o,'HRS_ebb_w9')












```

```{r local ebb_w9, echo=F}

vbl <- HRS_ebb_w9$R9LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ebb_w9)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w9, aes(x=factor(R9LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 into 0`
* `R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ebb_w9}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ebb_w9 <- left_join(HRS_ebb_w9, HRS_ds_ebb, by = "id")

# Categorical variable harmonization
HRS_ds_ebb_w9 <- tibble(id=HRS_ebb_w9$id)
HRS_ds_ebb_w9$h_respiratory <- rep(999,length(HRS_ebb_w9$id))
HRS_ds_ebb_w9$h_respiratory[which(((!is.na(HRS_ebb_w9$R9LUNGE)) & HRS_ebb_w9$R9LUNGE == 0) & (HRS_ebb_w9$h_respiratory != 1))] <- 0
HRS_ds_ebb_w9$h_respiratory[which(((!is.na(HRS_ebb_w9$R9LUNGE)) & HRS_ebb_w9$R9LUNGE == 1) | ((!is.na(HRS_ebb_w9$h_respiratory)) & (!is.na(HRS_ebb_w9$R9LUNGE)) & HRS_ebb_w9$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ebb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ebb_w9,log_vec=(HRS_ds_prov$id %in% HRS_ds_ebb_w9$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ebb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ebb_w9, echo=F}

vbl <- HRS_ds_ebb_w9$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w9, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ebb_w9, echo=F, results='asis'}

AfterH <- table(HRS_ds_ebb_w9$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ebb_w9$R9LUNGE)) & HRS_ebb_w9$R9LUNGE == 0) & (HRS_ebb_w9$h_respiratory != 1)),
  sum(((!is.na(HRS_ebb_w9$R9LUNGE)) & HRS_ebb_w9$R9LUNGE == 1) | ((!is.na(HRS_ebb_w9$h_respiratory)) & (!is.na(HRS_ebb_w9$R9LUNGE)) & HRS_ebb_w9$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ebb_w9$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ebb_w9)

```




### Wave 10

#### Study-specific variable description

| **Name** | `R10LUNGE` |
|-|-|-|-|-|
| **Label** | `R10LUNGE:W10 R ever had lung disease`|
| **Table name**  | `HRS-EBB-w10`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ebb_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w10','HRS.HRS-EBB-w10',variables=list('R10LUNGE'), missings = T)
HRS_ebb_w10 <- opal.execute(o,'HRS_ebb_w10')












```

```{r local ebb_w10, echo=F}

vbl <- HRS_ebb_w10$R10LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ebb_w10)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w10, aes(x=factor(R10LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 into 0`
* `R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ebb_w10}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ebb_w10 <- left_join(HRS_ebb_w10, HRS_ds_ebb, by = "id")

# Categorical variable harmonization
HRS_ds_ebb_w10 <- tibble(id=HRS_ebb_w10$id)
HRS_ds_ebb_w10$h_respiratory <- rep(999,length(HRS_ebb_w10$id))
HRS_ds_ebb_w10$h_respiratory[which(((!is.na(HRS_ebb_w10$R10LUNGE)) & HRS_ebb_w10$R10LUNGE == 0) & (HRS_ebb_w10$h_respiratory != 1))] <- 0
HRS_ds_ebb_w10$h_respiratory[which(((!is.na(HRS_ebb_w10$R10LUNGE)) & HRS_ebb_w10$R10LUNGE == 1) | ((!is.na(HRS_ebb_w10$h_respiratory)) & (!is.na(HRS_ebb_w10$R10LUNGE)) & HRS_ebb_w10$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
assign_merge <- function(endtib,sttib,log_vec=c(T),col_end_index=NULL,col_st_index=NULL){
  newtib <- left_join(endtib,sttib,by="id")
  newtib[log_vec,col_end_index] <- newtib[log_vec,col_st_index]
  id_ind <- match("id",names(newtib))
  newtib <- newtib[,c(id_ind,col_end_index)]
  names(newtib)[2] <- "x"
  newtib$x <- car::recode(newtib$x,"NA=999")
  names(newtib)[2] <- names(endtib)[col_end_index]
  newtib
}
HRS_ds_prov <- HRS_ds_ebb[,c(1,2)]
HRS_ds_prov <- assign_merge(HRS_ds_prov,HRS_ds_ebb_w10,log_vec=(HRS_ds_prov$id %in% HRS_ds_ebb_w10$id),col_end_index = 2, col_st_index = 3)
HRS_ds_ebb$h_respiratory <- HRS_ds_prov$h_respiratory
rm(HRS_ds_prov)


```


#### Statistics of the new harmonized variable

```{r descript ebb_w10, echo=F}

vbl <- HRS_ds_ebb_w10$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w10, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ebb_w10, echo=F, results='asis'}

AfterH <- table(HRS_ds_ebb_w10$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ebb_w10$R10LUNGE)) & HRS_ebb_w10$R10LUNGE == 0) & (HRS_ebb_w10$h_respiratory != 1)),
  sum(((!is.na(HRS_ebb_w10$R10LUNGE)) & HRS_ebb_w10$R10LUNGE == 1) | ((!is.na(HRS_ebb_w10$h_respiratory)) & (!is.na(HRS_ebb_w10$R10LUNGE)) & HRS_ebb_w10$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ebb_w10$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ebb_w10)

```



### Wave 11

#### Study-specific variable description

| **Name** | `R11LUNGE` |
|-|-|-|-|-|
| **Label** | `R11LUNGE:W11 R ever had lung disease`|
| **Table name**  | `HRS-EBB-w11`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign ebb_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_ebb_w11','HRS.HRS-EBB-w11',variables=list('R11LUNGE'), missings = T)
HRS_ebb_w11 <- opal.execute(o,'HRS_ebb_w11')












```

```{r local ebb_w11, echo=F}

vbl <- HRS_ebb_w11$R11LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_ebb_w11)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_ebb_w11, aes(x=factor(R11LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R7LUNGE == 0 and R8LUNGE == 0 and R9LUNGE == 0 and R10LUNGE == 0 and R11LUNGE == 0 into 0`
* `R7LUNGE == 1 or R8LUNGE == 1 or R9LUNGE == 1 or R10LUNGE == 1 or R11LUNGE == 1 into 1`
* `otherwise into 999`








**R script:**

```{r harmo ebb_w11}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_ebb_w11 <- left_join(HRS_ebb_w11, HRS_ds_ebb, by = "id")

# Categorical variable harmonization
HRS_ds_ebb_w11 <- tibble(id=HRS_ebb_w11$id)
HRS_ds_ebb_w11$h_respiratory <- rep(999,length(HRS_ebb_w11$id))
HRS_ds_ebb_w11$h_respiratory[which(((!is.na(HRS_ebb_w11$R11LUNGE)) & HRS_ebb_w11$R11LUNGE == 0) & (HRS_ebb_w11$h_respiratory != 1))] <- 0
HRS_ds_ebb_w11$h_respiratory[which(((!is.na(HRS_ebb_w11$R11LUNGE)) & HRS_ebb_w11$R11LUNGE == 1) | ((!is.na(HRS_ebb_w11$h_respiratory)) & (!is.na(HRS_ebb_w11$R11LUNGE)) & HRS_ebb_w11$h_respiratory == 1))] <- 1







# We update the status of the individuals in the global table
rm(HRS_ds_ebb)

```


#### Statistics of the new harmonized variable

```{r descript ebb_w11, echo=F}

vbl <- HRS_ds_ebb_w11$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_ebb_w11, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation ebb_w11, echo=F, results='asis'}

AfterH <- table(HRS_ds_ebb_w11$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_ebb_w11$R11LUNGE)) & HRS_ebb_w11$R11LUNGE == 0) & (HRS_ebb_w11$h_respiratory != 1)),
  sum(((!is.na(HRS_ebb_w11$R11LUNGE)) & HRS_ebb_w11$R11LUNGE == 1) | ((!is.na(HRS_ebb_w11$h_respiratory)) & (!is.na(HRS_ebb_w11$R11LUNGE)) & HRS_ebb_w11$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_ebb_w11$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_ebb_w11)

```



## MBB


### Wave 10

#### Study-specific variable description

| **Name** | `R10LUNGE` |
|-|-|
| **Label** | `R10LUNGE:W10 R ever had lung disease`|
| **Table name**  | `HRS-MBB-w10`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA` |
| **Description** |  |

```{r assign mbb_w10, echo=F}

opal.assign.table.tibble(o, 'HRS_mbb_w10','HRS.HRS-MBB-w10',variables=list('R10LUNGE'), missings = T)
HRS_mbb_w10 <- opal.execute(o,'HRS_mbb_w10')

```

```{r local mbb_w10, echo=F}

vbl <- HRS_mbb_w10$R10LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_mbb_w10)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w10, aes(x=factor(R10LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `keep up 1 into 1`
* `keep up 0 into 0`
* `NA into 999`



**R script:**

```{r harmo mbb_w10}

# Categorical variable harmonization
HRS_ds_mbb_w10 <- tibble(id=HRS_mbb_w10$id)
HRS_ds_mbb_w10$h_respiratory <- car::recode(HRS_mbb_w10$R10LUNGE, "NA=999")

# We build a global table in order to have updated the status of all the individuals through the different waves
HRS_ds_mbb <- HRS_ds_mbb_w10


```


#### Statistics of the new harmonized variable

```{r descript mbb_w10, echo=F}

vbl <- HRS_ds_mbb_w10$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_mbb_w10, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

```


#### Validation

```{r crosstabulation mbb_w10, echo=F}

AfterH <- table(HRS_ds_mbb_w10$h_respiratory, useNA = "ifany")
BeforeH <- table(HRS_mbb_w10$R10LUNGE, useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)
rm(HRS_mbb_w10)

```



### Wave 11

#### Study-specific variable description

| **Name** | `R11LUNGE` |
|-|-|-|-|-|
| **Label** | `R11LUNGE:W11 R ever had lung disease`|
| **Table name**  | `HRS-MBB-w11`|
| **Categories** | `0 = no`<br/>`1 = yes` |
| **Missings** | `NA`|  |  |  |
| **Description** |  |  |  |  |

```{r assign mbb_w11, echo=F}

opal.assign.table.tibble(o, 'HRS_mbb_w11','HRS.HRS-MBB-w11',variables=list('R11LUNGE'), missings = T)
HRS_mbb_w11 <- opal.execute(o,'HRS_mbb_w11')












```

```{r local mbb_w11, echo=F}

vbl <- HRS_mbb_w11$R11LUNGE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(HRS_mbb_w11)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(HRS_mbb_w11, aes(x=factor(R11LUNGE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

```


#### Harmonisation algorithm

To compute `h_respiratory` from the study-specific variable it has to be recoded as follows:

* `R10LUNGE == 0 and R11LUNGE == 0 into 0`
* `R10LUNGE == 1 or R11LUNGE == 1 into 1`
* `otherwise into 999`







**R script:**

```{r harmo mbb_w11}

# We use the harmonized variable of previous waves instead of the study-specific variables
HRS_mbb_w11 <- left_join(HRS_mbb_w11, HRS_ds_mbb, by = "id")

# Categorical variable harmonization
HRS_ds_mbb_w11 <- tibble(id=HRS_mbb_w11$id)
HRS_ds_mbb_w11$h_respiratory <- rep(999,length(HRS_mbb_w11$id))
HRS_ds_mbb_w11$h_respiratory[which(((!is.na(HRS_mbb_w11$R11LUNGE)) & HRS_mbb_w11$R11LUNGE == 0) & (HRS_mbb_w11$h_respiratory != 1))] <- 0
HRS_ds_mbb_w11$h_respiratory[which(((!is.na(HRS_mbb_w11$R11LUNGE)) & HRS_mbb_w11$R11LUNGE == 1) | ((!is.na(HRS_mbb_w11$h_respiratory)) & (!is.na(HRS_mbb_w11$R11LUNGE)) & HRS_mbb_w11$h_respiratory == 1))] <- 1






# We update the status of the individuals in the global table
rm(HRS_ds_mbb)
```


#### Statistics of the new harmonized variable

```{r descript mbb_w11, echo=F}

vbl <- HRS_ds_mbb_w11$h_respiratory
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(HRS_ds_mbb_w11, aes(x=factor(h_respiratory))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")







```


#### Validation

```{r crosstabulation mbb_w11, echo=F, results='asis'}

AfterH <- table(HRS_ds_mbb_w11$h_respiratory, useNA = "ifany")
X <- c(
  sum(((!is.na(HRS_mbb_w11$R11LUNGE)) & HRS_mbb_w11$R11LUNGE == 0) & (HRS_mbb_w11$h_respiratory != 1)),
  sum(((!is.na(HRS_mbb_w11$R11LUNGE)) & HRS_mbb_w11$R11LUNGE == 1) | ((!is.na(HRS_mbb_w11$h_respiratory)) & (!is.na(HRS_mbb_w11$R11LUNGE)) & HRS_mbb_w11$h_respiratory == 1))
)
BeforeH <- c(X[1:2],length(HRS_mbb_w11$id)-sum(X))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999")
kable(C)

rm(HRS_mbb_w11)

```






## Summary of descriptive statistics of the harmonised variable accross populations and waves

Two tables are generated: 

1. Percentages of categories in each harmonised variable.

2. Frequencies and percentages of individuals with different trajectories. To avoid too large table, Only trajectories with percentages larger than 0.3 are shown.

**R script:**

```{r summ}

lb.hrs <- list(hrs_w1 = HRS_ds_hrs_w1, ahead_w2 = HRS_ds_ahead_w2, coda_w4 = HRS_ds_coda_w4, wb_w4 = HRS_ds_wb_w4, ebb_w7 = HRS_ds_ebb_w7, mbb_w10 = HRS_ds_mbb_w10)

lf.hrs <- list(hrs_w2 = HRS_ds_hrs_w2, hrs_w3 = HRS_ds_hrs_w3, hrs_w4 = HRS_ds_hrs_w4, hrs_w5 = HRS_ds_hrs_w5, hrs_w6 = HRS_ds_hrs_w6, hrs_w7 = HRS_ds_hrs_w7, hrs_w8 = HRS_ds_hrs_w8, hrs_w9 = HRS_ds_hrs_w9, hrs_w10 = HRS_ds_hrs_w10, hrs_w11 = HRS_ds_hrs_w11, ahead_w3 = HRS_ds_ahead_w3, ahead_w4 = HRS_ds_ahead_w4, ahead_w5 = HRS_ds_ahead_w5, ahead_w6 = HRS_ds_ahead_w6, ahead_w7 = HRS_ds_ahead_w7, ahead_w8 = HRS_ds_ahead_w8, ahead_w9 = HRS_ds_ahead_w9, ahead_w10 = HRS_ds_ahead_w10, ahead_w11 = HRS_ds_ahead_w11, coda_w5 = HRS_ds_coda_w5, coda_w6 = HRS_ds_coda_w6, coda_w7 = HRS_ds_coda_w7, coda_w8 = HRS_ds_coda_w8, coda_w9 = HRS_ds_coda_w9, coda_w10 = HRS_ds_coda_w10, coda_w11 = HRS_ds_coda_w11, wb_w5 = HRS_ds_wb_w5, wb_w6 = HRS_ds_wb_w6, wb_w7 = HRS_ds_wb_w7, wb_w8 = HRS_ds_wb_w8, wb_w9 = HRS_ds_wb_w9, wb_w10 = HRS_ds_wb_w10, wb_w11 = HRS_ds_wb_w11, ebb_w8 = HRS_ds_ebb_w8, ebb_w9 = HRS_ds_ebb_w9, ebb_w10 = HRS_ds_ebb_w10, ebb_w11 = HRS_ds_ebb_w11, mbb_w11 = HRS_ds_mbb_w11)

###################

for(name in names(lb.hrs)) {
  m_name <- paste0("HRS_m_ds_",name)
  aux_object <- lb.hrs[[name]]
  label(lb.hrs[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label # Text value assigned at the DS description, at the top
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  lb.hrs[[name]][[2]] <- labelled(lb.hrs[[name]][[2]], labels = cat_label)
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cat_label[1:2])
  assign(m_name, aux_object)
  rm(aux_object)
}

for(name in names(lf.hrs)) {
  m_name <- paste0("HRS_m_ds_",name)
  aux_object <- lf.hrs[[name]]
  label(lf.hrs[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label # Text value assigned at the DS description, at the top
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  lf.hrs[[name]][[2]] <- labelled(lf.hrs[[name]][[2]], labels = cat_label)
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cat_label[1:2])
  assign(m_name, aux_object)
  rm(aux_object)
}

##################################

mb.hrs <- list(hrs_w1 = HRS_m_ds_hrs_w1, ahead_w2 = HRS_m_ds_ahead_w2, coda_w4 = HRS_m_ds_coda_w4, wb_w4 = HRS_m_ds_wb_w4, ebb_w7 = HRS_m_ds_ebb_w7, mbb_w10 = HRS_m_ds_mbb_w10)

mf.hrs <- list(hrs_w2 = HRS_m_ds_hrs_w2, hrs_w3 = HRS_m_ds_hrs_w3, hrs_w4 = HRS_m_ds_hrs_w4, hrs_w5 = HRS_m_ds_hrs_w5, hrs_w6 = HRS_m_ds_hrs_w6, hrs_w7 = HRS_m_ds_hrs_w7, hrs_w8 = HRS_m_ds_hrs_w8, hrs_w9 = HRS_m_ds_hrs_w9, hrs_w10 = HRS_m_ds_hrs_w10, hrs_w11 = HRS_m_ds_hrs_w11, ahead_w3 = HRS_m_ds_ahead_w3, ahead_w4 = HRS_m_ds_ahead_w4, ahead_w5 = HRS_m_ds_ahead_w5, ahead_w6 = HRS_m_ds_ahead_w6, ahead_w7 = HRS_m_ds_ahead_w7, ahead_w8 = HRS_m_ds_ahead_w8, ahead_w9 = HRS_m_ds_ahead_w9, ahead_w10 = HRS_m_ds_ahead_w10, ahead_w11 = HRS_m_ds_ahead_w11, coda_w5 = HRS_m_ds_coda_w5, coda_w6 = HRS_m_ds_coda_w6, coda_w7 = HRS_m_ds_coda_w7, coda_w8 = HRS_m_ds_coda_w8, coda_w9 = HRS_m_ds_coda_w9, coda_w10 = HRS_m_ds_coda_w10, coda_w11 = HRS_m_ds_coda_w11, wb_w5 = HRS_m_ds_wb_w5, wb_w6 = HRS_m_ds_wb_w6, wb_w7 = HRS_m_ds_wb_w7, wb_w8 = HRS_m_ds_wb_w8, wb_w9 = HRS_m_ds_wb_w9, wb_w10 = HRS_m_ds_wb_w10, wb_w11 = HRS_m_ds_wb_w11, ebb_w8 = HRS_m_ds_ebb_w8, ebb_w9 = HRS_m_ds_ebb_w9, ebb_w10 = HRS_m_ds_ebb_w10, ebb_w11 = HRS_m_ds_ebb_w11, mbb_w11 = HRS_m_ds_mbb_w11)

#################################

# Table HRS
t.hrs <- frq(lb.hrs[[1]][2])[[1]][,c(1,2,4)] 
for (i in 1:10){
  t.hrs[3+i] <- frq(lf.hrs[[i]][2])[[1]][,4] 
}
t.hrs[13,] <- c("n", "sample size", length(lb.hrs[[1]][[2]]),
             length(lf.hrs[[1]][[2]]), length(lf.hrs[[2]][[2]]), length(lf.hrs[[3]][[2]]), length(lf.hrs[[4]][[2]]), length(lf.hrs[[5]][[2]]), length(lf.hrs[[6]][[2]]), length(lf.hrs[[7]][[2]]), length(lf.hrs[[8]][[2]]), length(lf.hrs[[9]][[2]]), length(lf.hrs[[10]][[2]])
             )
names(t.hrs)<-c("val", "label", "w1", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.hrs)

dbb <- merge(HRS_m_ds_hrs_w1[,c("id","h_respiratory")], HRS_m_ds_hrs_w2[,c("id","h_respiratory")], by="id", suffixes = c(".w1",".w2"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w3[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w4[,c("id","h_respiratory")], by="id", suffixes = c(".w3",".w4"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w5[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w6[,c("id","h_respiratory")], by="id", suffixes = c(".w5",".w6"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w7[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w8[,c("id","h_respiratory")], by="id", suffixes = c(".w7",".w8"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w9[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w10[,c("id","h_respiratory")], by="id", suffixes = c(".w9",".w10"), all=T)
dbb <- merge(dbb, HRS_m_ds_hrs_w11[,c("id","h_respiratory")], by="id", all=T)
names(dbb) <- c("id", "w1", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],dbb[,9],dbb[,10],dbb[,11],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table AHEAD
t.ahead <- frq(lb.hrs[[2]][2])[[1]][,c(1,2,4)] 
for (i in 1:9){
  t.ahead[3+i] <- frq(lf.hrs[[i+10]][2])[[1]][,4] 
}
t.ahead[13,] <- c("n", "sample size", length(lb.hrs[[2]][[2]]),
             length(lf.hrs[[11]][[2]]), length(lf.hrs[[12]][[2]]), length(lf.hrs[[13]][[2]]), length(lf.hrs[[14]][[2]]), length(lf.hrs[[15]][[2]]), length(lf.hrs[[16]][[2]]), length(lf.hrs[[17]][[2]]), length(lf.hrs[[18]][[2]]), length(lf.hrs[[19]][[2]])
             )
names(t.ahead)<-c("val", "label", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.ahead)

dbb <- merge(HRS_m_ds_ahead_w2[,c("id","h_respiratory")], HRS_m_ds_ahead_w3[,c("id","h_respiratory")], by="id", suffixes = c(".w2",".w3"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w4[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w5[,c("id","h_respiratory")], by="id", suffixes = c(".w4",".w5"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w6[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w7[,c("id","h_respiratory")], by="id", suffixes = c(".w6",".w7"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w8[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w9[,c("id","h_respiratory")], by="id", suffixes = c(".w8",".w9"), all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w10[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ahead_w11[,c("id","h_respiratory")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w2", "w3", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],dbb[,9],dbb[,10],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table CODA
t.coda <- frq(lb.hrs[[3]][2])[[1]][,c(1,2,4)] 
for (i in 1:7){
  t.coda[3+i] <- frq(lf.hrs[[19+i]][2])[[1]][,4] 
}
t.coda[13,] <- c("n", "sample size", length(lb.hrs[[3]][[2]]),
             length(lf.hrs[[20]][[2]]), length(lf.hrs[[21]][[2]]), length(lf.hrs[[22]][[2]]), length(lf.hrs[[23]][[2]]), length(lf.hrs[[24]][[2]]), length(lf.hrs[[25]][[2]]), length(lf.hrs[[26]][[2]])
             )
names(t.coda)<-c("val", "label", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.coda)

dbb <- merge(HRS_m_ds_coda_w4[,c("id","h_respiratory")], HRS_m_ds_coda_w5[,c("id","h_respiratory")], by="id", suffixes = c(".w4",".w5"), all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w6[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w7[,c("id","h_respiratory")], by="id", suffixes = c(".w6",".w7"), all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w8[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w9[,c("id","h_respiratory")], by="id", suffixes = c(".w8",".w9"), all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w10[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_coda_w11[,c("id","h_respiratory")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table WB
t.wb <- frq(lb.hrs[[4]][2])[[1]][,c(1,2,4)] 
for (i in 1:7){
  t.wb[3+i] <- frq(lf.hrs[[26+i]][2])[[1]][,4] 
}
t.wb[13,] <- c("n", "sample size", length(lb.hrs[[4]][[2]]),
             length(lf.hrs[[27]][[2]]), length(lf.hrs[[28]][[2]]), length(lf.hrs[[29]][[2]]), length(lf.hrs[[30]][[2]]), length(lf.hrs[[31]][[2]]), length(lf.hrs[[32]][[2]]), length(lf.hrs[[33]][[2]])
             )
names(t.wb)<-c("val", "label", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
kable(t.wb)

dbb <- merge(HRS_m_ds_wb_w4[,c("id","h_respiratory")], HRS_m_ds_wb_w5[,c("id","h_respiratory")], by="id", suffixes = c(".w4",".w5"), all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w6[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w7[,c("id","h_respiratory")], by="id", suffixes = c(".w6",".w7"), all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w8[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w9[,c("id","h_respiratory")], by="id", suffixes = c(".w8",".w9"), all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w10[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_wb_w11[,c("id","h_respiratory")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w4", "w5", "w6", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],dbb[,7],dbb[,8],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table EBB
t.ebb <- frq(lb.hrs[[5]][2])[[1]][,c(1,2,4)] 
for (i in 1:4){
  t.ebb[3+i] <- frq(lf.hrs[[33+i]][2])[[1]][,4] 
}
t.ebb[13,] <- c("n", "sample size", length(lb.hrs[[5]][[2]]),
             length(lf.hrs[[34]][[2]]), length(lf.hrs[[35]][[2]]), length(lf.hrs[[36]][[2]]), length(lf.hrs[[37]][[2]])
             )
names(t.ebb)<-c("val", "label", "w7", "w8", "w9", "w10", "w11")
kable(t.ebb)

dbb <- merge(HRS_m_ds_ebb_w7[,c("id","h_respiratory")], HRS_m_ds_ebb_w8[,c("id","h_respiratory")], by="id", suffixes = c(".w7",".w8"), all=T)
dbb <- merge(dbb, HRS_m_ds_ebb_w9[,c("id","h_respiratory")], by="id", all=T)
dbb <- merge(dbb, HRS_m_ds_ebb_w10[,c("id","h_respiratory")], by="id", suffixes = c(".w9",".w10"), all=T)
dbb <- merge(dbb, HRS_m_ds_ebb_w11[,c("id","h_respiratory")], by="id", all=T)
names(dbb) <- c("id", "w7", "w8", "w9", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],dbb[,4],dbb[,5],dbb[,6],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

# Table MBB
t.mbb <- frq(lb.hrs[[6]][2])[[1]][,c(1,2,4)] 
for (i in 1:1){
  t.mbb[3+i] <- frq(lf.hrs[[37+i]][2])[[1]][,4] 
}
t.mbb[13,] <- c("n", "sample size", length(lb.hrs[[6]][[2]]), length(lf.hrs[[38]][[2]]))
names(t.mbb)<-c("val", "label", "w10", "w11")
kable(t.mbb)

dbb <- merge(HRS_m_ds_mbb_w10[,c("id","h_respiratory")], HRS_m_ds_mbb_w11[,c("id","h_respiratory")], by="id", suffixes = c(".w10",".w11"), all=T)
names(dbb) <- c("id", "w10", "w11")
v.dbb <- paste(dbb[,2],dbb[,3],sep="")
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

```



# Quality estimation

We assume that if an individual answers it has some chronic respiratory disease in one wave, it has for all the next waves.



<!-- ########################################################## --> 
<!-- # Save -->
```{r save, include=FALSE, echo=F}


for(name in names(lb.hrs)){
  h_respiratory <- lb.hrs[[name]]
  save(h_respiratory, file = paste0(datafolder,name,"/h_respiratory.RData"))
}

for(name in names(lf.hrs)) {
  h_respiratory <- lf.hrs[[name]]
  save(h_respiratory, file = paste0(datafolder,name,"/h_respiratory.RData"))
}


```
<!-- ########################################################## --> 






<!-- ########################################################## -->
<!--- # Close OPAL R Session -->
```{r closeRsession, echo=FALSE}
opal.logout(o)
```





