---
title: "Current depressive status"
output: 
  html_document:
    theme: united
    highlight: tango
    toc: true
    toc_depth: 6
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: true
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->



```{r setup, include=FALSE, echo=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_albert.r")
```

<!-- ########################################################## --> 

# Description of DataSchema variable

The description of harmonised variable is the following:

* Short name: `depression`
* Variable label: `Current depressive status of the participant`
* Variable description: `Current depressive status of the participant`
* Domain: `Psycological measures`
* Value type: `categorical`
* Category coding:

**Code** | **Category Label**
-------- | ------------------
0        | no depression
1        | depression

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing


```{r lab, echo=FALSE}
ds_label <- "Current depressive status"
ds_label_all <- "Current depressive status of the participant"
```


<!-- ########################################################## --> 

# Data process

## Poland 

### Wave 1

#### Study-specific variable description


| **Name** | `p54a`| `p54b` | `p54c` | `p54d` | `p54e` | `p54f` | `p54g` | `p54h` | `p54i` | `p54j` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `I was bothered by things that usually do not bother me`| `I did not feel like eating, my appeitite was poor` | `I felt like I could not shake off the blues even with help from family/friends` | `I felt that I was just as good as other people` | `I had trouble keeping my mind on what I was doing` | `I felt depressed` | `I felt that everything I did was an effort` | `I felt hopeful about the future` | `I thought my life had been a failure` | `I felt fearful` | 
| **Table name** | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` |
| **Categories** |`Less than 1 day`| `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | 
| | ` 1-2 days` | ` 1-2 days`| ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | 
| | `3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | 
| | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | 



| **Name** | `p54k`| `p54l` | `p54m` | `p54n` | `p54o` | `p54p` | `p54q` | `p54r` | `p54s` | `p54t` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `My sleep was restless`| `I was happy` | `I talked less than usual` | `I felt lonely` | `People were unfriendly` | `I enjoyed life` | `I had crying spells` | `I felt sad` | `I felt people dislike me` | `I could not get going` | 
| **Table name** | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` |
| **Categories** |`Less than 1 day`| `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | 
| | ` 1-2 days` | ` 1-2 days`| ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | 
| | `3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | 
| | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | 

```{r assign_po1, echo=FALSE}
opal.assign.table.tibble(o, 'HAPIEE_dep','HAPIEE.Po_baseline_etic',
                         variables=list('p54a', 'p54b', 'p54c', 'p54d', 'p54e', 'p54f', 'p54g', 'p54h', 'p54i', 'p54j', 'p54k', 'p54l', 'p54m', 'p54n', 'p54o', 'p54p', 'p54q', 'p54r', 'p54s', 'p54t'), missings = TRUE)
HAPIEE_dep <- opal.execute(o,'HAPIEE_dep')
```

```{r local_po1, echo=FALSE}
vari <- HAPIEE_dep$p54a
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54b
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54c
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54d
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54e
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54f
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54g
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54h
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54i
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54j
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54k
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54l
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54m
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54n
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54o
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54p
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54q
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54r
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54s
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54t
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 
* The reversed items p54d, p54h, p54l, p54p: 
  + `recode 'Less than 1 day' into 3`
  + `recode '1-2 days' into 2`
  + `recode '3-4 days' into 1`
  + `recode '5-7 days' into 0`
* The direct items p54a, p54b, p54c,p54e, p54f, p54g, p54i, p54j, p54k, p54m, p54n, p54o, p54q, p54r, p54s, p54t: 
  + `recode 'Less than 1 day' into 0`
  + `recode '1-2 days' into 1`
  + `recode '3-4 days' into 2`
  + `recode '5-7 days' into 3`

Secondly in order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 20. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 

* `0-15 into 0`
* `>16 into 1`
* `NA into 999`

**R script:**

```{r harmo_po1, echo=TRUE}
#reversed items
HAPIEE_dep$pd <- car::recode(HAPIEE_dep$p54d, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0")
HAPIEE_dep$ph <- car::recode(HAPIEE_dep$p54h, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0")
HAPIEE_dep$pl <- car::recode(HAPIEE_dep$p54l, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0")
HAPIEE_dep$pp <- car::recode(HAPIEE_dep$p54p, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0")


#direct items
HAPIEE_dep$pa <- car::recode(HAPIEE_dep$p54a, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pb <- car::recode(HAPIEE_dep$p54b, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pc <- car::recode(HAPIEE_dep$p54c, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pe <- car::recode(HAPIEE_dep$p54e, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pf <- car::recode(HAPIEE_dep$p54f, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pg <- car::recode(HAPIEE_dep$p54g, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pi <- car::recode(HAPIEE_dep$p54i, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pj <- car::recode(HAPIEE_dep$p54j, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pk <- car::recode(HAPIEE_dep$p54k, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pm <- car::recode(HAPIEE_dep$p54m, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pn <- car::recode(HAPIEE_dep$p54n, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$po <- car::recode(HAPIEE_dep$p54o, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pq <- car::recode(HAPIEE_dep$p54q, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pr <- car::recode(HAPIEE_dep$p54r, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$ps <- car::recode(HAPIEE_dep$p54s, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")
HAPIEE_dep$pt <- car::recode(HAPIEE_dep$p54t, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3")

HAPIEE_dep$nmiss <- apply(HAPIEE_dep[,22:41], MARGIN = 1, FUN = function(x) sum(is.na(x)))


HAPIEE_dep$final_score <- apply(HAPIEE_dep[,22:41], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))

HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss>4)] <- 999

HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==3)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==3)]/17)*20
HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)]/18)*20
HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)]/19)*20

HAPIEE_pol_ds_w1 <- tibble(id=HAPIEE_dep$id)
HAPIEE_pol_ds_w1$depression <- car::recode(HAPIEE_dep$final_score, "0:15.99999999=0; 16:900=1")
HAPIEE_pol_ds_w1$depression <- labelled(HAPIEE_pol_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_po1, echo=FALSE}
vari <- HAPIEE_pol_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(HAPIEE_pol_ds_w1, aes(x=factor(HAPIEE_pol_ds_w1[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_po1, echo=FALSE}
BeforeH <- c(sum(na.omit(HAPIEE_dep$final_score)<16), sum(na.omit(HAPIEE_dep$final_score)>=16 & na.omit(HAPIEE_dep$final_score)<900), sum(na.omit(HAPIEE_dep$final_score)==999))
AfterH <- table(HAPIEE_pol_ds_w1[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1", "NA->999") 
kable(C)
```


```{r importOPAL_po1, echo=FALSE}
#opal.assign.data(o, 'HAPIEE_pol_ds_w1', HAPIEE_pol_ds_w1)
#opal.symbol_import(o,'HAPIEE_pol_ds_w1', project='_Athlos_Harm_Dataset')

label(HAPIEE_pol_ds_w1$depression) <- ds_label_all
depression <- HAPIEE_pol_ds_w1
save(depression, file = "../RData/pol_w1/depression.RData")
rm(depression)

HAPIEE_pol_m_ds_w1 <- HAPIEE_pol_ds_w1
HAPIEE_pol_m_ds_w1$depression <- car::recode(HAPIEE_pol_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'HAPIEE_pol_m_ds_w1', HAPIEE_pol_m_ds_w1)
#opal.symbol_import(o,'HAPIEE_pol_m_ds_w1', project='_Athlos_Harm_Dataset')
```



### Wave 2

#### Study-specific variable description


| **Name** | `w2p54f`| `w2p54g` | `w2p54k` | `w2p54l` | `w2p54n` | `w2p54o` | `w2p54p` | `w2p54r` | `w2p54s` | `w2p54t` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `CESD10 I felt depressed.`| `CESD10 I felt that everything I did was an effort` | `CESD10 My sleep was restless` | `CESD10 I was happy` | `CESD10 I felt lonely` | `CESD10 People were unfriendly` | `CESD10 I enjoyed life` | `CESD10 I felt sad` | `CESD10 I felt people disliked me` | `CESD10 I could not get going` | 
| **Table name** | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` |
| **Categories** |`no`| `no` | `no` | `no` | `no` | `no` | `no` | `no` | `no` | `no` | 
| | ` yes` | ` yes`| ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | 
| **Missing** |`.b = refused`| `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | 
| | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | 
| | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` |

```{r assign_po2, echo=FALSE}
opal.assign.table.tibble(o, 'HAPIEE_dep','HAPIEE.Po_reexamination_etic',
                         variables=list('w2p54f', 'w2p54g', 'w2p54k', 'w2p54l', 'w2p54n', 'w2p54o', 'w2p54p', 'w2p54r', 'w2p54s', 'w2p54t'), missings = TRUE)
HAPIEE_dep <- opal.execute(o,'HAPIEE_dep')
```

```{r local_po2, echo=FALSE}
vari <- HAPIEE_dep$w2p54f
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54g
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54k
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54l
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54n
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54o
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54p
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54r
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54s
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54t
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 

* The reversed items w2p54l, w2p54p: 
   + `recode 'yes' into 0`
   + `recode 'no' into 1`
  
* The direct items w2p54f, w2p54g, w2p54k, w2p54n, w2p54o, w2p54r, w2p54s, w2p54t: 
    + `recode 'yes' into 1`
   + `recode 'no' into 0`  

Secondly in order to get the final score the items have to be summed. If one to 2 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 10. If more than 2 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 

* `0-3 into 0`
* `>4 into 1`
* `NA into`
  + `997 if the individual has more items = .b than .c, .d and NA`
  + `998 if the individual has more items = .c than .b, .d and NA`
  + `992 if the individual has more items = .d than .b, .c and NA`
  + `999 if the individual has more items = NA than .d, .c and .b`

**R script:**

```{r harmo_po2, echo=TRUE}
#reversed items
HAPIEE_dep$pl <- car::recode(HAPIEE_dep$w2p54l, "'yes'=0; 'no'=1; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$pp <- car::recode(HAPIEE_dep$w2p54p, "'yes'=0; 'no'=1; '.c'=NA; '.b'=NA; '.d'=NA")

#direct items
HAPIEE_dep$pf <- car::recode(HAPIEE_dep$w2p54f, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$pg <- car::recode(HAPIEE_dep$w2p54g, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$pk <- car::recode(HAPIEE_dep$w2p54k, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$pn <- car::recode(HAPIEE_dep$w2p54n, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$po <- car::recode(HAPIEE_dep$w2p54o, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$pr <- car::recode(HAPIEE_dep$w2p54r, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$ps <- car::recode(HAPIEE_dep$w2p54s, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")
HAPIEE_dep$pt <- car::recode(HAPIEE_dep$w2p54t, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA")


HAPIEE_dep$nmiss <- apply(HAPIEE_dep[,12:21], MARGIN = 1, FUN = function(x) sum(is.na(x)))


HAPIEE_dep$final_score <- apply(HAPIEE_dep[,12:21], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))


HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)]/8)*10
HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)]/9)*10

HAPIEE_dep$nb <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(x=='.b', na.rm = TRUE))
HAPIEE_dep$nc <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(x=='.c', na.rm = TRUE))
HAPIEE_dep$nd <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(x=='.d', na.rm = TRUE))
HAPIEE_dep$nNA <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(is.na(x)))

HAPIEE_dep$max_bcd_NA <- apply(HAPIEE_dep[,24:27], MARGIN = 1, FUN = function(x) which.max(x))
HAPIEE_dep$max_bcd_NA <- car::recode(HAPIEE_dep$max_bcd_NA, "1=997;2=998;3=992;4=999")

HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss>2)] <- HAPIEE_dep$max_bcd_NA[which(HAPIEE_dep$nmiss>2)]


HAPIEE_pol_ds_w2 <- tibble(id=HAPIEE_dep$id)
HAPIEE_pol_ds_w2$depression <- car::recode(HAPIEE_dep$final_score, "0:3.99999999=0; 4:900=1")
HAPIEE_pol_ds_w2$depression <- labelled(HAPIEE_pol_ds_w2[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_po2, echo=FALSE}
vari <- HAPIEE_pol_ds_w2$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(HAPIEE_pol_ds_w2, aes(x=factor(HAPIEE_pol_ds_w2[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_po2, echo=FALSE}
BeforeH <- c(sum(na.omit(HAPIEE_dep$final_score)<4), sum(na.omit(HAPIEE_dep$final_score)>=4 & na.omit(HAPIEE_dep$final_score)<900), sum(na.omit(HAPIEE_dep$final_score)==997), sum(na.omit(HAPIEE_dep$final_score)==999))
AfterH <- table(HAPIEE_pol_ds_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<4->0",">=4->1",".b->997", "NA->999") 
kable(C)
```


```{r importOPAL_po2, echo=FALSE}
#opal.assign.data(o, 'HAPIEE_pol_ds_w2', HAPIEE_pol_ds_w2)
#opal.symbol_import(o,'HAPIEE_pol_ds_w2', project='_Athlos_Harm_Dataset')

label(HAPIEE_pol_ds_w2$depression) <- ds_label_all
depression <- HAPIEE_pol_ds_w2
save(depression, file = "../RData/pol_w2/depression.RData")
rm(depression, HAPIEE_dep)

HAPIEE_pol_m_ds_w2 <- HAPIEE_pol_ds_w2
HAPIEE_pol_m_ds_w2$depression <- car::recode(HAPIEE_pol_m_ds_w2$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
opal.assign.data(o, 'HAPIEE_pol_m_ds_w2', HAPIEE_pol_m_ds_w2)
#opal.symbol_import(o,'HAPIEE_pol_m_ds_w2', project='_Athlos_Harm_Dataset')
```





## Czech Republic 

### Wave 1

#### Study-specific variable description

 
| **Name** | `p54a`| `p54b` | `p54c` | `p54d` | `p54e` | `p54f` | `p54g` | `p54h` | `p54i` | `p54j` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `I was bothered by things that usually do not bother me`| `I did not feel like eating, my appeitite was poor` | `I felt like I could not shake off the blues even with help from family/friends` | `I felt that I was just as good as other people` | `I had trouble keeping my mind on what I was doing` | `I felt depressed` | `I felt that everything I did was an effort` | `I felt hopeful about the future` | `I thought my life had been a failure` | `I felt fearful` | 
| **Table name** | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` |
| **Categories** |`Less than 1 day`| `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | 
| | ` 1-2 days` | ` 1-2 days`| ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | 
| | `3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | 
| | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | 



| **Name** | `p54k`| `p54l` | `p54m` | `p54n` | `p54o` | `p54p` | `p54q` | `p54r` | `p54s` | `p54t` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `My sleep was restless`| `I was happy` | `I talked less than usual` | `I felt lonely` | `People were unfriendly` | `I enjoyed life` | `I had crying spells` | `I felt sad` | `I felt people dislike me` | `I could not get going` | 
| **Table name** | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` | `Po_baseline_etic` |
| **Categories** |`Less than 1 day`| `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | `Less than 1 day` | 
| | ` 1-2 days` | ` 1-2 days`| ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | ` 1-2 days` | 
| | `3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | ` 3-4 days` | 
| | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | ` 5-7 days` | 

```{r assign_cz1, echo=FALSE}
opal.assign.table.tibble(o, 'HAPIEE_dep','HAPIEE.Cz_baseline_etic',
                         variables=list('p54a', 'p54b', 'p54c', 'p54d', 'p54e', 'p54f', 'p54g', 'p54h', 'p54i', 'p54j', 'p54k', 'p54l', 'p54m', 'p54n', 'p54o', 'p54p', 'p54q', 'p54r', 'p54s', 'p54t'), missings = TRUE)
HAPIEE_dep <- opal.execute(o,'HAPIEE_dep')
```

```{r local_cz1, echo=FALSE}
vari <- HAPIEE_dep$p54a
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54b
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54c
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54d
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54e
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54f
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54g
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54h
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54i
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54j
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54k
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54l
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54m
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54n
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54o
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54p
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54q
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54r
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54s
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$p54t
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 
* The reversed items p54d, p54h, p54l, p54p: 
  + `recode 'Less than 1 day' into 3`
  + `recode '1-2 days' into 2`
  + `recode '3-4 days' into 1`
  + `recode '5-7 days' into 0`
* The direct items p54a, p54b, p54c,p54e, p54f, p54g, p54i, p54j, p54k, p54m, p54n, p54o, p54q, p54r, p54s, p54t: 
  + `recode 'Less than 1 day' into 0`
  + `recode '1-2 days' into 1`
  + `recode '3-4 days' into 2`
  + `recode '5-7 days' into 3`

Secondly in order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 20. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 

* `0-15 into 0`
* `>16 into 1`
* `NA into 999`

There is a individual that has all the values 9, it is going to consider as missing and will be recoded as 999. 

**R script:**

```{r harmo_cz1, echo=TRUE}
#reversed items
HAPIEE_dep$pd <- car::recode(HAPIEE_dep$p54d, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0; '9'=NA")
HAPIEE_dep$ph <- car::recode(HAPIEE_dep$p54h, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0; '9'=NA")
HAPIEE_dep$pl <- car::recode(HAPIEE_dep$p54l, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0; '9'=NA")
HAPIEE_dep$pp <- car::recode(HAPIEE_dep$p54p, "'Less than 1 day'=3; '1-2 days'=2; '3-4 days'=1; '5-7 days'=0; '9'=NA")


#direct items
HAPIEE_dep$pa <- car::recode(HAPIEE_dep$p54a, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pb <- car::recode(HAPIEE_dep$p54b, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pc <- car::recode(HAPIEE_dep$p54c, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pe <- car::recode(HAPIEE_dep$p54e, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pf <- car::recode(HAPIEE_dep$p54f, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pg <- car::recode(HAPIEE_dep$p54g, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pi <- car::recode(HAPIEE_dep$p54i, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pj <- car::recode(HAPIEE_dep$p54j, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pk <- car::recode(HAPIEE_dep$p54k, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pm <- car::recode(HAPIEE_dep$p54m, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pn <- car::recode(HAPIEE_dep$p54n, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$po <- car::recode(HAPIEE_dep$p54o, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pq <- car::recode(HAPIEE_dep$p54q, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pr <- car::recode(HAPIEE_dep$p54r, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$ps <- car::recode(HAPIEE_dep$p54s, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")
HAPIEE_dep$pt <- car::recode(HAPIEE_dep$p54t, "'Less than 1 day'=0; '1-2 days'=1; '3-4 days'=2; '5-7 days'=3; '9'=NA")

HAPIEE_dep$nmiss <- apply(HAPIEE_dep[,22:41], MARGIN = 1, FUN = function(x) sum(is.na(x)))


HAPIEE_dep$final_score <- apply(HAPIEE_dep[,22:41], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))

HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss>4)] <- 999

HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==3)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==3)]/17)*20
HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)]/18)*20
HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)]/19)*20

HAPIEE_cz_ds_w1 <- tibble(id=HAPIEE_dep$id)
HAPIEE_cz_ds_w1$depression <- car::recode(HAPIEE_dep$final_score, "0:15.99999999=0; 16:900=1")
HAPIEE_cz_ds_w1$depression <- labelled(HAPIEE_cz_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_cz1, echo=FALSE}
vari <- HAPIEE_cz_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(HAPIEE_cz_ds_w1, aes(x=factor(HAPIEE_cz_ds_w1[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_cz1, echo=FALSE}
BeforeH <- c(sum(na.omit(HAPIEE_dep$final_score)<16), sum(na.omit(HAPIEE_dep$final_score)>=16 & na.omit(HAPIEE_dep$final_score)<900), sum(na.omit(HAPIEE_dep$final_score)==999))
AfterH <- table(HAPIEE_cz_ds_w1[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1", "NA->999") 
kable(C)
```


```{r importOPAL_cz1, echo=FALSE}
#opal.assign.data(o, 'HAPIEE_cz_ds_w1', HAPIEE_cz_ds_w1)
#opal.symbol_import(o,'HAPIEE_cz_ds_w1', project='_Athlos_Harm_Dataset')


label(HAPIEE_cz_ds_w1$depression) <- ds_label_all
depression <- HAPIEE_cz_ds_w1
save(depression, file = "../RData/cz_w1/depression.RData")
rm(depression, HAPIEE_dep)

HAPIEE_cz_m_ds_w1 <- HAPIEE_cz_ds_w1
HAPIEE_cz_m_ds_w1$depression <- car::recode(HAPIEE_cz_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
opal.assign.data(o, 'HAPIEE_cz_m_ds_w1', HAPIEE_cz_m_ds_w1)
#opal.symbol_import(o,'HAPIEE_cz_m_ds_w1', project='_Athlos_Harm_Dataset')
```







### Wave 2

#### Study-specific variable description

| **Name** | `w2p54f`| `w2p54g` | `w2p54k` | `w2p54l` | `w2p54n` | `w2p54o` | `w2p54p` | `w2p54r` | `w2p54s` | `w2p54t` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `CESD10 I felt depressed.`| `CESD10 I felt that everything I did was an effort` | `CESD10 My sleep was restless` | `CESD10 I was happy` | `CESD10 I felt lonely` | `CESD10 People were unfriendly` | `CESD10 I enjoyed life` | `CESD10 I felt sad` | `CESD10 I felt people disliked me` | `CESD10 I could not get going` | 
| **Table name** | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` | `Cz_reexamination_etic` |
| **Categories** |`no`| `no` | `no` | `no` | `no` | `no` | `no` | `no` | `no` | `no` | 
| | ` yes` | ` yes`| ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | 
| **Missing** |`.b = refused`| `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | 
| | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | 
| | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` |

```{r assign_cz2, echo=FALSE}
opal.assign.table.tibble(o, 'HAPIEE_dep','HAPIEE.Cz_reexamination_etic',
                         variables=list('w2p54f', 'w2p54g', 'w2p54k', 'w2p54l', 'w2p54n', 'w2p54o', 'w2p54p', 'w2p54r', 'w2p54s', 'w2p54t'), missings = TRUE)
HAPIEE_dep <- opal.execute(o,'HAPIEE_dep')
```

```{r local_cz2, echo=FALSE}
vari <- HAPIEE_dep$w2p54f
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54g
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54k
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54l
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54n
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54o
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54p
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54r
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54s
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54t
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d', '7', '8', '9'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 
* The reversed items w2p54l, w2p54p: 
  + `recode 'yes' into 0`
  + `recode 'no' into 1`
  
* The direct items w2p54f, w2p54g, w2p54k, w2p54n, w2p54o, w2p54r, w2p54s, w2p54t: 
  + `recode 'yes' into 1`
  + `recode 'no' into 0`  

Secondly in order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 10. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 

* `0-3 into 0`
* `>4 into 1`
* `NA into`
  + `997 if the individual has more items = .b than .c, .d and NA`
  + `998 if the individual has more items = .c than .b, .d and NA`
  + `992 if the individual has more items = .d than .b, .c and NA`
  + `999 if the individual has more items = NA than .d, .c and .b`


There are individuals that has values 8 or 9, it is going to consider as missing and will be recoded as 999. 

**R script:**

```{r harmo_cz2, echo=TRUE}
#reversed items
HAPIEE_dep$pl <- car::recode(HAPIEE_dep$w2p54l, "'yes'=0; 'no'=1; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$pp <- car::recode(HAPIEE_dep$w2p54p, "'yes'=0; 'no'=1; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")

#direct items
HAPIEE_dep$pf <- car::recode(HAPIEE_dep$w2p54f, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$pg <- car::recode(HAPIEE_dep$w2p54g, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$pk <- car::recode(HAPIEE_dep$w2p54k, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$pn <- car::recode(HAPIEE_dep$w2p54n, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$po <- car::recode(HAPIEE_dep$w2p54o, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$pr <- car::recode(HAPIEE_dep$w2p54r, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$ps <- car::recode(HAPIEE_dep$w2p54s, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")
HAPIEE_dep$pt <- car::recode(HAPIEE_dep$w2p54t, "'yes'=1; 'no'=0; '.c'=NA; '.b'=NA; '.d'=NA; '8'=NA; '9'=NA")


HAPIEE_dep$nmiss <- apply(HAPIEE_dep[,12:21], MARGIN = 1, FUN = function(x) sum(is.na(x)))

HAPIEE_dep$final_score <- apply(HAPIEE_dep[,12:21], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))


HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==2)]/8)*10
HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)] <- (HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss==1)]/9)*10

HAPIEE_dep$nb <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(x=='.b', na.rm = TRUE))
HAPIEE_dep$nc <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(x=='.c', na.rm = TRUE))
HAPIEE_dep$nd <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(x=='.d', na.rm = TRUE))
HAPIEE_dep$nNA <- apply(HAPIEE_dep[,2:11], MARGIN = 1, FUN = function(x) sum(is.na(x)))

HAPIEE_dep$max_bcd_NA <- apply(HAPIEE_dep[,24:27], MARGIN = 1, FUN = function(x) which.max(x))
HAPIEE_dep$max_bcd_NA <- car::recode(HAPIEE_dep$max_bcd_NA, "1=997;2=998;3=992;4=999")

HAPIEE_dep$final_score[which(HAPIEE_dep$nmiss>2)] <- HAPIEE_dep$max_bcd_NA[which(HAPIEE_dep$nmiss>2)]



HAPIEE_cz_ds_w2 <- tibble(id=HAPIEE_dep$id)
HAPIEE_cz_ds_w2$depression <- car::recode(HAPIEE_dep$final_score, "0:3.99999999=0; 4:900=1")
HAPIEE_cz_ds_w2$depression <- labelled(HAPIEE_cz_ds_w2[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_cz2, echo=FALSE}
vari <- HAPIEE_cz_ds_w2$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(HAPIEE_cz_ds_w2, aes(x=factor(HAPIEE_cz_ds_w2[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_cz2, echo=FALSE}
BeforeH <- c(sum(na.omit(HAPIEE_dep$final_score)<4), sum(na.omit(HAPIEE_dep$final_score)>=4 & na.omit(HAPIEE_dep$final_score)<900), sum(na.omit(HAPIEE_dep$final_score)==997), sum(na.omit(HAPIEE_dep$final_score)==999))
AfterH <- table(HAPIEE_cz_ds_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<4->0",">=4->1",".b->997", "NA->999") 
kable(C)
```


```{r importOPAL_cz2, echo=FALSE}
#opal.assign.data(o, 'HAPIEE_cz_ds_w2', HAPIEE_cz_ds_w2)
#opal.symbol_import(o,'HAPIEE_cz_ds_w2', project='_Athlos_Harm_Dataset')

label(HAPIEE_cz_ds_w2$depression) <- ds_label_all
depression <- HAPIEE_cz_ds_w2
save(depression, file = "../RData/cz_w2/depression.RData")
rm(depression)

HAPIEE_cz_m_ds_w2 <- HAPIEE_cz_ds_w2
HAPIEE_cz_m_ds_w2$depression <- car::recode(HAPIEE_cz_m_ds_w2$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'HAPIEE_cz_m_ds_w2', HAPIEE_cz_m_ds_w2)
#opal.symbol_import(o,'HAPIEE_cz_m_ds_w2', project='_Athlos_Harm_Dataset')
```







## Lithuania 

### Wave 1

#### Study-specific variable description

| **Name** | `w2p54f`| `w2p54g` | `w2p54k` | `w2p54l` | `w2p54n` | `w2p54o` | `w2p54p` | `w2p54r` | `w2p54s` | `w2p54t` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `CESD10 I felt depressed.`| `CESD10 I felt that everything I did was an effort` | `CESD10 My sleep was restless` | `CESD10 I was happy` | `CESD10 I felt lonely` | `CESD10 People were unfriendly` | `CESD10 I enjoyed life` | `CESD10 I felt sad` | `CESD10 I felt people disliked me` | `CESD10 I could not get going` | 
| **Table name** | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` | `Po_reexamination_etic` |
| **Categories** |`no`| `no` | `no` | `no` | `no` | `no` | `no` | `no` | `no` | `no` | 
| | ` yes` | ` yes`| ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | ` yes` | 
| **Missing** |`.b = refused`| `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | `.b = refused` | 
| | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | `.c = don't know` | 
| | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` | `.d = impute` |


```{r assign_li1, echo=FALSE}
opal.assign.table.tibble(o, 'HAPIEE_dep','HAPIEE.Li_baseline_etic',
                         variables=list('w2p54f', 'w2p54g', 'w2p54k', 'w2p54l', 'w2p54n', 'w2p54o', 'w2p54p', 'w2p54r', 'w2p54s', 'w2p54t'), missings = TRUE)
HAPIEE_dep <- opal.execute(o,'HAPIEE_dep')
```

```{r local_li1, echo=FALSE}
vari <- HAPIEE_dep$w2p54f
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54g
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54k
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54l
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54n
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54o
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54p
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54r
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54s
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- HAPIEE_dep$w2p54t
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c('.b', '.c', '.d'))[2], caption = "Type of missing")
ggplot(HAPIEE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

All the variables are missing, the harmonized variable can't be calculated. 


# Quality estimation

The 20 items version test (likert) of the Center for Epidemiologic Depression Scale was used for the first waves and the 10-item version test (binary response) was used for the 'follow-up and reexamination'.
We got the final variable using single items because didn't have the final score variable.
Missing values were treated as follows:
- 20 item version: maximum 3 items were allowed > score the completed items divided by the number of items answered and multiplied by 20
- 10 item version: maximum 2 items were allowed > score the completed items divided by the number of items answered and multiplied by 10


```{r closeRsession, echo=FALSE} 
opal.logout(o)
```
