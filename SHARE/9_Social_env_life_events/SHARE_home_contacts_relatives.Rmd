---
title: "SHARE"
author: "Katarzyna Jablonska"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true 
    depth: 4
    number_sections: true  
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r prepare, message=FALSE, include=FALSE}
library(bitops)
library(RCurl)
library(rjson)
library(mime)
library(opal)
library(tibble)
library(car)
library(labelled)
library(Hmisc)
source("Continuous_summary.R")
source("Categorical_summary.R")

# authenticate within opal server 
o <- opal.login('','...','http://...')
```

# Socio-demographic and economic characteristics 

## `Living with relatives`

### Description of DataSchema variable `Are living in home with family members/relatives (= daily contact with family member)?`

The description of harmonised variable is the following:
  
* Name: `home_rel`
* Label: `Are living in home with family members/relatives (= daily contact with family member)?`
* Type: categorical
* Categories: 
    + `0 = no`
    + `1 = yes`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done/not yet recorded`
    + `995 = Don't answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`


### SHARE - Wave 1

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `cv018_2` UP TO `cv018_9` **from table sharew1_rel2-6-0_cv_h**
* Label: `relation hhmember to respondent`
* Categories:
    + `1 = spouse`
    + `2 = partner`
    + `3 = child`
    + `4 = child-in-law`
    + `5 = parent`
    + `6 = parent-in-law`
    + `7 = sibling`
    + `8 = grand-child`
    + `9 = other relative (specify)`
    + `10 = other non-relative (specify)`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`
 
 
```{r assign1}
opal.assign.table.tibble(o, 'SHARE_w1_home_rel','SHARE.sharew1_rel2-6-0_cv_h', 
                        variables=list('cv018_2','cv018_3','cv018_4','cv018_5','cv018_6','cv018_7','cv018_8','cv018_9'), missings = TRUE)

```

```{r local1}
SHARE_w1_home_rel <- opal.execute(o,'SHARE_w1_home_rel')
Categorical_summary(var =SHARE_w1_home_rel$cv018_2, missing_values = NA)
ggplot(SHARE_w1_home_rel, aes(x=factor(cv018_2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("relation hhmember to respondent") + ylab("Frequency") 
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any is in 1:9 then 1`

R code of the ALGORITHM:

```{r harmo1}
SHARE_ds_w1 <- tibble(id=SHARE_w1_home_rel$id)

SHARE_w1_home_rel$cv018_2 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_2), "NA='-999'")
SHARE_w1_home_rel$cv018_3 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_3), "NA='-999'")
SHARE_w1_home_rel$cv018_4 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_4), "NA='-999'")
SHARE_w1_home_rel$cv018_5 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_5), "NA='-999'")
SHARE_w1_home_rel$cv018_6 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_6), "NA='-999'")
SHARE_w1_home_rel$cv018_7 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_7), "NA='-999'")
SHARE_w1_home_rel$cv018_8 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_8), "NA='-999'")
SHARE_w1_home_rel$cv018_9 <- car::recode(as.vector(SHARE_w1_home_rel$cv018_9), "NA='-999'")

SHARE_ds_w1$home_rel <- c(NA)
for(i in 1:dim(SHARE_w1_home_rel)[1]){
  if( SHARE_w1_home_rel$cv018_2[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_3[i] %in% c(1:9) |
     SHARE_w1_home_rel$cv018_4[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_5[i] %in% c(1:9) |
     SHARE_w1_home_rel$cv018_6[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_7[i] %in% c(1:9) |
     SHARE_w1_home_rel$cv018_8[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_9[i] %in% c(1:9) ) {
    SHARE_ds_w1$home_rel[i] = 1 }
  else if( SHARE_w1_home_rel$cv018_2[i] == -999 & SHARE_w1_home_rel$cv018_3[i] == -999 &
     SHARE_w1_home_rel$cv018_4[i] == -999 & SHARE_w1_home_rel$cv018_5[i] == -999 &
     SHARE_w1_home_rel$cv018_6[i] == -999 & SHARE_w1_home_rel$cv018_7[i] == -999 &
     SHARE_w1_home_rel$cv018_8[i] == -999 & SHARE_w1_home_rel$cv018_9[i] == -999 ) {
    SHARE_ds_w1$home_rel[i] = 999 }
  else if( SHARE_w1_home_rel$cv018_2[i] == -2 | SHARE_w1_home_rel$cv018_3[i] == -2 |
     SHARE_w1_home_rel$cv018_4[i] == -2 | SHARE_w1_home_rel$cv018_5[i] == -2 |
     SHARE_w1_home_rel$cv018_6[i] == -2 | SHARE_w1_home_rel$cv018_7[i] == -2 |
     SHARE_w1_home_rel$cv018_8[i] == -2 | SHARE_w1_home_rel$cv018_9[i] == -2 ) {
    SHARE_ds_w1$home_rel[i] = 997 }
  else if( SHARE_w1_home_rel$cv018_2[i] == -1 | SHARE_w1_home_rel$cv018_3[i] == -1 |
     SHARE_w1_home_rel$cv018_4[i] == -1 | SHARE_w1_home_rel$cv018_5[i] == -1 |
     SHARE_w1_home_rel$cv018_6[i] == -1 | SHARE_w1_home_rel$cv018_7[i] == -1 |
     SHARE_w1_home_rel$cv018_8[i] == -1 | SHARE_w1_home_rel$cv018_9[i] == -1 ) {
    SHARE_ds_w1$home_rel[i] = 998 }
  else if( !( SHARE_w1_home_rel$cv018_2[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_3[i] %in% c(1:9) |
     SHARE_w1_home_rel$cv018_4[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_5[i] %in% c(1:9) |
     SHARE_w1_home_rel$cv018_6[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_7[i] %in% c(1:9) |
     SHARE_w1_home_rel$cv018_8[i] %in% c(1:9) | SHARE_w1_home_rel$cv018_9[i] %in% c(1:9) ) ) {
    SHARE_ds_w1$home_rel[i] = 0 }
}

SHARE_ds_w1$home_rel <- car::recode(as.vector(SHARE_ds_w1$home_rel), "NA='999'")
SHARE_ds_w1$home_rel <- labelled(SHARE_ds_w1$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript1}
Categorical_summary(var = SHARE_ds_w1$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w1, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### SHARE - Wave 2

#### Study-specific variables

The study-specific variable elected to be harmonised is:
  
* Name: `cv018_2` UP TO `cv018_13` **from table sharew2_rel2-6-0_cv_h**
* Label: `relation hhmember to respondent`
* Categories:
    + `1 = spouse`
    + `2 = partner`
    + `3 = child`
    + `4 = child-in-law`
    + `5 = parent`
    + `6 = parent-in-law`
    + `7 = sibling`
    + `8 = grand-child`
    + `9 = other relative (specify)`
    + `10 = other non-relative (specify)`
    + `11 = ex-spouse/ex-partner`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`




```{r assign2}
opal.assign.table.tibble(o, 'SHARE_w2_home_rel','SHARE.sharew2_rel2-6-0_cv_h', 
                         variables=list('cv018_2','cv018_3','cv018_4','cv018_5','cv018_6','cv018_7','cv018_8','cv018_9',
                                        'cv018_10','cv018_11','cv018_12','cv018_13'), missings = TRUE)
```

```{r local2}
SHARE_w2_home_rel <- opal.execute(o,'SHARE_w2_home_rel')
Categorical_summary(var =SHARE_w2_home_rel$cv018_2, missing_values = NA)
ggplot(SHARE_w2_home_rel, aes(x=factor(cv018_2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("relation hhmember to respondent") + ylab("Frequency") 
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
  
* `if any is in 1:9 then 1`

R code of the ALGORITHM:
  
```{r harmo2}
SHARE_ds_w2 <- tibble(id=SHARE_w2_home_rel$id)

SHARE_w2_home_rel$cv018_2 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_2), "NA='-999'")
SHARE_w2_home_rel$cv018_3 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_3), "NA='-999'")
SHARE_w2_home_rel$cv018_4 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_4), "NA='-999'")
SHARE_w2_home_rel$cv018_5 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_5), "NA='-999'")
SHARE_w2_home_rel$cv018_6 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_6), "NA='-999'")
SHARE_w2_home_rel$cv018_7 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_7), "NA='-999'")
SHARE_w2_home_rel$cv018_8 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_8), "NA='-999'")
SHARE_w2_home_rel$cv018_9 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_9), "NA='-999'")
SHARE_w2_home_rel$cv018_10 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_10), "NA='-999'")
SHARE_w2_home_rel$cv018_11 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_11), "NA='-999'")
SHARE_w2_home_rel$cv018_12 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_12), "NA='-999'")
SHARE_w2_home_rel$cv018_13 <- car::recode(as.vector(SHARE_w2_home_rel$cv018_13), "NA='-999'")

SHARE_ds_w2$home_rel <- c(NA)
for(i in 1:dim(SHARE_w2_home_rel)[1]){
  if( SHARE_w2_home_rel$cv018_2[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_3[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_4[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_5[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_6[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_7[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_8[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_9[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_10[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_11[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_12[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_13[i] %in% c(1:9) ) {
    SHARE_ds_w2$home_rel[i] = 1 }
  else if( SHARE_w2_home_rel$cv018_2[i] == -999 & SHARE_w2_home_rel$cv018_3[i] == -999 &
      SHARE_w2_home_rel$cv018_4[i] == -999 & SHARE_w2_home_rel$cv018_5[i] == -999 &
      SHARE_w2_home_rel$cv018_6[i] == -999 & SHARE_w2_home_rel$cv018_7[i] == -999 &
      SHARE_w2_home_rel$cv018_8[i] == -999 & SHARE_w2_home_rel$cv018_9[i] == -999 &
      SHARE_w2_home_rel$cv018_10[i] == -999 & SHARE_w2_home_rel$cv018_11[i] == -999 &
      SHARE_w2_home_rel$cv018_12[i] == -999 & SHARE_w2_home_rel$cv018_13[i] == -999 ) {
    SHARE_ds_w2$home_rel[i] = 999 }
  else if( SHARE_w2_home_rel$cv018_2[i] == -2 | SHARE_w2_home_rel$cv018_3[i] == -2 |
      SHARE_w2_home_rel$cv018_4[i] == -2 | SHARE_w2_home_rel$cv018_5[i] == -2 |
      SHARE_w2_home_rel$cv018_6[i] == -2 | SHARE_w2_home_rel$cv018_7[i] == -2 |
      SHARE_w2_home_rel$cv018_8[i] == -2 | SHARE_w2_home_rel$cv018_9[i] == -2 |
      SHARE_w2_home_rel$cv018_10[i] == -2 | SHARE_w2_home_rel$cv018_11[i] == -2 |
      SHARE_w2_home_rel$cv018_12[i] == -2 | SHARE_w2_home_rel$cv018_13[i] == -2 ) {
    SHARE_ds_w2$home_rel[i] = 997 }
  else if( SHARE_w2_home_rel$cv018_2[i] == -1 | SHARE_w2_home_rel$cv018_3[i] == -1 |
      SHARE_w2_home_rel$cv018_4[i] == -1 | SHARE_w2_home_rel$cv018_5[i] == -1 |
      SHARE_w2_home_rel$cv018_6[i] == -1 | SHARE_w2_home_rel$cv018_7[i] == -1 |
      SHARE_w2_home_rel$cv018_8[i] == -1 | SHARE_w2_home_rel$cv018_9[i] == -1 |
      SHARE_w2_home_rel$cv018_10[i] == -1 | SHARE_w2_home_rel$cv018_11[i] == -1 |
      SHARE_w2_home_rel$cv018_12[i] == -1 | SHARE_w2_home_rel$cv018_13[i] == -1 ) {
    SHARE_ds_w2$home_rel[i] = 998 }
  else if( !( SHARE_w2_home_rel$cv018_2[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_3[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_4[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_5[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_6[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_7[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_8[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_9[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_10[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_11[i] %in% c(1:9) |
      SHARE_w2_home_rel$cv018_12[i] %in% c(1:9) | SHARE_w2_home_rel$cv018_13[i] %in% c(1:9) ) ) {
    SHARE_ds_w2$home_rel[i] = 0 }
}

SHARE_ds_w2$home_rel <- car::recode(as.vector(SHARE_ds_w2$home_rel), "NA='999'")
SHARE_ds_w2$home_rel <- labelled(SHARE_ds_w2$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript2}
Categorical_summary(var = SHARE_ds_w2$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w2, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### SHARE - Wave 4

#### Study-specific variables

The study-specific variable elected to be harmonised is:
 

* Name: `sn005_1` UP TO `sn005_7`
* Label: `network relationship: sn person 1`
* Categories:
    + `1 = Spouse/Partner`
    + `2 = Mother`
    + `3 = Father`
    + `4 = Mother-in-law``
    + `5 = Father-in-law`
    + `6 = Stepmother`
    + `7 = Stepfather`
    + `8 = Brother`
    + `9 = Sister`
    + `10 = Child`
    + `11 = Step-child/your current partner's child`
    + `12 = Son-in-law``
    + `13 = Daughter-in-law`
    + `14 = Grandchild`
    + `15 = Grandparent`
    + `16 = Aunt`
    + `17 = Uncle`
    + `18 = Niece`
    + `19 = Nephew`
    + `20 = Other relative`
    + `21 = Friend`
    + `22 = (Ex-)colleague/co-worker`
    + `23 = Neighbour`
    + `24 = Ex-spouse/partner`
    + `25 = Minister, priest, or other clergy`
    + `26 = Therapist or other professional helper`
    + `27 = Housekeeper/Home health care provider`
    + `96 = None of these`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`
    
    
* Name: `sn006_1` UP TO `sn006_7`
* Label: `network proximity: sn person 1`
* Categories:
    + `1 = In the same household`
    + `2 = In the same building`
    + `3 = Less than 1 kilometre away`
    + `4 = Between 1 and 5 kilometres away`
    + `5 = Between 5 and 25 kilometres away`
    + `6 = Between 25 and 100 kilometres away`
    + `7 = Between 100 and 500 kilometres away`
    + `8 = More than 500 kilometres away`
    + `9 = Country-specific category`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`


```{r assign4}
opal.assign.table.tibble(o, 'SHARE_w4_home_rel','SHARE.sharew4_rel1-1-1_sn', 
                         variables=list('sn005_1','sn005_2','sn005_3','sn005_4','sn005_5','sn005_6','sn005_7',
                                        'sn006_1','sn006_2','sn006_3','sn006_4','sn006_5','sn006_6','sn006_7'), missings = TRUE)
```

```{r local4}
SHARE_w4_home_rel <- opal.execute(o,'SHARE_w4_home_rel')
Categorical_summary(var =SHARE_w4_home_rel$sn005_1, missing_values = NA)
ggplot(SHARE_w4_home_rel, aes(x=factor(sn005_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("network relationship: sn person 1") + ylab("Frequency") 
Categorical_summary(var =SHARE_w4_home_rel$sn006_1, missing_values = NA)
ggplot(SHARE_w4_home_rel, aes(x=factor(sn006_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("network proximity: sn person 1") + ylab("Frequency") 
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
  
* `if for any i: sn005_i in 1:20 and sn006_i == 1, then 1`

R code of the ALGORITHM:
  
```{r harmo4}
SHARE_ds_w4 <- tibble(id=SHARE_w4_home_rel$id)

SHARE_w4_home_rel$sn005_1 <- car::recode(as.vector(SHARE_w4_home_rel$sn005_1), "NA='-999'")
SHARE_w4_home_rel$sn005_2 <- car::recode(as.vector(SHARE_w4_home_rel$sn005_2), "NA='-999'")
SHARE_w4_home_rel$sn005_3 <- car::recode(as.vector(SHARE_w4_home_rel$sn005_3), "NA='-999'")
SHARE_w4_home_rel$sn005_4 <- car::recode(as.vector(SHARE_w4_home_rel$sn005_4), "NA='-999'")
SHARE_w4_home_rel$sn005_5 <- car::recode(as.vector(SHARE_w4_home_rel$sn005_5), "NA='-999'")
SHARE_w4_home_rel$sn005_6 <- car::recode(as.vector(SHARE_w4_home_rel$sn005_6), "NA='-999'")
SHARE_w4_home_rel$sn005_7 <- car::recode(as.vector(SHARE_w4_home_rel$sn005_7), "NA='-999'")

SHARE_w4_home_rel$sn006_1 <- car::recode(as.vector(SHARE_w4_home_rel$sn006_1), "NA='-999'")
SHARE_w4_home_rel$sn006_2 <- car::recode(as.vector(SHARE_w4_home_rel$sn006_2), "NA='-999'")
SHARE_w4_home_rel$sn006_3 <- car::recode(as.vector(SHARE_w4_home_rel$sn006_3), "NA='-999'")
SHARE_w4_home_rel$sn006_4 <- car::recode(as.vector(SHARE_w4_home_rel$sn006_4), "NA='-999'")
SHARE_w4_home_rel$sn006_5 <- car::recode(as.vector(SHARE_w4_home_rel$sn006_5), "NA='-999'")
SHARE_w4_home_rel$sn006_6 <- car::recode(as.vector(SHARE_w4_home_rel$sn006_6), "NA='-999'")
SHARE_w4_home_rel$sn006_7 <- car::recode(as.vector(SHARE_w4_home_rel$sn006_7), "NA='-999'")


SHARE_ds_w4$home_rel <- c(NA)
for(i in 1:dim(SHARE_w4_home_rel)[1]){
  if( ( SHARE_w4_home_rel$sn005_1[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_1[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_2[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_2[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_3[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_3[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_4[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_4[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_5[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_5[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_6[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_6[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_7[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_7[i] ==1 ) ){
    SHARE_ds_w4$home_rel[i] = 1 }
  else if( SHARE_w4_home_rel$sn005_1[i] == -999 & SHARE_w4_home_rel$sn006_1[i] == -999 &
      SHARE_w4_home_rel$sn005_2[i] == -999 & SHARE_w4_home_rel$sn006_2[i] == -999 &
      SHARE_w4_home_rel$sn005_3[i] == -999 & SHARE_w4_home_rel$sn006_3[i] == -999 &
      SHARE_w4_home_rel$sn005_4[i] == -999 & SHARE_w4_home_rel$sn006_4[i] == -999 &
      SHARE_w4_home_rel$sn005_5[i] == -999 & SHARE_w4_home_rel$sn006_5[i] == -999 &
      SHARE_w4_home_rel$sn005_6[i] == -999 & SHARE_w4_home_rel$sn006_6[i] == -999 &
      SHARE_w4_home_rel$sn005_7[i] == -999 & SHARE_w4_home_rel$sn006_7[i] == -999 ) {
    SHARE_ds_w4$home_rel[i] = 999 }
  else if( !( ( SHARE_w4_home_rel$sn005_1[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_1[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_2[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_2[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_3[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_3[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_4[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_4[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_5[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_5[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_6[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_6[i] ==1 ) |
      ( SHARE_w4_home_rel$sn005_7[i] %in% c(1:20) & SHARE_w4_home_rel$sn006_7[i] ==1 ) ) ) {
    SHARE_ds_w4$home_rel[i] = 0 }
}

SHARE_ds_w4$home_rel <- car::recode(as.vector(SHARE_ds_w4$home_rel), "NA='999'")
SHARE_ds_w4$home_rel <- labelled(SHARE_ds_w4$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript4}
Categorical_summary(var = SHARE_ds_w4$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w4, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation4}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]



### SHARE - Wave 5

#### Study-specific variables

The study-specific variable elected to be harmonised is:
  
* Name: `ch007_1` UP TO `ch007_20` **from table sharew5_rel1-0-0_ch**
* Label: `Child 1 where does child live`
* Categories:
    + `1 = In the same household`
    + `2 = In the same building`
    + `3 = Less than 1 kilometre away`
    + `4 = Between 1 and 5 kilometres away`
    + `5 = Between 5 and 25 kilometres away`
    + `6 = Between 25 and 100 kilometres away`
    + `7 = Between 100 and 500 kilometres away`
    + `8 = More than 500 kilometres away`
    + `9 = More than 500 kilometres away in another country`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`


```{r assign5}
opal.assign.table.tibble(o, 'SHARE_w5_home_rel','SHARE.sharew5_rel1-0-0_ch', 
                         variables=list('ch007_1','ch007_2','ch007_3','ch007_4','ch007_5','ch007_6','ch007_7','ch007_8',
                                        'ch007_9','ch007_10','ch007_11','ch007_12','ch007_13','ch007_14','ch007_15',
                                        'ch007_16','ch007_17','ch007_18','ch007_19','ch007_20'), missings = TRUE)
```

```{r local5}
SHARE_w5_home_rel <- opal.execute(o,'SHARE_w5_home_rel')
Categorical_summary(var =SHARE_w5_home_rel$ch007_1, missing_values = NA)
ggplot(SHARE_w5_home_rel, aes(x=factor(ch007_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Child 1 where does child live") + ylab("Frequency") 
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
  
* `if any equals 1 then 1`

R code of the ALGORITHM:
  
```{r harmo5}
SHARE_ds_w5 <- tibble(id=SHARE_w5_home_rel$id)

SHARE_w5_home_rel$ch007_1 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_1), "NA='-999'")
SHARE_w5_home_rel$ch007_2 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_2), "NA='-999'")
SHARE_w5_home_rel$ch007_3 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_3), "NA='-999'")
SHARE_w5_home_rel$ch007_4 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_4), "NA='-999'")
SHARE_w5_home_rel$ch007_5 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_5), "NA='-999'")
SHARE_w5_home_rel$ch007_6 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_6), "NA='-999'")
SHARE_w5_home_rel$ch007_7 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_7), "NA='-999'")
SHARE_w5_home_rel$ch007_8 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_8), "NA='-999'")
SHARE_w5_home_rel$ch007_9 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_9), "NA='-999'")
SHARE_w5_home_rel$ch007_10 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_10), "NA='-999'")
SHARE_w5_home_rel$ch007_11 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_11), "NA='-999'")
SHARE_w5_home_rel$ch007_12 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_12), "NA='-999'")
SHARE_w5_home_rel$ch007_13 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_13), "NA='-999'")
SHARE_w5_home_rel$ch007_14 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_14), "NA='-999'")
SHARE_w5_home_rel$ch007_15 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_15), "NA='-999'")
SHARE_w5_home_rel$ch007_16 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_16), "NA='-999'")
SHARE_w5_home_rel$ch007_17 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_17), "NA='-999'")
SHARE_w5_home_rel$ch007_18 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_18), "NA='-999'")
SHARE_w5_home_rel$ch007_19 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_19), "NA='-999'")
SHARE_w5_home_rel$ch007_20 <- car::recode(as.vector(SHARE_w5_home_rel$ch007_20), "NA='-999'")


SHARE_ds_w5$home_rel <- c(NA)
for(i in 1:dim(SHARE_w5_home_rel)[1]){
  if( SHARE_w5_home_rel$ch007_1[i] ==1 | SHARE_w5_home_rel$ch007_2[i] ==1 | SHARE_w5_home_rel$ch007_3[i] ==1 |
      SHARE_w5_home_rel$ch007_4[i] ==1 | SHARE_w5_home_rel$ch007_5[i] ==1 | SHARE_w5_home_rel$ch007_6[i] ==1 |
      SHARE_w5_home_rel$ch007_7[i] ==1 | SHARE_w5_home_rel$ch007_8[i] ==1 | SHARE_w5_home_rel$ch007_9[i] ==1 |
      SHARE_w5_home_rel$ch007_10[i] ==1 | SHARE_w5_home_rel$ch007_11[i] ==1 | SHARE_w5_home_rel$ch007_12[i] ==1 |
      SHARE_w5_home_rel$ch007_13[i] ==1 | SHARE_w5_home_rel$ch007_14[i] ==1 | SHARE_w5_home_rel$ch007_15[i] ==1 |
      SHARE_w5_home_rel$ch007_16[i] ==1 | SHARE_w5_home_rel$ch007_17[i] ==1 | SHARE_w5_home_rel$ch007_18[i] ==1 |
      SHARE_w5_home_rel$ch007_19[i] ==1 | SHARE_w5_home_rel$ch007_20[i] ==1 ) {
    SHARE_ds_w5$home_rel[i] = 1 }
  else if( SHARE_w5_home_rel$ch007_1[i] == -999 & SHARE_w5_home_rel$ch007_2[i] == -999 & SHARE_w5_home_rel$ch007_3[i] == -999 &
      SHARE_w5_home_rel$ch007_4[i] == -999 & SHARE_w5_home_rel$ch007_5[i] == -999 & SHARE_w5_home_rel$ch007_6[i] == -999 &
      SHARE_w5_home_rel$ch007_7[i] == -999 & SHARE_w5_home_rel$ch007_8[i] == -999 & SHARE_w5_home_rel$ch007_9[i] == -999 &
      SHARE_w5_home_rel$ch007_10[i] == -999 & SHARE_w5_home_rel$ch007_11[i] == -999 & SHARE_w5_home_rel$ch007_12[i] == -999 &
      SHARE_w5_home_rel$ch007_13[i] == -999 & SHARE_w5_home_rel$ch007_14[i] == -999 & SHARE_w5_home_rel$ch007_15[i] == -999 &
      SHARE_w5_home_rel$ch007_16[i] == -999 & SHARE_w5_home_rel$ch007_17[i] == -999 & SHARE_w5_home_rel$ch007_18[i] == -999 &
      SHARE_w5_home_rel$ch007_19[i] == -999 & SHARE_w5_home_rel$ch007_20[i] == -999 ) {
    SHARE_ds_w5$home_rel[i] = 999 }
  else if( !( SHARE_w5_home_rel$ch007_1[i] ==1 | SHARE_w5_home_rel$ch007_2[i] ==1 | SHARE_w5_home_rel$ch007_3[i] ==1 |
      SHARE_w5_home_rel$ch007_4[i] ==1 | SHARE_w5_home_rel$ch007_5[i] ==1 | SHARE_w5_home_rel$ch007_6[i] ==1 |
      SHARE_w5_home_rel$ch007_7[i] ==1 | SHARE_w5_home_rel$ch007_8[i] ==1 | SHARE_w5_home_rel$ch007_9[i] ==1 |
      SHARE_w5_home_rel$ch007_10[i] ==1 | SHARE_w5_home_rel$ch007_11[i] ==1 | SHARE_w5_home_rel$ch007_12[i] ==1 |
      SHARE_w5_home_rel$ch007_13[i] ==1 | SHARE_w5_home_rel$ch007_14[i] ==1 | SHARE_w5_home_rel$ch007_15[i] ==1 |
      SHARE_w5_home_rel$ch007_16[i] ==1 | SHARE_w5_home_rel$ch007_17[i] ==1 | SHARE_w5_home_rel$ch007_18[i] ==1 |
      SHARE_w5_home_rel$ch007_19[i] ==1 | SHARE_w5_home_rel$ch007_20[i] ==1 ) ) {
    SHARE_ds_w5$home_rel[i] = 0 }
}

SHARE_ds_w5$home_rel <- car::recode(as.vector(SHARE_ds_w5$home_rel), "NA='999'")
SHARE_ds_w5$home_rel <- labelled(SHARE_ds_w5$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript5}
Categorical_summary(var = SHARE_ds_w5$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w5, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation5}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]

