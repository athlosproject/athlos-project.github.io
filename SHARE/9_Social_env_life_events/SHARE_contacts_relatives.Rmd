---
title: "SHARE"
author: "Katarzyna Jablonska"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true 
    depth: 4
    number_sections: true  
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r prepare, message=FALSE, include=FALSE}
library(bitops)
library(RCurl)
library(rjson)
library(mime)
library(opal)
library(tibble)
library(car)
library(labelled)
library(Hmisc)
source("Continuous_summary.R")
source("Categorical_summary.R")

# authenticate within opal server 
o <- opal.login('','...','http://...')
```

# Socio-demographic and economic characteristics 

## `Any form of contacts with relatives`


### Description of DataSchema variable `Are any form of contact (face-to-face/phone/mail/Internet communicators) with family members/relatives frequent (i.e. contact once a month or more often)`

The description of harmonised variable is the following:
  
* Name: `cont_rel`
* Label: `Are any form of contact (face-to-face/phone/mail/Internet communicators) with family members/relatives frequent (i.e. contact once a week or more often)?`
* Type: categorical
* Categories: 
    + `0 = no`
    + `1 = yes`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done/not yet recorded`
    + `995 = Don't answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`


### SHARE - Wave 1

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `ch014_1` UP TO `ch014_4` **from table sharew1_rel2-6-0_ch**
* Label: `contact with (selected) child 1`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`
 
* Name: `dn032_2` **from table sharew1_rel2-6-0_dn**
* Label: `personal contact with parent during past 12 months: father`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`

* Name: `dn032_1` **from table sharew1_rel2-6-0_dn**
* Label: `personal contact with parent during past 12 months: mother`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`


```{r assign1}
opal.assign.table.tibble(o, 'SHARE_w1_cont_rel1','SHARE.sharew1_rel2-6-0_ch', 
                        variables=list('ch014_1','ch014_2','ch014_3','ch014_4'), missings = TRUE)

opal.assign.table.tibble(o, 'SHARE_w1_cont_rel2','SHARE.sharew1_rel2-6-0_dn', 
                        variables=list('dn032_2','dn032_1'), missings = TRUE)

opal.assign.table.tibble(o, 'SHARE_w1_home_rel','SHARE.sharew1_rel2-6-0_cv_h', 
                        variables=list('cv018_2','cv018_3','cv018_4','cv018_5','cv018_6','cv018_7','cv018_8','cv018_9'),missings = TRUE)

```

```{r local1}
SHARE_w1_cont_rel1 <- opal.execute(o,'SHARE_w1_cont_rel1')
Categorical_summary(var =SHARE_w1_cont_rel1$ch014_1, missing_values = NA)
ggplot(SHARE_w1_cont_rel1, aes(x=factor(ch014_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("contact with (selected) child 1") + ylab("Frequency") 

SHARE_w1_cont_rel2 <- opal.execute(o,'SHARE_w1_cont_rel2')
Categorical_summary(var =SHARE_w1_cont_rel2$dn032_2, missing_values = NA)
ggplot(SHARE_w1_cont_rel2, aes(x=factor(dn032_2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: father") + ylab("Frequency") 
Categorical_summary(var =SHARE_w1_cont_rel2$dn032_1, missing_values = NA)
ggplot(SHARE_w1_cont_rel2, aes(x=factor(dn032_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: mother") + ylab("Frequency") 

SHARE_w1_home_rel <- opal.execute(o, 'SHARE_w1_home_rel')
```
```{r}
SHARE_w1_home_rel
SHARE_w1_cont_rel1

```
#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any is in 1:3 then 1`

R code of the ALGORITHM:

```{r harmo1}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, 
                       ch014_1=new_2$ch014_1, ch014_2=new_2$ch014_2, ch014_3=new_2$ch014_3, ch014_4=new_2$ch014_4,
                       dn032_1=new$dn032_1, dn032_2=new$dn032_2) 
                       # id = new_2$id
                       # colname_form_OLD_table = new_2$colname_form_OLD_table 
                       # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = SHARE_w1_cont_rel1 (ch014_1,..,ch014_4)
# new = SHARE_w1_cont_rel2 (dn032_1, dn032_2)

SHARE_w1_cont_rel <- same_indiv(SHARE_w1_cont_rel1, SHARE_w1_cont_rel2)

SHARE_ds_w1 <- tibble(id=SHARE_w1_cont_rel$id)

SHARE_w1_cont_rel$ch014_1 <- car::recode(as.vector(SHARE_w1_cont_rel$ch014_1), "NA='-999'")
SHARE_w1_cont_rel$ch014_2 <- car::recode(as.vector(SHARE_w1_cont_rel$ch014_2), "NA='-999'")
SHARE_w1_cont_rel$ch014_3 <- car::recode(as.vector(SHARE_w1_cont_rel$ch014_3), "NA='-999'")
SHARE_w1_cont_rel$ch014_4 <- car::recode(as.vector(SHARE_w1_cont_rel$ch014_4), "NA='-999'")
SHARE_w1_cont_rel$dn032_1 <- car::recode(as.vector(SHARE_w1_cont_rel$dn032_1), "NA='-999'")
SHARE_w1_cont_rel$dn032_2 <- car::recode(as.vector(SHARE_w1_cont_rel$dn032_2), "NA='-999'")


SHARE_ds_w1$cont_rel <- c(NA)
for(i in 1:dim(SHARE_w1_cont_rel)[1]){
  if( SHARE_w1_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w1_cont_rel$ch014_2[i] %in% c(1,2,3) |
     SHARE_w1_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w1_cont_rel$ch014_4[i] %in% c(1,2,3) |
     SHARE_w1_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w1_cont_rel$dn032_2[i] %in% c(1,2,3) ) {
    SHARE_ds_w1$cont_rel[i] = 1 }
  else if( SHARE_w1_cont_rel$ch014_1[i] == -999 & SHARE_w1_cont_rel$ch014_2[i] == -999 &
     SHARE_w1_cont_rel$ch014_3[i] == -999 & SHARE_w1_cont_rel$ch014_4[i] == -999 &
     SHARE_w1_cont_rel$dn032_1[i] == -999 & SHARE_w1_cont_rel$dn032_2[i] == -999 ) {
    SHARE_ds_w1$cont_rel[i] = 999 }
  else if( SHARE_w1_cont_rel$ch014_1[i] == -1 & SHARE_w1_cont_rel$ch014_2[i] == -1 &
     SHARE_w1_cont_rel$ch014_3[i] == -1 & SHARE_w1_cont_rel$ch014_4[i] == -1 &
     SHARE_w1_cont_rel$dn032_1[i] == -1 & SHARE_w1_cont_rel$dn032_2[i] == -1 ) {
    SHARE_ds_w1$cont_rel[i] = 998 }
  else if( SHARE_w1_cont_rel$ch014_1[i] == -2 & SHARE_w1_cont_rel$ch014_2[i] == -2 &
     SHARE_w1_cont_rel$ch014_3[i] == -2 & SHARE_w1_cont_rel$ch014_4[i] == -2 &
     SHARE_w1_cont_rel$dn032_1[i] == -2 & SHARE_w1_cont_rel$dn032_2[i] == -2 ) {
    SHARE_ds_w1$cont_rel[i] = 997 }
  else if( !( SHARE_w1_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w1_cont_rel$ch014_2[i] %in% c(1,2,3) |
     SHARE_w1_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w1_cont_rel$ch014_4[i] %in% c(1,2,3) |
     SHARE_w1_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w1_cont_rel$dn032_2[i] %in% c(1,2,3) ) ) {
    SHARE_ds_w1$cont_rel[i] = 0 }
}

SHARE_ds_w1$cont_rel <- car::recode(as.vector(SHARE_ds_w1$cont_rel), "NA='999'")
SHARE_ds_w1$cont_rel <- labelled(SHARE_ds_w1$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript1}
Categorical_summary(var = SHARE_ds_w1$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w1, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact (face-to-face/phone/mail/Internet communicators) with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### SHARE - Wave 2

#### Study-specific variables

The study-specific variable elected to be harmonised is:
  
* Name: `ch014_1` UP TO `ch014_4` **from table sharew2_rel2-6-0_ch**
* Label: `contact with (selected) child 1`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`

* Name: `dn032_2` **from table sharew2_rel2-6-0_dn**
* Label: `personal contact with parent during past 12 months: father`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`

* Name: `dn032_1` **from table sharew2_rel2-6-0_dn**
* Label: `personal contact with parent during past 12 months: mother`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`


```{r assign2}
opal.assign.table.tibble(o, 'SHARE_w2_cont_rel1','SHARE.sharew2_rel2-6-0_ch', 
                         variables=list('ch014_1','ch014_2','ch014_3','ch014_4'), missings = TRUE)

opal.assign.table.tibble(o, 'SHARE_w2_cont_rel2','SHARE.sharew2_rel2-6-0_dn', 
                         variables=list('dn032_2','dn032_1'), missings = TRUE)
```

```{r local2}
SHARE_w2_cont_rel1 <- opal.execute(o,'SHARE_w2_cont_rel1')
Categorical_summary(var =SHARE_w2_cont_rel1$ch014_1, missing_values = NA)
ggplot(SHARE_w2_cont_rel1, aes(x=factor(ch014_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("contact with (selected) child 1") + ylab("Frequency") 

SHARE_w2_cont_rel2 <- opal.execute(o,'SHARE_w2_cont_rel2')
Categorical_summary(var =SHARE_w2_cont_rel2$dn032_2, missing_values = NA)
ggplot(SHARE_w2_cont_rel2, aes(x=factor(dn032_2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: father") + ylab("Frequency") 
Categorical_summary(var =SHARE_w2_cont_rel2$dn032_1, missing_values = NA)
ggplot(SHARE_w2_cont_rel2, aes(x=factor(dn032_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: mother") + ylab("Frequency") 
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
  
* `if any is in 1:3 then 1`

R code of the ALGORITHM:
  
```{r harmo2}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, 
                       ch014_1=new_2$ch014_1, ch014_2=new_2$ch014_2, ch014_3=new_2$ch014_3, ch014_4=new_2$ch014_4,
                       dn032_1=new$dn032_1, dn032_2=new$dn032_2) 
  # id = new_2$id
  # colname_form_OLD_table = new_2$colname_form_OLD_table 
  # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = SHARE_w2_cont_rel1 (ch014_1,..,ch014_4)
# new = SHARE_w2_cont_rel2 (dn032_1, dn032_2)

SHARE_w2_cont_rel <- same_indiv(SHARE_w2_cont_rel1, SHARE_w2_cont_rel2)

SHARE_ds_w2 <- tibble(id=SHARE_w2_cont_rel$id)

SHARE_w2_cont_rel$ch014_1 <- car::recode(as.vector(SHARE_w2_cont_rel$ch014_1), "NA='-999'")
SHARE_w2_cont_rel$ch014_2 <- car::recode(as.vector(SHARE_w2_cont_rel$ch014_2), "NA='-999'")
SHARE_w2_cont_rel$ch014_3 <- car::recode(as.vector(SHARE_w2_cont_rel$ch014_3), "NA='-999'")
SHARE_w2_cont_rel$ch014_4 <- car::recode(as.vector(SHARE_w2_cont_rel$ch014_4), "NA='-999'")
SHARE_w2_cont_rel$dn032_1 <- car::recode(as.vector(SHARE_w2_cont_rel$dn032_1), "NA='-999'")
SHARE_w2_cont_rel$dn032_2 <- car::recode(as.vector(SHARE_w2_cont_rel$dn032_2), "NA='-999'")

SHARE_ds_w2$cont_rel <- c(NA)
for(i in 1:dim(SHARE_w2_cont_rel)[1]){
  if( SHARE_w2_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w2_cont_rel$ch014_2[i] %in% c(1,2,3) |
      SHARE_w2_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w2_cont_rel$ch014_4[i] %in% c(1,2,3) |
      SHARE_w2_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w2_cont_rel$dn032_2[i] %in% c(1,2,3) ) {
    SHARE_ds_w2$cont_rel[i] = 1 }
  else if( SHARE_w2_cont_rel$ch014_1[i] == -999 & SHARE_w2_cont_rel$ch014_2[i] == -999 &
      SHARE_w2_cont_rel$ch014_3[i] == -999 & SHARE_w2_cont_rel$ch014_4[i] == -999 &
      SHARE_w2_cont_rel$dn032_1[i] == -999 & SHARE_w2_cont_rel$dn032_2[i] == -999 ) {
    SHARE_ds_w2$cont_rel[i] = 999 }
  else if( !( SHARE_w2_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w2_cont_rel$ch014_2[i] %in% c(1,2,3) |
              SHARE_w2_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w2_cont_rel$ch014_4[i] %in% c(1,2,3) |
              SHARE_w2_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w2_cont_rel$dn032_2[i] %in% c(1,2,3) ) ) {
    SHARE_ds_w2$cont_rel[i] = 0 }
}

SHARE_ds_w2$cont_rel <- car::recode(as.vector(SHARE_ds_w2$cont_rel), "NA='999'")
SHARE_ds_w2$cont_rel <- labelled(SHARE_ds_w2$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript2}
Categorical_summary(var = SHARE_ds_w2$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w2, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact (face-to-face/phone/mail/Internet communicators) with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### SHARE - Wave 4

#### Study-specific variables

The study-specific variable elected to be harmonised is:
  
* Name: `ch014_1` UP TO `ch014_20` **from table sharew4_rel1-1-1_ch**
* Label: `contact with (selected) child 1`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`

* Name: `dn032_2` **from table sharew4_rel1-1-1_dn**
* Label: `personal contact with parent during past 12 months: father`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`

* Name: `dn032_1` **from table sharew4_rel1-1-1_dn**
* Label: `personal contact with parent during past 12 months: mother`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`


* Name: `sn005_1` UP TO `sn005_7` **from table sharew4_rel1-1-1_sn**
* Label: `network relationship:sn person 1`
* Categories:
    + `1 = Spouse/Partner`
    + `2 = Mother`
    + `3 = Father`
    + `4 = Mother-in-law``
    + `5 = Father-in-law`
    + `6 = Stepmother`
    + `7 = Stepfather`
    + `8 = Brother`
    + `9 = Sister`
    + `10 = Child`
    + `11 = Step-child/your current partner's child`
    + `12 = Son-in-law``
    + `13 = Daughter-in-law`
    + `14 = Grandchild`
    + `15 = Grandparent`
    + `16 = Aunt`
    + `17 = Uncle`
    + `18 = Niece`
    + `19 = Nephew`
    + `20 = Other relative`
    + `21 = Friend`
    + `22 = (Ex-)colleague/co-worker`
    + `23 = Neighbour`
    + `24 = Ex-spouse/partner`
    + `25 = Minister, priest, or other clergy`
    + `26 = Therapist or other professional helper`
    + `27 = Housekeeper/Home health care provider`
    + `96 = None of these`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`
    
    
* Name: `sn007_1` UP TO `sn007_7` **from table sharew4_rel1-1-1_sn**
* Label: `network contact: sn person 1`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`


```{r assign4}
opal.assign.table.tibble(o, 'SHARE_w4_cont_rel1','SHARE.sharew4_rel1-1-1_ch', 
                         variables=list('ch014_1','ch014_2','ch014_3','ch014_4','ch014_5','ch014_6','ch014_7','ch014_8',
                                        'ch014_9','ch014_10','ch014_11','ch014_12','ch014_13','ch014_14','ch014_15','ch014_16',
                                        'ch014_17','ch014_18','ch014_19','ch014_20'), missings = TRUE)

opal.assign.table.tibble(o, 'SHARE_w4_cont_rel2','SHARE.sharew4_rel1-1-1_dn', 
                         variables=list('dn032_2','dn032_1'), missings = TRUE)

opal.assign.table.tibble(o, 'SHARE_w4_cont_rel3','SHARE.sharew4_rel1-1-1_sn', 
                         variables=list('sn005_1','sn005_2','sn005_3','sn005_4','sn005_5','sn005_6','sn005_7',
                                        'sn007_1','sn007_2','sn007_3','sn007_4','sn007_5','sn007_6','sn007_7'), missings = TRUE)
```

```{r local4}
SHARE_w4_cont_rel1 <- opal.execute(o,'SHARE_w4_cont_rel1')
Categorical_summary(var =SHARE_w4_cont_rel1$ch014_1, missing_values = NA)
ggplot(SHARE_w4_cont_rel1, aes(x=factor(ch014_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("contact with (selected) child 1") + ylab("Frequency") 

SHARE_w4_cont_rel2 <- opal.execute(o,'SHARE_w4_cont_rel2')
Categorical_summary(var =SHARE_w4_cont_rel2$dn032_2, missing_values = NA)
ggplot(SHARE_w4_cont_rel2, aes(x=factor(dn032_2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: father") + ylab("Frequency") 
Categorical_summary(var =SHARE_w4_cont_rel2$dn032_1, missing_values = NA)
ggplot(SHARE_w4_cont_rel2, aes(x=factor(dn032_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: mother") + ylab("Frequency") 

SHARE_w4_cont_rel3 <- opal.execute(o,'SHARE_w4_cont_rel3')
Categorical_summary(var =SHARE_w4_cont_rel3$sn005_1, missing_values = NA)
ggplot(SHARE_w4_cont_rel3, aes(x=factor(sn005_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("network relationship:sn person 1") + ylab("Frequency") 
Categorical_summary(var =SHARE_w4_cont_rel3$sn007_1, missing_values = NA)
ggplot(SHARE_w4_cont_rel3, aes(x=factor(sn007_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("network contact: sn person 1") + ylab("Frequency") 
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
  
* `if any of ch014_i, dn032_i is in 1:3 then 1`
* `if for any i: sn005_i in 1:20 and sn007_i in 1:3, then 1`

R code of the ALGORITHM:
  
```{r harmo4}
# Double same_indiv because we have 3 different tables

same_indiv <- function(old, new){
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, 
                       ch014_1=new_2$ch014_1, ch014_2=new_2$ch014_2, ch014_3=new_2$ch014_3, ch014_4=new_2$ch014_4,
                       ch014_5=new_2$ch014_5, ch014_6=new_2$ch014_6, ch014_7=new_2$ch014_7, ch014_8=new_2$ch014_8,
                       ch014_9=new_2$ch014_9, ch014_10=new_2$ch014_10, ch014_11=new_2$ch014_11, ch014_12=new_2$ch014_12,
                       ch014_13=new_2$ch014_13, ch014_14=new_2$ch014_14, ch014_15=new_2$ch014_15, ch014_16=new_2$ch014_16,
                       ch014_17=new_2$ch014_17, ch014_18=new_2$ch014_18, ch014_19=new_2$ch014_19, ch014_20=new_2$ch014_20,
                       dn032_1=new$dn032_1, dn032_2=new$dn032_2) 
  # id = new_2$id
  # colname_form_OLD_table = new_2$colname_form_OLD_table 
  # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = SHARE_w4_cont_rel1 (ch014_1,..,ch014_20)
# new = SHARE_w4_cont_rel2 (dn032_1, dn032_2)

SHARE_w4_cont_rel12 <- same_indiv(SHARE_w4_cont_rel1, SHARE_w4_cont_rel2)


same_indiv2 <- function(old, new){
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, 
                       ch014_1=new_2$ch014_1, ch014_2=new_2$ch014_2, ch014_3=new_2$ch014_3, ch014_4=new_2$ch014_4,
                       ch014_5=new_2$ch014_5, ch014_6=new_2$ch014_6, ch014_7=new_2$ch014_7, ch014_8=new_2$ch014_8,
                       ch014_9=new_2$ch014_9, ch014_10=new_2$ch014_10, ch014_11=new_2$ch014_11, ch014_12=new_2$ch014_12,
                       ch014_13=new_2$ch014_13, ch014_14=new_2$ch014_14, ch014_15=new_2$ch014_15, ch014_16=new_2$ch014_16,
                       ch014_17=new_2$ch014_17, ch014_18=new_2$ch014_18, ch014_19=new_2$ch014_19, ch014_20=new_2$ch014_20,
                       dn032_1=new_2$dn032_1, dn032_2=new_2$dn032_2,
                       sn005_1=new$sn005_1,sn005_2=new$sn005_2,sn005_3=new$sn005_3,sn005_4=new$sn005_4,
                       sn005_5=new$sn005_5,sn005_6=new$sn005_6,sn005_7=new$sn005_7,
                       sn007_1=new$sn007_1,sn007_2=new$sn007_2,sn007_3=new$sn007_3,sn007_4=new$sn007_4,
                       sn007_5=new$sn007_5,sn007_6=new$sn007_6,sn007_7=new$sn007_7) 
  # id = new_2$id
  # colname_form_OLD_table = new_2$colname_form_OLD_table 
  # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = SHARE_w4_cont_rel12 (ch014_1,..,ch014_20, dn032_1, dn032_2)
# new = SHARE_w4_cont_rel3 (sn005_1,..,sn005_7, sn007_1,..,sn007_7)

SHARE_w4_cont_rel <- same_indiv2(SHARE_w4_cont_rel12, SHARE_w4_cont_rel3)


SHARE_ds_w4 <- tibble(id=SHARE_w4_cont_rel$id)

SHARE_w4_cont_rel$ch014_1 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_1), "NA='-999'")
SHARE_w4_cont_rel$ch014_2 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_2), "NA='-999'")
SHARE_w4_cont_rel$ch014_3 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_3), "NA='-999'")
SHARE_w4_cont_rel$ch014_4 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_4), "NA='-999'")
SHARE_w4_cont_rel$ch014_5 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_5), "NA='-999'")
SHARE_w4_cont_rel$ch014_6 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_6), "NA='-999'")
SHARE_w4_cont_rel$ch014_7 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_7), "NA='-999'")
SHARE_w4_cont_rel$ch014_8 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_8), "NA='-999'")
SHARE_w4_cont_rel$ch014_9 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_9), "NA='-999'")
SHARE_w4_cont_rel$ch014_10 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_10), "NA='-999'")
SHARE_w4_cont_rel$ch014_11 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_11), "NA='-999'")
SHARE_w4_cont_rel$ch014_12 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_12), "NA='-999'")
SHARE_w4_cont_rel$ch014_13 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_13), "NA='-999'")
SHARE_w4_cont_rel$ch014_14 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_14), "NA='-999'")
SHARE_w4_cont_rel$ch014_15 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_15), "NA='-999'")
SHARE_w4_cont_rel$ch014_16 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_16), "NA='-999'")
SHARE_w4_cont_rel$ch014_17 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_17), "NA='-999'")
SHARE_w4_cont_rel$ch014_18 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_18), "NA='-999'")
SHARE_w4_cont_rel$ch014_19 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_19), "NA='-999'")
SHARE_w4_cont_rel$ch014_20 <- car::recode(as.vector(SHARE_w4_cont_rel$ch014_20), "NA='-999'")

SHARE_w4_cont_rel$dn032_1 <- car::recode(as.vector(SHARE_w4_cont_rel$dn032_1), "NA='-999'")
SHARE_w4_cont_rel$dn032_2 <- car::recode(as.vector(SHARE_w4_cont_rel$dn032_2), "NA='-999'")

SHARE_w4_cont_rel$sn005_1 <- car::recode(as.vector(SHARE_w4_cont_rel$sn005_1), "NA='-999'")
SHARE_w4_cont_rel$sn005_2 <- car::recode(as.vector(SHARE_w4_cont_rel$sn005_2), "NA='-999'")
SHARE_w4_cont_rel$sn005_3 <- car::recode(as.vector(SHARE_w4_cont_rel$sn005_3), "NA='-999'")
SHARE_w4_cont_rel$sn005_4 <- car::recode(as.vector(SHARE_w4_cont_rel$sn005_4), "NA='-999'")
SHARE_w4_cont_rel$sn005_5 <- car::recode(as.vector(SHARE_w4_cont_rel$sn005_5), "NA='-999'")
SHARE_w4_cont_rel$sn005_6 <- car::recode(as.vector(SHARE_w4_cont_rel$sn005_6), "NA='-999'")
SHARE_w4_cont_rel$sn005_7 <- car::recode(as.vector(SHARE_w4_cont_rel$sn005_7), "NA='-999'")

SHARE_w4_cont_rel$sn007_1 <- car::recode(as.vector(SHARE_w4_cont_rel$sn007_1), "NA='-999'")
SHARE_w4_cont_rel$sn007_2 <- car::recode(as.vector(SHARE_w4_cont_rel$sn007_2), "NA='-999'")
SHARE_w4_cont_rel$sn007_3 <- car::recode(as.vector(SHARE_w4_cont_rel$sn007_3), "NA='-999'")
SHARE_w4_cont_rel$sn007_4 <- car::recode(as.vector(SHARE_w4_cont_rel$sn007_4), "NA='-999'")
SHARE_w4_cont_rel$sn007_5 <- car::recode(as.vector(SHARE_w4_cont_rel$sn007_5), "NA='-999'")
SHARE_w4_cont_rel$sn007_6 <- car::recode(as.vector(SHARE_w4_cont_rel$sn007_6), "NA='-999'")
SHARE_w4_cont_rel$sn007_7 <- car::recode(as.vector(SHARE_w4_cont_rel$sn007_7), "NA='-999'")


SHARE_ds_w4$cont_rel <- c(NA)
for(i in 1:dim(SHARE_w4_cont_rel)[1]){
  
  if( SHARE_w4_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_2[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_4[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_5[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_6[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_7[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_8[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_9[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_10[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_11[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_12[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_13[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_14[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_15[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_16[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_17[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_18[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_19[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_20[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w4_cont_rel$dn032_2[i] %in% c(1,2,3) ) {
    SHARE_ds_w4$cont_rel[i] = 1 }
  
  else if( (SHARE_w4_cont_rel$sn005_1[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_1[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_2[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_2[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_3[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_3[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_4[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_4[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_5[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_5[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_6[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_6[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_7[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_7[i] %in% c(1,2,3)) ){
    SHARE_ds_w4$cont_rel[i] = 1 }
  
  else if( !( SHARE_w4_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_2[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_4[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_5[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_6[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_7[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_8[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_9[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_10[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_11[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_12[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_13[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_14[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_15[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_16[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_17[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_18[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$ch014_19[i] %in% c(1,2,3) | SHARE_w4_cont_rel$ch014_20[i] %in% c(1,2,3) |
      SHARE_w4_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w4_cont_rel$dn032_2[i] %in% c(1,2,3) ) |
      !( (SHARE_w4_cont_rel$sn005_1[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_1[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_2[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_2[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_3[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_3[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_4[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_4[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_5[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_5[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_6[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_6[i] %in% c(1,2,3)) |
           (SHARE_w4_cont_rel$sn005_7[i] %in% c(1:20) & SHARE_w4_cont_rel$sn007_7[i] %in% c(1,2,3)) ) ) {
    SHARE_ds_w4$cont_rel[i] = 0 }
}

SHARE_ds_w4$cont_rel <- car::recode(as.vector(SHARE_ds_w4$cont_rel), "NA='999'")
SHARE_ds_w4$cont_rel <- labelled(SHARE_ds_w4$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript4}
Categorical_summary(var = SHARE_ds_w4$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w4, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact (face-to-face/phone/mail/Internet communicators) with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation4}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]



### SHARE - Wave 5

#### Study-specific variables

The study-specific variable elected to be harmonised is:
  
* Name: `ch014_1` UP TO `ch014_20` **from table sharew5_rel1-0-0_ch**
* Label: `contact with (selected) child 1`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`

* Name: `dn032_2` **from table sharew5_rel1-0-0_dn**
* Label: `personal contact with parent during past 12 months: father`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`

* Name: `dn032_1` **from table sharew5_rel1-0-0_dn**
* Label: `personal contact with parent during past 12 months: mother`
* Categories:
    + `1 = daily`
    + `2 = several times a week`
    + `3 = about once a week`
    + `4 = about every two weeks`
    + `5 = about once a month`
    + `6 = less than once a month`
    + `7 = never`
* Missings:
    + `-2 = refusal`
    + `-1 = don't know`


```{r assign5}
opal.assign.table.tibble(o, 'SHARE_w5_cont_rel1','SHARE.sharew5_rel1-0-0_ch', 
                         variables=list('ch014_1','ch014_2','ch014_3','ch014_4','ch014_5','ch014_6','ch014_7','ch014_8',
                                        'ch014_9','ch014_10','ch014_11','ch014_12','ch014_13','ch014_14','ch014_15','ch014_16',
                                        'ch014_17','ch014_18','ch014_19','ch014_20'), missings = TRUE)

opal.assign.table.tibble(o, 'SHARE_w5_cont_rel2','SHARE.sharew5_rel1-0-0_dn', 
                         variables=list('dn032_2','dn032_1'), missings = TRUE)
```

```{r local5}
SHARE_w5_cont_rel1 <- opal.execute(o,'SHARE_w5_cont_rel1')
Categorical_summary(var =SHARE_w5_cont_rel1$ch014_1, missing_values = NA)
ggplot(SHARE_w5_cont_rel1, aes(x=factor(ch014_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("contact with (selected) child 1") + ylab("Frequency") 

SHARE_w5_cont_rel2 <- opal.execute(o,'SHARE_w5_cont_rel2')
Categorical_summary(var =SHARE_w5_cont_rel2$dn032_2, missing_values = NA)
ggplot(SHARE_w5_cont_rel2, aes(x=factor(dn032_2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: father") + ylab("Frequency") 
Categorical_summary(var =SHARE_w5_cont_rel2$dn032_1, missing_values = NA)
ggplot(SHARE_w5_cont_rel2, aes(x=factor(dn032_1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("personal contact with parent during past 12 months: mother") + ylab("Frequency") 
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
  
* `if any is in 1:3 then 1`

R code of the ALGORITHM:
  
```{r harmo5}

same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  colnames(new_2) <- colnames(old)
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep_len(NA,dim(old)[2]-1))
    }
  }
  new_2 <- data.frame(new_2)
  new_22 <- data.frame(id=new_2$id, 
                       ch014_1=new_2$ch014_1, ch014_2=new_2$ch014_2, ch014_3=new_2$ch014_3, ch014_4=new_2$ch014_4,
                       ch014_5=new_2$ch014_5, ch014_6=new_2$ch014_6, ch014_7=new_2$ch014_7, ch014_8=new_2$ch014_8,
                       ch014_9=new_2$ch014_9, ch014_10=new_2$ch014_10, ch014_11=new_2$ch014_11, ch014_12=new_2$ch014_12,
                       ch014_13=new_2$ch014_13, ch014_14=new_2$ch014_14, ch014_15=new_2$ch014_15, ch014_16=new_2$ch014_16,
                       ch014_17=new_2$ch014_17, ch014_18=new_2$ch014_18, ch014_19=new_2$ch014_19, ch014_20=new_2$ch014_20,
                       dn032_1=new$dn032_1, dn032_2=new$dn032_2) 
  # id = new_2$id
  # colname_form_OLD_table = new_2$colname_form_OLD_table 
  # colname_form_NEW_table = new$colname_form_NEW_table
  new_22
}

# old = SHARE_w5_cont_rel1 (ch014_1,..,ch014_20)
# new = SHARE_w5_cont_rel2 (dn032_1, dn032_2)

SHARE_w5_cont_rel <- same_indiv(SHARE_w5_cont_rel1, SHARE_w5_cont_rel2)

SHARE_ds_w5 <- tibble(id=SHARE_w5_cont_rel$id)

SHARE_w5_cont_rel$ch014_1 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_1), "NA='-999'")
SHARE_w5_cont_rel$ch014_2 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_2), "NA='-999'")
SHARE_w5_cont_rel$ch014_3 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_3), "NA='-999'")
SHARE_w5_cont_rel$ch014_4 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_4), "NA='-999'")
SHARE_w5_cont_rel$ch014_5 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_5), "NA='-999'")
SHARE_w5_cont_rel$ch014_6 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_6), "NA='-999'")
SHARE_w5_cont_rel$ch014_7 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_7), "NA='-999'")
SHARE_w5_cont_rel$ch014_8 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_8), "NA='-999'")
SHARE_w5_cont_rel$ch014_9 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_9), "NA='-999'")
SHARE_w5_cont_rel$ch014_10 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_10), "NA='-999'")
SHARE_w5_cont_rel$ch014_11 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_11), "NA='-999'")
SHARE_w5_cont_rel$ch014_12 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_12), "NA='-999'")
SHARE_w5_cont_rel$ch014_13 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_13), "NA='-999'")
SHARE_w5_cont_rel$ch014_14 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_14), "NA='-999'")
SHARE_w5_cont_rel$ch014_15 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_15), "NA='-999'")
SHARE_w5_cont_rel$ch014_16 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_16), "NA='-999'")
SHARE_w5_cont_rel$ch014_17 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_17), "NA='-999'")
SHARE_w5_cont_rel$ch014_18 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_18), "NA='-999'")
SHARE_w5_cont_rel$ch014_19 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_19), "NA='-999'")
SHARE_w5_cont_rel$ch014_20 <- car::recode(as.vector(SHARE_w5_cont_rel$ch014_20), "NA='-999'")
SHARE_w5_cont_rel$dn032_1 <- car::recode(as.vector(SHARE_w5_cont_rel$dn032_1), "NA='-999'")
SHARE_w5_cont_rel$dn032_2 <- car::recode(as.vector(SHARE_w5_cont_rel$dn032_2), "NA='-999'")


SHARE_ds_w5$cont_rel <- c(NA)
for(i in 1:dim(SHARE_w5_cont_rel)[1]){
  if( SHARE_w5_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_2[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_4[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_5[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_6[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_7[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_8[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_9[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_10[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_11[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_12[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_13[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_14[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_15[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_16[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_17[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_18[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_19[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_20[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w5_cont_rel$dn032_2[i] %in% c(1,2,3) ) {
    SHARE_ds_w5$cont_rel[i] = 1 }
  else if( SHARE_w5_cont_rel$ch014_1[i] == -999 & SHARE_w5_cont_rel$ch014_2[i] == -999 &
      SHARE_w5_cont_rel$ch014_3[i] == -999 & SHARE_w5_cont_rel$ch014_4[i] == -999 &
      SHARE_w5_cont_rel$ch014_5[i] == -999 & SHARE_w5_cont_rel$ch014_6[i] == -999 &
      SHARE_w5_cont_rel$ch014_7[i] == -999 & SHARE_w5_cont_rel$ch014_8[i] == -999 &
      SHARE_w5_cont_rel$ch014_9[i] == -999 & SHARE_w5_cont_rel$ch014_10[i] == -999 &
      SHARE_w5_cont_rel$ch014_11[i] == -999 & SHARE_w5_cont_rel$ch014_12[i] == -999 &
      SHARE_w5_cont_rel$ch014_13[i] == -999 & SHARE_w5_cont_rel$ch014_14[i] == -999 &
      SHARE_w5_cont_rel$ch014_15[i] == -999 & SHARE_w5_cont_rel$ch014_16[i] == -999 &
      SHARE_w5_cont_rel$ch014_17[i] == -999 & SHARE_w5_cont_rel$ch014_18[i] == -999 &
      SHARE_w5_cont_rel$ch014_19[i] == -999 & SHARE_w5_cont_rel$ch014_20[i] == -999 &
      SHARE_w5_cont_rel$dn032_1[i] == -999 & SHARE_w5_cont_rel$dn032_2[i] == -999 ) {
    SHARE_ds_w5$cont_rel[i] = 999 }
  else if( !( SHARE_w5_cont_rel$ch014_1[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_2[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_3[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_4[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_5[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_6[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_7[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_8[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_9[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_10[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_11[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_12[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_13[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_14[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_15[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_16[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_17[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_18[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$ch014_19[i] %in% c(1,2,3) | SHARE_w5_cont_rel$ch014_20[i] %in% c(1,2,3) |
      SHARE_w5_cont_rel$dn032_1[i] %in% c(1,2,3) | SHARE_w5_cont_rel$dn032_2[i] %in% c(1,2,3) ) ) {
    SHARE_ds_w5$cont_rel[i] = 0 }
}

SHARE_ds_w5$cont_rel <- car::recode(as.vector(SHARE_ds_w5$cont_rel), "NA='999'")
SHARE_ds_w5$cont_rel <- labelled(SHARE_ds_w5$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript5}
Categorical_summary(var = SHARE_ds_w5$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SHARE_ds_w5, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact (face-to-face/phone/mail/Internet communicators) with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation5}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]

