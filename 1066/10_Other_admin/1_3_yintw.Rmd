---
title: "Year of interview"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/Rmds/setup_ania.r")
```
<!-- ########################################################## --> 


# Description of DataSchema variable

The description of harmonised variable is the following:


* Short name: `yintw`
* Variable label: `year of interview`
* Domain: `Other administrative variables`
* Value type: `Continuous`

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing


<!-- ########################################################## --> 

# Data process


```{r, dataDirectory, echo=FALSE}
datafolder <- "../RData"
```


## Cuba

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_cuba1, echo=F}
opal.assign.table.tibble(o, 't1066_cuba_w1_yinter','10-66.1066-Cuba-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_cuba1, echo=F}
t1066_cuba_w1_yinter <- opal.execute(o,'t1066_cuba_w1_yinter')
t1066_cuba_w1_yinter$yinter <- as.numeric(format(t1066_cuba_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_cuba_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_cuba_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

There is a value 2206 in year of interview that is going to consider as a 2006 because it is consider a write mistake. The value NA in year or interview is going to be computed as 2004 since is the most frecuent value. 


#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 2004`

**R script:**

```{r harmo_cuba1}
t1066_ds_cuba_w1 <- tibble(id=t1066_cuba_w1_yinter$id)
t1066_ds_cuba_w1$yintw <- car::recode(t1066_cuba_w1_yinter$yinter, "NA=2004; 2206=2006")
t1066_ds_cuba_w1$yintw <- labelled(t1066_ds_cuba_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_cuba1, echo=F}
Categorical_summary(var = t1066_ds_cuba_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_cuba_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_cuba1, echo=F}
BeforeH <- table(t1066_cuba_w1_yinter$yinter)
BeforeH <- c(BeforeH[1:4], sum(BeforeH[c(5,7)]), BeforeH[6])
AfterH <- table(t1066_ds_cuba_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2002", "2003", "2004", "2005", "2006", "2007")
kable(C)
```





```{r importOPAL_cuba1, echo=F}
val_labels(t1066_ds_cuba_w1) <- NULL
#opal.assign.data(o, 't1066_ds_cuba_w1', t1066_ds_cuba_w1)
#opal.symbol_import(o,'t1066_ds_cuba_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_cuba_w1 <- t1066_ds_cuba_w1
t1066_m_ds_cuba_w1$yintw <- car::recode(t1066_ds_cuba_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_cuba_w1', t1066_m_ds_cuba_w1)
#opal.symbol_import(o,'t1066_m_ds_cuba_w1', project='_Athlos_Harm_Dataset')
```






### Wave 2 


```{r assign_cuba2, echo=F}
opal.assign.table.tibble(o, 't1066_cuba_w2_id','10-66.1066-Cuba-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_cuba2, echo=F}
t1066_cuba_w2_id <- opal.execute(o,'t1066_cuba_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2009. 

**R script:**

```{r harmo_cuba2}
t1066_ds_cuba_w2 <- tibble(id=t1066_cuba_w2_id$id)
t1066_ds_cuba_w2$yintw <- 2009
t1066_ds_cuba_w2$yintw <- labelled(t1066_ds_cuba_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_cuba2, echo=F}
Categorical_summary(var = t1066_ds_cuba_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_cuba_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_cuba2, echo=F}
```





```{r importOPAL_cuba2, echo=F}
val_labels(t1066_ds_cuba_w2) <- NULL
#opal.assign.data(o, 't1066_ds_cuba_w2', t1066_ds_cuba_w2)
#opal.symbol_import(o,'t1066_ds_cuba_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_cuba_w2 <- t1066_ds_cuba_w2
t1066_m_ds_cuba_w2$yintw <- car::recode(t1066_m_ds_cuba_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_cuba_w2', t1066_m_ds_cuba_w2)
#opal.symbol_import(o,'t1066_m_ds_cuba_w2', project='_Athlos_Harm_Dataset')
```




## India

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_india1, echo=F}
opal.assign.table.tibble(o, 't1066_india_w1_yinter','10-66.1066-India-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_india1, echo=F}
t1066_india_w1_yinter <- opal.execute(o,'t1066_india_w1_yinter')
t1066_india_w1_yinter$yinter <- as.numeric(format(t1066_india_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_india_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_india_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

The values NA in year or interview are going to be computed as 2004 since is the most frecuent value. 

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_india1}
t1066_ds_india_w1 <- tibble(id=t1066_india_w1_yinter$id)
t1066_ds_india_w1$yintw <- car::recode(t1066_india_w1_yinter$yinter, "NA=2004")
t1066_ds_india_w1$yintw <- labelled(t1066_ds_india_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_india1, echo=F}
Categorical_summary(var = t1066_ds_india_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_india_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_india1, echo=F}
BeforeH <- table(t1066_india_w1_yinter$yinter, useNA = "ifany")
BeforeH <- c(BeforeH[1], sum(BeforeH[c(2,5)]), BeforeH[3:4])
AfterH <- table(t1066_ds_india_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2003", "2004", "2005", "2006")
kable(C)
```





```{r importOPAL_india1, echo=F}
val_labels(t1066_ds_india_w1) <- NULL
#opal.assign.data(o, 't1066_ds_india_w1', t1066_ds_india_w1)
#opal.symbol_import(o,'t1066_ds_india_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_india_w1 <- t1066_ds_india_w1
t1066_m_ds_india_w1$yintw <- car::recode(t1066_m_ds_india_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_india_w1', t1066_m_ds_india_w1)
#opal.symbol_import(o,'t1066_m_ds_india_w1', project='_Athlos_Harm_Dataset')
```






### Wave 2 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `fu_DATE`
* Label: `date of interview (follow-up)`


```{r assign_india2, echo=F}
opal.assign.table.tibble(o, 't1066_india_w2_yinter','10-66.1066-India-Followup',
                         variables=list('fu_DATE'), missings = TRUE)
```

```{r local_india2, echo=F}
t1066_india_w2_yinter <- opal.execute(o,'t1066_india_w2_yinter')
t1066_india_w2_yinter$yinter <- as.numeric(format(t1066_india_w2_yinter$fu_DATE, '%Y'))
Categorical_summary(var = t1066_india_w2_yinter$yinter, missing_values = NA)
ggplot(t1066_india_w2_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

The values NA in year or interview are going to be computed as 2008 since is the most frecuent value. 

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as 2008. 

**R script:**

```{r harmo_india2}
t1066_ds_india_w2 <- tibble(id=t1066_india_w2_yinter$id)
t1066_ds_india_w2$yintw <- car::recode(t1066_india_w2_yinter$yinter, "NA=2008")
t1066_ds_india_w2$yintw <- labelled(t1066_ds_india_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_india2, echo=F}
Categorical_summary(var = t1066_ds_india_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_india_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_india2, echo=F}
BeforeH <- sum(table(t1066_india_w2_yinter$yinter, useNA = "ifany"))
AfterH <- table(t1066_ds_india_w2$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2008")
kable(C)
```





```{r importOPAL_india2, echo=F}
val_labels(t1066_ds_india_w2) <- NULL
#opal.assign.data(o, 't1066_ds_india_w2', t1066_ds_india_w2)
#opal.symbol_import(o,'t1066_ds_india_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_india_w2 <- t1066_ds_india_w2
t1066_m_ds_india_w2$yintw <- car::recode(t1066_m_ds_india_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_india_w2', t1066_m_ds_india_w2)
#opal.symbol_import(o,'t1066_m_ds_india_w2', project='_Athlos_Harm_Dataset')
```







## Urban China

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_UCh1, echo=F}
opal.assign.table.tibble(o, 't1066_UCh_w1_yinter','10-66.1066-UrbanChina-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_UCh1, echo=F}
t1066_UCh_w1_yinter <- opal.execute(o,'t1066_UCh_w1_yinter')
t1066_UCh_w1_yinter$yinter <- as.numeric(format(t1066_UCh_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_UCh_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_UCh_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_UCh1}
t1066_ds_UCh_w1 <- tibble(id=t1066_UCh_w1_yinter$id)
t1066_ds_UCh_w1$yintw <- t1066_UCh_w1_yinter$yinter
t1066_ds_UCh_w1$yintw <- labelled(t1066_ds_UCh_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_UCh1, echo=F}
Categorical_summary(var = t1066_ds_UCh_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UCh_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_UCh1, echo=F}
BeforeH <- table(t1066_UCh_w1_yinter$yinter, useNA = "ifany")
AfterH <- table(t1066_ds_UCh_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2003", "2004", "2005")
kable(C)
```





```{r importOPAL_UCh1, echo=F}
val_labels(t1066_ds_UCh_w1) <- NULL
#opal.assign.data(o, 't1066_ds_UCh_w1', t1066_ds_UCh_w1)
#opal.symbol_import(o,'t1066_ds_UCh_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_UCh_w1 <- t1066_ds_UCh_w1
t1066_m_ds_UCh_w1$yintw <- car::recode(t1066_m_ds_UCh_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_UCh_w1', t1066_m_ds_UCh_w1)
#opal.symbol_import(o,'t1066_m_ds_UCh_w1', project='_Athlos_Harm_Dataset')
```






### Wave 2 

#### Study-specific variables

```{r assign_UCh2, echo=F}
opal.assign.table.tibble(o, 't1066_UCh_w2_id','10-66.1066-UrbanChina-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_UCh2, echo=F}
t1066_UCh_w2_id <- opal.execute(o,'t1066_UCh_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2009. 

**R script:**

```{r harmo_UCh2}
t1066_ds_UCh_w2 <- tibble(id=t1066_UCh_w2_id$id)
t1066_ds_UCh_w2$yintw <- 2009
t1066_ds_UCh_w2$yintw <- labelled(t1066_ds_UCh_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_UCh2, echo=F}
Categorical_summary(var = t1066_ds_UCh_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UCh_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_UCh2, echo=F}
```





```{r importOPAL_UCh2, echo=F}
val_labels(t1066_ds_UCh_w2) <- NULL
#opal.assign.data(o, 't1066_ds_UCh_w2', t1066_ds_UCh_w2)
#opal.symbol_import(o,'t1066_ds_UCh_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_UCh_w2 <- t1066_ds_UCh_w2
t1066_m_ds_UCh_w2$yintw <- car::recode(t1066_m_ds_UCh_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_UCh_w2', t1066_m_ds_UCh_w2)
#opal.symbol_import(o,'t1066_m_ds_UCh_w2', project='_Athlos_Harm_Dataset')
```



## Rural China

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`

```{r assign_RCh1, echo=F}
opal.assign.table.tibble(o, 't1066_RCh_w1_yinter','10-66.1066-RuralChina-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_RCh1, echo=F}
t1066_RCh_w1_yinter <- opal.execute(o,'t1066_RCh_w1_yinter')
t1066_RCh_w1_yinter$yinter <- as.numeric(format(t1066_RCh_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_RCh_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_RCh_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_RCh1}
t1066_ds_RCh_w1 <- tibble(id=t1066_RCh_w1_yinter$id)
t1066_ds_RCh_w1$yintw <- car::recode(t1066_RCh_w1_yinter$yinter, "NA=2004")
t1066_ds_RCh_w1$yintw <- labelled(t1066_ds_RCh_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_RCh1, echo=F}
Categorical_summary(var = t1066_ds_RCh_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RCh_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_RCh1, echo=F}
BeforeH <- table(t1066_RCh_w1_yinter$yinter, useNA = "ifany")
AfterH <- table(t1066_ds_RCh_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2004", "2005")
kable(C)
```





```{r importOPAL_RCh1, echo=F}
val_labels(t1066_ds_RCh_w1) <- NULL
#opal.assign.data(o, 't1066_ds_RCh_w1', t1066_ds_RCh_w1)
#opal.symbol_import(o,'t1066_ds_RCh_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_RCh_w1 <- t1066_ds_RCh_w1
t1066_m_ds_RCh_w1$yintw <- car::recode(t1066_m_ds_RCh_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_RCh_w1', t1066_m_ds_RCh_w1)
#opal.symbol_import(o,'t1066_m_ds_RCh_w1', project='_Athlos_Harm_Dataset')
```







### Wave 2 

```{r assign_RCh2, echo=F}
opal.assign.table.tibble(o, 't1066_RCh_w2_id','10-66.1066-RuralChina-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_RCh2, echo=F}
t1066_RCh_w2_id <- opal.execute(o,'t1066_RCh_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2009. 

**R script:**

```{r harmo_RCh2}
t1066_ds_RCh_w2 <- tibble(id=t1066_RCh_w2_id$id)
t1066_ds_RCh_w2$yintw <- 2009
t1066_ds_RCh_w2$yintw <- labelled(t1066_ds_RCh_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_RCh2, echo=F}
Categorical_summary(var = t1066_ds_RCh_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RCh_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_RCh2, echo=F}
```





```{r importOPAL_RCh2, echo=F}
val_labels(t1066_ds_RCh_w2) <- NULL
#opal.assign.data(o, 't1066_ds_RCh_w2', t1066_ds_RCh_w2)
#opal.symbol_import(o,'t1066_ds_RCh_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_RCh_w2 <- t1066_ds_RCh_w2
t1066_m_ds_RCh_w2$yintw <- car::recode(t1066_m_ds_RCh_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_RCh_w2', t1066_m_ds_RCh_w2)
#opal.symbol_import(o,'t1066_m_ds_RCh_w2', project='_Athlos_Harm_Dataset')
```





## Dominican Republic

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_DR1, echo=F}
opal.assign.table.tibble(o, 't1066_DR_w1_yinter','10-66.1066-DominicanRepublic-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_DR1, echo=F}
t1066_DR_w1_yinter <- opal.execute(o,'t1066_DR_w1_yinter')
t1066_DR_w1_yinter$yinter <- as.numeric(format(t1066_DR_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_DR_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_DR_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

There are the values 2204 and 5005 that are going to consider as a 2004 and 2005 respetcively because they are considered write mistakes. The value NA in year or interview is going to be computed as 2005 since is the most frecuent value. 

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_DR1}
t1066_ds_DR_w1 <- tibble(id=t1066_DR_w1_yinter$id)
t1066_ds_DR_w1$yintw <- car::recode(t1066_DR_w1_yinter$yinter, "2204=2004; 5005=2005; NA=2005")
t1066_ds_DR_w1$yintw <- labelled(t1066_ds_DR_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_DR1, echo=F}
Categorical_summary(var = t1066_ds_DR_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_DR_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_DR1, echo=F}
BeforeH <- table(t1066_DR_w1_yinter$yinter, useNA = "ifany")
BeforeH <- c(BeforeH[1:3], sum(BeforeH[c(4,7)]), sum(BeforeH[c(5,8,9)]), BeforeH[6])
AfterH <- table(t1066_ds_DR_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2001", "2002", "2003", "2004", "2005", "2006")
kable(C)
```





```{r importOPAL_DR1, echo=F}
val_labels(t1066_ds_DR_w1) <- NULL
#opal.assign.data(o, 't1066_ds_DR_w1', t1066_ds_DR_w1)
#opal.symbol_import(o,'t1066_ds_DR_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_DR_w1 <- t1066_ds_DR_w1
t1066_m_ds_DR_w1$yintw <- car::recode(t1066_m_ds_DR_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_DR_w1', t1066_m_ds_DR_w1)
#opal.symbol_import(o,'t1066_m_ds_DR_w1', project='_Athlos_Harm_Dataset')
```








### Wave 2 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `gender`
* Label: `gender (PSEXRE miscodes recoded)`
* Categories: 
    + `1.0 = Female`
    + `2.0 = Male`


```{r assign_DR2, echo=F}
opal.assign.table.tibble(o, 't1066_DR_w2_id','10-66.1066-DominicanRepublic-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_DR2, echo=F}
t1066_DR_w2_id <- opal.execute(o,'t1066_DR_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2010. 

**R script:**

```{r harmo_DR2}
t1066_ds_DR_w2 <- tibble(id=t1066_DR_w2_id$id)
t1066_ds_DR_w2$yintw <- 2010
t1066_ds_DR_w2$yintw <- labelled(t1066_ds_DR_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_DR2, echo=F}
Categorical_summary(var = t1066_ds_DR_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_DR_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_DR2, echo=F}
```





```{r importOPAL_DR2, echo=F}
val_labels(t1066_ds_DR_w2) <- NULL
#opal.assign.data(o, 't1066_ds_DR_w2', t1066_ds_DR_w2)
#opal.symbol_import(o,'t1066_ds_DR_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_DR_w2 <- t1066_ds_DR_w2
t1066_m_ds_DR_w2$yintw <- car::recode(t1066_m_ds_DR_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_DR_w2', t1066_m_ds_DR_w2)
#opal.symbol_import(o,'t1066_m_ds_DR_w2', project='_Athlos_Harm_Dataset')
```






## Venezuela

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_V1, echo=F}
opal.assign.table.tibble(o, 't1066_Ven_w1_yinter','10-66.1066-Venezuela-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_V1, echo=F}
t1066_Ven_w1_yinter <- opal.execute(o,'t1066_Ven_w1_yinter')
t1066_Ven_w1_yinter$yinter <- as.numeric(format(t1066_Ven_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_Ven_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_Ven_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_V1}
t1066_ds_Ven_w1 <- tibble(id=t1066_Ven_w1_yinter$id)
t1066_ds_Ven_w1$yintw <- t1066_Ven_w1_yinter$yinter
t1066_ds_Ven_w1$yintw <- labelled(t1066_ds_Ven_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_V1, echo=F}
Categorical_summary(var = t1066_ds_Ven_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_Ven_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_V1, echo=F}
BeforeH <- table(t1066_Ven_w1_yinter$yinter, useNA = "ifany")
AfterH <- table(t1066_ds_Ven_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2003", "2004", "2005", "2006")
kable(C)
```





```{r importOPAL_V1, echo=F}
val_labels(t1066_ds_Ven_w1) <- NULL
#opal.assign.data(o, 't1066_ds_Ven_w1', t1066_ds_Ven_w1)
#opal.symbol_import(o,'t1066_ds_Ven_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_Ven_w1 <- t1066_ds_Ven_w1
t1066_m_ds_Ven_w1$yintw <- car::recode(t1066_m_ds_Ven_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_Ven_w1', t1066_m_ds_Ven_w1)
#opal.symbol_import(o,'t1066_m_ds_Ven_w1', project='_Athlos_Harm_Dataset')
```







### Wave 2 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `gender`
* Label: `gender (PSEXRE miscodes recoded)`
* Categories: 
    + `1.0 = Female`
    + `2.0 = Male`


```{r assign_V2, echo=F}
opal.assign.table.tibble(o, 't1066_Ven_w2_id','10-66.1066-Venezuela-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_V2, echo=F}
t1066_Ven_w2_id <- opal.execute(o,'t1066_Ven_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2010. 

**R script:**

```{r harmo_V2}
t1066_ds_Ven_w2 <- tibble(id=t1066_Ven_w2_id$id)
t1066_ds_Ven_w2$yintw <- 2010
t1066_ds_Ven_w2$yintw <- labelled(t1066_ds_Ven_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_V2, echo=F}
Categorical_summary(var = t1066_ds_Ven_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_Ven_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_V2, echo=F}
```





```{r importOPAL_V2, echo=F}
val_labels(t1066_ds_Ven_w2) <- NULL
#opal.assign.data(o, 't1066_ds_Ven_w2', t1066_ds_Ven_w2)
#opal.symbol_import(o,'t1066_ds_Ven_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_Ven_w2 <- t1066_ds_Ven_w2
t1066_m_ds_Ven_w2$yintw <- car::recode(t1066_m_ds_Ven_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_Ven_w2', t1066_m_ds_Ven_w2)
#opal.symbol_import(o,'t1066_m_ds_Ven_w2', project='_Athlos_Harm_Dataset')
```



## Urban Peru

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`

```{r assign_UP, echo=F}
opal.assign.table.tibble(o, 't1066_UP_w1_yinter','10-66.1066-UrbanPeru-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_UP1, echo=F}
t1066_UP_w1_yinter <- opal.execute(o,'t1066_UP_w1_yinter')
t1066_UP_w1_yinter$yinter <- as.numeric(format(t1066_UP_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_UP_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_UP_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

The value NA in year or interview is going to be computed as 2005 since is the most frecuent value. 

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_UP1}
t1066_ds_UP_w1 <- tibble(id=t1066_UP_w1_yinter$id)
t1066_ds_UP_w1$yintw <- car::recode(t1066_UP_w1_yinter$yinter, "NA=2005")
t1066_ds_UP_w1$yintw <- labelled(t1066_ds_UP_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_UP1, echo=F}
Categorical_summary(var = t1066_ds_UP_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UP_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_UP1, echo=F}
BeforeH <- table(t1066_UP_w1_yinter$yinter, useNA = "ifany")
BeforeH <- c(BeforeH[1:2], sum(BeforeH[c(3,6)]), BeforeH[4:5])
AfterH <- table(t1066_ds_UP_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- names(AfterH)
kable(C)
```





```{r importOPAL_UP1, echo=F}
val_labels(t1066_ds_UP_w1) <- NULL
#opal.assign.data(o, 't1066_ds_UP_w1', t1066_ds_UP_w1)
#opal.symbol_import(o,'t1066_ds_UP_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_UP_w1 <- t1066_ds_UP_w1
t1066_m_ds_UP_w1$yintw <- car::recode(t1066_m_ds_UP_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_UP_w1', t1066_m_ds_UP_w1)
#opal.symbol_import(o,'t1066_m_ds_UP_w1', project='_Athlos_Harm_Dataset')
```






### Wave 2 

#### Study-specific variables

```{r assign_UP2, echo=F}
opal.assign.table.tibble(o, 't1066_UP_w2_id','10-66.1066-UrbanPeru-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_UP2, echo=F}
t1066_UP_w2_id <- opal.execute(o,'t1066_UP_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2010. 

**R script:**

```{r harmo_UP2}
t1066_ds_UP_w2 <- tibble(id=t1066_UP_w2_id$id)
t1066_ds_UP_w2$yintw <- 2010
t1066_ds_UP_w2$yintw <- labelled(t1066_ds_UP_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_UP2, echo=F}
Categorical_summary(var = t1066_ds_UP_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UP_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_UP2, echo=F}
```





```{r importOPAL_UP2, echo=F}
val_labels(t1066_ds_UP_w2) <- NULL
#opal.assign.data(o, 't1066_ds_UP_w2', t1066_ds_UP_w2)
#opal.symbol_import(o,'t1066_ds_UP_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_UP_w2 <- t1066_ds_UP_w2
t1066_m_ds_UP_w2$yintw <- car::recode(t1066_m_ds_UP_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_UP_w2', t1066_m_ds_UP_w2)
#opal.symbol_import(o,'t1066_m_ds_UP_w2', project='_Athlos_Harm_Dataset')
```






## Rural Peru

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_RP, echo=F}
opal.assign.table.tibble(o, 't1066_RP_w1_yinter','10-66.1066-RuralPeru-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_RP1, echo=F}
t1066_RP_w1_yinter <- opal.execute(o,'t1066_RP_w1_yinter')
t1066_RP_w1_yinter$yinter <- as.numeric(format(t1066_RP_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_RP_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_RP_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

There is a value 2026 in year of interview that is going to consider as a 2006 because it is consider as a write mistake.

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_RP1}
t1066_ds_RP_w1 <- tibble(id=t1066_RP_w1_yinter$id)
t1066_ds_RP_w1$yintw <- car::recode(t1066_RP_w1_yinter$yinter, "2026=2006; NA=2004")
t1066_ds_RP_w1$yintw <- labelled(t1066_ds_RP_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_RP1, echo=F}
Categorical_summary(var = t1066_ds_RP_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RP_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_RP1, echo=F}
X <- table(t1066_RP_w1_yinter$yinter, useNA = "ifany")
BeforeH <- c(X[1],sum(X[2:3]))
AfterH <- table(t1066_ds_RP_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- names(AfterH)
kable(C)
```





```{r importOPAL_RP1, echo=F}
val_labels(t1066_ds_RP_w1) <- NULL
#opal.assign.data(o, 't1066_ds_RP_w1', t1066_ds_RP_w1)
#opal.symbol_import(o,'t1066_ds_RP_w1', project='_Athlos_Harm_Dataset')

t1066_m_ds_RP_w1 <- t1066_ds_RP_w1
t1066_m_ds_RP_w1$yintw <- car::recode(t1066_m_ds_RP_w1$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_RP_w1', t1066_m_ds_RP_w1)
#opal.symbol_import(o,'t1066_m_ds_RP_w1', project='_Athlos_Harm_Dataset')
```








### Wave 2 

```{r assign_RP2, echo=F}
opal.assign.table.tibble(o, 't1066_RP_w2_id','10-66.1066-RuralPeru-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_RP2, echo=F}
t1066_RP_w2_id <- opal.execute(o,'t1066_RP_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2009. 

**R script:**

```{r harmo_RP2}
t1066_ds_RP_w2 <- tibble(id=t1066_RP_w2_id$id)
t1066_ds_RP_w2$yintw <- 2009
t1066_ds_RP_w2$yintw <- labelled(t1066_ds_RP_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_RP2, echo=F}
Categorical_summary(var = t1066_ds_RP_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RP_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_RP2, echo=F}
```





```{r importOPAL_RP2, echo=F}
val_labels(t1066_ds_RP_w2) <- NULL
#opal.assign.data(o, 't1066_ds_RP_w2', t1066_ds_RP_w2)
#opal.symbol_import(o,'t1066_ds_RP_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_RP_w2 <- t1066_ds_RP_w2
t1066_m_ds_RP_w2$yintw <- car::recode(t1066_m_ds_RP_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_RP_w2', t1066_m_ds_RP_w2)
#opal.symbol_import(o,'t1066_m_ds_RP_w2', project='_Athlos_Harm_Dataset')
```








## Urban Mexico

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_UM1, echo=F}
opal.assign.table.tibble(o, 't1066_UM_w1_yinter','10-66.1066-UrbanMexico-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_UM1, echo=F}
t1066_UM_w1_yinter <- opal.execute(o,'t1066_UM_w1_yinter')
t1066_UM_w1_yinter$yinter <- as.numeric(format(t1066_UM_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_UM_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_UM_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`


**R script:**

```{r harmo_UM1}
t1066_ds_UM_w1 <- tibble(id=t1066_UM_w1_yinter$id)
t1066_ds_UM_w1$yintw <- car::recode(t1066_UM_w1_yinter$yinter, "NA=2004")
t1066_ds_UM_w1$yintw <- labelled(t1066_ds_UM_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_UM1, echo=F}
Categorical_summary(var = t1066_ds_UM_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UM_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_UM1, echo=F}
BeforeH <- table(t1066_UM_w1_yinter$yinter, useNA = "ifany")
AfterH <- table(t1066_ds_UM_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- names(AfterH)
kable(C)
```





```{r importOPAL_UM1, echo=F}
#val_labels(t1066_ds_UM_w1) <- NULL
##opal.assign.data(o, 't1066_ds_UM_w1', t1066_ds_UM_w1)
##opal.symbol_import(o,'t1066_ds_UM_w1', project='_Athlos_Harm_Dataset')
```








### Wave 2

```{r assign_UM2, echo=F}
opal.assign.table.tibble(o, 't1066_UM_w2_id','10-66.1066-UrbanMexico-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_UM2, echo=F}
t1066_UM_w2_id <- opal.execute(o,'t1066_UM_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2009. 

**R script:**

```{r harmo_UM2}
t1066_ds_UM_w2 <- tibble(id=t1066_UM_w2_id$id)
t1066_ds_UM_w2$yintw <- 2009
t1066_ds_UM_w2$yintw <- labelled(t1066_ds_UM_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_UM2, echo=F}
Categorical_summary(var = t1066_ds_UM_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UM_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_UM2, echo=F}
```





```{r importOPAL_UM2, echo=F}
val_labels(t1066_ds_UM_w2) <- NULL
#opal.assign.data(o, 't1066_ds_UM_w2', t1066_ds_UM_w2)
#opal.symbol_import(o,'t1066_ds_UM_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_UM_w2 <- t1066_ds_UM_w2
t1066_m_ds_UM_w2$yintw <- car::recode(t1066_m_ds_UM_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_UM_w2', t1066_m_ds_UM_w2)
#opal.symbol_import(o,'t1066_m_ds_UM_w2', project='_Athlos_Harm_Dataset')
```




## Rural Mexico

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`

```{r assign_RM1, echo=F}
opal.assign.table.tibble(o, 't1066_RM_w1_yinter','10-66.1066-RuralMexico-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_RM1, echo=F}
t1066_RM_w1_yinter <- opal.execute(o,'t1066_RM_w1_yinter')
t1066_RM_w1_yinter$yinter <- as.numeric(format(t1066_RM_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_RM_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_RM_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_RM1}
t1066_ds_RM_w1 <- tibble(id=t1066_RM_w1_yinter$id)
t1066_ds_RM_w1$yintw <- car::recode(t1066_RM_w1_yinter$yinter, "NA=2004")
t1066_ds_RM_w1$yintw <- labelled(t1066_ds_RM_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_RM1, echo=F}
Categorical_summary(var = t1066_ds_RM_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RM_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```


#### Validation
```{r crosstabulation_RM1, echo=F}
BeforeH <- table(t1066_RM_w1_yinter$yinter, useNA = "ifany")
AfterH <- table(t1066_ds_RM_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- names(AfterH)
kable(C)
```





```{r importOPAL_RM1, echo=F}
#val_labels(t1066_ds_RM_w1) <- NULL
##opal.assign.data(o, 't1066_ds_RM_w1', t1066_ds_RM_w1)
##opal.symbol_import(o,'t1066_ds_RM_w1', project='_Athlos_Harm_Dataset')
```







### Wave 2 


```{r assign_RM2, echo=F}
opal.assign.table.tibble(o, 't1066_RM_w2_id','10-66.1066-RuralMexico-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_RM2, echo=F}
t1066_RM_w2_id <- opal.execute(o,'t1066_RM_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2009. 

**R script:**

```{r harmo_RM2}
t1066_ds_RM_w2 <- tibble(id=t1066_RM_w2_id$id)
t1066_ds_RM_w2$yintw <- 2009
t1066_ds_RM_w2$yintw <- labelled(t1066_ds_RM_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_RM2, echo=F}
Categorical_summary(var = t1066_ds_RM_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RM_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_RM2, echo=F}
```





```{r importOPAL_RM2, echo=F}
val_labels(t1066_ds_RM_w2) <- NULL
#opal.assign.data(o, 't1066_ds_RM_w2', t1066_ds_RM_w2)
#opal.symbol_import(o,'t1066_ds_RM_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_RM_w2 <- t1066_ds_RM_w2
t1066_m_ds_RM_w2$yintw <- car::recode(t1066_m_ds_RM_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_RM_w2', t1066_m_ds_RM_w2)
#opal.symbol_import(o,'t1066_m_ds_RM_w2', project='_Athlos_Harm_Dataset')
```






## Puerto Rico

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `DATE`
* Label: `date of baseline interview`


```{r assign_PR1, echo=F}
opal.assign.table.tibble(o, 't1066_PR_w1_yinter','10-66.1066-PuertoRico-Baseline',
                         variables=list('DATE'), missings = TRUE)
```

```{r local_PR1, echo=F}
t1066_PR_w1_yinter <- opal.execute(o,'t1066_PR_w1_yinter')
t1066_PR_w1_yinter$yinter <- as.numeric(format(t1066_PR_w1_yinter$DATE, '%Y'))
Categorical_summary(var = t1066_PR_w1_yinter$yinter, missing_values = NA)
ggplot(t1066_PR_w1_yinter, aes(x=factor(yinter))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same of the study-specific variable but the missing values have to be recoded as follows:

* `NA into 999`

**R script:**

```{r harmo_PR1}
t1066_ds_PR_w1 <- tibble(id=t1066_PR_w1_yinter$id)
t1066_ds_PR_w1$yintw <- car::recode(t1066_PR_w1_yinter$yinter, "NA=2004")
t1066_ds_PR_w1$yintw <- labelled(t1066_ds_PR_w1$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_PR1, echo=F}
Categorical_summary(var = t1066_ds_PR_w1$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_PR_w1, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_PR1, echo=F}
BeforeH <- table(t1066_PR_w1_yinter$yinter, useNA = "ifany")
AfterH <- table(t1066_ds_PR_w1$yintw)
C <- rbind(BeforeH,AfterH)
colnames(C) <- names(AfterH)
kable(C)
```





```{r importOPAL_PR1, echo=F}
#val_labels(t1066_ds_PR_w1) <- NULL
##opal.assign.data(o, 't1066_ds_PR_w1', t1066_ds_PR_w1)
##opal.symbol_import(o,'t1066_ds_PR_w1', project='_Athlos_Harm_Dataset')
```






### Wave 2 

```{r assign_PR2, echo=F}
opal.assign.table.tibble(o, 't1066_PR_w2_id','10-66.1066-PuertoRico-Followup',
                         variables=list('centreid'), missings = TRUE)
```

```{r local_PR2, echo=F}
t1066_PR_w2_id <- opal.execute(o,'t1066_PR_w2_id')
```

#### Harmonisation algorithm
As we won't have the year of interview, it is going to be computed as 2013. 

**R script:**

```{r harmo_PR2}
t1066_ds_PR_w2 <- tibble(id=t1066_PR_w2_id$id)
t1066_ds_PR_w2$yintw <- 2013
t1066_ds_PR_w2$yintw <- labelled(t1066_ds_PR_w2$yintw, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript_PR2, echo=F}
Categorical_summary(var = t1066_ds_PR_w2$yintw, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_PR_w2, aes(x=factor(yintw))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Year of interview") + ylab("Frequency")
```

#### Validation
```{r crosstabulation_PR2, echo=F}
```




```{r importOPAL_PR2, echo=F}
val_labels(t1066_ds_PR_w2) <- NULL
#opal.assign.data(o, 't1066_ds_PR_w2', t1066_ds_PR_w2)
#opal.symbol_import(o,'t1066_ds_PR_w2', project='_Athlos_Harm_Dataset')

t1066_m_ds_PR_w2 <- t1066_ds_PR_w2
t1066_m_ds_PR_w2$yintw <- car::recode(t1066_m_ds_PR_w2$yintw, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 't1066_m_ds_PR_w2', t1066_m_ds_PR_w2)
#opal.symbol_import(o,'t1066_m_ds_PR_w2', project='_Athlos_Harm_Dataset')
```


```{r save, echo=FALSE}
#1
yintw <- t1066_ds_cuba_w1
save(yintw, file = "../RData/cuba_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_cuba_w2
save(yintw, file = "../RData/cuba_w2/yintw.RData")
rm(yintw)

#2
yintw <- t1066_ds_india_w1
save(yintw, file = "../RData/india_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_india_w2
save(yintw, file = "../RData/india_w2/yintw.RData")
rm(yintw)

#3
yintw <- t1066_ds_UCh_w1
save(yintw, file = "../RData/UCh_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_UCh_w2
save(yintw, file = "../RData/UCh_w2/yintw.RData")
rm(yintw)

#4
yintw <- t1066_ds_RCh_w1
save(yintw, file = "../RData/RCh_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_RCh_w2
save(yintw, file = "../RData/RCh_w2/yintw.RData")
rm(yintw)

#5
yintw <- t1066_ds_DR_w1
save(yintw, file = "../RData/DR_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_DR_w2
save(yintw, file = "../RData/DR_w2/yintw.RData")
rm(yintw)

#6

yintw <- t1066_ds_Ven_w1
save(yintw, file = "../RData/Ven_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_Ven_w2
save(yintw, file = "../RData/Ven_w2/yintw.RData")
rm(yintw)

#7

yintw <- t1066_ds_UP_w1
save(yintw, file = "../RData/UP_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_UP_w2
save(yintw, file = "../RData/UP_w2/yintw.RData")
rm(yintw)

#8
yintw <- t1066_ds_RP_w1
save(yintw, file = "../RData/RP_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_RP_w2
save(yintw, file = "../RData/RP_w2/yintw.RData")
rm(yintw)
#9

yintw <- t1066_ds_UM_w1
save(yintw, file = "../RData/UM_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_UM_w2
save(yintw, file = "../RData/UM_w2/yintw.RData")
rm(yintw)


#10
yintw <- t1066_ds_RM_w1
save(yintw, file = "../RData/RM_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_RM_w2
save(yintw, file = "../RData/RM_w2/yintw.RData")
rm(yintw)
#11

yintw <- t1066_ds_PR_w1
save(yintw, file = "../RData/PR_w1/yintw.RData")
rm(yintw)

yintw <- t1066_ds_PR_w2
save(yintw, file = "../RData/PR_w2/yintw.RData")
rm(yintw)

```


#### Quality estimation
The authors of the study do not reveal the exact date of the interview of wave 2 for anonymization reasons. For harmonization purposes we assume is that of the wave (based on study time lapse information).

At wave 1, the missing values have been recoded as the most frequent year between the no missing values. 




```{r closeRsession, echo=FALSE}
opal.logout(o)
```

