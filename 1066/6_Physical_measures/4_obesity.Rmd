---
title: "Obesity"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---
  
<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_albert.r")
```
<!-- ########################################################## --> 


# Description of DataSchema variable

The description of harmonised variable is the following:

* Name: `obesity`
* Label: `Precense of obesity based in Body Mass Index classification according to the WHO BMI classification (http://apps.who.int/bmi/index.jsp?introPage=intro_3.html): BMI value equal to or above 30Kg/m^2.`
* Type of variable: `categorical`
* Categories: 
    + `0 = not obese`
    + `1 = obese`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing` 
* Comments: `the BMI variable should be created by dividing weight and hiegh variables by means of the following equation= weight (kg)/height(m)^2. Then, the Obesity variable should be generated according to the WHO cutoff point for BMI classification.`


```{r lab, echo=FALSE}
ds_label <- "Precense of obesity based in Body Mass Index classification according to the WHO BMI classification (http://apps.who.int/bmi/index.jsp?introPage=intro_3.html): BMI value equal to or above 30Kg/m^2"
```

### Data process

#### Cuba

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_cuba2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_cuba_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_cuba2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=t1066_bmi[[2]])) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency") + xlim(10,70)
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_cuba2}
t1066_ds_cuba_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_cuba_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_cuba_w2$obesity <- labelled(t1066_ds_cuba_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_cuba2}
Categorical_summary(var = t1066_ds_cuba_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_cuba_w2, aes(x=factor(t1066_ds_cuba_w2[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_cuba2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_cuba_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1", "999") 
kable(C)
```


```{r read_cuba2, include=FALSE}
rm(t1066_bmi)
```


#### India

##### Wave 1

There is no varibale. 


##### Wave 2

There is no varibale. 


#### Urban China

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_UCh2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_UCh_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_UCh2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(t1066_bmi[[2]])) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_UCh2}
t1066_ds_UCh_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_UCh_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_UCh_w2$obesity <- labelled(t1066_ds_UCh_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_UCh2}
Categorical_summary(var = t1066_ds_UCh_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UCh_w2, aes(x=factor(t1066_ds_UCh_w2[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_UCh2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_UCh_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","999") 
kable(C)
```


```{r read_UCh2, include=FALSE}
rm(t1066_bmi)
```




#### Rural China

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_RCh2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_RCh_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_RCh2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_RCh2}
t1066_ds_RCh_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_RCh_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_RCh_w2$obesity <- labelled(t1066_ds_RCh_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_RCh2}
Categorical_summary(var = t1066_ds_RCh_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RCh_w2, aes(x=factor(t1066_ds_RCh_w2[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_RCh2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_RCh_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1", "999") 
kable(C)
```


```{r read_RCh2, include=FALSE}
rm(t1066_bmi)
```



#### Dominican Republic

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_DR2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_DR_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_DR2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency") 
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_DR2}
t1066_ds_DR_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_DR_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_DR_w2$obesity <- labelled(t1066_ds_DR_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_DR2}
Categorical_summary(var = t1066_ds_DR_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_DR_w2, aes(x=factor(t1066_ds_DR_w2[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_DR2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_DR_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","999") 
kable(C)
```


```{r read_DR2, include=FALSE}
rm(t1066_bmi)
```


#### Venezuela

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_V2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_Ven_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_V2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `NA into 999`

```{r harmo_V2}
t1066_ds_Ven_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_Ven_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_Ven_w2$obesity <- labelled(t1066_ds_Ven_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_V2}
Categorical_summary(var = t1066_ds_Ven_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_Ven_w2, aes(x=factor(obesity))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_V2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_Ven_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","999") 
kable(C)
```



```{r read_V2, include=FALSE}
rm(t1066_bmi)
```


#### Urban Peru

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_UP2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_UP_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_UP2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_UP2}
t1066_ds_UP_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_UP_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_UP_w2$obesity <- labelled(t1066_ds_UP_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_UP2}
Categorical_summary(var = t1066_ds_UP_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UP_w2, aes(x=factor(obesity))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_UP2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_UP_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","999") 
kable(C)
```



```{r read_UP2, include=FALSE}
rm(t1066_bmi)
```


#### Rural Peru

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_RP2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_RP_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_RP2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_RP2}
t1066_ds_RP_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_RP_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_RP_w2$obesity <- labelled(t1066_ds_RP_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_RP2}
Categorical_summary(var = t1066_ds_RP_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RP_w2, aes(x=factor(obesity))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_RP2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_RP_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","999") 
kable(C)
```



```{r read_RP2, include=FALSE}
rm(t1066_bmi)
```

#### Urban Mexico

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_UM2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_UM_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_UM2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_UM2}
t1066_ds_UM_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_UM_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_UM_w2$obesity <- labelled(t1066_ds_UM_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_UM2}
Categorical_summary(var = t1066_ds_UM_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UM_w2, aes(x=factor(obesity))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_UM2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(sum(na.omit(t1066_bmi[[2]])==999), sum(is.na(t1066_bmi[[2]]))))
AfterH <- table(t1066_ds_UM_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","NA->999") 
kable(C)
```



```{r read_UM2, include=FALSE}
rm(t1066_bmi)
```


#### Rural Mexico

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_RM2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_RM_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_RM2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_RM2}
t1066_ds_RM_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_RM_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_RM_w2$obesity <- labelled(t1066_ds_RM_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_RM2}
Categorical_summary(var = t1066_ds_RM_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RM_w2, aes(x=factor(obesity))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_RM2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_RM_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","999") 
kable(C)
```



```{r read_RM2, include=FALSE}
rm(t1066_bmi)
```


#### Puerto Rico

##### Wave 1

There is no varibale. 


##### Wave 2

###### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `bmi`
* Label: `Body Mass Index calculated as weight (kg)/height(m)^2`
* Type of variable: `countinous`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done`
    + `995 = Does not answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`
    
```{r assign_PR2, include=FALSE}
opal.assign.table.tibble(o, 't1066_bmi','_Athlos_Harm_Dataset.t1066_ds_PR_w2',
                         variables=list('bmi'), missings = TRUE)
t1066_bmi <- opal.execute(o,'t1066_bmi')
t1066_bmi$bmi <- as.numeric(t1066_bmi$bmi)
```

```{r local_PR2}
Continuous_summary(t1066_bmi[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_bmi, aes(x=factor(t1066_bmi[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("BMI") + ylab("Frequency")
```

###### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `BMI<30 into 0` 
* `BMI>=30 into 1`
* `NA into 999`

```{r harmo_PR2}
t1066_ds_PR_w2 <- tibble(id=t1066_bmi$id)
t1066_ds_PR_w2$obesity <- car::recode(t1066_bmi[[2]], "lo:29.9999999=0; 30:900=1; NA=999")
t1066_ds_PR_w2$obesity <- labelled(t1066_ds_PR_w2[[2]], labels = c("not obese"=0, "obese"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=994, "Does not answer"=995,  "Not applicable"=996, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

###### Statistical description of the new harmonised variable
```{r descript_PR2}
Categorical_summary(var = t1066_ds_PR_w2[[2]], missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_PR_w2, aes(x=factor(obesity))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Obesity") + ylab("Frequency")
```

###### Validation
```{r crosstab_PR2}
BeforeH <- c(sum(na.omit(t1066_bmi[[2]])<30),sum(na.omit(t1066_bmi[[2]])>=30 & na.omit(t1066_bmi[[2]])<=900), sum(na.omit(t1066_bmi[[2]])==999))
AfterH <- table(t1066_ds_PR_w2[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<30->0",">=30->1","999") 
kable(C)
```



```{r read_PR2, include=FALSE}
rm(t1066_bmi)
```


### Descriptive statistics of the harmonised variable accross populations and waves

Percentages of categories in each harmonised variable by cohort and wave:

```{r summ}

# Table HRS
l.hds <- list(t1066_ds_cuba_w2 = t1066_ds_cuba_w2 , t1066_ds_UCh_w2 = t1066_ds_UCh_w2, t1066_ds_RCh_w2 = t1066_ds_RCh_w2, t1066_ds_DR_w2=t1066_ds_DR_w2, t1066_ds_Ven_w2=t1066_ds_Ven_w2, t1066_ds_UP_w2=t1066_ds_UP_w2, t1066_ds_RP_w2=t1066_ds_RP_w2, t1066_ds_UM_w2=t1066_ds_UM_w2, t1066_ds_RM_w2=t1066_ds_RM_w2, t1066_ds_PR_w2=t1066_ds_PR_w2)

t.hds <- frq(l.hds[[2]][2])[[1]][,c(1,2)] 
for (i in 1:length(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]][2])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", 
             length(l.hds[[1]][[2]]), length(l.hds[[2]][[2]]) , length(l.hds[[3]][[2]]), length(l.hds[[4]][[2]]), length(l.hds[[5]][[2]]), length(l.hds[[6]][[2]]), length(l.hds[[7]][[2]]), length(l.hds[[8]][[2]]), length(l.hds[[9]][[2]]), length(l.hds[[10]][[2]]) )
names(t.hds)<-c("val", "label", "Cuba_w2", "UrbanChina_W2", "RuralChina_W2", "DominicanRepublic_W2", "Venezuela_W2", "UrbanPeru_W2", "RuralPeru_W2", "UrbanMexico_W2", "RuralMexico_W2", "PuertoRico_W2")
kable(t.hds)
```



# Quality estimation
Once BMI has been calculated using weight (Kg) and Height (m^2),
Obesity was calculated by using the BMI cutoff>=30kg/m2 following the WHO 
classification. Finally, the resulting BMI variable was coded as follows: 
BMI>30kg/m2 =1 (obese); BMI<30kg/m2 =0 (not obese) to generate two categories.


```{r save, echo=FALSE}
obesity <- t1066_ds_cuba_w2
save(obesity, file = "../RData/cuba_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_UCh_w2
save(obesity, file = "../RData/UCh_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_RCh_w2
save(obesity, file = "../RData/RCh_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_DR_w2
save(obesity, file = "../RData/DR_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_Ven_w2
save(obesity, file = "../RData/Ven_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_UP_w2
save(obesity, file = "../RData/UP_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_RP_w2
save(obesity, file = "../RData/RP_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_UM_w2
save(obesity, file = "../RData/UM_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_RM_w2
save(obesity, file = "../RData/RM_w2/obesity.RData")
rm(obesity)

obesity <- t1066_ds_PR_w2
save(obesity, file = "../RData/PR_w2/obesity.RData")
rm(obesity)

```






<!--- #### Close OPAL R Session -->
```{r closeRsession, echo=FALSE}
#opal.logout(o)
```
