---
title: "Current smoker"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 
<!-- # Installation, loading packages -->
```{r setup, include=FALSE}
source("../../setup.r")
```
<!-- ########################################################## --> 
<!-- # Loading DS description -->
```{r main, child='../../_DS_Rmd/current_smokingDS.Rmd'}
```
```{r global, echo=F}
source('../../_DS_Rmd/current_smokingDS.R')
```




# Data process


## Cuba

### Wave 1 

#### Study-specific variable description

| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-Cuba-Baseline` | `1066-Cuba-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |

   

```{r assign cuba w1, echo=F}
opal.assign.table.tibble(o, 't1066_cuba_w1','10-66.1066-Cuba-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_cuba_w1 <- opal.execute(o,'t1066_cuba_w1')
```

```{r local cuba w1, echo=F}
vbl <- t1066_cuba_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_cuba_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_cuba_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_cuba_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_cuba_w1$PSMOKE,t1066_cuba_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")

```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`

```{r harmo cuba w1}
t1066_ds_cuba_w1 <- tibble(id=t1066_cuba_w1$id)
t1066_ds_cuba_w1$current_smoking<-Recode(t1066_cuba_w1$PSMKNOW, "1 = '1';0='0'; NA='999'")
t1066_ds_cuba_w1$current_smoking[which(t1066_cuba_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript cuba w1, echo=F}
vbl <- t1066_ds_cuba_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_cuba_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation cuba w1, echo=F}
```


### Wave 2 

#### Study-specific variable description


| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-Cuba-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|
| **Description** |  |

```{r assign cuba w2, echo=F}
opal.assign.table.tibble(o, 't1066_cuba_w2','10-66.1066-Cuba-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_cuba_w2 <- opal.execute(o,'t1066_cuba_w2')
```

```{r local cuba w2, echo=F}
vbl <- t1066_cuba_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_cuba_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_cuba_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo cuba w2}
t1066_ds_cuba_w2 <- tibble(id=t1066_cuba_w2$id)
t1066_ds_cuba_w2$current_smoking <-  Recode(t1066_cuba_w2$f_PSMOKE1, "0 = '0';1 ='1'; NA='999'")
t1066_ds_cuba_w2$current_smoking <- labelled(t1066_ds_cuba_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript cuba w2, echo=F}
vbl <- t1066_ds_cuba_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_cuba_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation cuba w2, echo=F}
AfterH <- table(t1066_ds_cuba_w2$current_smoking)
X<-table(t1066_cuba_w2$f_PSMOKE1)
nas<-length(t1066_cuba_w2$f_PSMOKE1)-length(na.omit(t1066_cuba_w2$f_PSMOKE1))
BeforeH <- c(X,nas)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1", "NA->999") 
kable(C)
```

## India

### Wave 1 

#### Study-specific variable description


| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-India-Baseline` | `1066-India-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |

   


```{r assign India w1, echo=F}
opal.assign.table.tibble(o, 't1066_india_w1','10-66.1066-India-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_india_w1 <- opal.execute(o,'t1066_india_w1')
```

```{r local India w1, echo=F}
vbl <- t1066_india_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_india_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_india_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_india_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_india_w1$PSMOKE,t1066_india_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo India w1}
t1066_ds_india_w1 <- tibble(id=t1066_india_w1$id)
t1066_ds_india_w1$current_smoking <- Recode(t1066_india_w1$PSMKNOW, "1 = '1';0='0';NA=999")
t1066_ds_india_w1$current_smoking[which(t1066_india_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript India w1, echo=F}
vbl <- t1066_ds_india_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_india_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation India w1, echo=F}
```



## UrbanChina

### Wave 1 

#### Study-specific variable description


| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-UrbanChina-Baseline` | `1066-UrbanChina-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |


```{r assign UrbanChina w1, echo=F}
opal.assign.table.tibble(o, 't1066_UCh_w1','10-66.1066-UrbanChina-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_UCh_w1 <- opal.execute(o,'t1066_UCh_w1')
```

```{r local UrbanChina w1, echo=F}
vbl <- t1066_UCh_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UCh_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_UCh_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UCh_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_UCh_w1$PSMOKE,t1066_UCh_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo UrbanChina w1}
t1066_ds_UCh_w1 <- tibble(id=t1066_UCh_w1$id)
t1066_ds_UCh_w1$current_smoking <- Recode(t1066_UCh_w1$PSMKNOW, "0 = '0';1 ='1';NA = '999'")
t1066_ds_UCh_w1$current_smoking[which(t1066_UCh_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript UrbanChina w1, echo=F}
vbl <- t1066_ds_UCh_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = names(t1066_ds_UCh_w1)[2])
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_UCh_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanChina w1, echo=F}
```


### Wave 2 

#### Study-specific variable description


| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-UrbanChina-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** | |
| **Description** |  |

  
```{r assign UrbanChina w2, echo=F}
opal.assign.table.tibble(o, 't1066_UCh_w2','10-66.1066-UrbanChina-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_UCh_w2 <- opal.execute(o,'t1066_UCh_w2')
```

```{r local UrbanChina w2, echo=F}
vbl <- t1066_UCh_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_UCh_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UCh_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`

```{r harmo UrbanChina w2}
t1066_ds_UCh_w2 <- tibble(id=t1066_UCh_w2$id)
t1066_ds_UCh_w2$current_smoking <-  Recode(t1066_UCh_w2$f_PSMOKE1, "0 = '0';1 ='1'")
t1066_ds_UCh_w2$current_smoking <- labelled(t1066_ds_UCh_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanChina w2, echo=F}
vbl <- t1066_ds_UCh_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_UCh_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanChina w2, echo=F}
AfterH <- table(t1066_ds_UCh_w2$current_smoking)
X<-table(t1066_UCh_w2$f_PSMOKE1)
#nas<-length(t1066_UCh_w2$f_PSMOKE1)-length(na.omit(t1066_UCh_w2$f_PSMOKE1))
BeforeH <- c(X)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1") 
kable(C)
```


## RuralChina

### Wave 1 

#### Study-specific variable description

| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-RuralChina-Baseline` | `1066-RuralChina-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |


```{r assign RuralChina w1, echo=F}
opal.assign.table.tibble(o, 't1066_RCh_w1','10-66.1066-RuralChina-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_RCh_w1 <- opal.execute(o,'t1066_RCh_w1')
```

```{r local RuralChina w1, echo=F}
vbl <- t1066_RCh_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RCh_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_RCh_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RCh_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_RCh_w1$PSMOKE,t1066_RCh_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo RuralChina w1}
t1066_ds_RCh_w1 <- tibble(id=t1066_RCh_w1$id)
t1066_ds_RCh_w1$current_smoking <- Recode(t1066_RCh_w1$PSMKNOW, "0 = '0';1='1';NA='999'")
t1066_ds_RCh_w1$current_smoking[which(t1066_RCh_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript RuralChina w1, echo=F}
vbl <- t1066_ds_RCh_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_RCh_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralChina w1, echo=F}
```



### Wave 2 

#### Study-specific variable description

| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-RuralChina-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|
| **Description** |  |

```{r assign RuralChina w2, echo=F}
opal.assign.table.tibble(o, 't1066_RCh_w2','10-66.1066-RuralChina-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_RCh_w2 <- opal.execute(o,'t1066_RCh_w2')
```

```{r local RuralChina w2, echo=F}
Categorical_summary(t1066_RCh_w2$f_PSMOKE1)
ggplot(t1066_RCh_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo RuralChina w2}
t1066_ds_RCh_w2 <- tibble(id=t1066_RCh_w2$id)
t1066_ds_RCh_w2$current_smoking <-  Recode(t1066_RCh_w2$f_PSMOKE1, "0 = '0';1='1'; NA='999'")
t1066_ds_RCh_w2$current_smoking <- labelled(t1066_ds_RCh_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralChina w2, echo=F}
vbl <- t1066_ds_RCh_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_RCh_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralChina w2, echo=F}
AfterH <- table(t1066_ds_RCh_w2$current_smoking)
X<-table(t1066_RCh_w2$f_PSMOKE1)
nas<-length(t1066_RCh_w2$f_PSMOKE1)-length(na.omit(t1066_RCh_w2$f_PSMOKE1))
BeforeH <- c(X,nas)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999") 
kable(C)
```




## Dominican Republic

### Wave 1 

#### Study-specific variable description


| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-DominicanRepublic-Baseline` | `1066-DominicanRepublic-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |


```{r assign DominicanRepublic w1, echo=F}
opal.assign.table.tibble(o, 't1066_DR_w1','10-66.1066-DominicanRepublic-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_DR_w1 <- opal.execute(o,'t1066_DR_w1')
```

```{r local DominicanRepublic w1, echo=F}
vbl <- t1066_DR_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_DR_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_DR_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_DR_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_DR_w1$PSMOKE,t1066_DR_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo DominicanRepublic w1}
t1066_ds_DR_w1 <- tibble(id=t1066_DR_w1$id)
t1066_ds_DR_w1$current_smoking <- Recode(t1066_DR_w1$PSMKNOW, "0 = '0';1 ='1';NA='999'")
t1066_ds_DR_w1$current_smoking[which(t1066_DR_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript DominicanRepublic w1, echo=F}
vbl <- t1066_ds_DR_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_DR_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation DominicanRepublic w1, echo=F}
```



### Wave 2 

#### Study-specific variable description


| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-DominicanRepublic-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|
| **Description** |  |

```{r assign DominicanRepublic w2, echo=F}
opal.assign.table.tibble(o, 't1066_DR_w2','10-66.1066-DominicanRepublic-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_DR_w2 <- opal.execute(o,'t1066_DR_w2')
```

```{r local DominicanRepublic w2, echo=F}
vbl <- t1066_DR_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_DR_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_DR_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo DominicanRepublic w2}
t1066_ds_DR_w2 <- tibble(id=t1066_DR_w2$id)
t1066_ds_DR_w2$current_smoking <-  Recode(t1066_DR_w2$f_PSMOKE1, "0 = '0';1 ='1'; NA='999'")
t1066_ds_DR_w2$current_smoking <- labelled(t1066_ds_DR_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript DominicanRepublic w2, echo=F}
vbl <- t1066_ds_DR_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_DR_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation DominicanRepublic w2, echo=F}
AfterH <- table(t1066_ds_DR_w2$current_smoking)
X<-table(t1066_DR_w2$f_PSMOKE1)
nas<-length(t1066_DR_w2$f_PSMOKE1)-length(na.omit(t1066_DR_w2$f_PSMOKE1))
BeforeH <- c(X,nas)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999") 
kable(C)
```



## Venezuela

### Wave 1 

#### Study-specific variable description

| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-Venezuela-Baseline` | `1066-Venezuela-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |



```{r assign Venezuela w1, echo=F}
opal.assign.table.tibble(o, 't1066_Ven_w1','10-66.1066-Venezuela-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_Ven_w1 <- opal.execute(o,'t1066_Ven_w1')
```

```{r local Venezuela w1, echo=F}
vbl <- t1066_Ven_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_Ven_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_Ven_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_Ven_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_Ven_w1$PSMOKE,t1066_Ven_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo Venezuela w1}
t1066_ds_Ven_w1 <- tibble(id=t1066_Ven_w1$id)
t1066_ds_Ven_w1$current_smoking <- Recode(t1066_Ven_w1$PSMKNOW, "0 = '0';1='1';NA='999'")
t1066_ds_Ven_w1$current_smoking[which(t1066_Ven_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript Venezuela w1, echo=F}
vbl <- t1066_ds_Ven_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_Ven_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation Venezuela w1, echo=F}
```



### Wave 2 

#### Study-specific variable description

| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-Venezuela-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|
| **Description** |  |

```{r assign Venezuela w2, echo=F}
opal.assign.table.tibble(o, 't1066_Ven_w2','10-66.1066-Venezuela-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_Ven_w2 <- opal.execute(o,'t1066_Ven_w2')
```

```{r local Venezuela w2, echo=F}
vbl <- t1066_Ven_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_Ven_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_Ven_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo Venezuela w2}
t1066_ds_Ven_w2 <- tibble(id=t1066_Ven_w2$id)
t1066_ds_Ven_w2$current_smoking <-  Recode(t1066_Ven_w2$f_PSMOKE1, "0 = '0';1 ='1'; NA='999'")
t1066_ds_Ven_w2$current_smoking <- labelled(t1066_ds_Ven_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript Venezuela w2, echo=F}
vbl <- t1066_ds_Ven_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_Ven_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation Venezuela w2, echo=F}
AfterH <- table(t1066_ds_Ven_w2$current_smoking)
X<-table(t1066_Ven_w2$f_PSMOKE1)
nas<-length(t1066_Ven_w2$f_PSMOKE1)-length(na.omit(t1066_Ven_w2$f_PSMOKE1))
BeforeH <- c(X,nas)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999") 
kable(C)
```



## Urban Peru

### Wave 1 

#### Study-specific variable description


| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-UrbanPeru-Baseline` | `1066-UrbanPeru-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |


```{r assign UrbanPeru w1, echo=F}
opal.assign.table.tibble(o, 't1066_UP_w1','10-66.1066-UrbanPeru-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_UP_w1 <- opal.execute(o,'t1066_UP_w1')
```

```{r local UrbanPeru w1, echo=F}
vbl <- t1066_UP_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UP_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_UP_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UP_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_UP_w1$PSMOKE,t1066_UP_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo UrbanPeru w1}
t1066_ds_UP_w1 <- tibble(id=t1066_UP_w1$id)
t1066_ds_UP_w1$current_smoking <- Recode(t1066_UP_w1$PSMKNOW, "0 = '0';1='1';NA='999'")
t1066_ds_UP_w1$current_smoking[which(t1066_UP_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript UrbanPeru w1, echo=F}
vbl <- t1066_ds_UP_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = names(t1066_ds_UP_w1)[2])
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_UP_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanPeru w1, echo=F}
```


### Wave 2 

#### Study-specific variable description

| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-UrbanPeru-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** | |
| **Description** |  |

```{r assign UrbanPeru w2, echo=F}
opal.assign.table.tibble(o, 't1066_UP_w2','10-66.1066-UrbanPeru-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_UP_w2 <- opal.execute(o,'t1066_UP_w2')
```

```{r local UrbanPeru w2, echo=F}
vbl <- t1066_UP_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_UP_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UP_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo UrbanPeru w2}
t1066_ds_UP_w2 <- tibble(id=t1066_UP_w2$id)
t1066_ds_UP_w2$current_smoking <-  Recode(t1066_UP_w2$f_PSMOKE1, "0 = '0';1='1'; NA='999'")
t1066_ds_UP_w2$current_smoking <- labelled(t1066_ds_UP_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanPeru w2, echo=F}
vbl <- t1066_ds_UP_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_UP_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanPeru w2, echo=F}
AfterH <- table(t1066_ds_UP_w2$current_smoking)
X<-table(t1066_UP_w2$f_PSMOKE1)
#nas<-length(t1066_UP_w2$f_PSMOKE1)-length(na.omit(t1066_UP_w2$f_PSMOKE1))
BeforeH <- c(X)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1") 
kable(C)
```


## Rural Peru

### Wave 1 

#### Study-specific variable description

| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-RuralPeru-Baseline` | `1066-RuralPeru-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |


```{r assign RuralPeru w1, echo=F}
opal.assign.table.tibble(o, 't1066_RP_w1','10-66.1066-RuralPeru-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_RP_w1 <- opal.execute(o,'t1066_RP_w1')
```

```{r local RuralPeru w1, echo=F}
vbl <- t1066_RP_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RP_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_RP_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RP_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_RP_w1$PSMOKE,t1066_RP_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo RuralPeru w1}
t1066_ds_RP_w1 <- tibble(id=t1066_RP_w1$id)
t1066_ds_RP_w1$current_smoking <- Recode(t1066_RP_w1$PSMKNOW, "0 = '0';1 ='1'; NA = '999'")
t1066_ds_RP_w1$current_smoking[which(t1066_RP_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript RuralPeru w1, echo=F}
vbl <- t1066_ds_RP_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_RP_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralPeru w1, echo=F}
```



### Wave 2 

#### Study-specific variable description

| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-RuralPeru-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** | |
| **Description** |  |

```{r assign RuralPeru w2, echo=F}
opal.assign.table.tibble(o, 't1066_RP_w2','10-66.1066-RuralPeru-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_RP_w2 <- opal.execute(o,'t1066_RP_w2')
```

```{r local RuralPeru w2, echo=F}
vbl <- t1066_RP_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_RP_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RP_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`

```{r harmo RuralPeru w2}
t1066_ds_RP_w2 <- tibble(id=t1066_RP_w2$id)
t1066_ds_RP_w2$current_smoking <-  Recode(t1066_RP_w2$f_PSMOKE1, "0 = '0';1 ='1'")
t1066_ds_RP_w2$current_smoking <- labelled(t1066_ds_RP_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralPeru w2, echo=F}
vbl <- t1066_ds_RP_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_RP_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralPeru w2, echo=F}
AfterH <- table(t1066_ds_RP_w2$current_smoking)
X<-table(t1066_RP_w2$f_PSMOKE1)
#nas<-length(t1066_RP_w2$f_PSMOKE1)-length(na.omit(t1066_RP_w2$f_PSMOKE1))
BeforeH <- c(X)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1") 
kable(C)
```



## Urban Mexico

### Wave 1 

#### Study-specific variable description

| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-UrbanMexico-Baseline` | `1066-UrbanMexico-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |


```{r assign UM w1, echo=F}
opal.assign.table.tibble(o, 't1066_UM_w1','10-66.1066-UrbanMexico-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_UM_w1 <- opal.execute(o,'t1066_UM_w1')
```

```{r local UM w1, echo=F}
vbl <- t1066_UM_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UM_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_UM_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UM_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_UM_w1$PSMOKE,t1066_UM_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo UM w1}
t1066_ds_UM_w1 <- tibble(id=t1066_UM_w1$id)
t1066_ds_UM_w1$current_smoking <- Recode(t1066_UM_w1$PSMKNOW, "0 = '0';1='1';NA='999'")
t1066_ds_UM_w1$current_smoking[which(t1066_UM_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript UM w1, echo=F}
vbl <- t1066_ds_UM_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_UM_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation UM w1, echo=F}
```



### Wave 2 

#### Study-specific variable description

| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-UrbanMexico-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|
| **Description** |  |

```{r assign UM w2, echo=F}
opal.assign.table.tibble(o, 't1066_UM_w2','10-66.1066-UrbanMexico-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_UM_w2 <- opal.execute(o,'t1066_UM_w2')
```

```{r local UM w2, echo=F}
vbl <- t1066_UM_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_UM_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_UM_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo UM w2}
t1066_ds_UM_w2 <- tibble(id=t1066_UM_w2$id)
t1066_ds_UM_w2$current_smoking <-  Recode(t1066_UM_w2$f_PSMOKE1, "0 = '0';1='1'; NA='999'")
t1066_ds_UM_w2$current_smoking <- labelled(t1066_ds_UM_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UM w2, echo=F}
vbl <- t1066_ds_UM_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_UM_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation UM w2, echo=F}
AfterH <- table(t1066_ds_UM_w2$current_smoking)
X<-table(t1066_UM_w2$f_PSMOKE1)
nas<-length(t1066_UM_w2$f_PSMOKE1)-length(na.omit(t1066_UM_w2$f_PSMOKE1))
BeforeH <- c(X,nas)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999") 
kable(C)
```



## Rural Mexico

### Wave 1 

#### Study-specific variable description

| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-RuralMexico-Baseline` | `1066-RuralMexico-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |



```{r assign RM w1, echo=F}
opal.assign.table.tibble(o, 't1066_RM_w1','10-66.1066-RuralMexico-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_RM_w1 <- opal.execute(o,'t1066_RM_w1')
```

```{r local RM w1, echo=F}
vbl <- t1066_RM_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RM_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_RM_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RM_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_RM_w1$PSMOKE,t1066_RM_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo RM w1}
t1066_ds_RM_w1 <- tibble(id=t1066_RM_w1$id)
t1066_ds_RM_w1$current_smoking <- Recode(t1066_RM_w1$PSMKNOW, "0 = '0';1 ='1';NA='999'")
t1066_ds_RM_w1$current_smoking[which(t1066_RM_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript RM w1, echo=F}
vbl <- t1066_ds_RM_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_RM_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation RM w1, echo=F}
```



### Wave 2 

#### Study-specific variable description

| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-RuralMexico-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|
| **Description** |  |


```{r assign RM w2, echo=F}
opal.assign.table.tibble(o, 't1066_RM_w2','10-66.1066-RuralMexico-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_RM_w2 <- opal.execute(o,'t1066_RM_w2')
```

```{r local RM w2, echo=F}
vbl <- t1066_RM_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_RM_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_RM_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo RM w2}
t1066_ds_RM_w2 <- tibble(id=t1066_RM_w2$id)
t1066_ds_RM_w2$current_smoking <-  Recode(t1066_RM_w2$f_PSMOKE1, "0 = '0';1='1'; NA='999'")
t1066_ds_RM_w2$current_smoking <- labelled(t1066_ds_RM_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RM w2, echo=F}
vbl <- t1066_ds_RM_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_RM_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation RM w2, echo=F}
AfterH <- table(t1066_ds_RM_w2$current_smoking)
X<-table(t1066_RM_w2$f_PSMOKE1)
nas<-length(t1066_RM_w2$f_PSMOKE1)-length(na.omit(t1066_RM_w2$f_PSMOKE1))
BeforeH <- c(X,nas)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999") 
kable(C)
```



## Puerto Rico

### Wave 1 

#### Study-specific variable description

| **Name** | `PSMKNOW` |`PSMOKE`|
|-|-|-|
| **Label** | `still smoking regularly?` |`ever smoked?` |
| **Table name** | `1066-PuertoRico-Baseline` | `1066-PuertoRico-Baseline` |
| **Categories** | `0 = No` <br/> `1 = Yes`|`0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|`NA`|
| **Description** |  |  |


```{r assign PR w1, echo=F}
opal.assign.table.tibble(o, 't1066_PR_w1','10-66.1066-PuertoRico-Baseline', variables=list('PSMKNOW','PSMOKE'), missings = TRUE)
t1066_PR_w1 <- opal.execute(o,'t1066_PR_w1')
```

```{r local PR w1, echo=F}
vbl <- t1066_PR_w1$PSMKNOW
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_PR_w1, aes(x=factor(PSMKNOW))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

vbl <- t1066_PR_w1$PSMOKE
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = attributes(vbl)$`spss::shortName`)
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_PR_w1, aes(x=factor(PSMOKE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")

kable(table(t1066_PR_w1$PSMOKE,t1066_PR_w1$PSMKNOW,useNA = "ifany"), caption = "Crosstabulate of PSMOKE with PSMKNOW")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable `PSMKNOW` it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `PSMOKE==0 into 0`
* `NA into 999`


```{r harmo PR w1}
t1066_ds_PR_w1 <- tibble(id=t1066_PR_w1$id)
t1066_ds_PR_w1$current_smoking <- Recode(t1066_PR_w1$PSMKNOW, "0 = '0';1 ='1';NA = '999'")
t1066_ds_PR_w1$current_smoking[which(t1066_PR_w1$PSMOKE==0)] <- 0
```

#### Statistical description of the new harmonised variable
```{r descript PR w1, echo=F}
vbl <- t1066_ds_PR_w1$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_PR_w1, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation PR w1, echo=F}
```



### Wave 2 

#### Study-specific variable description


| **Name** | `f_PSMOKE1` |
|-|-|
| **Label** | `in the last week, did you smoke or use tobacco?` |
| **Table name** | `1066-PuertoRico-Followup` |
| **Categories** | `0 = No` <br/> `1 = Yes`|
| **Missings** |`NA`|
| **Description** |  |

```{r assign PR w2, echo=F}
opal.assign.table.tibble(o, 't1066_PR_w2','10-66.1066-PuertoRico-Followup', variables=list('f_PSMOKE1'), missings = TRUE)
t1066_PR_w2 <- opal.execute(o,'t1066_PR_w2')
```

```{r local PR w2, echo=F}
vbl <- t1066_PR_w2$f_PSMOKE1
kable(Categorical_summary(vbl, missing_values = NA)[2], caption = names(t1066_PR_w2)[2])
kable(Categorical_summary(vbl, missing_values = NA)[1], caption = "Category")
ggplot(t1066_PR_w2, aes(x=factor(f_PSMOKE1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(label(vbl)) + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `0 into 0` 
* `1 into 1`
* `NA into 999`

```{r harmo PR w2}
t1066_ds_PR_w2 <- tibble(id=t1066_PR_w2$id)
t1066_ds_PR_w2$current_smoking <-  Recode(t1066_PR_w2$f_PSMOKE1, "0 = '0';1 ='1'; NA='999'")
t1066_ds_PR_w2$current_smoking <- labelled(t1066_ds_PR_w2$current_smoking, labels = c(No=0, Yes=1,Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript PR w2, echo=F}
vbl <- t1066_ds_PR_w2$current_smoking
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[3], caption = ds_label)
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[1], caption = "Category")
kable(Categorical_summary(vbl, missing_values = miss_values_vector)[2], caption = "Type of missing")
ggplot(t1066_ds_PR_w2, aes(x=factor(current_smoking))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation PR w2, echo=F}
AfterH <- table(t1066_ds_PR_w2$current_smoking)
X<-table(t1066_PR_w2$f_PSMOKE1)
nas<-length(t1066_PR_w2$f_PSMOKE1)-length(na.omit(t1066_PR_w2$f_PSMOKE1))
BeforeH <- c(X,nas)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("0->0","1->1","NA->999") 
kable(C)
```






## Descriptive statistics of the harmonised variable accross populations and waves

Percentages of categories in each harmonised variable:






```{r summ, echo=F}

lb.hds <- list(cuba_w1 = t1066_ds_cuba_w1, india_w1 = t1066_ds_india_w1, UCh_w1 = t1066_ds_UCh_w1, RCh_w1 = t1066_ds_RCh_w1, DR_w1 = t1066_ds_DR_w1, Ven_w1 = t1066_ds_Ven_w1, UP_w1 = t1066_ds_UP_w1, RP_w1 = t1066_ds_RP_w1, UM_w1 = t1066_ds_UM_w1, RM_w1 = t1066_ds_RM_w1, PR_w1 = t1066_ds_PR_w1)

lf.hds <- list(cuba_w2 = t1066_ds_cuba_w2, UCh_w2 = t1066_ds_UCh_w2, RCh_w2 = t1066_ds_RCh_w2, DR_w2 = t1066_ds_DR_w2, Ven_w2 = t1066_ds_Ven_w2, UP_w2 = t1066_ds_UP_w2, RP_w2 = t1066_ds_RP_w2, UM_w2 = t1066_ds_UM_w2, RM_w2 = t1066_ds_RM_w2, PR_w2 = t1066_ds_PR_w2)

#l.hds <- list(cuba_w1 = t1066_ds_cuba_w1, cuba_w2 = t1066_ds_cuba_w2, india_w1 = t1066_ds_india_w1, india_w2 = t1066_ds_india_w2, UCh_w1 = t1066_ds_UCh_w1, UCh_w2 = t1066_ds_UCh_w2, RCh_w1 = t1066_ds_RCh_w1, RCh_w2 = t1066_ds_RCh_w2, DR_w1 = t1066_ds_DR_w1, DR_w2 = t1066_ds_DR_w2, Ven_w1 = t1066_ds_Ven_w1, Ven_w2 = t1066_ds_Ven_w2, UP_w1 = t1066_ds_UP_w1, UP_w2 = t1066_ds_UP_w2, RP_w1 = t1066_ds_RP_w1, RP_w2 = t1066_ds_RP_w2, UM_w1 = t1066_ds_UM_w1, UM_w2 = t1066_ds_UM_w2, RM_w1 = t1066_ds_RM_w1, RM_w2 = t1066_ds_RM_w2, PR_w1 = t1066_ds_PR_w1, PR_w2 = t1066_ds_PR_w2)

for(name in names(lb.hds)) {
  aux_object <- lb.hds[[name]]
  label(lb.hds[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label # Text value assigned at the DS description, at the top
  lb.hds[[name]][[2]] <- labelled(lb.hds[[name]][[2]], labels = cat_label)
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cat_label[1:2])
  m_name <- paste0("t1066_m_ds_",name)
  assign(m_name, aux_object)
  rm(aux_object)
}

for(name in names(lf.hds)) {
  aux_object <- lf.hds[[name]]
  label(lf.hds[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label # Text value assigned at the DS description, at the top
  lf.hds[[name]][[2]] <- labelled(lf.hds[[name]][[2]], labels = cat_label)
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cat_label[1:2])
  m_name <- paste0("t1066_m_ds_",name)
  assign(m_name, aux_object)
  rm(aux_object)
}

tb.hds <- frq(lb.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(lb.hds)){
  tb.hds[2+i] <- frq(lb.hds[[i]][2])[[1]][,4] 
}
tb.hds[13,] <- c("n", "sample size", 
             length(lb.hds[[1]][[2]]), length(lb.hds[[2]][[2]]) , length(lb.hds[[3]][[2]]), length(lb.hds[[4]][[2]]), length(lb.hds[[5]][[2]]), length(lb.hds[[6]][[2]]), length(lb.hds[[7]][[2]]), length(lb.hds[[8]][[2]]), length(lb.hds[[9]][[2]]), length(lb.hds[[10]][[2]]), length(lb.hds[[11]][[2]])
             )
names(tb.hds)<-c("val", "label", "cuba_w1", "india_w1", "UCh_w1", "RCh_w1","DR_w1","Ven_w1","UP_w1","RP_w1","UM_w1","RM_w1","PR_w1")
kable(tb.hds)

tf.hds <- frq(lf.hds[[1]][2])[[1]][,c(1,2)] 
for (i in seq_along(lf.hds)){
  tf.hds[2+i] <- frq(lf.hds[[i]][2])[[1]][,4] 
}
tf.hds[13,] <- c("n", "sample size", 
             length(lf.hds[[1]][[2]]), length(lf.hds[[2]][[2]]) , length(lf.hds[[3]][[2]]), length(lf.hds[[4]][[2]]), length(lf.hds[[5]][[2]]), length(lf.hds[[6]][[2]]), length(lf.hds[[7]][[2]]), length(lf.hds[[8]][[2]]), length(lf.hds[[9]][[2]]), length(lf.hds[[10]][[2]])
             )
names(tf.hds)<-c("val", "label", "cuba_w2", "UCh_w2", "RCh_w2","DR_w2","Ven_w2","UP_w2","RP_w2","UM_w2","RM_w2","PR_w2")
kable(tf.hds)



```


<!-- ########################################################## --> 
<!-- # Save -->
```{r save, include=FALSE, echo=F}

for(index in seq_along(lb.hds)){
  current_smoking <- lb.hds[[index]]
  save(current_smoking, file = paste0(datafolder,names(lb.hds)[index],"/current_smoking.RData"))
}

for(index in seq_along(lf.hds)){
  current_smoking <- lf.hds[[index]]
  save(current_smoking, file = paste0(datafolder,names(lf.hds)[index],"/current_smoking.RData"))
}


```
<!-- ########################################################## --> 







# Quality estimation

```{r closeRsession, echo=FALSE}
opal.logout(o)
```