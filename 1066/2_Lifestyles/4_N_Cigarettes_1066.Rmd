---
title: "Number of cigarettes"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 
<!-- # Installation, loading packages -->
```{r setup, include=FALSE}
source("../../setup_iago.r")
```
<!-- ########################################################## --> 
<!-- # Loading DS description -->
```{r main, child='../../_DS_Rmd/n_cigarettesDS.Rmd'}
```
```{r global, echo=F}
source('../../_DS_Rmd/n_cigarettesDS.R')
```




# Data process

## Cuba

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign cuba w1, echo=F}
opal.assign.table.tibble(o, 's1066_cuba_w1_n_cigarettes','10-66.1066-Cuba-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local cuba w1, echo=F}
s1066_cuba_w1_n_cigarettes <- opal.execute(o,'s1066_cuba_w1_n_cigarettes')
Continuous_summary(s1066_cuba_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_cuba_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo cuba w1}
t1066_ds_cuba_w1 <- tibble(id=s1066_cuba_w1_n_cigarettes$id)
t1066_ds_cuba_w1$n_cigarettes<-Recode(s1066_cuba_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_cuba_w1$n_cigarettes <- labelled(t1066_ds_cuba_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript cuba w1, echo=F}
Continuous_summary(var = t1066_ds_cuba_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_cuba_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation cuba w1, echo=F}
AfterH <- table(t1066_ds_cuba_w1$n_cigarettes)
X<-table(s1066_cuba_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_cuba_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_cuba_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_cuba_w1$n_cigarettes)))[-28],sep=""),"NA->999") 
kable(C)
```



### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign cuba w2, echo=F}
opal.assign.table.tibble(o, 's1066_cuba_w2_n_cigarettes','10-66.1066-Cuba-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local cuba w2, echo=F}
s1066_cuba_w2_n_cigarettes <- opal.execute(o,'s1066_cuba_w2_n_cigarettes')
Continuous_summary(s1066_cuba_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_cuba_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo cuba w2}
t1066_ds_cuba_w2 <- tibble(id=s1066_cuba_w2_n_cigarettes$id)
t1066_ds_cuba_w2$n_cigarettes<-Recode(s1066_cuba_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_cuba_w2$n_cigarettes <- labelled(t1066_ds_cuba_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript cuba w2, echo=F}
Continuous_summary(var = t1066_ds_cuba_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_cuba_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation cuba w2, echo=F}
AfterH <- table(t1066_ds_cuba_w2$n_cigarettes)
X<-table(s1066_cuba_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_cuba_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_cuba_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_cuba_w2$n_cigarettes)))[-22],sep=""),"NA->999") 
kable(C)
```



## India

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign india w1, echo=F}
opal.assign.table.tibble(o, 's1066_india_w1_n_cigarettes','10-66.1066-India-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local india w1, echo=F}
s1066_india_w1_n_cigarettes <- opal.execute(o,'s1066_india_w1_n_cigarettes')
Continuous_summary(s1066_india_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_india_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo india w1}
t1066_ds_india_w1 <- tibble(id=s1066_india_w1_n_cigarettes$id)
t1066_ds_india_w1$n_cigarettes<-Recode(s1066_india_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_india_w1$n_cigarettes <- labelled(t1066_ds_india_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript india w1, echo=F}
Continuous_summary(var = t1066_ds_india_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_india_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation india w1, echo=F}
AfterH <- table(t1066_ds_india_w1$n_cigarettes)
X<-table(s1066_india_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_india_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_india_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_india_w1$n_cigarettes)))[-28],sep=""),"NA->999") 
kable(C)
```


## Urban China

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign UrbanChina w1, echo=F}
opal.assign.table.tibble(o, 's1066_UrbanChina_w1_n_cigarettes','10-66.1066-UrbanChina-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local UrbanChina w1, echo=F}
s1066_UrbanChina_w1_n_cigarettes <- opal.execute(o,'s1066_UrbanChina_w1_n_cigarettes')
Continuous_summary(s1066_UrbanChina_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_UrbanChina_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo UrbanChina w1}
t1066_ds_UCh_w1 <- tibble(id=s1066_UrbanChina_w1_n_cigarettes$id)
t1066_ds_UCh_w1$n_cigarettes<-Recode(s1066_UrbanChina_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_UCh_w1$n_cigarettes <- labelled(t1066_ds_UCh_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanChina w1, echo=F}
Continuous_summary(var = t1066_ds_UCh_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UCh_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanChina w1, echo=F}
AfterH <- table(t1066_ds_UCh_w1$n_cigarettes)
X<-table(s1066_UrbanChina_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_UrbanChina_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_UrbanChina_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_UCh_w1$n_cigarettes)))[-25],sep=""),"NA->999") 
kable(C)
```




### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign UrbanChina w2, echo=F}
opal.assign.table.tibble(o, 's1066_UrbanChina_w2_n_cigarettes','10-66.1066-UrbanChina-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local UrbanChina w2, echo=F}
s1066_UrbanChina_w2_n_cigarettes <- opal.execute(o,'s1066_UrbanChina_w2_n_cigarettes')
Continuous_summary(s1066_UrbanChina_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_UrbanChina_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo UrbanChina w2}
t1066_ds_UCh_w2 <- tibble(id=s1066_UrbanChina_w2_n_cigarettes$id)
t1066_ds_UCh_w2$n_cigarettes<-Recode(s1066_UrbanChina_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_UCh_w2$n_cigarettes <- labelled(t1066_ds_UCh_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanChina w2, echo=F}
Continuous_summary(var = t1066_ds_UCh_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UCh_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanChina w2, echo=F}
AfterH <- table(t1066_ds_UCh_w2$n_cigarettes)
X<-table(s1066_UrbanChina_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_UrbanChina_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_UrbanChina_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_UCh_w2$n_cigarettes)))[-17],sep=""),"NA->999") 
kable(C)
```



## Rural China

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign RuralChina w1, echo=F}
opal.assign.table.tibble(o, 's1066_RuralChina_w1_n_cigarettes','10-66.1066-RuralChina-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local RuralChina w1, echo=F}
s1066_RuralChina_w1_n_cigarettes <- opal.execute(o,'s1066_RuralChina_w1_n_cigarettes')
Continuous_summary(s1066_RuralChina_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_RuralChina_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo RuralChina w1}
t1066_ds_RCh_w1 <- tibble(id=s1066_RuralChina_w1_n_cigarettes$id)
t1066_ds_RCh_w1$n_cigarettes<-Recode(s1066_RuralChina_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_RCh_w1$n_cigarettes <- labelled(t1066_ds_RCh_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralChina w1, echo=F}
Continuous_summary(var = t1066_ds_RCh_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RCh_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralChina w1, echo=F}
AfterH <- table(t1066_ds_RCh_w1$n_cigarettes)
X<-table(s1066_RuralChina_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_RuralChina_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_RuralChina_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_RCh_w1$n_cigarettes)))[-21],sep=""),"NA->999") 
kable(C)
```



### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign RuralChina w2, echo=F}
opal.assign.table.tibble(o, 's1066_RuralChina_w2_n_cigarettes','10-66.1066-RuralChina-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local RuralChina w2, echo=F}
s1066_RuralChina_w2_n_cigarettes <- opal.execute(o,'s1066_RuralChina_w2_n_cigarettes')
Continuous_summary(s1066_RuralChina_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_RuralChina_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo RuralChina w2}
t1066_ds_RCh_w2 <- tibble(id=s1066_RuralChina_w2_n_cigarettes$id)
t1066_ds_RCh_w2$n_cigarettes<-Recode(s1066_RuralChina_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_RCh_w2$n_cigarettes <- labelled(t1066_ds_RCh_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralChina w2, echo=F}
Continuous_summary(var = t1066_ds_RCh_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RCh_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralChina w2, echo=F}
AfterH <- table(t1066_ds_RCh_w2$n_cigarettes)
X<-table(s1066_RuralChina_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_RuralChina_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_RuralChina_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_RCh_w2$n_cigarettes)))[-22],sep=""),"NA->999") 
kable(C)
```




## Dominican Republic

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign DominicanRepublic w1, echo=F}
opal.assign.table.tibble(o, 's1066_DominicanRepublic_w1_n_cigarettes','10-66.1066-DominicanRepublic-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local DominicanRepublic w1, echo=F}
s1066_DominicanRepublic_w1_n_cigarettes <- opal.execute(o,'s1066_DominicanRepublic_w1_n_cigarettes')
Continuous_summary(s1066_DominicanRepublic_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_DominicanRepublic_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo DominicanRepublic w1}
t1066_ds_DR_w1 <- tibble(id=s1066_DominicanRepublic_w1_n_cigarettes$id)
t1066_ds_DR_w1$n_cigarettes<-Recode(s1066_DominicanRepublic_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_DR_w1$n_cigarettes <- labelled(t1066_ds_DR_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript DominicanRepublic w1, echo=F}
Continuous_summary(var = t1066_ds_DR_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_DR_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation DominicanRepublic w1, echo=F}
AfterH <- table(t1066_ds_DR_w1$n_cigarettes)
X<-table(s1066_DominicanRepublic_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_DominicanRepublic_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_DominicanRepublic_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_DR_w1$n_cigarettes)))[-33],sep=""),"NA->999") 
kable(C)
```




### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign DominicanRepublic w2, echo=F}
opal.assign.table.tibble(o, 's1066_DominicanRepublic_w2_n_cigarettes','10-66.1066-DominicanRepublic-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local DominicanRepublic w2, echo=F}
s1066_DominicanRepublic_w2_n_cigarettes <- opal.execute(o,'s1066_DominicanRepublic_w2_n_cigarettes')
Continuous_summary(s1066_DominicanRepublic_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_DominicanRepublic_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo DominicanRepublic w2}
t1066_ds_DR_w2 <- tibble(id=s1066_DominicanRepublic_w2_n_cigarettes$id)
t1066_ds_DR_w2$n_cigarettes<-Recode(s1066_DominicanRepublic_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_DR_w2$n_cigarettes <- labelled(t1066_ds_DR_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript DominicanRepublic w2, echo=F}
Continuous_summary(var = t1066_ds_DR_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_DR_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation DominicanRepublic w2, echo=F}
AfterH <- table(t1066_ds_DR_w2$n_cigarettes)
X<-table(s1066_DominicanRepublic_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_DominicanRepublic_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_DominicanRepublic_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_DR_w2$n_cigarettes)))[-16],sep=""),"NA->999") 
kable(C)
```




## Venezuela

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign Venezuela w1, echo=F}
opal.assign.table.tibble(o, 's1066_Venezuela_w1_n_cigarettes','10-66.1066-Venezuela-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local Venezuela w1, echo=F}
s1066_Venezuela_w1_n_cigarettes <- opal.execute(o,'s1066_Venezuela_w1_n_cigarettes')
Continuous_summary(s1066_Venezuela_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_Venezuela_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo Venezuela w1}
t1066_ds_Ven_w1 <- tibble(id=s1066_Venezuela_w1_n_cigarettes$id)
t1066_ds_Ven_w1$n_cigarettes<-Recode(s1066_Venezuela_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_Ven_w1$n_cigarettes <- labelled(t1066_ds_Ven_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript Venezuela w1, echo=F}
Continuous_summary(var = t1066_ds_Ven_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_Ven_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation Venezuela w1, echo=F}
AfterH <- table(t1066_ds_Ven_w1$n_cigarettes)
X<-table(s1066_Venezuela_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_Venezuela_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_Venezuela_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_Ven_w1$n_cigarettes)))[-27],sep=""),"NA->999") 
kable(C)
```



### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign Venezuela w2, echo=F}
opal.assign.table.tibble(o, 's1066_Venezuela_w2_n_cigarettes','10-66.1066-Venezuela-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local Venezuela w2, echo=F}
s1066_Venezuela_w2_n_cigarettes <- opal.execute(o,'s1066_Venezuela_w2_n_cigarettes')
Continuous_summary(s1066_Venezuela_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_Venezuela_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo Venezuela w2}
t1066_ds_Ven_w2 <- tibble(id=s1066_Venezuela_w2_n_cigarettes$id)
t1066_ds_Ven_w2$n_cigarettes<-Recode(s1066_Venezuela_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_Ven_w2$n_cigarettes <- labelled(t1066_ds_Ven_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript Venezuela w2, echo=F}
Continuous_summary(var = t1066_ds_Ven_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_Ven_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation Venezuela w2, echo=F}
AfterH <- table(t1066_ds_Ven_w2$n_cigarettes)
X<-table(s1066_Venezuela_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_Venezuela_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_Venezuela_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_Ven_w2$n_cigarettes)))[-15],sep=""),"NA->999") 
kable(C)
```




## Urban Peru

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign UrbanPeru w1, echo=F}
opal.assign.table.tibble(o, 's1066_UrbanPeru_w1_n_cigarettes','10-66.1066-UrbanPeru-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local UrbanPeru w1, echo=F}
s1066_UrbanPeru_w1_n_cigarettes <- opal.execute(o,'s1066_UrbanPeru_w1_n_cigarettes')
Continuous_summary(s1066_UrbanPeru_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_UrbanPeru_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo UrbanPeru w1}
t1066_ds_UP_w1 <- tibble(id=s1066_UrbanPeru_w1_n_cigarettes$id)
t1066_ds_UP_w1$n_cigarettes<-Recode(s1066_UrbanPeru_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_UP_w1$n_cigarettes <- labelled(t1066_ds_UP_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanPeru w1, echo=F}
Continuous_summary(var = t1066_ds_UP_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UP_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanPeru w1, echo=F}
AfterH <- table(t1066_ds_UP_w1$n_cigarettes)
X<-table(s1066_UrbanPeru_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_UrbanPeru_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_UrbanPeru_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_UP_w1$n_cigarettes)))[-20],sep=""),"NA->999") 
kable(C)
```




### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign UrbanPeru w2, echo=F}
opal.assign.table.tibble(o, 's1066_UrbanPeru_w2_n_cigarettes','10-66.1066-UrbanPeru-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local UrbanPeru w2, echo=F}
s1066_UrbanPeru_w2_n_cigarettes <- opal.execute(o,'s1066_UrbanPeru_w2_n_cigarettes')
Continuous_summary(s1066_UrbanPeru_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_UrbanPeru_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo UrbanPeru w2}
t1066_ds_UP_w2 <- tibble(id=s1066_UrbanPeru_w2_n_cigarettes$id)
t1066_ds_UP_w2$n_cigarettes<-Recode(s1066_UrbanPeru_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_UP_w2$n_cigarettes <- labelled(t1066_ds_UP_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanPeru w2, echo=F}
Continuous_summary(var = t1066_ds_UP_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UP_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanPeru w2, echo=F}
AfterH <- table(t1066_ds_UP_w2$n_cigarettes)
X<-table(s1066_UrbanPeru_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_UrbanPeru_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_UrbanPeru_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_UP_w2$n_cigarettes)))[-13],sep=""),"NA->999") 
kable(C)
```



## Rural Peru

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign RuralPeru w1, echo=F}
opal.assign.table.tibble(o, 's1066_RuralPeru_w1_n_cigarettes','10-66.1066-RuralPeru-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local RuralPeru w1, echo=F}
s1066_RuralPeru_w1_n_cigarettes <- opal.execute(o,'s1066_RuralPeru_w1_n_cigarettes')
Continuous_summary(s1066_RuralPeru_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_RuralPeru_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo RuralPeru w1}
t1066_ds_RP_w1 <- tibble(id=s1066_RuralPeru_w1_n_cigarettes$id)
t1066_ds_RP_w1$n_cigarettes<-Recode(s1066_RuralPeru_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_RP_w1$n_cigarettes <- labelled(t1066_ds_RP_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralPeru w1, echo=F}
Continuous_summary(var = t1066_ds_RP_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RP_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralPeru w1, echo=F}
AfterH <- table(t1066_ds_RP_w1$n_cigarettes)
X<-table(s1066_RuralPeru_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_RuralPeru_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_RuralPeru_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_RP_w1$n_cigarettes)))[-16],sep=""),"NA->999") 
kable(C)
```




### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign RuralPeru w2, echo=F}
opal.assign.table.tibble(o, 's1066_RuralPeru_w2_n_cigarettes','10-66.1066-RuralPeru-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local RuralPeru w2, echo=F}
s1066_RuralPeru_w2_n_cigarettes <- opal.execute(o,'s1066_RuralPeru_w2_n_cigarettes')
Continuous_summary(s1066_RuralPeru_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_RuralPeru_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo RuralPeru w2}
t1066_ds_RP_w2 <- tibble(id=s1066_RuralPeru_w2_n_cigarettes$id)
t1066_ds_RP_w2$n_cigarettes<-Recode(s1066_RuralPeru_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_RP_w2$n_cigarettes <- labelled(t1066_ds_RP_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralPeru w2, echo=F}
Continuous_summary(var = t1066_ds_RP_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RP_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralPeru w2, echo=F}
AfterH <- table(t1066_ds_RP_w2$n_cigarettes)
X<-table(s1066_RuralPeru_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_RuralPeru_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_RuralPeru_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_RP_w2$n_cigarettes)))[-5],sep=""),"NA->999") 
kable(C)
```




## Urban Mexico

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign UrbanMexico w1, echo=F}
opal.assign.table.tibble(o, 's1066_UrbanMexico_w1_n_cigarettes','10-66.1066-UrbanMexico-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local UrbanMexico w1, echo=F}
s1066_UrbanMexico_w1_n_cigarettes <- opal.execute(o,'s1066_UrbanMexico_w1_n_cigarettes')
Continuous_summary(s1066_UrbanMexico_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_UrbanMexico_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo UrbanMexico w1}
t1066_ds_UM_w1 <- tibble(id=s1066_UrbanMexico_w1_n_cigarettes$id)
t1066_ds_UM_w1$n_cigarettes<-Recode(s1066_UrbanMexico_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_UM_w1$n_cigarettes <- labelled(t1066_ds_UM_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanMexico w1, echo=F}
Continuous_summary(var = t1066_ds_UM_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UM_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanMexico w1, echo=F}
AfterH <- table(t1066_ds_UM_w1$n_cigarettes)
X<-table(s1066_UrbanMexico_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_UrbanMexico_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_UrbanMexico_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_UM_w1$n_cigarettes)))[-20],sep=""),"NA->999") 
kable(C)
```



### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign UrbanMexico w2, echo=F}
opal.assign.table.tibble(o, 's1066_UrbanMexico_w2_n_cigarettes','10-66.1066-UrbanMexico-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local UrbanMexico w2, echo=F}
s1066_UrbanMexico_w2_n_cigarettes <- opal.execute(o,'s1066_UrbanMexico_w2_n_cigarettes')
Continuous_summary(s1066_UrbanMexico_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_UrbanMexico_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo UrbanMexico w2}
t1066_ds_UM_w2 <- tibble(id=s1066_UrbanMexico_w2_n_cigarettes$id)
t1066_ds_UM_w2$n_cigarettes<-Recode(s1066_UrbanMexico_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_UM_w2$n_cigarettes <- labelled(t1066_ds_UM_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript UrbanMexico w2, echo=F}
Continuous_summary(var = t1066_ds_UM_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_UM_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation UrbanMexico w2, echo=F}
AfterH <- table(t1066_ds_UM_w2$n_cigarettes)
X<-table(s1066_UrbanMexico_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_UrbanMexico_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_UrbanMexico_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_UM_w2$n_cigarettes)))[-8],sep=""),"NA->999") 
kable(C)
```




## Rural Mexico

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign RuralMexico w1, echo=F}
opal.assign.table.tibble(o, 's1066_RuralMexico_w1_n_cigarettes','10-66.1066-RuralMexico-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local RuralMexico w1, echo=F}
s1066_RuralMexico_w1_n_cigarettes <- opal.execute(o,'s1066_RuralMexico_w1_n_cigarettes')
Continuous_summary(s1066_RuralMexico_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_RuralMexico_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo RuralMexico w1}
t1066_ds_RM_w1 <- tibble(id=s1066_RuralMexico_w1_n_cigarettes$id)
t1066_ds_RM_w1$n_cigarettes<-Recode(s1066_RuralMexico_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_RM_w1$n_cigarettes <- labelled(t1066_ds_RM_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralMexico w1, echo=F}
Continuous_summary(var = t1066_ds_RM_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RM_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralMexico w1, echo=F}
AfterH <- table(t1066_ds_RM_w1$n_cigarettes)
X<-table(s1066_RuralMexico_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_RuralMexico_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_RuralMexico_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_RM_w1$n_cigarettes)))[-20],sep=""),"NA->999") 
kable(C)
```




### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign RuralMexico w2, echo=F}
opal.assign.table.tibble(o, 's1066_RuralMexico_w2_n_cigarettes','10-66.1066-RuralMexico-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local RuralMexico w2, echo=F}
s1066_RuralMexico_w2_n_cigarettes <- opal.execute(o,'s1066_RuralMexico_w2_n_cigarettes')
Continuous_summary(s1066_RuralMexico_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_RuralMexico_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo RuralMexico w2}
t1066_ds_RM_w2 <- tibble(id=s1066_RuralMexico_w2_n_cigarettes$id)
t1066_ds_RM_w2$n_cigarettes<-Recode(s1066_RuralMexico_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_RM_w2$n_cigarettes <- labelled(t1066_ds_RM_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript RuralMexico w2, echo=F}
Continuous_summary(var = t1066_ds_RM_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_RM_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation RuralMexico w2, echo=F}
AfterH <- table(t1066_ds_RM_w2$n_cigarettes)
X<-table(s1066_RuralMexico_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_RuralMexico_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_RuralMexico_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_RM_w2$n_cigarettes)))[-8],sep=""),"NA->999") 
kable(C)
```




## Puerto Rico

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign PuertoRico w1, echo=F}
opal.assign.table.tibble(o, 's1066_PuertoRico_w1_n_cigarettes','10-66.1066-PuertoRico-Baseline', variables=list('PCIGDOSE'), missings = TRUE)
```

```{r local PuertoRico w1, echo=F}
s1066_PuertoRico_w1_n_cigarettes <- opal.execute(o,'s1066_PuertoRico_w1_n_cigarettes')
Continuous_summary(s1066_PuertoRico_w1_n_cigarettes$PCIGDOSE)
ggplot(s1066_PuertoRico_w1_n_cigarettes, aes(x=factor(PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `PCIGDOSE*7`
* `NA into 999`

```{r harmo PuertoRico w1}
t1066_ds_PR_w1 <- tibble(id=s1066_PuertoRico_w1_n_cigarettes$id)
t1066_ds_PR_w1$n_cigarettes<-Recode(s1066_PuertoRico_w1_n_cigarettes$PCIGDOSE*7, "NA = '999' ")
t1066_ds_PR_w1$n_cigarettes <- labelled(t1066_ds_PR_w1$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript PuertoRico w1, echo=F}
Continuous_summary(var = t1066_ds_PR_w1$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_PR_w1, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation PuertoRico w1, echo=F}
AfterH <- table(t1066_ds_PR_w1$n_cigarettes)
X<-table(s1066_PuertoRico_w1_n_cigarettes$PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_PuertoRico_w1_n_cigarettes$PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_PuertoRico_w1_n_cigarettes$PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_PR_w1$n_cigarettes)))[-21],sep=""),"NA->999") 
kable(C)
```



### Wave 2

#### Study-specific variable description

The study-specific variables elected to be harmonised is:


* Name: `f_PCIGDOSE`
* Label: `amount smoked`
* Categories:
   + `Continuous variable`
* Missings
   + `NA`


```{r assign PuertoRico w2, echo=F}
opal.assign.table.tibble(o, 's1066_PuertoRico_w2_n_cigarettes','10-66.1066-PuertoRico-Followup', variables=list('f_PCIGDOSE'), missings = TRUE)
```

```{r local PuertoRico w2, echo=F}
s1066_PuertoRico_w2_n_cigarettes <- opal.execute(o,'s1066_PuertoRico_w2_n_cigarettes')
Continuous_summary(s1066_PuertoRico_w2_n_cigarettes$f_PCIGDOSE)
ggplot(s1066_PuertoRico_w2_n_cigarettes, aes(x=factor(f_PCIGDOSE))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `f_PCIGDOSE*7`
* `NA into 999`

```{r harmo PuertoRico w2}
t1066_ds_PR_w2 <- tibble(id=s1066_PuertoRico_w2_n_cigarettes$id)
t1066_ds_PR_w2$n_cigarettes<-Recode(s1066_PuertoRico_w2_n_cigarettes$f_PCIGDOSE*7, "NA = '999' ")
t1066_ds_PR_w2$n_cigarettes <- labelled(t1066_ds_PR_w2$n_cigarettes, labels = c(Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript PuertoRico w2, echo=F}
Continuous_summary(var = t1066_ds_PR_w2$n_cigarettes,missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(t1066_ds_PR_w2, aes(x=factor(n_cigarettes))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Number of cigarettes smoked per week") + ylab("Frequency")
```

#### Validation
```{r crosstabulation PuertoRico w2, echo=F}
AfterH <- table(t1066_ds_PR_w2$n_cigarettes)
X<-table(s1066_PuertoRico_w2_n_cigarettes$f_PCIGDOSE)
BeforeH <- c(X,sum(is.na(s1066_PuertoRico_w2_n_cigarettes$f_PCIGDOSE)))
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(paste(sort(unique(na.omit(s1066_PuertoRico_w2_n_cigarettes$f_PCIGDOSE))),"->",sort(unique(na.omit(t1066_ds_PR_w2$n_cigarettes)))[-13],sep=""),"NA->999") 
kable(C)
```






<!-- ########################################################## --> 
<!-- # Save -->
```{r save, include=FALSE, echo=F}


lb.hds <- list(cuba_w1 = t1066_ds_cuba_w1, india_w1 = t1066_ds_india_w1, UCh_w1 = t1066_ds_UCh_w1, RCh_w1 = t1066_ds_RCh_w1, DR_w1 = t1066_ds_DR_w1, Ven_w1 = t1066_ds_Ven_w1, UP_w1 = t1066_ds_UP_w1, RP_w1 = t1066_ds_RP_w1, UM_w1 = t1066_ds_UM_w1, RM_w1 = t1066_ds_RM_w1, PR_w1 = t1066_ds_PR_w1)

lf.hds <- list(cuba_w2 = t1066_ds_cuba_w2, UCh_w2 = t1066_ds_UCh_w2, RCh_w2 = t1066_ds_RCh_w2, DR_w2 = t1066_ds_DR_w2, Ven_w2 = t1066_ds_Ven_w2, UP_w2 = t1066_ds_UP_w2, RP_w2 = t1066_ds_RP_w2, UM_w2 = t1066_ds_UM_w2, RM_w2 = t1066_ds_RM_w2, PR_w2 = t1066_ds_PR_w2)

for(name in names(lb.hds)) {
  label(lb.hds[[name]][[2]]) <- ds_label # Text value assigned at the DS description, at the top
  lb.hds[[name]][[2]] <- labelled(lb.hds[[name]][[2]], labels = cont_label)
}

for(name in names(lf.hds)) {
  label(lf.hds[[name]][[2]]) <- ds_label # Text value assigned at the DS description, at the top
  lf.hds[[name]][[2]] <- labelled(lf.hds[[name]][[2]], labels = cont_label)
}

for(index in seq_along(lb.hds)){
  n_cigarettes <- lb.hds[[index]]
  save(n_cigarettes, file = paste0(datafolder,names(lb.hds)[index],"/n_cigarettes.RData"))
}

for(index in seq_along(lf.hds)){
  n_cigarettes <- lf.hds[[index]]
  save(n_cigarettes, file = paste0(datafolder,names(lf.hds)[index],"/n_cigarettes.RData"))
}


```
<!-- ########################################################## --> 







# Quality estimation

```{r closeRsession, echo=FALSE}
opal.logout(o)
```