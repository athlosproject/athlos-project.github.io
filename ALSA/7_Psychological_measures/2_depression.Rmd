---
title: "Current depressive status"
output: 
  html_document:
    theme: united
    highlight: tango
    toc: true
    toc_depth: 6
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: true
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->



```{r setup, include=FALSE, echo=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_albert.r")
```

<!-- ########################################################## --> 

# Description of DataSchema variable

The description of harmonised variable is the following:

* Short name: `depression`
* Variable label: `Current depressive status of the participant`
* Variable description: `Current depressive status of the participant`
* Domain: `Psycological measures`
* Value type: `categorical`
* Category coding:

**Code** | **Category Label**
-------- | ------------------
0        | no depression
1        | depression

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing


```{r lab, echo=FALSE}
ds_label <- "Current depressive status"
ds_label_all <- "Current depressive status of the participant"
```

<!-- ########################################################## --> 

<!-- ########################################################## --> 

# Data process

## ALSA (Australian population)

### Wave 1

#### Study-specific variable description

 
| **Name** | `CESD`|
|-|-|
| **Label** | `CESD Depression Scale: Total score`|
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99 = missing` |
| **Description** |  |

```{r assign1, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave1',
                         variables=list('CESD'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local1, echo=FALSE}
vari <- ALSA_dep$CESD
kable(Continuous_summary(var = vari, missing_values = c(99))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(99))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(99))$summary, caption = "Summary")
ggplot(ALSA_dep, aes(vari)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `CESD < 16 into 0` 
* `CESD >= 16 into 1`
* `99 into 999`
* `NA into 999`

**R script:**

```{r harmo1, echo=TRUE}
ALSA_ds_w1 <- tibble(id=ALSA_dep$id)
ALSA_ds_w1$depression <- car::recode(ALSA_dep[[2]], "lo:15=0; 16:90=1; NA=999; 99=999")
ALSA_ds_w1$depression <- labelled(ALSA_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1, echo=FALSE}
vari <- ALSA_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(ALSA_ds_w1, aes(x=factor(ALSA_ds_w1[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation1, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep[[2]])<16),sum(na.omit(ALSA_dep[[2]])>=16 & na.omit(ALSA_dep[[2]])<90), sum(is.na(ALSA_dep[[2]]), na.omit(ALSA_dep[[2]]==99)))
AfterH <- table(ALSA_ds_w1[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1","NA->999") 
kable(C)
```

 
```{r save, echo=FALSE}
label(ALSA_ds_w1$depression) <- ds_label_all
depression <- ALSA_ds_w1
save(depression, file = "../RData/w1/depression.RData")
rm(depression, ALSA_dep)
```

 




### Wave 2 

There is no variable. 
 
 

 


### Wave 3 

#### Study-specific variable description

| **Name** | `CESDW3`|
|-|-|
| **Label** | `CESD DEPRESSION SCALE: TOTAL SCORE`|
| **Table name** | `ALSA-Wave3` |
| **Description** |  |

```{r assign3, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave3',
                         variables=list('CESDW3'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local3, echo=FALSE}
vari <- ALSA_dep$CESDW3
kable(Continuous_summary(vari, missing_values = NA)[3], caption = ds_label) 
pander(Continuous_summary(vari, missing_values = NA)$summary, caption = "Summary")
ggplot(ALSA_dep, aes(vari)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `CESDW3 < 16 into 0` 
* `CESDW3 >= 16 into 1`
* `99 into 999`
* `NA into 999`

**R script:**

```{r harmo3, echo=TRUE}
ALSA_ds_w3 <- tibble(id=ALSA_dep$id)
ALSA_ds_w3$depression <- car::recode(ALSA_dep[[2]], "lo:15=0; 16:90=1; NA=999; 99=999")
ALSA_ds_w3$depression <- labelled(ALSA_ds_w3[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript3, echo=FALSE}
vari <- ALSA_ds_w3$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(ALSA_ds_w3, aes(x=factor(ALSA_ds_w3[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation3, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep[[2]])<16),sum(na.omit(ALSA_dep[[2]])>=16 & na.omit(ALSA_dep[[2]])<90), sum(is.na(ALSA_dep[[2]]), na.omit(ALSA_dep[[2]]==99)))
AfterH <- table(ALSA_ds_w3[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1","NA->999") 
kable(C)
```

 
```{r save3, echo=FALSE}
label(ALSA_ds_w3$depression) <- ds_label_all
depression <- ALSA_ds_w3
save(depression, file = "../RData/w3/depression.RData")
rm(depression, ALSA_dep)
```
 

 




### Wave 4 

There is no variable.
 
 

 





### Wave 5 

There is no variable.
 
 

 





### Wave 6 

#### Study-specific variable description

| **Name** | `CESD1W6`| `CESD2W6` | `CESD3W6` | `CESD4W6` | `CESD5W6` | `CESD6W6` | `CESD7W6` | `CESD8W6` | `CESD9W6` | `CESD10W6` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `I was bothered by things that usually don`| `I did not feel like eating: my appetite was poor` | `I felt that I could not shake off feeling low even with help from my family and friends` | `I felt that I was just as good as other people` | `I had trouble keeping my mind on what I was doing` | `I felt depressed` | `I felt that everything I did was an effort` | `I felt hopeful about the future` | `I thought my life had been a failure` | `I felt afraid` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = rarely or none of the time`| `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | 
| | `2 = some of the time` | `2 = some of the time`| `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | 
| | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | 
| | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | 
| **Missing** |`0 = no answer`| `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | 

| **Name** | `CESD11W6`| `CESD12W6` | `CESD13W6` | `CESD14W6` | `CESD15W6` | `CESD16W6` | `CESD17W6` | `CESD18W6` | `CESD19W6` | `CESD20W6` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `My sleep was restless`| `I was happy` | `It seemed that I talked less than usual` | `I felt lonely` | `People were unfriendly` | `I enjoyed life` | `I had crying spells` | `I felt sad` | `I felt people disliked me` | `I could not get going` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = rarely or none of the time`| `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | 
| | `2 = some of the time` | `2 = some of the time`| `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | 
| | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | 
| | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | 
| **Missing** |`0 = no answer`| `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | 
| **Description** |  | | | | | | | | | | 

```{r assign6, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave6',
                         variables=list('CESD1W6', 'CESD2W6', 'CESD3W6', 'CESD4W6', 'CESD5W6', 'CESD6W6', 'CESD7W6', 'CESD8W6', 'CESD9W6', 'CESD10W6', 'CESD11W6', 'CESD12W6', 'CESD13W6', 'CESD14W6', 'CESD15W6', 'CESD16W6', 'CESD17W6', 'CESD18W6', 'CESD19W6', 'CESD20W6'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local6, echo=FALSE}
vari <- ALSA_dep$CESD1W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD2W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD3W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD4W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD5W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD6W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD7W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD8W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD9W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD10W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD11W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD12W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD13W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD14W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD15W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD16W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD17W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD18W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD19W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD20W6
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 
* The reversed items CESD4W6, CESD8W6, CESD12W6, CESD16W6: 
  + `recode 1 into 3`
  + `keep 2`
  + `recode 3 into 1`
  + `recode 4 into 0`
* The direct items CESD1W6, CESD2W6, CESD3W6, CESD5W6, CESD6W6, CESD7W6, CESD9W6, CESD10W6, CESD11W6, CESD13W6, CESD14W6, CESD15W6, CESD17W6, CESD18W6, CESD19W6, CESD20W6: 
  + `recode 1 into 0`
  + `recode 2 into 1`
  + `recode 3 into 2`
  + `recode 4 into 3`

Secondly in order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 20. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 
* `0-15 into 0`
* `>16 into 1`
* `NA into`
  + `995 if the individual has more items = 0 than NA`
  + `999 if the individual has more items = NA than 0`

**R script:**

```{r harmo6, echo=TRUE}
#reversed items
ALSA_dep$p4 <- car::recode(ALSA_dep$CESD4W6, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p8 <- car::recode(ALSA_dep$CESD8W6, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p12 <- car::recode(ALSA_dep$CESD12W6, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p16 <- car::recode(ALSA_dep$CESD16W6, "1=3; 3=1; 4=0; 0=NA")

#direct items  
ALSA_dep$p1 <- car::recode(ALSA_dep$CESD1W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p2 <- car::recode(ALSA_dep$CESD2W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p3 <- car::recode(ALSA_dep$CESD3W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p5 <- car::recode(ALSA_dep$CESD5W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p6 <- car::recode(ALSA_dep$CESD6W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p7 <- car::recode(ALSA_dep$CESD7W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p9 <- car::recode(ALSA_dep$CESD9W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p10 <- car::recode(ALSA_dep$CESD10W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p11 <- car::recode(ALSA_dep$CESD11W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p13 <- car::recode(ALSA_dep$CESD13W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p14 <- car::recode(ALSA_dep$CESD14W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p15 <- car::recode(ALSA_dep$CESD15W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p17 <- car::recode(ALSA_dep$CESD17W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p18 <- car::recode(ALSA_dep$CESD18W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p19 <- car::recode(ALSA_dep$CESD19W6, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p20 <- car::recode(ALSA_dep$CESD20W6, "1=0; 2=1; 3=2; 4=3; 0=NA")

ALSA_dep$nmiss <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(is.na(x)))


ALSA_dep$final_score <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))


ALSA_dep$final_score[which(ALSA_dep$nmiss==3)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==3)]/17)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==2)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==2)]/18)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==1)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==1)]/19)*20

ALSA_dep$n0 <- apply(ALSA_dep[,2:21], MARGIN = 1, FUN = function(x) sum(x==0, na.rm = TRUE))
ALSA_dep$nNA <- apply(ALSA_dep[,2:21], MARGIN = 1, FUN = function(x) sum(is.na(x)))

ALSA_dep$max_0_NA <- apply(ALSA_dep[,44:45], MARGIN = 1, FUN = function(x) which.max(x))
ALSA_dep$max_0_NA <- car::recode(ALSA_dep$max_0_NA, "1=995;2=999")

ALSA_dep$final_score[which(ALSA_dep$nmiss>4)] <- ALSA_dep$max_0_NA[which(ALSA_dep$nmiss>4)]


ALSA_ds_w6 <- tibble(id=ALSA_dep$id)
ALSA_ds_w6$depression <- car::recode(ALSA_dep$final_score, "0:15.99999999=0; 16:900=1")
ALSA_ds_w6$depression <- labelled(ALSA_ds_w6[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript6, echo=FALSE}
vari <- ALSA_ds_w6$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(ALSA_ds_w6, aes(x=factor(ALSA_ds_w6[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation6, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep$final_score)<16), sum(na.omit(ALSA_dep$final_score)>=16 & na.omit(ALSA_dep$final_score)<900), sum(na.omit(ALSA_dep$final_score)==995), sum(na.omit(ALSA_dep$final_score)==999))
AfterH <- table(ALSA_ds_w6[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1","0->995", "NA->999") 
kable(C)
```

```{r importOPAL6, echo=FALSE}
label(ALSA_ds_w6$depression) <- ds_label_all
depression <- ALSA_ds_w6
save(depression, file = "../RData/w6/depression.RData")
rm(depression, ALSA_dep)
```


 




### Wave 7 

#### Study-specific variable description

| **Name** | `CESDtotalw7`|
|-|-|
| **Label** | `CESD total w7`|
| **Table name** | `ALSA-Wave7` |
| **Description** |  |

```{r assign7, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave7',
                         variables=list('CESDtotalw7'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local7, echo=FALSE}
vari <- ALSA_dep$CESDtotalw7
kable(Continuous_summary(vari, missing_values = NA)[3], caption = ds_label) 
pander(Continuous_summary(vari, missing_values = NA)$summary, caption = "Summary")
ggplot(ALSA_dep, aes(vari)) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `CESDtotalw7 < 16 into 0` 
* `CESDtotalw7 >= 16 into 1`
* `99 into 999`
* `NA into 999`

**R script:**

```{r harmo7, echo=TRUE}
ALSA_ds_w7 <- tibble(id=ALSA_dep$id)
ALSA_ds_w7$depression <- car::recode(ALSA_dep[[2]], "lo:15=0; 16:90=1; NA=999")
ALSA_ds_w7$depression <- labelled(ALSA_ds_w7[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript7, echo=FALSE}
vari <- ALSA_ds_w7$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(ALSA_ds_w7, aes(x=factor(ALSA_ds_w7[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation7, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep[[2]])<16),sum(na.omit(ALSA_dep[[2]])>=16 & na.omit(ALSA_dep[[2]])<90), sum(is.na(ALSA_dep[[2]]), na.omit(ALSA_dep[[2]]==99)))
AfterH <- table(ALSA_ds_w7[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1","NA->999") 
kable(C)
```

 
```{r save7, echo=FALSE}
label(ALSA_ds_w7$depression) <- ds_label_all
depression <- ALSA_ds_w7
save(depression, file = "../RData/w7/depression.RData")
rm(depression, ALSA_dep)
```

 

 


### Wave 8 

There is no variable.

 




### Wave 9 

#### Study-specific variable description

| **Name** | `CESD1W9`| `CESD2W9` | `CESD3W9` | `CESD4W9` | `CESD5W9` | `CESD6W9` | `CESD7W9` | `CESD8W9` | `CESD9W9` | `CESD10W9` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `I was bothered by things that usually don`| `I did not feel like eating: my appetite was poor` | `I felt that I could not shake off feeling low even with help from my family and friends` | `I felt that I was just as good as other people` | `I had trouble keeping my mind on what I was doing` | `I felt depressed` | `I felt that everything I did was an effort` | `I felt hopeful about the future` | `I thought my life had been a failure` | `I felt afraid` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = rarely or none of the time`| `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | 
| | `2 = some of the time` | `2 = some of the time`| `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | 
| | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | 
| | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | 
| **Missing** |`0 = Not Answered`| `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | 

| **Name** | `CESD11W9`| `CESD12W9` | `CESD13W9` | `CESD14W9` | `CESD15W9` | `CESD16W9` | `CESD17W9` | `CESD18W9` | `CESD19W9` | `CESD20W9` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `My sleep was restless`| `I was happy` | `It seemed that I talked less than usual` | `I felt lonely` | `People were unfriendly` | `I enjoyed life` | `I had crying spells` | `I felt sad` | `I felt people disliked me` | `I could not get going` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = Most or all of the time`| `1 = Most or all of the time` | `1 = Most or all of the time` | `1 = Most or all of the time` | `1 = Most or all of the time` | `1 = Most or all of the time` | `1 = Most or all of the time` | `1 = Most or all of the time` | `1 = Most or all of the time` | `1 = Most or all of the time` | 
| | `2 = Some of the time` | `2 = Some of the time`| `2 = Some of the time` | `2 = Some of the time` | `2 = Some of the time` | `2 = Some of the time` | `2 = Some of the time` | `2 = Some of the time` | `2 = Some of the time` | `2 = Some of the time` | 
| | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | `3 = Some of the time` | 
| | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | `4 = Rarely or none of the time` | 
| **Missing** |`0 = Not Answered`| `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | `0 = Not Answered` | 
| **Description** |  | | | | | | | | | | 

```{r assign9, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave9',
                         variables=list('CESD1W9', 'CESD2W9', 'CESD3W9', 'CESD4W9', 'CESD5W9', 'CESD6W9', 'CESD7W9', 'CESD8W9', 'CESD9W9', 'CESD10W9', 'CESD11W9', 'CESD12W9', 'CESD13W9', 'CESD14W9', 'CESD15W9', 'CESD16W9', 'CESD17W9', 'CESD18W9', 'CESD19W9', 'CESD20W9'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local9, echo=FALSE}
vari <- ALSA_dep$CESD1W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD2W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD3W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD4W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD5W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD6W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD7W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD8W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD9W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD10W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD11W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD12W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD13W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD14W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD15W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD16W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD17W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD18W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD19W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD20W9
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 

* The reversed items CESD4W6, CESD8W6, CESD12W6, CESD16W6: 
  + `recode 1 into 3`
  + `keep 2`
  + `recode 3 into 1`
  + `recode 4 into 0`


* The direct items CESD1W6, CESD2W6, CESD3W6, CESD5W6, CESD6W6, CESD7W6, CESD9W6, CESD10W6: 
  + `recode 1 into 0`
  + `recode 2 into 1`
  + `recode 3 into 2`
  + `recode 4 into 3`
  
* The direct items CESD11W6, CESD13W6, CESD14W6, CESD15W6, CESD17W6, CESD18W6, CESD19W6, CESD20W6: 
  + `recode 1 into 3`
  + `keep 2`
  + `recode 3 into 1`
  + `recode 4 into 0`

Secondly in order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 20. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 
* `0-15 into 0`
* `>16 into 1`
* `NA into`
  + `995 if the individual has more items = 0 than NA`
  + `999 if the individual has more items = NA than 0`

**R script:**


```{r harmo9, echo=TRUE}
#reversed items
ALSA_dep$p4 <- car::recode(ALSA_dep$CESD4W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p8 <- car::recode(ALSA_dep$CESD8W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p12 <- car::recode(ALSA_dep$CESD12W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p16 <- car::recode(ALSA_dep$CESD16W9, "1=3; 3=1; 4=0; 0=NA")

#direct items  
ALSA_dep$p1 <- car::recode(ALSA_dep$CESD1W9, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p2 <- car::recode(ALSA_dep$CESD2W9, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p3 <- car::recode(ALSA_dep$CESD3W9, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p5 <- car::recode(ALSA_dep$CESD5W9, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p6 <- car::recode(ALSA_dep$CESD6W9, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p7 <- car::recode(ALSA_dep$CESD7W9, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p9 <- car::recode(ALSA_dep$CESD9W9, "1=0; 2=1; 3=2; 4=3; 0=NA")
ALSA_dep$p10 <- car::recode(ALSA_dep$CESD10W9, "1=0; 2=1; 3=2; 4=3; 0=NA")

ALSA_dep$p11 <- car::recode(ALSA_dep$CESD11W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p13 <- car::recode(ALSA_dep$CESD13W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p14 <- car::recode(ALSA_dep$CESD14W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p15 <- car::recode(ALSA_dep$CESD15W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p17 <- car::recode(ALSA_dep$CESD17W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p18 <- car::recode(ALSA_dep$CESD18W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p19 <- car::recode(ALSA_dep$CESD19W9, "1=3; 3=1; 4=0; 0=NA")
ALSA_dep$p20 <- car::recode(ALSA_dep$CESD20W9, "1=3; 3=1; 4=0; 0=NA")

ALSA_dep$nmiss <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(is.na(x)))


ALSA_dep$final_score <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))


ALSA_dep$final_score[which(ALSA_dep$nmiss==3)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==3)]/17)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==2)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==2)]/18)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==1)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==1)]/19)*20

ALSA_dep$n0 <- apply(ALSA_dep[,2:21], MARGIN = 1, FUN = function(x) sum(x==0, na.rm = TRUE))
ALSA_dep$nNA <- apply(ALSA_dep[,2:21], MARGIN = 1, FUN = function(x) sum(is.na(x)))

ALSA_dep$max_0_NA <- apply(ALSA_dep[,44:45], MARGIN = 1, FUN = function(x) which.max(x))
ALSA_dep$max_0_NA <- car::recode(ALSA_dep$max_0_NA, "1=995;2=999")

ALSA_dep$final_score[which(ALSA_dep$nmiss>4)] <- ALSA_dep$max_0_NA[which(ALSA_dep$nmiss>4)]

ALSA_ds_w9 <- tibble(id=ALSA_dep$id)
ALSA_ds_w9$depression <- car::recode(ALSA_dep$final_score, "0:15.99999999=0; 16:900=1")
ALSA_ds_w9$depression <- labelled(ALSA_ds_w9[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript9, echo=FALSE}
vari <- ALSA_ds_w9$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(ALSA_ds_w9, aes(x=factor(ALSA_ds_w9[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation9, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep$final_score)<16), sum(na.omit(ALSA_dep$final_score)>=16 & na.omit(ALSA_dep$final_score)<900), sum(na.omit(ALSA_dep$final_score)==995), sum(na.omit(ALSA_dep$final_score)==999))
AfterH <- table(ALSA_ds_w9[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1","0->995", "NA->999") 
kable(C)
```

 
```{r importOPAL9, echo=FALSE}
label(ALSA_ds_w9$depression) <- ds_label_all
depression <- ALSA_ds_w9
save(depression, file = "../RData/w9/depression.RData")
rm(depression, ALSA_dep)
```


 





### Wave 10 

There is no variable.
 

 



### Wave 11 

#### Study-specific variable description

| **Name** | `CESD1W11`| `CESD2W11` | `CESD3W11` | `CESD4W11` | `CESD5W11` | `CESD6W11` | `CESD7W11` | `CESD8W11` | `CESD9W11` | `CESD10W11` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `I was bothered by things that usually don't bother me`| `I did not feel like eating: my appetite was poor` | `I felt that I could not shake off feeling low even with help from my family and friends` | `I felt that I was just as good as other people` | `I had trouble keeping my mind on what I was doing` | `I felt depressed` | `I felt that everything I did was an effort` | `I felt hopeful about the future` | `I thought my life had been a failure` | `I felt afraid` | 
| **Table name** | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` |
| **Categories** |`0 = rarely or none of the time`| `0 = rarely or none of the time` | `0 = rarely or none of the time` | `0 = Most or all of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | `0 = Most or all of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | 
| | `1 = some of the time` | `1 = some of the time`| `1 = some of the time` | `1 = quite a bit of the time` | `1 = some of the time` | `1 = some of the time` | `1 = some of the time` | `1 = quite a bit of the time` | `1 = some of the time` | `1 = some of the time` | 
| | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = some of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = some of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | 
| | `3 = most or all of the time` | `3 = most or all of the time` | `3 = most or all of the time` | `3 = rarely or none of the time` | `3 = most or all of the time` | `3 = most or all of the time` | `3 = most or all of the time` | `3 = rarely or none of the time` | `3 = most or all of the time` | `3 = most or all of the time` | 
 

| **Name** | `CESD11W11`| `CESD12W11` | `CESD13W11` | `CESD14W11` | `CESD15W11` | `CESD16W11` | `CESD17W11` | `CESD18W11` | `CESD19W11` | `CESD20W11` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `My sleep was restless`| `I was happy` | `It seemed that I talked less than usual` | `I felt lonely` | `People were unfriendly` | `I enjoyed life` | `I had crying spells` | `I felt sad` | `I felt people disliked me` | `I could not get going` | 
| **Table name** | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` | `ALSA-Wave11` |
| **Categories** |`0 = rarely or none of the time`| `0 = Most or all of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | `0 = Most or all of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | `0 = rarely or none of the time` | 
| | `1 = some of the time` | `1 = quite a bit of the time`| `1 = some of the time` | `1 = some of the time` | `1 = some of the time` | `1 = quite a bit of the time` | `1 = some of the time` | `1 = some of the time` | `1 = some of the time` | `1 = some of the time` | 
| | `2 = quite a bit of the time` | `2 = some of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = some of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | `2 = quite a bit of the time` | 
| | `3 = most or all of the time` | `3 = rarely or none of the time` | `3 = most or all of the time` | `3 = most or all of the time` | `3 = most or all of the time` | `3 = rarely or none of the time` | `3 = most or all of the time` | `3 = most or all of the time` | `3 = most or all of the time` | `3 = most or all of the time` | 
| **Description** |  | | | | | | | | | | 

```{r assign11, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave11',
                         variables=list('CESD1W11', 'CESD2W11', 'CESD3W11', 'CESD4W11', 'CESD5W11', 'CESD6W11', 'CESD7W11', 'CESD8W11', 'CESD9W11', 'CESD10W11', 'CESD11W11', 'CESD12W11', 'CESD13W11', 'CESD14W11', 'CESD15W11', 'CESD16W11', 'CESD17W11', 'CESD18W11', 'CESD19W11', 'CESD20W11'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local11, echo=FALSE}
vari <- ALSA_dep$CESD1W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD2W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD3W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD4W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD5W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD6W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD7W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD8W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD9W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD10W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD11W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD12W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD13W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD14W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD15W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD16W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD17W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD18W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD19W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD20W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
In order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 20. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 
* `0-15 into 0`
* `>16 into 1`
* `NA into 999`

**R script:**

```{r harmo11, echo=TRUE}
ALSA_dep$nmiss <- apply(ALSA_dep[,2:21], MARGIN = 1, FUN = function(x) sum(is.na(x)))


ALSA_dep$final_score <- apply(ALSA_dep[,2:21], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))


ALSA_dep$final_score[which(ALSA_dep$nmiss==3)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==3)]/17)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==2)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==2)]/18)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==1)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==1)]/19)*20

ALSA_dep$final_score[which(ALSA_dep$nmiss>4)] <- 999

ALSA_ds_w11 <- tibble(id=ALSA_dep$id)
 ALSA_ds_w11$depression <- car::recode(ALSA_dep$final_score, "0:15.99999999=0; 16:900=1")
 ALSA_ds_w11$depression <- labelled( ALSA_ds_w11[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript11, echo=FALSE}
vari <-  ALSA_ds_w11$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot( ALSA_ds_w11, aes(x=factor( ALSA_ds_w11[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation11, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep$final_score)<16), sum(na.omit(ALSA_dep$final_score)>=16 & na.omit(ALSA_dep$final_score)<900), sum(na.omit(ALSA_dep$final_score)==999))
AfterH <- table( ALSA_ds_w11[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1", "NA->999") 
kable(C)
```

```{r importOPAL11, echo=FALSE}
label( ALSA_ds_w11$depression) <- ds_label_all
depression <-  ALSA_ds_w11
save(depression, file = "../RData/w11/depression.RData")
rm(depression, ALSA_dep)
```
 
 

 




### Wave 12 

#### Study-specific variable description

 
| **Name** | `CESD1W12`| `CESD2W12` | `CESD3W12` | `CESD4W12` | `CESD5W12` | `CESD6W12` | `CESD7W12` | `CESD8W12` | `CESD9W12` | `CESD10W12` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `I was bothered by things that usually don`| `I did not feel like eating: my appetite was poor` | `I felt that I could not shake off feeling low even with help from my family and friends` | `I felt that I was just as good as other people` | `I had trouble keeping my mind on what I was doing` | `I felt depressed` | `I felt that everything I did was an effort` | `I felt hopeful about the future` | `I thought my life had been a failure` | `I felt afraid` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = rarely or none of the time`| `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | 
| | `2 = some of the time` | `2 = some of the time`| `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | 
| | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | 
| | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | 
| **Missing** |`0 = no answer`| `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | 

| **Name** | `CESD11W12`| `CESD12W12` | `CESD13W12` | `CESD14W12` | `CESD15W12` | `CESD16W12` | `CESD17W12` | `CESD18W12` | `CESD19W12` | `CESD20W12` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `My sleep was restless`| `I was happy` | `It seemed that I talked less than usual` | `I felt lonely` | `People were unfriendly` | `I enjoyed life` | `I had crying spells` | `I felt sad` | `I felt people disliked me` | `I could not get going` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = rarely or none of the time`| `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | 
| | `2 = some of the time` | `2 = some of the time`| `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | 
| | `3-4 days` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | 
| | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | 
| **Missing** |`0 = no answer`| `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | 
| **Description** |  | | | | | | | | | | 

```{r assign12, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave12',
                         variables=list('CESD1W12', 'CESD2W12', 'CESD3W12', 'CESD4W12', 'CESD5W12', 'CESD6W12', 'CESD7W12', 'CESD8W12', 'CESD9W12', 'CESD10W12', 'CESD11W12', 'CESD12W12', 'CESD13W12', 'CESD14W12', 'CESD15W12', 'CESD16W12', 'CESD17W12', 'CESD18W12', 'CESD19W12', 'CESD20W12'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local12, echo=FALSE}
vari <- ALSA_dep$CESD1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD2W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD3W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD4W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD5W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD6W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD7W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD8W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD9W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD10W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD11W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD12W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD13W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD14W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD15W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD16W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD17W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD18W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD19W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD20W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 

* The reversed items CESD4W12, CESD8W12, CESD12W12, CESD16W12: 
  + `recode 1 into 3`
  + `keep 2`
  + `recode 3 into 1`
  + `recode 4 into 0`

* The direct items CESD1W12, CESD2W12, CESD3W12, CESD5W12, CESD6W12, CESD7W12, CESD9W12, CESD10W12, CESD11W12, CESD13W12, CESD14W12, CESD15W12, CESD17W12, CESD18W12, CESD19W12, CESD20W12: 
  + `recode 1 into 0`
  + `recode 2 into 1`
  + `recode 3 into 2`
  + `recode 4 into 3`

Secondly in order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 20. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 

* `0-15 into 0`
* `>16 into 1`
* `NA into 999`

**R script:**

```{r harmo12, echo=TRUE}
#reversed items
ALSA_dep$p4 <- car::recode(ALSA_dep$CESD4W12, "1=3; 3=1; 4=0")
ALSA_dep$p8 <- car::recode(ALSA_dep$CESD8W12, "1=3; 3=1; 4=0")
ALSA_dep$p12 <- car::recode(ALSA_dep$CESD12W12, "1=3; 3=1; 4=0")
ALSA_dep$p16 <- car::recode(ALSA_dep$CESD16W12, "1=3; 3=1; 4=0")

#direct items  
ALSA_dep$p1 <- car::recode(ALSA_dep$CESD1W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p2 <- car::recode(ALSA_dep$CESD2W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p3 <- car::recode(ALSA_dep$CESD3W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p5 <- car::recode(ALSA_dep$CESD5W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p6 <- car::recode(ALSA_dep$CESD6W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p7 <- car::recode(ALSA_dep$CESD7W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p9 <- car::recode(ALSA_dep$CESD9W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p10 <- car::recode(ALSA_dep$CESD10W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p11 <- car::recode(ALSA_dep$CESD11W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p13 <- car::recode(ALSA_dep$CESD13W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p14 <- car::recode(ALSA_dep$CESD14W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p15 <- car::recode(ALSA_dep$CESD15W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p17 <- car::recode(ALSA_dep$CESD17W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p18 <- car::recode(ALSA_dep$CESD18W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p19 <- car::recode(ALSA_dep$CESD19W12, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p20 <- car::recode(ALSA_dep$CESD20W12, "1=0; 2=1; 3=2; 4=3")

ALSA_dep$nmiss <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(is.na(x)))


ALSA_dep$final_score <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))


ALSA_dep$final_score[which(ALSA_dep$nmiss==3)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==3)]/17)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==2)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==2)]/18)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==1)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==1)]/19)*20

ALSA_dep$final_score[which(ALSA_dep$nmiss>4)] <- 999

ALSA_ds_w12 <- tibble(id=ALSA_dep$id)
ALSA_ds_w12$depression <- car::recode(ALSA_dep$final_score, "0:15.99999999=0; 16:900=1")
ALSA_ds_w12$depression <- labelled(ALSA_ds_w12[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript12, echo=FALSE}
vari <- ALSA_ds_w12$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(ALSA_ds_w12, aes(x=factor(ALSA_ds_w12[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation12, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep$final_score)<16), sum(na.omit(ALSA_dep$final_score)>=16 & na.omit(ALSA_dep$final_score)<900), sum(na.omit(ALSA_dep$final_score)==999))
AfterH <- table(ALSA_ds_w12[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1", "NA->999") 
kable(C)
```

 
 
```{r importOPAL12, echo=FALSE}
label(ALSA_ds_w12$depression) <- ds_label_all
depression <- ALSA_ds_w12
save(depression, file = "../RData/w12/depression.RData")
rm(depression, ALSA_dep)
```

 





### Wave 13 

#### Study-specific variable description

| **Name** | `CESD1W13`| `CESD2W13` | `CESD3W13` | `CESD4W13` | `CESD5W13` | `CESD6W13` | `CESD7W13` | `CESD8W13` | `CESD9W13` | `CESD10W13` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `I was bothered by things that usually don`| `I did not feel like eating: my appetite was poor` | `I felt that I could not shake off feeling low even with help from my family and friends` | `I felt that I was just as good as other people` | `I had trouble keeping my mind on what I was doing` | `I felt depressed` | `I felt that everything I did was an effort` | `I felt hopeful about the future` | `I thought my life had been a failure` | `I felt afraid` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = rarely or none of the time`| `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | 
| | `2 = some of the time` | `2 = some of the time`| `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | 
| | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | 
| | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | 
| **Missing** |`0 = no answer`| `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | 

| **Name** | `CESD11W13`| `CESD12W13` | `CESD13W13` | `CESD14W13` | `CESD15W13` | `CESD16W13` | `CESD17W13` | `CESD18W13` | `CESD19W13` | `CESD20W13` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `My sleep was restless`| `I was happy` | `It seemed that I talked less than usual` | `I felt lonely` | `People were unfriendly` | `I enjoyed life` | `I had crying spells` | `I felt sad` | `I felt people disliked me` | `I could not get going` | 
| **Table name** | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` | `ALSA-Wave6` |
| **Categories** |`1 = rarely or none of the time`| `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | `1 = rarely or none of the time` | 
| | `2 = some of the time` | `2 = some of the time`| `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | `2 = some of the time` | 
| | `3-4 days` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | `3 = quite a bit of the time` | 
| | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | `4 = most or all of the time` | 
| **Missing** |`0 = no answer`| `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | `0 = no answer` | 
| **Description** |  | | | | | | | | | | 

```{r assign13, echo=FALSE}
opal.assign.table.tibble(o, 'ALSA_dep','ALSA.ALSA-Wave13',
                         variables=list('CESD1W13', 'CESD2W13', 'CESD3W13', 'CESD4W13', 'CESD5W13', 'CESD6W13', 'CESD7W13', 'CESD8W13', 'CESD9W13', 'CESD10W13', 'CESD11W13', 'CESD12W13', 'CESD13W13', 'CESD14W13', 'CESD15W13', 'CESD16W13', 'CESD17W13', 'CESD18W13', 'CESD19W13', 'CESD20W13'), missings = TRUE)
ALSA_dep <- opal.execute(o,'ALSA_dep')
```

```{r local13, echo=FALSE}
vari <- ALSA_dep$CESD1W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD2W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD3W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD4W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD5W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD6W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD7W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD8W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD9W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD10W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD11W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD12W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD13W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD14W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD15W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD16W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD17W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD18W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD19W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- ALSA_dep$CESD20W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(ALSA_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

First of all: 

* The reversed items CESD4W13, CESD8W13, CESD12W13, CESD16W13: 
  + `recode 1 into 3`
  + `keep 2`
  + `recode 3 into 1`
  + `recode 4 into 0`

* The direct items CESD1W13, CESD2W13, CESD3W13, CESD5W13, CESD6W13, CESD7W13, CESD9W13, CESD10W13, CESD11W13, CESD13W13, CESD14W13, CESD15W13, CESD17W13, CESD18W13, CESD19W13, CESD20W13: 
  + `recode 1 into 0`
  + `recode 2 into 1`
  + `recode 3 into 2`
  + `recode 4 into 3`

Secondly in order to get the final score the items have to be summed. If one to 4 items are missing, scores on the completed items are summed; the total is divided by the number of items answered and multiplied by 20. If more than 4 items are missing the individual get a missing value in the final score. 

After get the final score, it has to be recoded as follows: 

* `0-15 into 0`
* `>16 into 1`
* `NA into 999`

**R script:**

```{r harmo13, echo=TRUE}
#reversed items
ALSA_dep$p4 <- car::recode(ALSA_dep$CESD4W13, "1=3; 3=1; 4=0")
ALSA_dep$p8 <- car::recode(ALSA_dep$CESD8W13, "1=3; 3=1; 4=0")
ALSA_dep$p12 <- car::recode(ALSA_dep$CESD12W13, "1=3; 3=1; 4=0")
ALSA_dep$p16 <- car::recode(ALSA_dep$CESD16W13, "1=3; 3=1; 4=0")

#direct items  
ALSA_dep$p1 <- car::recode(ALSA_dep$CESD1W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p2 <- car::recode(ALSA_dep$CESD2W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p3 <- car::recode(ALSA_dep$CESD3W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p5 <- car::recode(ALSA_dep$CESD5W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p6 <- car::recode(ALSA_dep$CESD6W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p7 <- car::recode(ALSA_dep$CESD7W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p9 <- car::recode(ALSA_dep$CESD9W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p10 <- car::recode(ALSA_dep$CESD10W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p11 <- car::recode(ALSA_dep$CESD11W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p13 <- car::recode(ALSA_dep$CESD13W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p14 <- car::recode(ALSA_dep$CESD14W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p15 <- car::recode(ALSA_dep$CESD15W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p17 <- car::recode(ALSA_dep$CESD17W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p18 <- car::recode(ALSA_dep$CESD18W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p19 <- car::recode(ALSA_dep$CESD19W13, "1=0; 2=1; 3=2; 4=3")
ALSA_dep$p20 <- car::recode(ALSA_dep$CESD20W13, "1=0; 2=1; 3=2; 4=3")

ALSA_dep$nmiss <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(is.na(x)))


ALSA_dep$final_score <- apply(ALSA_dep[,22:41], MARGIN = 1, FUN = function(x) sum(x, na.rm = TRUE))


ALSA_dep$final_score[which(ALSA_dep$nmiss==3)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==3)]/17)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==2)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==2)]/18)*20
ALSA_dep$final_score[which(ALSA_dep$nmiss==1)] <- (ALSA_dep$final_score[which(ALSA_dep$nmiss==1)]/19)*20

ALSA_dep$final_score[which(ALSA_dep$nmiss>4)] <- 999

ALSA_ds_w13 <- tibble(id=ALSA_dep$id)
ALSA_ds_w13$depression <- car::recode(ALSA_dep$final_score, "0:15.99999999=0; 16:900=1")
ALSA_ds_w13$depression <- labelled(ALSA_ds_w13[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript13, echo=FALSE}
vari <- ALSA_ds_w13$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(ALSA_ds_w13, aes(x=factor(ALSA_ds_w13[[2]]))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation13, echo=FALSE}
BeforeH <- c(sum(na.omit(ALSA_dep$final_score)<16), sum(na.omit(ALSA_dep$final_score)>=16 & na.omit(ALSA_dep$final_score)<900), sum(na.omit(ALSA_dep$final_score)==999))
AfterH <- table(ALSA_ds_w13[[2]], useNA = "ifany")
C <- rbind(BeforeH,AfterH)
colnames(C) <- c("<16->0",">=16->1", "NA->999") 
kable(C)
```

```{r importOPAL13, echo=FALSE}
label(ALSA_ds_w13$depression) <- ds_label_all
depression <- ALSA_ds_w13
save(depression, file = "../RData/w13/depression.RData")
rm(depression, ALSA_dep)
```

 


# Quality estimation

They used the Center for Epidemiologic Studies Depression Scale (CES-D). 20-ITEM VERSION

Harmonized depression variable is available for the following waves: 1, 3, 6, 7, 9, 11, 12 and 13.
For w1 and w3 the total score variable was available, thus we used it to get the harmonized variable. 
For the other waves, we took the single items to get the harmonized variable taking into account the reversed items and the optimal cut-off score of the scale (The possible scores range from 0  60. Higher scores indicate greater degrees of depressed mood. score =16)
For the missing values we follow this directions: score the completed items divided by the number of items answered and multiplied by 20. 

```{r closeRsession, echo=FALSE} 
opal.logout(o)
```