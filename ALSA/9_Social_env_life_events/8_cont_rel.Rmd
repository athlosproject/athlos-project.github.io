---
title: "Are any form of contact ( face-to-face/phone/mail/Internet communicators) with family members/relatives frequent (i.e. contact once a week or more often)?"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 
<!-- # Installation, loading packages -->
```{r setup, include=FALSE}
source("../../setup_iago.r")
```
<!-- ########################################################## --> 
<!-- # Loading DS description -->
```{r main, child='../../_DS_Rmd/cont_relDS.Rmd'}
```
```{r global, echo=F}
source('../../_DS_Rmd/cont_relDS.R')
```

<!-- ########################################################## --> 

# Data process


## Australia

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `RELAT0` UP TO `RELAT9`
* Label: `Household Relationships`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:         
    + `99 = Missing`


* Name: `CONTOTHR`
* Label: `(Apart from any child or children, children-in-law, or grandchildren) about how often do you spend some time with family or relatives who do not live with you?`
* Categories:
    + `1 = Amost every day`
    + `2 = A few times a week`
    + `3 = Once a week`
    + `4 = Few times a month`
    + `5 = Once a month`
    + `6 = Every few months`
    + `7 = Once a year`
    + `8 = Less often`
    + `9 = Never`
* Missings:
    + `99 = Missing`

* Name: `CONTCHLD`
* Label: `Think of your children and/or children-in-law who do not live with you. In the past twelve months, how often did you have personal contact with at least one of them?`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `9 = Missing`

* Name: `CONTGDCH`
* Label: `Think of your grandchildren (who do not live with you). In the past twelve months, how often did you have personal contact with at least one of them?`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `9 = Missing`
    
* Name: `PHOTHRRL`
* Label: `Phone contact with relatives`
* Categories:
    + `1 = Amost every day`
    + `2 = A few times a week`
    + `3 = Once a week`
    + `4 = Few times a month`
    + `5 = Once a month`
    + `6 = Every few months`
    + `7 = Once a year`
    + `8 = Less often`
    + `9 = Never`
* Missings:
    + `99 = Missing`
    

* Name: `PHCNCHLD`
* Label: `Phone contact with children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `9 = Missing`
    

* Name: `PHCNGDCH`
* Label: `Phone contact with grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `9 = Missing`


* Name: `MLFRCHLD`
* Label: `Mail from children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `9 = Missing`


* Name: `MLFRGDCH`
* Label: `Mail from grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `9 = Missing`


* Description: 
```{r assign1, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_cont_rel','ALSA.ALSA-Wave1', 
                        variables=list('RELAT0','RELAT1','RELAT2','RELAT3','RELAT4','RELAT5',
                                       'RELAT6','RELAT7','RELAT8','RELAT9', 'CONTOTHR','CONTCHLD','CONTGDCH',
                                       'PHOTHRRL','PHCNCHLD','PHCNGDCH','MLFRCHLD','MLFRGDCH'), missings = TRUE)
```

```{r local1, echo=F}
ALSA_w1_cont_rel <- opal.execute(o,'ALSA_w1_cont_rel')

vari <-  ALSA_w1_cont_rel$RELAT0
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT0))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT1
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT1))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT2
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <-  ALSA_w1_cont_rel$RELAT8
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")


vari <-  ALSA_w1_cont_rel$RELAT9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w1_cont_rel$RELAT0, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(RELAT9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <- ALSA_w1_cont_rel$CONTOTHR
kable(Categorical_summary(vari, missing_values = c(9, 99))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9, 99))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9, 99))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w1_cont_rel$CONTOTHR, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(CONTOTHR))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with relatives (other than children/grandchildren/family living with you)") + ylab("Frequency")



vari <- ALSA_w1_cont_rel$CONTCHLD
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w1_cont_rel$CONTCHLD, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(CONTCHLD))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with children (not living with you)") + ylab("Frequency")

vari <- ALSA_w1_cont_rel$CONTGDCH
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w1_cont_rel$CONTGDCH, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(CONTGDCH))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with grandchildren (not living with you)") + ylab("Frequency")

vari <- ALSA_w1_cont_rel$PHOTHRRL
kable(Categorical_summary(vari, missing_values = c(9,99))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9,99))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9,99))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w1_cont_rel$PHOTHRRL, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(PHOTHRRL))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with relatives") + ylab("Frequency")


vari <- ALSA_w1_cont_rel$PHCNCHLD
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w1_cont_rel$PHCNCHLD, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(PHCNCHLD))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone ontact with children") + ylab("Frequency")

vari <- ALSA_w1_cont_rel$PHCNGDCH
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w1_cont_rel$PHCNGDCH, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(PHCNGDCH))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with grandchildren") + ylab("Frequency")

vari <- ALSA_w1_cont_rel$MLFRCHLD
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9))[2], caption = "Type of missing")
#(var = ALSA_w1_cont_rel$MLFRCHLD, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(MLFRCHLD))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from children") + ylab("Frequency")

vari <- ALSA_w1_cont_rel$MLFRGDCH
kable(Categorical_summary(vari, missing_values = c(9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(9))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w1_cont_rel$MLFRGDCH, missing_values = NA)
ggplot(ALSA_w1_cont_rel, aes(x=factor(MLFRGDCH))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from grandchildren") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

First of all, an auxiliar variable home_rel (Are living in home with family members/relatives (= daily contact with family member)?) is created. It takes value 1 if answer is yes and 0 if not.
* `if any of RELAT0,...,RELAT9 equals one of 1,...,15 - then recode into 1`
* `if all of RELAT0,...,RELAT9 not in 1,...15 - then recode into 0`
* `99 relat0..9 or NA into 999`

Then, the variable is created as follows:
* `if 'CONTOTHR' is in 1:5 or any of 'CONTCHLD','CONTGDCH' is in 1:4 or home_rel is 1 or 'PHOTHRRL' in 1:5 or 'PHCNCHLD','PHCNGDCH','MLFRCHLD','MLFRGDCH' in 1:4- then recode into 1`
* `if 'CONTOTHR' is in 6:9 and both 'CONTCHLD','CONTGDCH' are in 5:6 and home_rel is 0 and 'PHOTHRRL' in 6:9  and all 'PHCNCHLD','PHCNGDCH','MLFRCHLD','MLFRGDCH' in 5:6 - then recode into 0`
* `9 child/grandchild or 99 relatives or 99 relat0..9 or NA into 999`




**R script:**

```{r harmo1, echo=TRUE}
ALSA_ds_w1 <- tibble(id=ALSA_w1_cont_rel$id)

# AUXILIAR VARIABLE
ALSA_w1_cont_rel$RELAT0 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT0), "NA='-999'")
ALSA_w1_cont_rel$RELAT1 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT1), "NA='-999'")
ALSA_w1_cont_rel$RELAT2 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT2), "NA='-999'")
ALSA_w1_cont_rel$RELAT3 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT3), "NA='-999'")
ALSA_w1_cont_rel$RELAT4 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT4), "NA='-999'")
ALSA_w1_cont_rel$RELAT5 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT5), "NA='-999'")
ALSA_w1_cont_rel$RELAT6 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT6), "NA='-999'")
ALSA_w1_cont_rel$RELAT7 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT7), "NA='-999'")
ALSA_w1_cont_rel$RELAT8 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT8), "NA='-999'")
ALSA_w1_cont_rel$RELAT9 <- car::recode(as.vector(ALSA_w1_cont_rel$RELAT9), "NA='-999'")

ALSA_ds_w1$home_rel <- c(NA)  
for(i in 1:dim(ALSA_w1_cont_rel)[1]){
  if( ALSA_w1_cont_rel$RELAT0[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT1[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT2[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT3[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT4[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT5[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT6[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT7[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT8[i] %in% c(1:15) | 
      ALSA_w1_cont_rel$RELAT9[i] %in% c(1:15) ) {
    ALSA_ds_w1$home_rel[i] = 1 }
    else if(ALSA_w1_cont_rel$RELAT0[i] %in% c(99, -999) &
            ALSA_w1_cont_rel$RELAT1[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT2[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT3[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT4[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT5[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT6[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT7[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT8[i] %in% c(99, -999) & 
            ALSA_w1_cont_rel$RELAT9[i] %in% c(99, -999) ) {
    ALSA_ds_w1$home_rel[i] = 999 }
  else if( !( ALSA_w1_cont_rel$RELAT0[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT1[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT2[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT3[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT4[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT5[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT6[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT7[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT8[i] %in% c(1:15) | 
              ALSA_w1_cont_rel$RELAT9[i] %in% c(1:15) ) ) {
    ALSA_ds_w1$home_rel[i] = 0 }
}

ALSA_ds_w1$home_rel <- car::recode(as.vector(ALSA_ds_w1$home_rel), "NA='999'")
ALSA_ds_w1$home_rel <- labelled(ALSA_ds_w1$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))


# CONT_REL VARIABLE

ALSA_w1_cont_rel$CONTOTHR <- car::recode(as.vector(ALSA_w1_cont_rel$CONTOTHR), "NA='-999'")
ALSA_w1_cont_rel$CONTCHLD <- car::recode(as.vector(ALSA_w1_cont_rel$CONTCHLD), "NA='-999'")
ALSA_w1_cont_rel$CONTGDCH <- car::recode(as.vector(ALSA_w1_cont_rel$CONTGDCH), "NA='-999'")
ALSA_w1_cont_rel$PHOTHRRL <- car::recode(as.vector(ALSA_w1_cont_rel$PHOTHRRL), "NA='-999'")
ALSA_w1_cont_rel$PHCNCHLD <- car::recode(as.vector(ALSA_w1_cont_rel$PHCNCHLD), "NA='-999'")
ALSA_w1_cont_rel$PHCNGDCH <- car::recode(as.vector(ALSA_w1_cont_rel$PHCNGDCH), "NA='-999'")
ALSA_w1_cont_rel$MLFRCHLD <- car::recode(as.vector(ALSA_w1_cont_rel$MLFRCHLD), "NA='-999'")
ALSA_w1_cont_rel$MLFRGDCH <- car::recode(as.vector(ALSA_w1_cont_rel$MLFRGDCH), "NA='-999'")

ALSA_w1_cont_rel2 <- left_join(ALSA_w1_cont_rel, ALSA_ds_w1, by='id')

ALSA_ds_w1$cont_rel <- c(NA) 
for(i in 1:dim(ALSA_w1_cont_rel2)[1]){
  if( ALSA_w1_cont_rel2$CONTOTHR[i] %in% c(1,2,3,4,5) | 
      ALSA_w1_cont_rel2$CONTCHLD[i] %in% c(1,2,3,4) | 
      ALSA_w1_cont_rel2$CONTGDCH[i] %in% c(1,2,3,4) |
      ALSA_w1_cont_rel2$home_rel[i] == 1|
      ALSA_w1_cont_rel2$PHOTHRRL[i] %in% c(1,2,3,4,5) | 
      ALSA_w1_cont_rel2$PHCNCHLD[i] %in% c(1,2,3,4) | 
      ALSA_w1_cont_rel2$PHCNGDCH[i] %in% c(1,2,3,4) |
      ALSA_w1_cont_rel2$MLFRCHLD[i] %in% c(1,2,3,4) | 
      ALSA_w1_cont_rel2$MLFRGDCH[i] %in% c(1,2,3,4)) {
  ALSA_ds_w1$cont_rel[i] = 1 }
  else if( ALSA_w1_cont_rel2$CONTOTHR[i] %in% c(6,7,8,9) & 
           ALSA_w1_cont_rel2$CONTCHLD[i] %in% c(5,6) & 
           ALSA_w1_cont_rel2$CONTGDCH[i] %in% c(5,6) &
           ALSA_w1_cont_rel2$home_rel[i] == 0 &
           ALSA_w1_cont_rel2$PHOTHRRL[i] %in% c(6,7,8,9) & 
           ALSA_w1_cont_rel2$PHCNCHLD[i] %in% c(5,6) & 
           ALSA_w1_cont_rel2$PHCNGDCH[i] %in% c(5,6) &
           ALSA_w1_cont_rel2$MLFRCHLD[i] %in% c(5,6) & 
           ALSA_w1_cont_rel2$MLFRGDCH[i] %in% c(5,6)) {
    ALSA_ds_w1$cont_rel[i] = 0 }
  else if( ALSA_w1_cont_rel2$CONTOTHR[i] == 99 | 
           ALSA_w1_cont_rel2$CONTCHLD[i] %in% c(9, 99) | 
           ALSA_w1_cont_rel2$CONTGDCH[i] %in% c(9, 99) |
           ALSA_w1_cont_rel2$home_rel[i] %nin% c(0,1)|
           ALSA_w1_cont_rel2$PHOTHRRL[i] == 99 | 
           ALSA_w1_cont_rel2$PHCNCHLD[i] == 9 | 
           ALSA_w1_cont_rel2$PHCNGDCH[i] == 9 |
          ALSA_w1_cont_rel2$MLFRCHLD[i] == 9 | 
          ALSA_w1_cont_rel2$MLFRGDCH[i] == 9) {
    ALSA_ds_w1$cont_rel[i] = 999 }
}


ALSA_ds_w1$cont_rel <- car::recode(as.vector(ALSA_ds_w1$cont_rel), "NA='999'")
ALSA_ds_w1$cont_rel <- labelled(ALSA_ds_w1$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1, echo=F}
vari <- ALSA_ds_w1$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w1$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w1, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1, echo=F}

```

 

### Wave2

#### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `RELAT0`,...,`RELAT9` ***from ALSA.ALSA-Wave1***
* Label: `Household Relationships`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:         
    + `99 = Missing`


* Name: `Q2`
* Label: `People still living with you?`
* Categories:
    + `1 = Yes`
    + `2 = No`
    
* Name: `Q2A`
* Label: `Anyone else now living in your household?`
* Categories:
    + `1 = Yes`
    + `2 = No` 
     
* Name: `X27`, `X31` - new people; `X10`, `X14` - people moved out
* Label: `Relationship`
* Categories:
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`   


* Description: 
```{r assign2, echo=F}
opal.assign.table.tibble(o, 'ALSA_w2_cont_rel','ALSA.ALSA-Wave2',variables=list('Q2','Q2A','X10','X14','X27','X31'), missings = TRUE)
```

```{r local2, echo=F}
ALSA_w2_cont_rel <- opal.execute(o,'ALSA_w2_cont_rel')

vari <- ALSA_w2_cont_rel$Q2
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_cont_rel$Q2, missing_values = NA)
ggplot(ALSA_w2_cont_rel, aes(x=factor(Q2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("People still living with you?") + ylab("Frequency")

vari <- ALSA_w2_cont_rel$Q2A
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_cont_rel$Q2A, missing_values = NA)
ggplot(ALSA_w2_cont_rel, aes(x=factor(Q2A))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Anyone else now living in your household?") + ylab("Frequency")

vari <- ALSA_w2_cont_rel$X10
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_cont_rel$X10, missing_values = NA)
ggplot(ALSA_w2_cont_rel, aes(x=factor(X10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")


vari <- ALSA_w2_cont_rel$X14
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_cont_rel$X10, missing_values = NA)
ggplot(ALSA_w2_cont_rel, aes(x=factor(X14))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")


vari <- ALSA_w2_cont_rel$X27
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_cont_rel$X10, missing_values = NA)
ggplot(ALSA_w2_cont_rel, aes(x=factor(X27))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")


vari <- ALSA_w2_cont_rel$X31
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_cont_rel$X10, missing_values = NA)
ggplot(ALSA_w2_cont_rel, aes(x=factor(X31))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:


* `if any of relat0,..,relat9 in 1,..,15 and Q2=1 - into 1`
* `else if Q2A=1 and any of X27, X31 is in 1,..,15 - into 1`
* `else if Q2=2 and N = number of relat0,..,relat9 not empty and: `
    `if N=1 and RELAT0=X10 in 1,..,15 - into 0`
    `if N=2 and X10 AND X14 in 1,..,15 - into 0`
    `if N=3 and X10 AND X14 in 1,..,15 - into 0`
    `if N=4 and X10 AND X14 in 1,..,15 - into 0`
* `else if Q2A=1 and both X27 AND X31 not in 1,..,15 - into 0`
* `NA into 999`

Note that in this wave only information about housebold is available.

**R script:**

```{r harmo2, echo=TRUE}
ALSA_w2_cont_rel_2 <- left_join(ALSA_w2_cont_rel,ALSA_w1_cont_rel, by='id')

ALSA_ds_w2 <- tibble(id=ALSA_w2_cont_rel_2$id)

ALSA_w2_cont_rel_2$Q2 <- car::recode(as.vector(ALSA_w2_cont_rel_2$Q2), "NA='-999'")
ALSA_w2_cont_rel_2$Q2A <- car::recode(as.vector(ALSA_w2_cont_rel_2$Q2A), "NA='-999'")
ALSA_w2_cont_rel_2$X10 <- car::recode(as.vector(ALSA_w2_cont_rel_2$X10), "NA='-999'")
ALSA_w2_cont_rel_2$X14 <- car::recode(as.vector(ALSA_w2_cont_rel_2$X14), "NA='-999'")
ALSA_w2_cont_rel_2$X27 <- car::recode(as.vector(ALSA_w2_cont_rel_2$X27), "NA='-999'")
ALSA_w2_cont_rel_2$X31 <- car::recode(as.vector(ALSA_w2_cont_rel_2$X31), "NA='-999'")
ALSA_w2_cont_rel_2$RELAT0 <- car::recode(as.vector(ALSA_w2_cont_rel_2$RELAT0), "NA='-999'")
ALSA_w2_cont_rel_2$RELAT1 <- car::recode(as.vector(ALSA_w2_cont_rel_2$RELAT1), "NA='-999'")
ALSA_w2_cont_rel_2$RELAT2 <- car::recode(as.vector(ALSA_w2_cont_rel_2$RELAT2), "NA='-999'")
ALSA_w2_cont_rel_2$RELAT3 <- car::recode(as.vector(ALSA_w2_cont_rel_2$RELAT3), "NA='-999'")
ALSA_w2_cont_rel_2$RELAT4 <- car::recode(as.vector(ALSA_w2_cont_rel_2$RELAT4), "NA='-999'")
ALSA_w2_cont_rel_2$RELAT5 <- car::recode(as.vector(ALSA_w2_cont_rel_2$RELAT5), "NA='-999'")


# firstly I will count how many of relat0,..,relat9 are in 1:15 (it will help later):
ALSA_w2_cont_rel_2$count_rel <- c(NA)
for(i in 1:dim(ALSA_w2_cont_rel_2[1])){
  if( ALSA_w2_cont_rel_2$RELAT0[i] %in% c(1:15) ) { ALSA_w2_cont_rel_2$count_rel[i]=1 }
  if( ALSA_w2_cont_rel_2$RELAT1[i] %in% c(1:15) ) { ALSA_w2_cont_rel_2$count_rel[i]=ALSA_w2_cont_rel_2$count_rel[i]+1 }
  if( ALSA_w2_cont_rel_2$RELAT2[i] %in% c(1:15) ) { ALSA_w2_cont_rel_2$count_rel[i]=ALSA_w2_cont_rel_2$count_rel[i]+1 }
  if( ALSA_w2_cont_rel_2$RELAT3[i] %in% c(1:15) ) { ALSA_w2_cont_rel_2$count_rel[i]=ALSA_w2_cont_rel_2$count_rel[i]+1 }
  if( ALSA_w2_cont_rel_2$RELAT4[i] %in% c(1:15) ) { ALSA_w2_cont_rel_2$count_rel[i]=ALSA_w2_cont_rel_2$count_rel[i]+1 }
  if( ALSA_w2_cont_rel_2$RELAT5[i] %in% c(1:15) ) { ALSA_w2_cont_rel_2$count_rel[i]=ALSA_w2_cont_rel_2$count_rel[i]+1 }
}
ALSA_w2_cont_rel_2$count_rel <- car::recode(as.vector(ALSA_w2_cont_rel_2$count_rel), "NA='-999'")
# ALSA_ds_w2$count_rel - column with number of relatives living with resp. in the previous wave

#Categorical_summary(var = ALSA_w2_cont_rel_2$count_rel, missing_values = NA)

ALSA_ds_w2$home_rel <- c(NA)
for(i in 1:dim(ALSA_w2_cont_rel_2[1])){
  
  # all people still living with respondent and somebody is a relative:
  if( ALSA_w2_cont_rel_2$Q2[i] == 1 & ALSA_w2_cont_rel_2$count_rel[i] > 0 ) { 
    ALSA_ds_w2$home_rel[i] = 1 }
  
  # there are some new relatives living with respondent:
  else if( ALSA_w2_cont_rel_2$Q2A[i] == 1 & 
      ( ALSA_w2_cont_rel_2$X27[i] %in% c(1:15) | ALSA_w2_cont_rel_2$X31[i] %in% c(1:15) ) ) { 
    ALSA_ds_w2$home_rel[i] = 1 }
  
  # somebody moved out/deceased, but respondent still live with a relative:
  
      # none of people moving out is a relative:
      else if( ALSA_w2_cont_rel_2$Q2[i] == 2 & ALSA_w2_cont_rel_2$count_rel[i] > 0 &
           !( ALSA_w2_cont_rel_2$X10[i] %in% c(1:15) | ALSA_w2_cont_rel_2$X14[i] %in% c(1:15) ) ) {
        ALSA_ds_w2$home_rel[i] = 1 }
      # 1 relative out:
      else if( ALSA_w2_cont_rel_2$Q2[i] == 2 & ALSA_w2_cont_rel_2$count_rel[i] > 1 &
           (
        (ALSA_w2_cont_rel_2$X10[i] %in% c(1:15) & !( ALSA_w2_cont_rel_2$X14[i] %in% c(1:15) ))
           ) ) {
        ALSA_ds_w2$home_rel[i] = 1 }
      # 2 relatives out:
      else if( ALSA_w2_cont_rel_2$Q2[i] == 2 & ALSA_w2_cont_rel_2$count_rel[i] > 2 &
           (
        (ALSA_w2_cont_rel_2$X10[i] %in% c(1:15) & ALSA_w2_cont_rel_2$X14[i] %in% c(1:15) ) 
           ) ) {
        ALSA_ds_w2$home_rel[i] = 1 }
      
  # 1 relative moved out/deceased and it was the only relative living with respondent:
  else if( ALSA_w2_cont_rel_2$Q2[i] == 2 & ALSA_w2_cont_rel_2$count_rel[i] == 1 &
           (
        (ALSA_w2_cont_rel_2$X10[i] %in% c(1:15) & !( ALSA_w2_cont_rel_2$X14[i] %in% c(1:15))
        )
           ) ) { 
    ALSA_ds_w2$home_rel[i] = 0 }
  
  # 2 relatives moved out and they were only relatives living with respondent:
  else if( ALSA_w2_cont_rel_2$Q2[i] == 2 & ALSA_w2_cont_rel_2$count_rel[i] == 2 &
           (
        (ALSA_w2_cont_rel_2$X10[i] %in% c(1:15) & ALSA_w2_cont_rel_2$X14[i] %in% c(1:15) ) 
           ) ) { 
    ALSA_ds_w2$home_rel[i] = 0 }
  
  # there are some new people living with respondent, but they are not relatives:
  else if( ALSA_w2_cont_rel_2$Q2A[i] == 1 & 
      !(ALSA_w2_cont_rel_2$X27[i] %in% c(1:15) | ALSA_w2_cont_rel_2$X31[i] %in% c(1:15) ) ) { 
        ALSA_ds_w2$home_rel[i] = 0 }
}

ALSA_ds_w2$home_rel <- car::recode(as.vector(ALSA_ds_w2$home_rel), "NA='999'")
ALSA_ds_w2$home_rel <- labelled(ALSA_ds_w2$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

ALSA_ds_w2$cont_rel <- ALSA_ds_w2$home_rel

```

#### Statistical description of the new harmonised variable
```{r descript2, echo=F}
vari <- ALSA_ds_w2$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w2$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w2, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are living in home with family members/relatives (= daily contact with family member)?") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2, echo=F}

```

 


### Wave 3

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `RELAT1W3`,...,`RELAT6W3`
* Label: `Household Relationships`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:         
    + `99 = Missing`

* Name: `CONTCHW3`
* Label: `Think of your children and/or children-in-law who do not live with you. In the past twelve months, how often did you have PERSONAL CONTACT with at least one of them?`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
    + `9=?`

* Name: `CONTGDW3`
* Label: `Think of your grandchildren (who do not live with you). In the past twelve months, how often did you have PERSONAL CONTACT with at least one of them?`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
    + `9=?`
    
* Name: `PHCNCHW3`
* Label: `Phone contact with children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`

* Name: `PHCNGDW3`
* Label: `Phone contact with grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`

* Name: `MLFRCHW3`
* Label: `Mail from children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`

* Name: `MLFRGDW3`
* Label: `Mail from grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`


* Description: 
```{r assign3, echo=F}
opal.assign.table.tibble(o, 'ALSA_w3_cont_rel','ALSA.ALSA-Wave3', 
                        variables=list('RELAT1W3','RELAT2W3','RELAT3W3','RELAT4W3','RELAT5W3','RELAT6W3', 
                                       'CONTCHW3','CONTGDW3', 
                                       'PHCNCHW3','PHCNGDW3','MLFRCHW3','MLFRGDW3'), missings = TRUE)
```

```{r local3, echo=F}
ALSA_w3_cont_rel <- opal.execute(o,'ALSA_w3_cont_rel')


vari <- ALSA_w3_cont_rel$RELAT1W3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_cont_rel$RELAT1W3, missing_values = NA)
ggplot(ALSA_w3_cont_rel, aes(x=factor(RELAT1W3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <- ALSA_w3_cont_rel$RELAT2W3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_cont_rel$RELAT1W3, missing_values = NA)
ggplot(ALSA_w3_cont_rel, aes(x=factor(RELAT1W3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <- ALSA_w3_cont_rel$RELAT1W3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_cont_rel$RELAT1W3, missing_values = NA)
ggplot(ALSA_w3_cont_rel, aes(x=factor(RELAT2W3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <- ALSA_w3_cont_rel$RELAT3W3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_cont_rel$RELAT1W3, missing_values = NA)
ggplot(ALSA_w3_cont_rel, aes(x=factor(RELAT3W3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <- ALSA_w3_cont_rel$RELAT4W3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_cont_rel$RELAT1W3, missing_values = NA)
ggplot(ALSA_w3_cont_rel, aes(x=factor(RELAT4W3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <- ALSA_w3_cont_rel$RELAT5W3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_cont_rel$RELAT1W3, missing_values = NA)
ggplot(ALSA_w3_cont_rel, aes(x=factor(RELAT5W3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")

vari <- ALSA_w3_cont_rel$RELAT6W3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_cont_rel$RELAT1W3, missing_values = NA)
ggplot(ALSA_w3_cont_rel, aes(x=factor(RELAT6W3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Household Relationships") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

First of all, an auxiliar variable home_rel (Are living in home with family members/relatives (= daily contact with family member)?) is created. It takes value 1 if answer is yes and 0 if not.
* `if any of RELAT1W3,..,RELAT6W3 is in 1:15 then recode into 1`
* `ELSE if all are NA's then 999`
* `ELSE if all of RELAT1W3,..,RELAT6W3 are not in 1:15 then recode into 0`
* `NA into 999`

Then, the variable is created as follows:

* `if any of 'CONTCHW3','CONTGDW3', 'PHCNCHW3','PHCNGDW3','MLFRCHW3','MLFRGDW3' are in 1:4 or home_rel is 1 - then recode into 1`
* `if if all of 'CONTCHW3','CONTGDW3', 'PHCNCHW3','PHCNGDW3','MLFRCHW3','MLFRGDW3' are in 5:6 and home_rel is 0 - then recode into 0`
* `9  or NA into 999`






**R script:**

```{r harmo3, echo=TRUE}
ALSA_ds_w3 <- tibble(id=ALSA_w3_cont_rel$id)

ALSA_w3_cont_rel$RELAT1W3 <- car::recode(as.vector(ALSA_w3_cont_rel$RELAT1W3), "NA='-999'")
ALSA_w3_cont_rel$RELAT2W3 <- car::recode(as.vector(ALSA_w3_cont_rel$RELAT2W3), "NA='-999'")
ALSA_w3_cont_rel$RELAT3W3 <- car::recode(as.vector(ALSA_w3_cont_rel$RELAT3W3), "NA='-999'")
ALSA_w3_cont_rel$RELAT4W3 <- car::recode(as.vector(ALSA_w3_cont_rel$RELAT4W3), "NA='-999'")
ALSA_w3_cont_rel$RELAT5W3 <- car::recode(as.vector(ALSA_w3_cont_rel$RELAT5W3), "NA='-999'")
ALSA_w3_cont_rel$RELAT6W3 <- car::recode(as.vector(ALSA_w3_cont_rel$RELAT6W3), "NA='-999'")

# AUXILIAR VARIABLE
ALSA_ds_w3$home_rel <- c(NA) 
for(i in 1:dim(ALSA_w3_cont_rel)[1]){
  if( ALSA_w3_cont_rel$RELAT1W3[i] %in% c(1:15) | 
      ALSA_w3_cont_rel$RELAT2W3[i] %in% c(1:15) |
      ALSA_w3_cont_rel$RELAT3W3[i] %in% c(1:15) | 
      ALSA_w3_cont_rel$RELAT4W3[i] %in% c(1:15) |
      ALSA_w3_cont_rel$RELAT5W3[i] %in% c(1:15) | 
      ALSA_w3_cont_rel$RELAT6W3[i] %in% c(1:15) ) {
  ALSA_ds_w3$home_rel[i] = 1 }
  else if( ALSA_w3_cont_rel$RELAT1W3[i] == -999 & 
           ALSA_w3_cont_rel$RELAT2W3[i] == -999 &
           ALSA_w3_cont_rel$RELAT3W3[i] == -999 & 
           ALSA_w3_cont_rel$RELAT4W3[i] == -999 &
           ALSA_w3_cont_rel$RELAT5W3[i] == -999 & 
           ALSA_w3_cont_rel$RELAT6W3[i] == -999 ) {
  ALSA_ds_w3$home_rel[i] = 999 }
  else if( !( ALSA_w3_cont_rel$RELAT1W3[i] %in% c(1:15) | 
              ALSA_w3_cont_rel$RELAT2W3[i] %in% c(1:15) |
              ALSA_w3_cont_rel$RELAT3W3[i] %in% c(1:15) | 
              ALSA_w3_cont_rel$RELAT4W3[i] %in% c(1:15) |
              ALSA_w3_cont_rel$RELAT5W3[i] %in% c(1:15) | 
              ALSA_w3_cont_rel$RELAT6W3[i] %in% c(1:15) ) ) {
  ALSA_ds_w3$home_rel[i] = 0 }
}

ALSA_ds_w3$home_rel <- car::recode(as.vector(ALSA_ds_w3$home_rel), "NA='999'")
ALSA_ds_w3$home_rel <- labelled(ALSA_ds_w3$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

# CONT_REL VARIABLE
ALSA_w3_cont_rel$CONTCHW3 <- car::recode(as.vector(ALSA_w3_cont_rel$CONTCHW3), "NA='-999'")
ALSA_w3_cont_rel$CONTGDW3 <- car::recode(as.vector(ALSA_w3_cont_rel$CONTGDW3), "NA='-999'")
ALSA_w3_cont_rel$PHCNCHW3 <- car::recode(as.vector(ALSA_w3_cont_rel$PHCNCHW3), "NA='-999'")
ALSA_w3_cont_rel$PHCNGDW3 <- car::recode(as.vector(ALSA_w3_cont_rel$PHCNGDW3), "NA='-999'")
ALSA_w3_cont_rel$MLFRCHW3 <- car::recode(as.vector(ALSA_w3_cont_rel$MLFRCHW3), "NA='-999'")
ALSA_w3_cont_rel$MLFRGDW3 <- car::recode(as.vector(ALSA_w3_cont_rel$MLFRGDW3), "NA='-999'")


ALSA_w3_cont_rel2 <- left_join(ALSA_w3_cont_rel, ALSA_ds_w3, by='id')

ALSA_ds_w3$cont_rel <- c(NA) 
for(i in 1:dim(ALSA_w3_cont_rel)[1]){
  if( ALSA_w3_cont_rel2$CONTCHW3[i] %in% c(1,2,3,4) | 
      ALSA_w3_cont_rel2$CONTGDW3[i] %in% c(1,2,3,4) |
      ALSA_w3_cont_rel2$home_rel[i] == 1|
      ALSA_w3_cont_rel2$PHCNCHW3[i] %in% c(1,2,3,4) | 
      ALSA_w3_cont_rel2$PHCNGDW3[i] %in% c(1,2,3,4) | 
      ALSA_w3_cont_rel2$MLFRGDW3[i] %in% c(1,2,3,4) |
      ALSA_w3_cont_rel2$MLFRGDW3[i] %in% c(1,2,3,4) ) {
    ALSA_ds_w3$cont_rel[i] = 1 }
  else if( ALSA_w3_cont_rel2$CONTCHW3[i] %in% c(5,6) & 
           ALSA_w3_cont_rel2$CONTGDW3[i] %in% c(5,6) &
           ALSA_w3_cont_rel2$home_rel[i] == 0 &
           ALSA_w3_cont_rel2$PHCNCHW3[i] %in% c(5,6) & 
           ALSA_w3_cont_rel2$PHCNGDW3[i] %in% c(5,6) &
           ALSA_w3_cont_rel2$MLFRCHW3[i] %in% c(5,6) & 
           ALSA_w3_cont_rel2$MLFRGDW3[i] %in% c(5,6)) {
    ALSA_ds_w3$cont_rel[i] = 0 }
  else if( ALSA_w3_cont_rel2$CONTCHW3[i] == 9 | 
           ALSA_w3_cont_rel2$CONTGDW3[i] == 9 |
           ALSA_w3_cont_rel2$home_rel %nin% c(0,1)) {
    ALSA_ds_w3$cont_rel[i] = 999 }
}

ALSA_ds_w3$cont_rel <- car::recode(as.vector(ALSA_ds_w3$cont_rel), "NA='999'")
ALSA_ds_w3$cont_rel <- labelled(ALSA_ds_w3$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

```

#### Statistical description of the new harmonised variable
```{r descript3, echo=F}
vari <- ALSA_ds_w3$home_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w3$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w3, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation3, echo=F}

```

 


### Wave 4

#### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `RELAT1W3`,...,`RELAT6W3` ***from ALSA.ALSA-Wave3***
* Label: `Household Relationships`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:         
    + `99 = Missing`

* Name: `CORESW4`
* Label: `People still living with you?`
* Categories:
    + `1 = Yes`
    + `2 = No`

* Name: `NEWRESW4`
* Label: `Is there anyone else now living in your household?`
* Categories:
    + `1 = Yes`
    + `2 = No`

* Name: `NREL1W4`,`NREL2W4`,`NREL3W4`,`NREL4W4`,`NREL5W4`,`CREL1W4`,`CREL2W4`,`CREL3W4`
* Label: `Relationship`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`   


* Description: 
```{r assign4, echo=F}
opal.assign.table.tibble(o, 'ALSA_w4_cont_rel','ALSA.ALSA-Wave4', 
                        variables=list('CORESW4','NEWRESW4','CREL1W4','CREL2W4','CREL3W4',
                                       'NREL1W4','NREL2W4','NREL3W4','NREL4W4','NREL5W4'), missings = TRUE)
```

```{r local4, echo=F}
ALSA_w4_cont_rel <- opal.execute(o,'ALSA_w4_cont_rel')

vari <- ALSA_w4_cont_rel$CORESW4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$CORESW4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(CORESW4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("People still living with you?") + ylab("Frequency")

vari <- ALSA_w4_cont_rel$NEWRESW4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$NEWRESW4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(NEWRESW4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Anyone else now living in your household?") + ylab("Frequency")

vari <- ALSA_w4_cont_rel$CREL1W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$CREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(CREL1W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency") + theme(axis.text.x = element_text(angle = 45, hjust=1, vjust=1))

vari <- ALSA_w4_cont_rel$CREL2W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$CREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(CREL2W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency") + theme(axis.text.x = element_text(angle = 45, hjust=1, vjust=1))

vari <- ALSA_w4_cont_rel$CREL3W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$CREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(CREL3W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency") + theme(axis.text.x = element_text(angle = 45, hjust=1, vjust=1))

vari <- ALSA_w4_cont_rel$NREL1W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$NREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(NREL1W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")

vari <- ALSA_w4_cont_rel$NREL2W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$NREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(NREL2W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")

vari <- ALSA_w4_cont_rel$NREL3W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$NREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(NREL3W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")

vari <- ALSA_w4_cont_rel$NREL4W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$NREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(NREL4W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")

vari <- ALSA_w4_cont_rel$NREL5W4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_cont_rel$NREL1W4, missing_values = NA)
ggplot(ALSA_w4_cont_rel, aes(x=factor(NREL5W4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `all people still living with respondent and somebody is a relative -> 1`
* `there are some new relatives living with respondent -> 1`
* `somebody moved out/deceased, but respondent still live with a relative -> 1`
* `one relative moved out/deceased and it was the only relative living with respondent -> 0`
* `two relatives moved out and they were only relatives living with respondent -> 0`
* `there are some new people living with respondent, but they are not relatives -> 0`
* `NA into 999`
Note that in this wave only information about housebold is available.

**R script:**

```{r harmo4, echo=TRUE}

ALSA_w4_cont_rel_2 <- left_join(ALSA_w4_cont_rel, ALSA_w3_cont_rel, by= 'id')



ALSA_w4_cont_rel_2$CORESW4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$CORESW4), "NA='-999'")
ALSA_w4_cont_rel_2$NEWRESW4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$NEWRESW4), "NA='-999'")
ALSA_w4_cont_rel_2$CREL1W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$CREL1W4), "NA='-999'")
ALSA_w4_cont_rel_2$CREL2W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$CREL2W4), "NA='-999'")
ALSA_w4_cont_rel_2$CREL3W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$CREL3W4), "NA='-999'")
ALSA_w4_cont_rel_2$NREL1W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$NREL1W4), "NA='-999'")
ALSA_w4_cont_rel_2$NREL2W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$NREL2W4), "NA='-999'")
ALSA_w4_cont_rel_2$NREL3W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$NREL3W4), "NA='-999'")
ALSA_w4_cont_rel_2$NREL4W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$NREL4W4), "NA='-999'")
ALSA_w4_cont_rel_2$NREL5W4 <- car::recode(as.vector(ALSA_w4_cont_rel_2$NREL5W4), "NA='-999'")
ALSA_w4_cont_rel_2$RELAT1W3 <- car::recode(as.vector(ALSA_w4_cont_rel_2$RELAT1W3), "NA='-999'")
ALSA_w4_cont_rel_2$RELAT2W3 <- car::recode(as.vector(ALSA_w4_cont_rel_2$RELAT2W3), "NA='-999'")
ALSA_w4_cont_rel_2$RELAT3W3 <- car::recode(as.vector(ALSA_w4_cont_rel_2$RELAT3W3), "NA='-999'")
ALSA_w4_cont_rel_2$RELAT4W3 <- car::recode(as.vector(ALSA_w4_cont_rel_2$RELAT4W3), "NA='-999'")
ALSA_w4_cont_rel_2$RELAT5W3 <- car::recode(as.vector(ALSA_w4_cont_rel_2$RELAT5W3), "NA='-999'")
ALSA_w4_cont_rel_2$RELAT6W3 <- car::recode(as.vector(ALSA_w4_cont_rel_2$RELAT6W3), "NA='-999'")


ALSA_ds_w4 <- tibble(id=ALSA_w4_cont_rel_2$id)
ALSA_ds_w4$count_rel <- c(NA)

# firstly I will count how many of relat1,..,relat6 are in 1:15 (it will help later):
for(i in 1:dim(ALSA_w4_cont_rel_2[1])){
  ALSA_ds_w4$count_rel[i]=0
  if( ALSA_w4_cont_rel_2$RELAT1W3[i] %in% c(1:15) ) { ALSA_ds_w4$count_rel[i]=ALSA_ds_w4$count_rel[i]+1 }
  if( ALSA_w4_cont_rel_2$RELAT2W3[i] %in% c(1:15) ) { ALSA_ds_w4$count_rel[i]=ALSA_ds_w4$count_rel[i]+1 }
  if( ALSA_w4_cont_rel_2$RELAT3W3[i] %in% c(1:15) ) { ALSA_ds_w4$count_rel[i]=ALSA_ds_w4$count_rel[i]+1 }
  if( ALSA_w4_cont_rel_2$RELAT4W3[i] %in% c(1:15) ) { ALSA_ds_w4$count_rel[i]=ALSA_ds_w4$count_rel[i]+1 }
  if( ALSA_w4_cont_rel_2$RELAT5W3[i] %in% c(1:15) ) { ALSA_ds_w4$count_rel[i]=ALSA_ds_w4$count_rel[i]+1 }
  if( ALSA_w4_cont_rel_2$RELAT6W3[i] %in% c(1:15) ) { ALSA_ds_w4$count_rel[i]=ALSA_ds_w4$count_rel[i]+1 }
}
ALSA_ds_w4$count_rel <- car::recode(as.vector(ALSA_ds_w4$count_rel), "NA='-999'")
# ALSA_ds_w4$count_rel - column with number of relatives living with resp. in the previous wave


ALSA_ds_w4$home_rel <- c(NA)
for(i in 1:dim(ALSA_w4_cont_rel_2[1])){
  
  # all people still living with respondent and somebody is a relative:
  if( ALSA_w4_cont_rel_2$CORESW4[i] == 1 & ALSA_ds_w4$count_rel[i] > 0 ) { 
    ALSA_ds_w4$home_rel[i] = 1 }
  
  # there are some new relatives living with respondent:
  else if( ALSA_w4_cont_rel_2$NEWRESW4[i] == 1 & 
      ( ALSA_w4_cont_rel_2$NREL1W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$NREL2W4[i] %in% c(1:15) | 
        ALSA_w4_cont_rel_2$NREL3W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$NREL4W4[i] %in% c(1:15) | 
        ALSA_w4_cont_rel_2$NREL5W4[i] %in% c(1:15) ) ) { 
    ALSA_ds_w4$home_rel[i] = 1 }
  
  # somebody moved out/deceased, but respondent still live with a relative:
  
      # none of crel is a relative:
      else if( ALSA_w4_cont_rel_2$CORESW4[i] == 2 & ALSA_ds_w4$count_rel[i] > 0 &
           !( ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) | 
              ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) ) ) {
        ALSA_ds_w4$home_rel[i] = 1 }
      # 1 relative out:
      else if( ALSA_w4_cont_rel_2$CORESW4[i] == 2 & ALSA_ds_w4$count_rel[i] > 1 &
           (
        (ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & !( ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) )) |
        (ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & !( ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) )) |
        (ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) & !( ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) ))
           ) ) {
        ALSA_ds_w4$home_rel[i] = 1 }
      # 2 relatives out:
      else if( ALSA_w4_cont_rel_2$CORESW4[i] == 2 & ALSA_ds_w4$count_rel[i] > 2 &
           (
        (ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & !(ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15)) ) |
        (ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) & !(ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15)) ) |
        (ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) & !(ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15)) )
           ) ) {
        ALSA_ds_w4$home_rel[i] = 1 }
      # 3 relatives out:
      else if( ALSA_w4_cont_rel_2$CORESW4[i] == 2 & ALSA_ds_w4$count_rel[i] > 3 &
           ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) ) {
        ALSA_ds_w4$home_rel[i] = 1 }
  
  
  # one relative moved out/deceased and it was the only relative living with respondent:
  else if( ALSA_w4_cont_rel_2$CORESW4[i] == 2 & ALSA_ds_w4$count_rel[i] == 1 &
           (
        (ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & !( ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) )) |
        (ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & !( ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) )) |
        (ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) & !( ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) ))
           ) ) { 
    ALSA_ds_w4$home_rel[i] = 0 }
  
  # two relatives moved out and they were only relatives living with respondent:
  else if( ALSA_w4_cont_rel_2$CORESW4[i] == 2 & ALSA_ds_w4$count_rel[i] == 2 &
           (
        (ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & !(ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15)) ) |
        (ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) & !(ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15)) ) |
        (ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) & !(ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15)) )
           ) ) { 
    ALSA_ds_w4$home_rel[i] = 0 }
  
  # three relatives moved out and they were only relatives living with respondent:
  else if( ALSA_w4_cont_rel_2$CORESW4[i] == 2 & ALSA_ds_w4$count_rel[i] == 3 &
           ALSA_w4_cont_rel_2$CREL1W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL2W4[i] %in% c(1:15) & ALSA_w4_cont_rel_2$CREL3W4[i] %in% c(1:15) ) { 
    ALSA_ds_w4$home_rel[i] = 0 }
  
  # there are some new people living with respondent, but they are not relatives:
  else if( ALSA_w4_cont_rel_2$NEWRESW4[i] == 1 & 
      !(ALSA_w4_cont_rel_2$NREL1W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$NREL2W4[i] %in% c(1:15) |
        ALSA_w4_cont_rel_2$NREL3W4[i] %in% c(1:15) | ALSA_w4_cont_rel_2$NREL4W4[i] %in% c(1:15) |
        ALSA_w4_cont_rel_2$NREL5W4[i] %in% c(1:15) ) ) { 
        ALSA_ds_w4$home_rel[i] = 0 }
}

ALSA_ds_w4$home_rel <- car::recode(as.vector(ALSA_ds_w4$home_rel), "NA='999'")
ALSA_ds_w4$home_rel <- labelled(ALSA_ds_w4$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

ALSA_ds_w4$cont_rel <- ALSA_ds_w4$home_rel
```

#### Statistical description of the new harmonised variable
```{r descript4, echo=F}
vari <- ALSA_ds_w4$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w4$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w4, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation4, echo=F}

```

 


### Wave 5

#### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `CORESW5`
* Label: `People still living with you?`
* Categories:
    + `1 = Yes`
    + `2 = No`
* Missings:
    + `3 = Refused/Dont know (do not read)`

* Name: `NEWRE1W5`,`NEWRE2W5`,`NEWRE3W5`,`NEWRE4W5`
* Label: ` Q2A IS THERE ANYONE ELSE NOW LIVING - Relationship`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`   

* Name: `home_rel` from Wave4

* Description: 
```{r assign5, echo=F}
opal.assign.table.tibble(o, 'ALSA_W5_cont_rel','ALSA.ALSA-Wave5', 
                        variables=list('CORESW5','NEWRE1W5','NEWRE2W5','NEWRE3W5','NEWRE4W5'), missings = TRUE)
```

```{r local5, echo=F}
ALSA_W5_cont_rel <- opal.execute(o,'ALSA_W5_cont_rel')

vari <- ALSA_W5_cont_rel$CORESW5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_W5_cont_rel$CORESW5, missing_values = NA)
ggplot(ALSA_W5_cont_rel, aes(x=factor(CORESW5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("People still living with you?") + ylab("Frequency")


vari <- ALSA_W5_cont_rel$NEWRE1W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_W5_cont_rel$NEWRE1W5, missing_values = NA)
ggplot(ALSA_W5_cont_rel, aes(x=factor(NEWRE1W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Anyone else now living in your household?") + ylab("Frequency")

vari <- ALSA_W5_cont_rel$NEWRE2W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_W5_cont_rel$NEWRE1W5, missing_values = NA)
ggplot(ALSA_W5_cont_rel, aes(x=factor(NEWRE2W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Anyone else now living in your household?") + ylab("Frequency")

vari <- ALSA_W5_cont_rel$NEWRE3W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_W5_cont_rel$NEWRE1W5, missing_values = NA)
ggplot(ALSA_W5_cont_rel, aes(x=factor(NEWRE3W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Anyone else now living in your household?") + ylab("Frequency")

vari <- ALSA_W5_cont_rel$NEWRE4W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_W5_cont_rel$NEWRE1W5, missing_values = NA)
ggplot(ALSA_W5_cont_rel, aes(x=factor(NEWRE4W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Anyone else now living in your household?") + ylab("Frequency")


```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:


* `if CORESW5=1 and home_rel from Wave3 equals 1 - into 1`
* `else if CORESW5=1 and home_rel from Wave3 equals 0 - into 0`
* `else if CORESW5=2 and home_rel from Wave3 equals 0 - into 0`
* `else if CORESW5=2 and home_rel from Wave3 equals 1 - into ?????`
* `else if any of NEWRE1W5,..,NEWRE4W5 is in 1,..,15 - into 1`
* `NA into 999`

Note that in this wave only information about housebold is available.
**R script:**

```{r harmo5, echo=TRUE}
ALSA_W5_cont_rel_2 <- left_join(ALSA_W5_cont_rel, ALSA_ds_w4, by='id')

ALSA_ds_w5 <- tibble(id=ALSA_W5_cont_rel_2$id)

ALSA_W5_cont_rel_2$home_rel <- car::recode(as.vector(ALSA_W5_cont_rel_2$home_rel), "NA='-999'")
ALSA_W5_cont_rel_2$CORESW5 <- car::recode(as.vector(ALSA_W5_cont_rel_2$CORESW5), "NA='-999'")
ALSA_W5_cont_rel_2$NEWRE1W5 <- car::recode(as.vector(ALSA_W5_cont_rel_2$NEWRE1W5), "NA='-999'")
ALSA_W5_cont_rel_2$NEWRE2W5 <- car::recode(as.vector(ALSA_W5_cont_rel_2$NEWRE2W5), "NA='-999'")
ALSA_W5_cont_rel_2$NEWRE3W5 <- car::recode(as.vector(ALSA_W5_cont_rel_2$NEWRE3W5), "NA='-999'")
ALSA_W5_cont_rel_2$NEWRE4W5 <- car::recode(as.vector(ALSA_W5_cont_rel_2$NEWRE4W5), "NA='-999'")

ALSA_ds_w5$home_rel <- c(NA)  
for(i in 1:dim(ALSA_W5_cont_rel_2[1])){
  
  # all people still living with respondent and he lived with a relative:
  if( ALSA_W5_cont_rel_2$CORESW5[i] == 1 & ALSA_W5_cont_rel_2$home_rel[i] == 1 ) { 
    ALSA_ds_w5$home_rel[i] = 1 }
  
  # all people still living with respondent but he lived without any relative:
  else if( ALSA_W5_cont_rel_2$CORESW5[i] == 1 & ALSA_W5_cont_rel_2$home_rel[i] == 0 ) { 
    ALSA_ds_w5$home_rel[i] = 0 }
  
  # somebody moved out/deceased but respondent lived without any relative:
  else if( ALSA_W5_cont_rel_2$CORESW5[i] == 2 & ALSA_W5_cont_rel_2$home_rel[i] == 0 ) { 
    ALSA_ds_w5$home_rel[i] = 0 }
  
  # there is a new relative live with respondent:
  else if( ALSA_W5_cont_rel_2$NEWRE1W5[i] %in% c(1:15) | ALSA_W5_cont_rel_2$NEWRE2W5[i] %in% c(1:15) |
        ALSA_W5_cont_rel_2$NEWRE3W5[i] %in% c(1:15) | ALSA_W5_cont_rel_2$NEWRE4W5[i] %in% c(1:15) ) { 
        ALSA_ds_w5$home_rel[i] = 1 }
  
  # somebody moved out/deceased and respondent lived with a relative: 
  # NO SUFFICIENT INFORMATION TO VERIFY...
}


ALSA_ds_w5$home_rel <- car::recode(as.vector(ALSA_ds_w5$home_rel), "NA='999'")
ALSA_ds_w5$home_rel <- labelled(ALSA_ds_w5$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

ALSA_ds_w5$cont_rel <- ALSA_ds_w5$home_rel
```

#### Statistical description of the new harmonised variable
```{r descript5, echo=F}
vari <- ALSA_ds_w5$home_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w5$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w5, aes(x=factor(home_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation5, echo=F}

```

 

### Wave 6

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

    
* Name: `RELAT1W6`,...,`RELAT5W6`
* Label: `relationship with person one`,...,`relationship with person five`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:         
    + `0 = No answer`

* Name: `CONTCHW6`
* Label: `child face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
*Missings:
    + `0 = no answer`

* Name: `CONTGDW6`
* Label: `grandchild face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
*Missings:
    + `0 = no answer`
    
    
* Name: `PHCNCHW6`
* Label: `Phone contact with children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `PHCNGDW6`
* Label: `Phone contact with grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRCHW6`
* Label: `Mail from children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRGDW6`
* Label: `Mail from grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Description: 
```{r assign6, echo=F}
opal.assign.table.tibble(o, 'ALSA_w6_cont_rel','ALSA.ALSA-Wave6', 
                        variables=list('RELAT1W6','RELAT2W6','RELAT3W6','RELAT4W6','RELAT5W6', 
                                       'CONTCHW6','CONTGDW6', 
                                       'PHCNCHW6','PHCNGDW6','MLFRCHW6','MLFRGDW6'), missings = TRUE)
```

```{r local6, echo=F}
ALSA_w6_cont_rel <- opal.execute(o,'ALSA_w6_cont_rel')

vari <- ALSA_w6_cont_rel$RELAT1W6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel$RELAT1W6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(RELAT1W6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$RELAT2W6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel$RELAT1W6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(RELAT2W6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$RELAT3W6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel$RELAT1W6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(RELAT3W6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$RELAT4W6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel$RELAT1W6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(RELAT4W6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$RELAT5W6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel$RELAT1W6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(RELAT5W6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$CONTCHW6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel2$CONTCHW6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(CONTCHW6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with children") + ylab("Frequency")


vari <- ALSA_w6_cont_rel$CONTGDW6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel2$CONTGDW6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(CONTGDW6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with grandchildren") + ylab("Frequency")




vari <- ALSA_w6_cont_rel$PHCNCHW6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel2$PHCNCHW6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(PHCNCHW6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with children") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$PHCNGDW6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#(var = ALSA_w6_cont_rel2$PHCNGDW6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(PHCNGDW6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with grandchildren") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$MLFRCHW6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel2$MLFRCHW6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(MLFRCHW6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from children") + ylab("Frequency")

vari <- ALSA_w6_cont_rel$MLFRGDW6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_cont_rel2$MLFRGDW6, missing_values = NA)
ggplot(ALSA_w6_cont_rel, aes(x=factor(MLFRGDW6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from grandchildren") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

First of all, an auxiliar variable home_rel (Are living in home with family members/relatives (= daily contact with family member)?) is created. It takes value 1 if answer is yes and 0 if not.
* `if any of RELAT1W6,..,RELAT5W6 is in 1:15 then recode into 1`
* `ELSE if all of RELAT1W6,..,RELAT5W6 are not in 1:15 then recode into 0`"
* `0 into 995`
* `NA into 999`

Then, the variable is created as follows:
* `if any of 'PHCNCHW6','PHCNGDW6','MLFRCHW6','MLFRGDW6', 'CONTCHW6','CONTGDW6' in 1:4 or home_rel is 1 - then recode into 1`
* `if all 'PHCNCHW6','PHCNGDW6','MLFRCHW6','MLFRGDW6', 'CONTCHW6','CONTGDW6' are in 5:6 and home_rel is 0 - then recode into 0`
* `home_rel = 995 and the rest 0 into 995`
* `NA and 999 into 999`


**R script:**

```{r harmo6, echo=TRUE}
ALSA_ds_w6 <- tibble(id=ALSA_w6_cont_rel$id)
# AUXILIAR VARIABLE
ALSA_w6_cont_rel$RELAT1W6 <- car::recode(as.vector(ALSA_w6_cont_rel$RELAT1W6), "NA='-999'")
ALSA_w6_cont_rel$RELAT2W6 <- car::recode(as.vector(ALSA_w6_cont_rel$RELAT2W6), "NA='-999'")
ALSA_w6_cont_rel$RELAT3W6 <- car::recode(as.vector(ALSA_w6_cont_rel$RELAT3W6), "NA='-999'")
ALSA_w6_cont_rel$RELAT4W6 <- car::recode(as.vector(ALSA_w6_cont_rel$RELAT4W6), "NA='-999'")
ALSA_w6_cont_rel$RELAT5W6 <- car::recode(as.vector(ALSA_w6_cont_rel$RELAT5W6), "NA='-999'")

ALSA_ds_w6$home_rel <- c(NA) 
for(i in 1:dim(ALSA_w6_cont_rel)[1]){
  if( ALSA_w6_cont_rel$RELAT1W6[i] %in% c(1:15) | ALSA_w6_cont_rel$RELAT2W6[i] %in% c(1:15) |
         ALSA_w6_cont_rel$RELAT3W6[i] %in% c(1:15) | ALSA_w6_cont_rel$RELAT4W6[i] %in% c(1:15) |
         ALSA_w6_cont_rel$RELAT5W6[i] %in% c(1:15) ) {
  ALSA_ds_w6$home_rel[i] = 1 }
  else if( ALSA_w6_cont_rel$RELAT1W6[i] == 0 & ALSA_w6_cont_rel$RELAT2W6[i] == 0 &
         ALSA_w6_cont_rel$RELAT3W6[i] == 0 & ALSA_w6_cont_rel$RELAT4W6[i] == 0 &
         ALSA_w6_cont_rel$RELAT5W6[i] == 0 ) {
  ALSA_ds_w6$home_rel[i] = 995 }
  else if( ALSA_w6_cont_rel$RELAT1W6[i] == -999 & ALSA_w6_cont_rel$RELAT2W6[i] == -999 &
         ALSA_w6_cont_rel$RELAT3W6[i] == -999 & ALSA_w6_cont_rel$RELAT4W6[i] == -999 &
         ALSA_w6_cont_rel$RELAT5W6[i] == -999 ) {
  ALSA_ds_w6$home_rel[i] = 999 }
  else if(  !(ALSA_w6_cont_rel$RELAT1W6[i] %in% c(1:15) | ALSA_w6_cont_rel$RELAT2W6[i] %in% c(1:15) |
         ALSA_w6_cont_rel$RELAT3W6[i] %in% c(1:15) | ALSA_w6_cont_rel$RELAT4W6[i] %in% c(1:15) |
         ALSA_w6_cont_rel$RELAT5W6[i] %in% c(1:15) ) ) {
  ALSA_ds_w6$home_rel[i] = 0 }
}

ALSA_ds_w6$home_rel <- car::recode(as.vector(ALSA_ds_w6$home_rel), "NA='999'")
ALSA_ds_w6$home_rel <- labelled(ALSA_ds_w6$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))


# CONT_REL VARIABLE

ALSA_w6_cont_rel$CONTCHW6 <- car::recode(as.vector(ALSA_w6_cont_rel$CONTCHW6), "NA='-999'")
ALSA_w6_cont_rel$CONTGDW6 <- car::recode(as.vector(ALSA_w6_cont_rel$CONTGDW6), "NA='-999'")
ALSA_w6_cont_rel$PHCNCHW6 <- car::recode(as.vector(ALSA_w6_cont_rel$PHCNCHW6), "NA='-999'")
ALSA_w6_cont_rel$PHCNGDW6 <- car::recode(as.vector(ALSA_w6_cont_rel$PHCNGDW6), "NA='-999'")
ALSA_w6_cont_rel$MLFRCHW6 <- car::recode(as.vector(ALSA_w6_cont_rel$MLFRCHW6), "NA='-999'")
ALSA_w6_cont_rel$MLFRGDW6 <- car::recode(as.vector(ALSA_w6_cont_rel$MLFRGDW6), "NA='-999'")


ALSA_w6_cont_rel2 <- left_join(ALSA_w6_cont_rel, ALSA_ds_w6, by='id')

ALSA_ds_w6$cont_rel <- c(NA) 
for(i in 1:dim(ALSA_w6_cont_rel2)[1]){
  if( ALSA_w6_cont_rel2$CONTCHW6[i] %in% c(1,2,3,4) | 
      ALSA_w6_cont_rel2$CONTGDW6[i] %in% c(1,2,3,4) |
      ALSA_w6_cont_rel2$PHCNCHW6[i] %in% c(1,2,3,4) | 
      ALSA_w6_cont_rel2$PHCNGDW6[i] %in% c(1,2,3,4) | 
    ALSA_w6_cont_rel2$MLFRGDW6[i] %in% c(1,2,3,4) | 
    ALSA_w6_cont_rel2$MLFRGDW6[i] %in% c(1,2,3,4)|
    ALSA_w6_cont_rel2$home_rel[i] == 1) {
    ALSA_ds_w6$cont_rel[i] = 1 }
  else if( ALSA_w6_cont_rel2$CONTCHW6[i] %in% c(5,6) & 
           ALSA_w6_cont_rel2$CONTGDW6[i] %in% c(5,6) &
           ALSA_w6_cont_rel2$PHCNCHW6[i] %in% c(5,6) & 
           ALSA_w6_cont_rel2$PHCNGDW6[i] %in% c(5,6) &
         ALSA_w6_cont_rel2$MLFRCHW6[i] %in% c(5,6) & 
         ALSA_w6_cont_rel2$MLFRGDW6[i] %in% c(5,6)&
           ALSA_w6_cont_rel2$home_rel[i] == 0) {
    ALSA_ds_w6$cont_rel[i] = 0 }
  else if(  ALSA_w6_cont_rel2$CONTCHW6[i] == 0 & 
            ALSA_w6_cont_rel2$CONTGDW6[i] == 0 &
            ALSA_w6_cont_rel2$PHCNCHW6[i] == 0 & 
           ALSA_w6_cont_rel2$PHCNGDW6[i] == 0 &
         ALSA_w6_cont_rel2$MLFRCHW6[i] == 0 & 
         ALSA_w6_cont_rel2$MLFRGDW6[i] == 0 &
         ALSA_w6_cont_rel2$home_rel[i]== 995) {
    ALSA_ds_w6$cont_rel[i] = 995 }
}

ALSA_ds_w6$cont_rel <- car::recode(as.vector(ALSA_ds_w6$cont_rel), "NA='999'")
ALSA_ds_w6$cont_rel <- labelled(ALSA_ds_w6$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

```

#### Statistical description of the new harmonised variable
```{r descript6, echo=F}
vari <- ALSA_ds_w6$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w6$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w6, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6, echo=F}

```

 

### Wave7

The study-specific variables elected to be harmonised are:

* Name: `contchw7`
* Label: `child face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
*Missings:
    + `0 = no answer`

* Name: `contgdw7`
* Label: `grandchild face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
*Missings:
    + `0 = no answer`

* Name: `phcnchw7`
* Label: `Phone contact with children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `phcngdw7`
* Label: `Phone contact with grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `mlfrchw7`
* Label: `Mail from children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `mlfrgdw7`
* Label: `Mail from grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

```{r assign7, echo=F}
opal.assign.table.tibble(o, 'ALSA_w7_cont_rel','ALSA.ALSA-Wave7', variables=list('contchw7','contgdw7',                                                                                'phcnchw7','phcngdw7','mlfrchw7','mlfrgdw7'), missings = TRUE)
```

```{r local7, echo=F}
ALSA_w7_cont_rel <- opal.execute(o,'ALSA_w7_cont_rel')

vari <- ALSA_w7_cont_rel$contchw7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w7_face_rel$contchw7, missing_values = NA)
ggplot(ALSA_w7_cont_rel, aes(x=factor(contchw7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with children") + ylab("Frequency")

vari <- ALSA_w7_cont_rel$contgdw7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w7_face_rel$contgdw7, missing_values = NA)
ggplot(ALSA_w7_cont_rel, aes(x=factor(contgdw7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with grandchildren") + ylab("Frequency")

vari <- ALSA_w7_cont_rel$phcnchw7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w7_oth_rel$phcnchw7, missing_values = NA)
ggplot(ALSA_w7_cont_rel, aes(x=factor(phcnchw7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with children") + ylab("Frequency")

vari <- ALSA_w7_cont_rel$phcngdw7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w7_oth_rel$phcngdw7, missing_values = NA)
ggplot(ALSA_w7_cont_rel, aes(x=factor(phcngdw7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with grandchildren") + ylab("Frequency")

vari <- ALSA_w7_cont_rel$mlfrchw7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w7_oth_rel$mlfrchw7, missing_values = NA)
ggplot(ALSA_w7_cont_rel, aes(x=factor(mlfrchw7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from children") + ylab("Frequency")

vari <- ALSA_w7_cont_rel$mlfrgdw7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w7_oth_rel$mlfrgdw7, missing_values = NA)
ggplot(ALSA_w7_cont_rel, aes(x=factor(mlfrgdw7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from grandchildren") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any of 'contchw7','contgdw7', 'phcnchw7','phcngdw7','mlfrchw7','mlfrgdw7' are in 1:4 then recode into 1`
* `ELSE if all of 'contchw7','contgdw7','phcnchw7','phcngdw7','mlfrchw7','mlfrgdw7' are in 5:6 then recode into 0`
* `0 into 995`
* `NA into 999`



Note thtat in this wave there is no information about household.

** R script:**
```{r harmo7}
ALSA_ds_w7 <- tibble(id=ALSA_w7_cont_rel$id)

ALSA_w7_cont_rel$contchw7 <- car::recode(as.vector(ALSA_w7_cont_rel$contchw7), "NA='-999'")
ALSA_w7_cont_rel$contgdw7 <- car::recode(as.vector(ALSA_w7_cont_rel$contgdw7), "NA='-999'")
ALSA_w7_cont_rel$phcnchw7 <- car::recode(as.vector(ALSA_w7_cont_rel$phcnchw7), "NA='-999'")
ALSA_w7_cont_rel$phcngdw7 <- car::recode(as.vector(ALSA_w7_cont_rel$phcngdw7), "NA='-999'")
ALSA_w7_cont_rel$mlfrchw7 <- car::recode(as.vector(ALSA_w7_cont_rel$mlfrchw7), "NA='-999'")
ALSA_w7_cont_rel$mlfrgdw7 <- car::recode(as.vector(ALSA_w7_cont_rel$mlfrgdw7), "NA='-999'")

ALSA_ds_w7$cont_rel <- c(NA) 
for(i in 1:dim(ALSA_w7_cont_rel)[1]){
  if( ALSA_w7_cont_rel$contchw7[i] %in% c(1,2,3,4) | 
      ALSA_w7_cont_rel$contgdw7[i] %in% c(1,2,3,4) |
      ALSA_w7_cont_rel$phcnchw7[i] %in% c(1,2,3,4) | 
      ALSA_w7_cont_rel$phcngdw7[i] %in% c(1,2,3,4) | 
      ALSA_w7_cont_rel$mlfrgdw7[i] %in% c(1,2,3,4) | 
      ALSA_w7_cont_rel$mlfrgdw7[i] %in% c(1,2,3,4)) {
    ALSA_ds_w7$cont_rel[i] = 1 }
  else if( ALSA_w7_cont_rel$contchw7[i] %in% c(5,6) & 
           ALSA_w7_cont_rel$contgdw7[i] %in% c(5,6) &
           ALSA_w7_cont_rel$phcnchw7[i] %in% c(5,6) & 
           ALSA_w7_cont_rel$phcngdw7[i] %in% c(5,6) &
           ALSA_w7_cont_rel$mlfrchw7[i] %in% c(5,6) & 
           ALSA_w7_cont_rel$mlfrgdw7[i] %in% c(5,6)) {
    ALSA_ds_w7$cont_rel[i] = 0 }
  else if(  ALSA_w7_cont_rel$contchw7[i] == 0 & 
            ALSA_w7_cont_rel$contgdw7[i] == 0 &
            ALSA_w7_cont_rel$phcnchw7[i] == 0 & 
            ALSA_w7_cont_rel$phcngdw7[i] == 0 &
            ALSA_w7_cont_rel$mlfrchw7[i] == 0 & 
            ALSA_w7_cont_rel$mlfrgdw7[i] == 0) {
    ALSA_ds_w7$cont_rel[i] = 995 }
}

ALSA_ds_w7$cont_rel <- car::recode(as.vector(ALSA_ds_w7$cont_rel), "NA='999'")
ALSA_ds_w7$cont_rel <- labelled(ALSA_ds_w7$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript7, echo=F}
vari <-  ALSA_ds_w7$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w7$face_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w7, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are face to face contacts with relatives frequent (i.e. contact once a month or more often)") + ylab("Frequency")
```

#### Validation
```{r crosstabulation7, echo=F}

```

### Wave8

#### Study-specific variable description

The study-specific variable elected to be harmonised is:


* Name: `RELAT1W6`,...,`RELAT5W6` **from Wave6**
* Label: `relationship with person one`,...,`relationship with person five`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:         
    + `0 = No answer`


* Name: `CORESW8`
* Label: `People still living with you?`
* Categories:
    + `1 = Yes`
    + `2 = No`
* Missings:
    + `0 = Not Answered`
    
    
* Name: `NEWRESW8`
* Label: `New household members?`
* Categories:
    + `1 = Yes`
    + `2 = No`
* Missings:
    + `0 = Not Answered`


* Name: `NREL1W8`,`NREL2W8`,`NREL3W8`,`NREL4W8`
* Label: `Relationship`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`  
* Missings:
    + `0 = Not Answered`


* Description: 
```{r assign8, echo=F}
opal.assign.table.tibble(o, 'ALSA_w8_cont_rel','ALSA.ALSA-Wave8', 
                        variables=list('coresw8','newresw8','nrel1w8','nrel2w8','nrel3w8','nrel4w8'), missings = TRUE)
```

```{r local8, echo=F}
ALSA_w8_cont_rel <- opal.execute(o,'ALSA_w8_cont_rel')

vari <- ALSA_w8_cont_rel$coresw8
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w8_cont_rel$coresw8, missing_values = NA)
ggplot(ALSA_w8_cont_rel, aes(x=factor(coresw8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("People still living with you?") + ylab("Frequency")

vari <- ALSA_w8_cont_rel$newresw8
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w8_cont_rel$newresw8, missing_values = NA)
ggplot(ALSA_w8_cont_rel, aes(x=factor(newresw8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("New household members?") + ylab("Frequency")

vari <- ALSA_w8_cont_rel$nrel1w8
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w8_cont_rel$nrel1w8, missing_values = NA)
ggplot(ALSA_w8_cont_rel, aes(x=factor(nrel1w8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")

vari <- ALSA_w8_cont_rel$nrel2w8
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w8_cont_rel$nrel1w8, missing_values = NA)
ggplot(ALSA_w8_cont_rel, aes(x=factor(nrel2w8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")

vari <- ALSA_w8_cont_rel$nrel3w8
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w8_cont_rel$nrel1w8, missing_values = NA)
ggplot(ALSA_w8_cont_rel, aes(x=factor(nrel3w8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")

vari <- ALSA_w8_cont_rel$nrel4w8
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w8_cont_rel$nrel1w8, missing_values = NA)
ggplot(ALSA_w8_cont_rel, aes(x=factor(nrel4w8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:



* `NA into 999`

Note that in this wave only information about housebold is available.

**R script:**

```{r harmo8, echo=TRUE}
ALSA_w8_cont_rel_2 <- left_join(ALSA_w8_cont_rel, ALSA_w6_cont_rel, by='id')

ALSA_ds_w8 <- tibble(id=ALSA_w8_cont_rel_2$id)

ALSA_w8_cont_rel_2$coresw8 <- car::recode(as.vector(ALSA_w8_cont_rel_2$coresw8), "NA='-999'")
ALSA_w8_cont_rel_2$newresw8 <- car::recode(as.vector(ALSA_w8_cont_rel_2$newresw8), "NA='-999'")
ALSA_w8_cont_rel_2$nrel1w8 <- car::recode(as.vector(ALSA_w8_cont_rel_2$nrel1w8), "NA='-999'")
ALSA_w8_cont_rel_2$nrel2w8 <- car::recode(as.vector(ALSA_w8_cont_rel_2$nrel2w8), "NA='-999'")
ALSA_w8_cont_rel_2$nrel3w8 <- car::recode(as.vector(ALSA_w8_cont_rel_2$nrel3w8), "NA='-999'")
ALSA_w8_cont_rel_2$nrel4w8 <- car::recode(as.vector(ALSA_w8_cont_rel_2$nrel4w8), "NA='-999'")
ALSA_w8_cont_rel_2$RELAT1W6 <- car::recode(as.vector(ALSA_w8_cont_rel_2$RELAT1W6), "NA='-999'")
ALSA_w8_cont_rel_2$RELAT2W6 <- car::recode(as.vector(ALSA_w8_cont_rel_2$RELAT2W6), "NA='-999'")
ALSA_w8_cont_rel_2$RELAT3W6 <- car::recode(as.vector(ALSA_w8_cont_rel_2$RELAT3W6), "NA='-999'")
ALSA_w8_cont_rel_2$RELAT4W6 <- car::recode(as.vector(ALSA_w8_cont_rel_2$RELAT4W6), "NA='-999'")
ALSA_w8_cont_rel_2$RELAT5W6 <- car::recode(as.vector(ALSA_w8_cont_rel_2$RELAT5W6), "NA='-999'")


# firstly I will count how many of relat1,..,relat5 are in 1:15 (it will help later):
ALSA_ds_w8$count_rel <- c(NA)
for(i in 1:dim(ALSA_w8_cont_rel_2[1])){
  ALSA_ds_w8$count_rel[i]=0
  if( ALSA_w8_cont_rel_2$RELAT1W6[i] %in% c(1:15) ) { ALSA_ds_w8$count_rel[i]=ALSA_ds_w8$count_rel[i]+1 }
  if( ALSA_w8_cont_rel_2$RELAT2W6[i] %in% c(1:15) ) { ALSA_ds_w8$count_rel[i]=ALSA_ds_w8$count_rel[i]+1 }
  if( ALSA_w8_cont_rel_2$RELAT3W6[i] %in% c(1:15) ) { ALSA_ds_w8$count_rel[i]=ALSA_ds_w8$count_rel[i]+1 }
  if( ALSA_w8_cont_rel_2$RELAT4W6[i] %in% c(1:15) ) { ALSA_ds_w8$count_rel[i]=ALSA_ds_w8$count_rel[i]+1 }
  if( ALSA_w8_cont_rel_2$RELAT5W6[i] %in% c(1:15) ) { ALSA_ds_w8$count_rel[i]=ALSA_ds_w8$count_rel[i]+1 }
}
ALSA_ds_w8$count_rel <- car::recode(as.vector(ALSA_ds_w8$count_rel), "NA='-999'")
# ALSA_ds_w8$count_rel - column with number of relatives living with resp. in the previous wave


ALSA_ds_w8$home_rel <- c(NA)  # I think it is required
for(i in 1:dim(ALSA_w8_cont_rel_2[1])){
  
  # all people still living with respondent and somebody is a relative:
  if( ALSA_w8_cont_rel_2$coresw8[i] == 1 & ALSA_ds_w8$count_rel[i] > 0 ) { 
    ALSA_ds_w8$home_rel[i] = 1 }
  
  # there are some new relatives living with respondent:
  else if( ALSA_w8_cont_rel_2$newresw8[i] == 1 & 
      ( ALSA_w8_cont_rel_2$nrel1w8[i] %in% c(1:15) | ALSA_w8_cont_rel_2$nrel2w8[i] %in% c(1:15) | 
        ALSA_w8_cont_rel_2$nrel3w8[i] %in% c(1:15) | ALSA_w8_cont_rel_2$nrel4w8[i] %in% c(1:15) ) ) { 
    ALSA_ds_w8$home_rel[i] = 1 }
  
  # somebody moved out/deceased and they were only people living with respondent:
  # NO SUFFICIENT INFORMATION TO VERIFY!!!
  
  # there are some new people living with respondent, but they are not relatives:
  else if( ALSA_w8_cont_rel_2$newresw8[i] == 1 & 
      !(ALSA_w8_cont_rel_2$nrel1w8[i] %in% c(1:15) | ALSA_w8_cont_rel_2$nrel2w8[i] %in% c(1:15) |
        ALSA_w8_cont_rel_2$nrel3w8[i] %in% c(1:15) | ALSA_w8_cont_rel_2$nrel4w8[i] %in% c(1:15) ) ) { 
        ALSA_ds_w8$home_rel[i] = 0 }
}

ALSA_ds_w8$home_rel <- car::recode(as.vector(ALSA_ds_w8$home_rel), "NA='999'")
ALSA_ds_w8$home_rel <- labelled(ALSA_ds_w8$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

ALSA_ds_w8$cont_rel <- ALSA_ds_w8$home_rel
```

#### Statistical description of the new harmonised variable
```{r descript8, echo=F}
vari <- ALSA_ds_w8$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w8$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w8, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation8, echo=F}

```

 
### Wave9

#### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `RELAT1W9`,...,`RELAT5W9`
* Label: `relationship with person one`,...,`relationship with person five`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:         
    + `0 = No answer`
* Name: `CONTCHW9`
* Label: `child face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
*Missings:
    + `0 = no answer`

* Name: `CONTGDW9`
* Label: `grandchild face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
*Missings:
    + `0 = no answer`
    
* Name: `PHCNCHW9`
* Label: `Phone contact with children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `PHCNGDW9`
* Label: `Phone contact with grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRCHW9`
* Label: `Mail from children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRGDW9`
* Label: `Mail from grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`
    
    
* Description: 
```{r assign9, echo=F}
opal.assign.table.tibble(o, 'ALSA_w9_cont_rel','ALSA.ALSA-Wave9', 
                        variables=list('RELAT1W9','RELAT2W9','RELAT3W9','RELAT4W9','RELAT5W9', 
                                       'CONTCHW9','CONTGDW9', 
                                       'PHCNCHW9','PHCNGDW9','MLFRCHW9','MLFRGDW9'), missings = TRUE)
```

```{r local9, echo=F}
ALSA_w9_cont_rel <- opal.execute(o,'ALSA_w9_cont_rel')

vari <- ALSA_w9_cont_rel$RELAT1W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel$RELAT1W9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(RELAT1W9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("relationship with person one") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT2W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel$RELAT1W9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(RELAT2W9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("relationship with person 2") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT3W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel$RELAT1W9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(RELAT3W9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("relationship with person 3") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT4W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel$RELAT1W9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(RELAT4W9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("relationship with person 4") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT5W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel$RELAT1W9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(RELAT5W9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("relationship with person 5") + ylab("Frequency")



vari <- ALSA_w9_cont_rel$RELAT1W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel2$CONTCHW9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(CONTCHW9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with children") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT1W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel2$CONTGDW9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(CONTGDW9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with grandchildren") + ylab("Frequency")


vari <- ALSA_w9_cont_rel$RELAT1W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel2$PHCNCHW9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(PHCNCHW9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with children") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT1W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel2$PHCNGDW9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(PHCNGDW9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with grandchildren") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT1W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel2$MLFRCHW9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(MLFRCHW9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from children") + ylab("Frequency")

vari <- ALSA_w9_cont_rel$RELAT1W9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_cont_rel2$MLFRGDW9, missing_values = NA)
ggplot(ALSA_w9_cont_rel, aes(x=factor(MLFRGDW9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from grandchildren") + ylab("Frequency")


```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

First of all, an auxiliar variable home_rel (Are living in home with family members/relatives (= daily contact with family member)?) is created. It takes value 1 if answer is yes and 0 if not.
* `if any of RELAT0,...,RELAT9 equals one of 1,...,15 - then recode into 1`
* `if all of RELAT0,...,RELAT9 not in 1,...15 - then recode into 0`
* `0 into 995`
* `99 relat0..9 or NA into 999`

Then, the variable is created as follows:
* `if any of 'CONTCHW9','CONTGDW9', 'PHCNCHW9','PHCNGDW9','MLFRCHW9','MLFRGDW9' is in 1:4 or home_rel is 1 - then recode into 1`
* `if  all of 'CONTCHW9','CONTGDW9', 'PHCNCHW9','PHCNGDW9','MLFRCHW9','MLFRGDW9' are in 5:6 and home_rel is 0  - then recode into 0`
* `0 into 995`
* `NA into 999`




**R script:**

```{r harmo9, echo=TRUE}
ALSA_ds_w9 <- tibble(id=ALSA_w9_cont_rel$id)

# AUXILIAR VARIABLE
ALSA_w9_cont_rel$RELAT1W9 <- car::recode(as.vector(ALSA_w9_cont_rel$RELAT1W9), "NA='-999'")
ALSA_w9_cont_rel$RELAT2W9 <- car::recode(as.vector(ALSA_w9_cont_rel$RELAT2W9), "NA='-999'")
ALSA_w9_cont_rel$RELAT3W9 <- car::recode(as.vector(ALSA_w9_cont_rel$RELAT3W9), "NA='-999'")
ALSA_w9_cont_rel$RELAT4W9 <- car::recode(as.vector(ALSA_w9_cont_rel$RELAT4W9), "NA='-999'")
ALSA_w9_cont_rel$RELAT5W9 <- car::recode(as.vector(ALSA_w9_cont_rel$RELAT5W9), "NA='-999'")

ALSA_ds_w9$home_rel <- c(NA) 
for(i in 1:dim(ALSA_w9_cont_rel)[1]){ 
  if( ALSA_w9_cont_rel$RELAT1W9[i] %in% c(1:15) | ALSA_w9_cont_rel$RELAT2W9[i] %in% c(1:15) |
      ALSA_w9_cont_rel$RELAT3W9[i] %in% c(1:15) | ALSA_w9_cont_rel$RELAT4W9[i] %in% c(1:15) |
      ALSA_w9_cont_rel$RELAT5W9[i] %in% c(1:15) ) {
    ALSA_ds_w9$home_rel[i] = 1 }
  else if( ALSA_w9_cont_rel$RELAT1W9[i] == -999 & ALSA_w9_cont_rel$RELAT2W9[i] == -999 &
      ALSA_w9_cont_rel$RELAT3W9[i] == -999 & ALSA_w9_cont_rel$RELAT4W9[i] == -999 &
      ALSA_w9_cont_rel$RELAT5W9[i] == -999 ) {
  ALSA_ds_w9$home_rel[i] = 999 }
  else if( ALSA_w9_cont_rel$RELAT1W9[i] == 0 & ALSA_w9_cont_rel$RELAT2W9[i] == 0 &
      ALSA_w9_cont_rel$RELAT3W9[i] == 0 & ALSA_w9_cont_rel$RELAT4W9[i] == 0 &
      ALSA_w9_cont_rel$RELAT5W9[i] == 0 ) {
  ALSA_ds_w9$home_rel[i] = 995 }
  else if( !( ALSA_w9_cont_rel$RELAT1W9[i] %in% c(1:15) | ALSA_w9_cont_rel$RELAT2W9[i] %in% c(1:15) |
         ALSA_w9_cont_rel$RELAT3W9[i] %in% c(1:15) | ALSA_w9_cont_rel$RELAT4W9[i] %in% c(1:15) |
         ALSA_w9_cont_rel$RELAT5W9[i] %in% c(1:15) ) ) {
  ALSA_ds_w9$home_rel[i] = 0 }
}

ALSA_ds_w9$home_rel <- car::recode(as.vector(ALSA_ds_w9$home_rel), "NA='999'")
ALSA_ds_w9$home_rel <- labelled(ALSA_ds_w9$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

# CONT_REL VARIABLE
ALSA_w9_cont_rel$CONTCHW9 <- car::recode(as.vector(ALSA_w9_cont_rel$CONTCHW9), "NA='-999'")
ALSA_w9_cont_rel$CONTGDW9 <- car::recode(as.vector(ALSA_w9_cont_rel$CONTGDW9), "NA='-999'")
ALSA_w9_cont_rel$PHCNCHW9 <- car::recode(as.vector(ALSA_w9_cont_rel$PHCNCHW9), "NA='-999'")
ALSA_w9_cont_rel$PHCNGDW9 <- car::recode(as.vector(ALSA_w9_cont_rel$PHCNGDW9), "NA='-999'")
ALSA_w9_cont_rel$MLFRCHW9 <- car::recode(as.vector(ALSA_w9_cont_rel$MLFRCHW9), "NA='-999'")
ALSA_w9_cont_rel$MLFRGDW9 <- car::recode(as.vector(ALSA_w9_cont_rel$MLFRGDW9), "NA='-999'")

ALSA_w9_cont_rel2 <- left_join(ALSA_w9_cont_rel, ALSA_ds_w9, by='id')


ALSA_ds_w9$cont_rel <- c(NA) 
for(i in 1:dim(ALSA_w9_cont_rel2)[1]){
  if( ALSA_w9_cont_rel2$CONTCHW9[i] %in% c(1,2,3,4) | 
      ALSA_w9_cont_rel2$CONTGDW9[i] %in% c(1,2,3,4)|
      ALSA_w9_cont_rel2$PHCNCHW9[i] %in% c(1,2,3,4) | 
      ALSA_w9_cont_rel2$PHCNGDW9[i] %in% c(1,2,3,4) | 
      ALSA_w9_cont_rel2$MLFRGDW9[i] %in% c(1,2,3,4) | 
      ALSA_w9_cont_rel2$MLFRGDW9[i] %in% c(1,2,3,4) |
      ALSA_w9_cont_rel2$home_rel[i] == 1) {
    ALSA_ds_w9$cont_rel[i] = 1 }
  else if( ALSA_w9_cont_rel2$CONTCHW9[i] %in% c(5,6) & 
           ALSA_w9_cont_rel2$CONTGDW9[i] %in% c(5,6) & 
           ALSA_w9_cont_rel2$home_rel[i] == 0 &
           ALSA_w9_cont_rel2$PHCNCHW9[i] %in% c(5,6) & 
           ALSA_w9_cont_rel2$PHCNGDW9[i] %in% c(5,6) &
           ALSA_w9_cont_rel2$MLFRCHW9[i] %in% c(5,6) & 
           ALSA_w9_cont_rel2$MLFRGDW9[i] %in% c(5,6)) {
    ALSA_ds_w9$cont_rel[i] = 0 }
  else if(  ALSA_w9_cont_rel2$CONTCHW9[i] == 0 & 
            ALSA_w9_cont_rel2$CONTGDW9[i] == 0 &
            ALSA_w9_cont_rel2$home_rel[i] == 995 &
            ALSA_w9_cont_rel2$PHCNCHW9[i] == 0 & 
            ALSA_w9_cont_rel2$PHCNGDW9[i] == 0 &
            ALSA_w9_cont_rel2$MLFRCHW9[i] == 0 & 
            ALSA_w9_cont_rel2$MLFRGDW9[i] == 0 ) {
    ALSA_ds_w9$cont_rel[i] = 995 }
}

ALSA_ds_w9$cont_rel <- car::recode(as.vector(ALSA_ds_w9$cont_rel), "NA='999'")
ALSA_ds_w9$cont_rel <- labelled(ALSA_ds_w9$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

```

#### Statistical description of the new harmonised variable
```{r descript9, echo=F}
vari <- ALSA_ds_w9$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w9$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w9, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation9, echo=F}

```
 

### Wave10

The study-specific variables elected to be harmonised are:

* Name: `home_rel` **from Wave9**

* Name: `CORESW10`
* Label: `People still living with you?`
* Categories:
    + `0 = No`
    + `1 = Yes`
* Missings:
    + `99 = not answered`
    
* Name: `NEWREW10`
* Label: `New household members?`
* Categories:
    + `0 = No`
    + `1 = Yes`
* Missings:
    + `99 = not answered`

* Name: `nrel1w10`,`nrel2w810`,`nrel3w10`,`nrel4w10`
* Label: `Relationship with a new household member`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Missings:
    + `99 = not answered`

Note that in this wave only information about housebold is available.

* Description: 
```{r assign10, echo=F}
opal.assign.table.tibble(o, 'ALSA_w10_cont_rel','ALSA.ALSA-Wave10', 
                        variables=list('coresw10','newrew10','nrel1w10','nrel2w810','nrel3w10','nrel4w10'), missings = TRUE)

## Notice a wird name nrel2w810 instead of nrel2w10 (probably a mistake)
```

```{r local10, echo=F}
ALSA_w10_cont_rel <- opal.execute(o,'ALSA_w10_cont_rel')

vari <- ALSA_w10_cont_rel$coresw10
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w10_cont_rel$coresw10, missing_values = NA)
ggplot(ALSA_w10_cont_rel, aes(x=factor(coresw10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("People still living with you?") + ylab("Frequency")

vari <- ALSA_w10_cont_rel$newrew10
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w10_cont_rel$newrew10, missing_values = NA)
ggplot(ALSA_w10_cont_rel, aes(x=factor(newrew10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("New household members?") + ylab("Frequency")

vari <- ALSA_w10_cont_rel$nrel1w10
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w10_cont_rel$nrel1w10, missing_values = NA)
ggplot(ALSA_w10_cont_rel, aes(x=factor(nrel1w10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with a new household member") + ylab("Frequency")


vari <- ALSA_w10_cont_rel$nrel2w810
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w10_cont_rel$nrel1w10, missing_values = NA)
ggplot(ALSA_w10_cont_rel, aes(x=factor(nrel2w810))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with a new household member") + ylab("Frequency")

vari <- ALSA_w10_cont_rel$nrel3w10
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w10_cont_rel$nrel1w10, missing_values = NA)
ggplot(ALSA_w10_cont_rel, aes(x=factor(nrel3w10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with a new household member") + ylab("Frequency")

vari <- ALSA_w10_cont_rel$nrel4w10
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w10_cont_rel$nrel1w10, missing_values = NA)
ggplot(ALSA_w10_cont_rel, aes(x=factor(nrel4w10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with a new household member") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:


* `if coresw10=1 and home_rel from Wave9 equals 1 - into 1`
* `else if coresw10=1 and home_rel from Wave9 equals 0 - into 0`
* `else if coresw10=0 and home_rel from Wave9 equals 0 - into 0`
* `else if coresw10=0 and home_rel from Wave9 equals 1 - into ?????`
* `else if any of nrel1w10,..,nrel4w10 is in 1,..,15 - into 1`
* `NA into 999`


**R script:**

```{r harmo10, echo=TRUE}
ALSA_w10_cont_rel_2 <- left_join(ALSA_w10_cont_rel, ALSA_ds_w9, by='id')

ALSA_ds_w10 <- tibble(id=ALSA_w10_cont_rel_2$id)

ALSA_w10_cont_rel_2$home_rel <- car::recode(as.vector(ALSA_w10_cont_rel_2$home_rel), "NA='-999'")
ALSA_w10_cont_rel_2$coresw10 <- car::recode(as.vector(ALSA_w10_cont_rel_2$coresw10), "NA='-999'")
ALSA_w10_cont_rel_2$nrel1w10 <- car::recode(as.vector(ALSA_w10_cont_rel_2$nrel1w10), "NA='-999'")
ALSA_w10_cont_rel_2$nrel2w810 <- car::recode(as.vector(ALSA_w10_cont_rel_2$nrel2w810), "NA='-999'")
ALSA_w10_cont_rel_2$nrel3w10 <- car::recode(as.vector(ALSA_w10_cont_rel_2$nrel3w10), "NA='-999'")
ALSA_w10_cont_rel_2$nrel4w10 <- car::recode(as.vector(ALSA_w10_cont_rel_2$nrel4w10), "NA='-999'")

ALSA_ds_w10$home_rel <- c(NA)  
for(i in 1:dim(ALSA_w10_cont_rel_2[1])){
  
  # all people still living with respondent and he lived with a relative:
  if( ALSA_w10_cont_rel_2$coresw10[i] == 1 & 
      ALSA_w10_cont_rel_2$home_rel[i] == 1 ) { 
    ALSA_ds_w10$home_rel[i] = 1 }
  
  # there is a new relative live with respondent:
  else if( ALSA_w10_cont_rel_2$nrel1w10[i] %in% c(1:15) | 
           ALSA_w10_cont_rel_2$nrel2w810[i] %in% c(1:15) |
           ALSA_w10_cont_rel_2$nrel3w10[i] %in% c(1:15) | 
           ALSA_w10_cont_rel_2$nrel4w10[i] %in% c(1:15) ) { 
    ALSA_ds_w10$home_rel[i] = 1 }
  
  # somebody moved out/deceased and respondent lived with a relative: 
  # NO SUFFICIENT INFORMATION TO VERIFY...
  
  # all people still living with respondent but he lived without any relative:
  else if( ALSA_w10_cont_rel_2$coresw10[i] == 1 & 
           ALSA_w10_cont_rel_2$home_rel[i] == 0 ) { 
    ALSA_ds_w10$home_rel[i] = 0 }
  
  # somebody moved out/deceased but respondent lived without any relative:
  else if( ALSA_w10_cont_rel_2$coresw10[i] == 0 & 
           ALSA_w10_cont_rel_2$home_rel[i] == 0 ) { 
    ALSA_ds_w10$home_rel[i] = 0 }

}

ALSA_ds_w10$home_rel <- car::recode(as.vector(ALSA_ds_w10$home_rel), "NA='999'")
ALSA_ds_w10$home_rel <- labelled(ALSA_ds_w10$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

ALSA_ds_w10$cont_rel <- ALSA_ds_w10$home_rel
```

#### Statistical description of the new harmonised variable
```{r descript10, echo=F}
vari <- ALSA_ds_w10$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w10$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w10, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10, echo=F}

```

 


### Wave11

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `RELAT1W11`,`RELAT2W11`,`RELAT3W11`
* Label: `relationship with person one`,...,`relationship with person three`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Name: `CONTCHW11`
* Label: `child face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`

* Name: `CONTGDW11`
* Label: `grandchild face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`

* Name: `PHCNCHW11`
* Label: `Phone contact with children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `PHCNGDW11`
* Label: `Phone contact with grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRCHW11`
* Label: `Mail from children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRGDW11`
* Label: `Mail from grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`


* Description: 
```{r assign11, echo=F}
opal.assign.table.tibble(o, 'ALSA_w11_cont_rel','ALSA.ALSA-Wave11', 
                        variables=list('RELAT1W11','RELAT2W11','RELAT3W11', 
                                       'CONTCHW11','CONTGDW11',
                                       'PHCNCHW11','PHCNGDW11','MLFRCHW11','MLFRGDW11'), missings = TRUE)
```

```{r local11, echo=F}
ALSA_w11_cont_rel <- opal.execute(o,'ALSA_w11_cont_rel')

vari <- ALSA_w11_cont_rel$RELAT1W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_cont_rel$RELAT1W11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(RELAT1W11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w11_cont_rel$RELAT2W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_cont_rel$RELAT1W11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(RELAT2W11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person 2") + ylab("Frequency")

vari <- ALSA_w11_cont_rel$RELAT3W11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_cont_rel$RELAT1W11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(RELAT3W11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person 3") + ylab("Frequency")



vari <- ALSA_w11_cont_rel$CONTCHW11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_face_rel$CONTCHW11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(CONTCHW11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with children") + ylab("Frequency")

vari <- ALSA_w11_cont_rel$CONTGDW11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_face_rel$CONTGDW11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(CONTGDW11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with grandchildren") + ylab("Frequency")


vari <- ALSA_w11_cont_rel$PHCNCHW11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_oth_rel$PHCNCHW11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(PHCNCHW11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with children") + ylab("Frequency")

vari <- ALSA_w11_cont_rel$PHCNGDW11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_oth_rel$PHCNGDW11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(PHCNGDW11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with grandchildren") + ylab("Frequency")

vari <- ALSA_w11_cont_rel$MLFRCHW11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_oth_rel$MLFRCHW11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(MLFRCHW11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from children") + ylab("Frequency")

vari <- ALSA_w11_cont_rel$MLFRGDW11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_oth_rel$MLFRGDW11, missing_values = NA)
ggplot(ALSA_w11_cont_rel, aes(x=factor(MLFRGDW11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from grandchildren") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
First of all, an auxiliar variable home_rel (Are living in home with family members/relatives (= daily contact with family member)?) is created. It takes value 1 if answer is yes and 0 if not.

* `if any of RELAT1w11,..,RELAT3w11 is in 1:15 then recode into 1`
* `ELSE if all of RELAT1w11,..,RELAT3w11 are not in 1:15 then recode into 0`"
* `0 into 995`
* `NA into 999`
Then, the variable is created as follows:
* `if  any of 'CONTCHW11','CONTGDW11', 'PHCNCHW11','PHCNGDW11','MLFRCHW11','MLFRGDW11' are in 1:4 or home_rel is 1 - then recode into 1`
* `if all of 'CONTCHW11','CONTGDW11', 'PHCNCHW11','PHCNGDW11','MLFRCHW11','MLFRGDW11' are in 5:6 and home_rel is 0  - then recode into 0`
* `0 into 995`
* `NA into 999`



**R script:**

```{r harmo11, echo=TRUE}
ALSA_ds_w11 <- tibble(id=ALSA_w11_cont_rel$id)

# AUXILIAR VARIABLE
ALSA_w11_cont_rel$RELAT1W11 <- car::recode(as.vector(ALSA_w11_cont_rel$RELAT1W11), "NA='-999'")
ALSA_w11_cont_rel$RELAT2W11 <- car::recode(as.vector(ALSA_w11_cont_rel$RELAT2W11), "NA='-999'")
ALSA_w11_cont_rel$RELAT3W11 <- car::recode(as.vector(ALSA_w11_cont_rel$RELAT3W11), "NA='-999'")

ALSA_ds_w11$home_rel <- c(NA) 
for(i in 1:dim(ALSA_w11_cont_rel)[1]){
  if( ALSA_w11_cont_rel$RELAT1W11[i] %in% c(1:15) | ALSA_w11_cont_rel$RELAT2W11[i] %in% c(1:15) |
         ALSA_w11_cont_rel$RELAT3W11[i] %in% c(1:15) ) {
    ALSA_ds_w11$home_rel[i] = 1 }
  else if(  ALSA_w11_cont_rel$RELAT1W11[i] == -999 & ALSA_w11_cont_rel$RELAT2W11[i] == -999 &
         ALSA_w11_cont_rel$RELAT3W11[i] == -999 ) {
    ALSA_ds_w11$home_rel[i] = 999 }
  else if(  ALSA_w11_cont_rel$RELAT1W11[i] == 0 & ALSA_w11_cont_rel$RELAT2W11[i] == 0 &
         ALSA_w11_cont_rel$RELAT3W11[i] == 0 ) {
    ALSA_ds_w11$home_rel[i] = 995 }
  else if( !( ALSA_w11_cont_rel$RELAT1W11[i] %in% c(1:15) | ALSA_w11_cont_rel$RELAT2W11[i] %in% c(1:15) |
              ALSA_w11_cont_rel$RELAT3W11[i] %in% c(1:15) ) ) {
    ALSA_ds_w11$home_rel[i] = 0 }
}

ALSA_ds_w11$home_rel <- car::recode(as.vector(ALSA_ds_w11$home_rel), "NA='999'")
ALSA_ds_w11$home_rel <- labelled(ALSA_ds_w11$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))


# CONT_REL VARIABLE
ALSA_w11_cont_rel$CONTCHW11 <- car::recode(as.vector(ALSA_w11_cont_rel$CONTCHW11), "NA='-999'")
ALSA_w11_cont_rel$CONTGDW11 <- car::recode(as.vector(ALSA_w11_cont_rel$CONTGDW11), "NA='-999'")
ALSA_w11_cont_rel$PHCNCHW11 <- car::recode(as.vector(ALSA_w11_cont_rel$PHCNCHW11), "NA='-999'")
ALSA_w11_cont_rel$PHCNGDW11 <- car::recode(as.vector(ALSA_w11_cont_rel$PHCNGDW11), "NA='-999'")
ALSA_w11_cont_rel$MLFRCHW11 <- car::recode(as.vector(ALSA_w11_cont_rel$MLFRCHW11), "NA='-999'")
ALSA_w11_cont_rel$MLFRGDW11 <- car::recode(as.vector(ALSA_w11_cont_rel$MLFRGDW11), "NA='-999'")


ALSA_w11_cont_rel2 <- left_join(ALSA_w11_cont_rel, ALSA_ds_w11, by='id')


ALSA_ds_w11$cont_rel <- c(NA) 
for(i in 1:dim(ALSA_w11_cont_rel2)[1]){
  if( ALSA_w11_cont_rel2$CONTCHW11[i] %in% c(1,2,3,4) | 
      ALSA_w11_cont_rel2$CONTGDW11[i] %in% c(1,2,3,4) |
      ALSA_w11_cont_rel2$PHCNCHW11[i] %in% c(1,2,3,4) | 
      ALSA_w11_cont_rel2$PHCNGDW11[i] %in% c(1,2,3,4) | 
      ALSA_w11_cont_rel2$MLFRGDW11[i] %in% c(1,2,3,4) | 
      ALSA_w11_cont_rel2$MLFRGDW11[i] %in% c(1,2,3,4) |
      ALSA_w11_cont_rel2$home_rel[i] ==1) {
    ALSA_ds_w11$cont_rel[i] = 1 }
  else if( ALSA_w11_cont_rel2$CONTCHW11[i] %in% c(5,6) & 
           ALSA_w11_cont_rel2$CONTGDW11[i] %in% c(5,6) &
           ALSA_w11_cont_rel2$PHCNCHW11[i] %in% c(5,6) & 
           ALSA_w11_cont_rel2$PHCNGDW11[i] %in% c(5,6) &
           ALSA_w11_cont_rel2$MLFRCHW11[i] %in% c(5,6) & 
           ALSA_w11_cont_rel2$MLFRGDW11[i] %in% c(5,6) &
           ALSA_w11_cont_rel2$home_rel[i] == 0) {
    ALSA_ds_w11$cont_rel[i] = 0 }
   else if( ALSA_w11_cont_rel2$PHCNCHW11[i] == 0 & 
            ALSA_w11_cont_rel2$PHCNGDW11[i] == 0 &
           ALSA_w11_cont_rel2$MLFRCHW11[i] == 0 & 
           ALSA_w11_cont_rel2$MLFRGDW11[i] == 0 &
           ALSA_w11_cont_rel2$home_rel[i] == 995) {
  ALSA_ds_w11$cont_rel[i] = 995 }
}

ALSA_ds_w11$cont_rel <- car::recode(as.vector(ALSA_ds_w11$cont_rel), "NA='999'")
ALSA_ds_w11$cont_rel <- labelled(ALSA_ds_w11$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

```

#### Statistical description of the new harmonised variable
```{r descript11, echo=F}
vari <- ALSA_ds_w11$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w11$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w11, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11, echo=F}

```

 
### Wave12

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `RELAT1W12`, `RELAT2W12`,`RELAT3W12`
* Label: `relationship with person one`,...,`relationship with person three`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`
* Name: `CONTCHW12`
* Label: `child face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `99 = no answer`

* Name: `CONTGDW12`
* Label: `grandchild face to face contact`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`    

* Name: `PHCNCHW12`
* Label: `Phone contact with children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `PHCNGDW12`
* Label: `Phone contact with grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRCHW12`
* Label: `Mail from children`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Name: `MLFRGDW12`
* Label: `Mail from grandchildren`
* Categories:
    + `1 = More than once per week`
    + `2 = Once a week`
    + `3 = Two or three times a month`
    + `4 = Almost once a month`
    + `5 = Less than once a month`
    + `6 = Never`
* Missings:
    + `0 = no answer`

* Description: 
```{r assign12, echo=F}
opal.assign.table.tibble(o, 'ALSA_w12_cont_rel','ALSA.ALSA-Wave12', 
                        variables=list('RELAT1W12','RELAT2W12','RELAT3W12', 
                                       'CONTCHW12','CONTGDW12', 
                                       'PHCNCHW12','PHCNGDW12','MLFRCHW12','MLFRGDW12'), missings = TRUE)
```

```{r local12, echo=F}
ALSA_w12_cont_rel <- opal.execute(o,'ALSA_w12_cont_rel')

vari <- ALSA_w12_cont_rel$RELAT1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_cont_rel$RELAT1W12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(RELAT1W12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w12_cont_rel$RELAT2W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_cont_rel$RELAT1W12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(RELAT2W12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w12_cont_rel$RELAT3W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_cont_rel$RELAT1W12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(RELAT3W12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")


vari <- ALSA_w12_cont_rel$RELAT1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_face_rel$CONTCHW12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(CONTCHW12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with children") + ylab("Frequency")

vari <- ALSA_w12_cont_rel$RELAT1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_face_rel$CONTGDW12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(CONTGDW12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Contact with grandchildren") + ylab("Frequency")


vari <- ALSA_w12_cont_rel$RELAT1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_oth_rel$PHCNCHW12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(PHCNCHW12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with children") + ylab("Frequency")

vari <- ALSA_w12_cont_rel$RELAT1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_oth_rel$PHCNGDW12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(PHCNGDW12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Phone contact with grandchildren") + ylab("Frequency")

vari <- ALSA_w12_cont_rel$RELAT1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_oth_rel$MLFRCHW12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(MLFRCHW12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from children") + ylab("Frequency")

vari <- ALSA_w12_cont_rel$RELAT1W12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_oth_rel$MLFRGDW12, missing_values = NA)
ggplot(ALSA_w12_cont_rel, aes(x=factor(MLFRGDW12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Mail from grandchildren") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

First of all, an auxiliar variable home_rel (Are living in home with family members/relatives (= daily contact with family member)?) is created. It takes value 1 if answer is yes and 0 if not.

* `if any of RELAT1w12,..,RELAT3w12 is in 1:15 then recode into 1`
* `ELSE if all of RELAT1w12,..,RELAT3w12 are not in 1:15 then recode into 0`"
* `0 into 995`
* `NA into 999`


* `if any of 'PHCNCHW12','PHCNGDW12','MLFRCHW12','MLFRGDW12', 'CONTCHW12','CONTGDW12' or home_rel = 1 in 1:4 then recode into 1`
* `if all 'PHCNCHW12','PHCNGDW12','MLFRCHW12','MLFRGDW12', 'CONTCHW12','CONTGDW12' are in 5:6 and home_rel = 0 then recode into 0`
* `0 into 995`
* `NA into 999`

**R script:**

```{r harmo12, echo=TRUE}
ALSA_ds_w12 <- tibble(id=ALSA_w12_cont_rel$id)

# AUXILIAR VARIABLE
ALSA_w12_cont_rel$RELAT1W12 <- car::recode(as.vector(ALSA_w12_cont_rel$RELAT1W12), "NA='-999'")
ALSA_w12_cont_rel$RELAT2W12 <- car::recode(as.vector(ALSA_w12_cont_rel$RELAT2W12), "NA='-999'")
ALSA_w12_cont_rel$RELAT3W12 <- car::recode(as.vector(ALSA_w12_cont_rel$RELAT3W12), "NA='-999'")

ALSA_ds_w12$home_rel <- c(NA) 
for(i in 1:dim(ALSA_w12_cont_rel)[1]){
  if( ALSA_w12_cont_rel$RELAT1W12[i] %in% c(1:15) | ALSA_w12_cont_rel$RELAT2W12[i] %in% c(1:15) |
      ALSA_w12_cont_rel$RELAT3W12[i] %in% c(1:15) ) {
    ALSA_ds_w12$home_rel[i] = 1 }
  else if(  ALSA_w12_cont_rel$RELAT1W12[i] == -999 & ALSA_w12_cont_rel$RELAT2W12[i] == -999 &
      ALSA_w12_cont_rel$RELAT3W12[i] == -999 ) {
    ALSA_ds_w12$home_rel[i] = 999 }
  else if(  ALSA_w12_cont_rel$RELAT1W12[i] == 0 & ALSA_w12_cont_rel$RELAT2W12[i] == 0 &
      ALSA_w12_cont_rel$RELAT3W12[i] == 0 ) {
    ALSA_ds_w12$home_rel[i] = 995 }
  else if( !( ALSA_w12_cont_rel$RELAT1W12[i] %in% c(1:15) | ALSA_w12_cont_rel$RELAT2W12[i] %in% c(1:15) |
              ALSA_w12_cont_rel$RELAT3W12[i] %in% c(1:15) ) ) {
    ALSA_ds_w12$home_rel[i] = 0 }
}

ALSA_ds_w12$home_rel <- car::recode(as.vector(ALSA_ds_w12$home_rel), "NA='999'")
ALSA_ds_w12$home_rel <- labelled(ALSA_ds_w12$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))


# CONT_REL VARIABLE
ALSA_w12_cont_rel$PHCNCHW12 <- car::recode(as.vector(ALSA_w12_cont_rel$PHCNCHW12), "NA='-999'")
ALSA_w12_cont_rel$PHCNGDW12 <- car::recode(as.vector(ALSA_w12_cont_rel$PHCNGDW12), "NA='-999'")
ALSA_w12_cont_rel$MLFRCHW12 <- car::recode(as.vector(ALSA_w12_cont_rel$MLFRCHW12), "NA='-999'")
ALSA_w12_cont_rel$MLFRGDW12 <- car::recode(as.vector(ALSA_w12_cont_rel$MLFRGDW12), "NA='-999'")
ALSA_w12_cont_rel$CONTCHW12 <- car::recode(as.vector(ALSA_w12_cont_rel$CONTCHW12), "NA='-999'")
ALSA_w12_cont_rel$CONTGDW12 <- car::recode(as.vector(ALSA_w12_cont_rel$CONTGDW12), "NA='-999'")

ALSA_w12_cont_rel2 <- left_join(ALSA_w12_cont_rel, ALSA_ds_w12, by='id')

ALSA_ds_w12$cont_rel <- c(NA)
for(i in 1:dim(ALSA_w12_cont_rel2)[1]){
  if( ALSA_w12_cont_rel2$PHCNCHW12[i] %in% c(1,2,3,4) | 
      ALSA_w12_cont_rel2$PHCNGDW12[i] %in% c(1,2,3,4) | 
      ALSA_w12_cont_rel2$MLFRGDW12[i] %in% c(1,2,3,4) | 
      ALSA_w12_cont_rel2$MLFRGDW12[i] %in% c(1,2,3,4) |
      ALSA_w12_cont_rel2$CONTCHW12[i] %in% c(1,2,3,4) | 
      ALSA_w12_cont_rel2$CONTGDW12[i] %in% c(1,2,3,4) |
      ALSA_w12_cont_rel2$home_rel[i] == 1) {
  ALSA_ds_w12$cont_rel[i] = 1 }
  else if( ALSA_w12_cont_rel2$PHCNCHW12[i] %in% c(5,6) & 
           ALSA_w12_cont_rel2$PHCNGDW12[i] %in% c(5,6) &
         ALSA_w12_cont_rel2$MLFRCHW12[i] %in% c(5,6) & 
         ALSA_w12_cont_rel2$MLFRGDW12[i] %in% c(5,6) &
         ALSA_w12_cont_rel2$CONTCHW12[i] %in% c(5,6) & 
         ALSA_w12_cont_rel2$CONTGDW12[i] %in% c(5,6) &
         ALSA_w12_cont_rel2$home_rel[i] == 0) {
  ALSA_ds_w12$cont_rel[i] = 0 }
  else if( ALSA_w12_cont_rel2$PHCNCHW12[i] == 0 &
           ALSA_w12_cont_rel2$PHCNGDW12[i] == 0 &
         ALSA_w12_cont_rel2$MLFRCHW12[i] == 0 &
         ALSA_w12_cont_rel2$MLFRGDW12[i] == 0 & 
         ALSA_w12_cont_rel2$CONTCHW12[i] == 99 &
         ALSA_w12_cont_rel2$home_rel[i] == 995) {
  ALSA_ds_w12$cont_rel[i] = 995 }
  }

ALSA_ds_w12$cont_rel <- car::recode(as.vector(ALSA_ds_w12$cont_rel), "NA='999'")
ALSA_ds_w12$cont_rel <- labelled(ALSA_ds_w12$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))


```

#### Statistical description of the new harmonised variable
```{r descript12, echo=F}
vari <- ALSA_ds_w12$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w12$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w12, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation12, echo=F}

```

 

### Wave13

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `RELAT1w13`, `RELAT2w13`,`RELAT3w13`
* Label: `relationship with person one`,...,`relationship with person three`
* Categories:
    + `1 = Spouse`
    + `2 = Son`
    + `3 = Daughter`
    + `4 = Son-in-law`
    + `5 = Daughter-in-law`
    + `6 = Grandchild`
    + `7 = Parent`
    + `8 = Parent-in-law`
    + `9 = Brother or sister`
    + `10 = Brother or sister-in-law`
    + `11 = Nephew or niece`
    + `12 = Cousin`
    + `13 = Uncle or aunt`
    + `14 = Great grandchild`
    + `15 = Other relative`
    + `16 = Friend`
    + `17 = Boarder or lodger`
    + `18 = Other`

Note that in this wave only information about housebold is available.
* Description: 

```{r assign13, echo=F}
opal.assign.table.tibble(o, 'ALSA_w13_cont_rel','ALSA.ALSA-Wave13', 
                        variables=list('RELAT1W13','RELAT2W13','RELAT3W13'), missings = TRUE)
```

```{r local13, echo=F}
ALSA_w13_cont_rel <- opal.execute(o,'ALSA_w13_cont_rel')

vari <- ALSA_w13_cont_rel$RELAT1W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w13_cont_rel$RELAT1W13, missing_values = NA)
ggplot(ALSA_w13_cont_rel, aes(x=factor(RELAT1W13))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person one") + ylab("Frequency")

vari <- ALSA_w13_cont_rel$RELAT2W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w13_cont_rel$RELAT1W13, missing_values = NA)
ggplot(ALSA_w13_cont_rel, aes(x=factor(RELAT2W13))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person 2") + ylab("Frequency")

vari <- ALSA_w13_cont_rel$RELAT3W13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`)
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w13_cont_rel$RELAT1W13, missing_values = NA)
ggplot(ALSA_w13_cont_rel, aes(x=factor(RELAT3W13))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship with person 3") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any of RELAT1W13,..,RELAT3W13 is in 1:15 then recode into 1`
* `ELSE if all of RELAT1W13,..,RELAT3W13 are not in 1:15 then recode into 0`"
* `0 into 995`
* `NA into 999`

**R script:**

```{r harmo13, echo=TRUE}
ALSA_ds_w13 <- tibble(id=ALSA_w13_cont_rel$id)

ALSA_w13_cont_rel$RELAT1W13 <- car::recode(as.vector(ALSA_w13_cont_rel$RELAT1W13), "NA='-999'")
ALSA_w13_cont_rel$RELAT2W13 <- car::recode(as.vector(ALSA_w13_cont_rel$RELAT2W13), "NA='-999'")
ALSA_w13_cont_rel$RELAT3W13 <- car::recode(as.vector(ALSA_w13_cont_rel$RELAT3W13), "NA='-999'")

ALSA_ds_w13$home_rel <- c(NA) 
for(i in 1:dim(ALSA_w13_cont_rel)[1]){
  if( ALSA_w13_cont_rel$RELAT1W13[i] %in% c(1:15) | ALSA_w13_cont_rel$RELAT2W13[i] %in% c(1:15) | ALSA_w13_cont_rel$RELAT3W13[i] %in% c(1:15) ) {
    ALSA_ds_w13$home_rel[i] = 1 }
  else if( ALSA_w13_cont_rel$RELAT1W13[i] == -999 & ALSA_w13_cont_rel$RELAT2W13[i] == -999 & ALSA_w13_cont_rel$RELAT3W13[i] == -999 ) {
    ALSA_ds_w13$home_rel[i] = 999 }
  else if( ALSA_w13_cont_rel$RELAT1W13[i] == 0 & ALSA_w13_cont_rel$RELAT2W13[i] == 0 & ALSA_w13_cont_rel$RELAT3W13[i] == 0 ) {
    ALSA_ds_w13$home_rel[i] = 995 }
  else if( !(ALSA_w13_cont_rel$RELAT1W13[i] %in% c(1:15) | ALSA_w13_cont_rel$RELAT2W13[i] %in% c(1:15) | ALSA_w13_cont_rel$RELAT3W13[i] %in% c(1:15)) ) {
    ALSA_ds_w13$home_rel[i] = 0 }
}

ALSA_ds_w13$home_rel <- car::recode(as.vector(ALSA_ds_w13$home_rel), "NA='999'")
ALSA_ds_w13$home_rel <- labelled(ALSA_ds_w13$home_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))

ALSA_ds_w13$cont_rel <- ALSA_ds_w13$home_rel
```

#### Statistical description of the new harmonised variable
```{r descript13, echo=F}
vari <-  ALSA_ds_w13$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w13$home_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w13, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are any form of contact with family members/relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation13, echo=F}

```








```{r final, echo=F}

l.hds <- list(w1 = ALSA_ds_w1, w2 = ALSA_ds_w2, w3 = ALSA_ds_w3, w4 = ALSA_ds_w4, w5 = ALSA_ds_w5, w6 = ALSA_ds_w6, w7 = ALSA_ds_w7, w8 = ALSA_ds_w8, w9 = ALSA_ds_w9, w10 = ALSA_ds_w10, w11 = ALSA_ds_w11, w12 = ALSA_ds_w12, w13 = ALSA_ds_w13)

for(name in names(l.hds)) {
  aux_object <- l.hds[[name]]
  label(l.hds[[name]][["cont_rel"]]) <- label(aux_object[["cont_rel"]]) <- ds_label # Text value assigned at the DS description, at the top
  l.hds[[name]][["cont_rel"]] <- labelled(l.hds[[name]][["cont_rel"]], labels = cat_label)
  aux_object[["cont_rel"]] <- car::recode(aux_object[["cont_rel"]], "miss_values_vector=NA")
  aux_object[["cont_rel"]] <- labelled(aux_object[["cont_rel"]], labels = cat_label[1:2])
  m_name <- paste0("ALSA_m_ds_",name)
  assign(m_name, aux_object)
  rm(aux_object)
}

```

## Summary of descriptive statistics of the harmonised variable accross populations and waves

Two tables are generated: 

1. Percentages of categories in each harmonised variable.

2. Frequencies and percentages of individuals with different trajectories. To avoid too large table, Only trajectories with percentages larger than 0.3 are shown.


```{r summ}

t.hds <- frq(l.hds[[1]]["cont_rel"])[[1]][,c(1,2)] 
for (i in seq_along(l.hds)){
  t.hds[2+i] <- frq(l.hds[[i]]["cont_rel"])[[1]][,4] 
}
t.hds[13,] <- c("n", "sample size", sapply(l.hds,function(wave) length(wave[[1]]))
             )
names(t.hds)<-c("val", "label",names(l.hds))
kable(t.hds)

dbb <- get(paste0("ALSA_m_ds_",names(l.hds)[1]))[,c("id","cont_rel")]
for(ind in 2:length(l.hds)){
  dbb <- merge(dbb, get(paste0("ALSA_m_ds_",names(l.hds)[ind]))[,c("id","cont_rel")], by = "id", suffixes = c("", paste0(".",names(l.hds)[ind])), all = T)
}
names(dbb) <- c("id", names(l.hds))

v.dbb <- dbb[,2]
for(ind in 2:length(l.hds)){
  v.dbb <- paste(v.dbb,dbb[,ind+1],sep="")
}
f.dbb <- frq(v.dbb)[[1]][,c(1,2,4)]
kable(f.dbb[f.dbb[,3]>=0.3,])

```






```{r save, echo=FALSE}
cont_rel <- ALSA_ds_w1[,-2]
save(cont_rel, file = "../RData/w1/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w2[,-2]
save(cont_rel, file = "../RData/w2/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w3[,-2]
save(cont_rel, file = "../RData/w3/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w4[,-c(2,3)]
save(cont_rel, file = "../RData/w4/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w5[,-2]
save(cont_rel, file = "../RData/w5/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w6[,-2]
save(cont_rel, file = "../RData/w6/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w7
save(cont_rel, file = "../RData/w7/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w8[,-c(2,3)]
save(cont_rel, file = "../RData/w8/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w9[,-2]
save(cont_rel, file = "../RData/w9/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w10[,-2]
save(cont_rel, file = "../RData/w10/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w11[,-2]
save(cont_rel, file = "../RData/w11/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w12[,-2]
save(cont_rel, file = "../RData/w12/cont_rel.RData")
rm(cont_rel)

cont_rel <- ALSA_ds_w13[,-2]
save(cont_rel, file = "../RData/w13/cont_rel.RData")
rm(cont_rel)


```

# Quality estimation
```{r closeRsession, echo=FALSE} 
opal.logout(o)
```


