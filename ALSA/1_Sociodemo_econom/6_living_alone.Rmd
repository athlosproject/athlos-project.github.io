---
title: "Living alone"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---
  
<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_laia.r")
```
<!-- ########################################################## --> 

# Description of DataSchema variable

The description of harmonised variable is the following:


* Short name: `living_alone`
* Variable label: `Participant is currently living alone`
* Variable description: `Participant is currently living alone`
* Domain: `Socio-demographic and economic characteristics`
* Value type: `categorical`
* Category coding:

**Code** | **Category Label**
-------- | ------------------
0        | No
1        | Yes

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing


# Data process 

## ALSA

### Wave 1 

#### Study-specific variable description



| **Name** | `HOWMANY`|
|-|-|
| **Label** | `Number of others in household` |
| **Table name** | `ALSA-Wave1` |
| **Missings** |`99 = Missing`|
| **Description** |  |

    
```{r assign1, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_la','ALSA.ALSA-Wave1',
                         variables=list('HOWMANY'), missings = TRUE)
```

```{r local1, echo=F}
ALSA_w1_la <- opal.execute(o,'ALSA_w1_la')
vari <- ALSA_w1_la$HOWMANY
kable(Categorical_summary(vari, missing_values = c(99))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(99))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(99))[2], caption = "Type of missing")
##Categorical_summary(var = ALSA_w1_la$HOWMANY, missing_values = c(99))
ggplot(ALSA_w1_la, aes(x=factor(HOWMANY))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* `recode 0 into 1`
* `>=1 into 0`
* `recode 99 "Missing" into 999`
* `NA into 999`

**R script:**

```{r harmo1}
ALSA_ds_w1 <- tibble(id=ALSA_w1_la$id)
ALSA_ds_w1$living_alone <- car::recode(ALSA_w1_la$HOWMANY, "0=1; 1:hi=0; NA=999")
ALSA_ds_w1$living_alone <- labelled(ALSA_ds_w1$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript1, echo=F}
vari <- ALSA_ds_w1$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w1$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w1, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1, echo=F}
BeforeH <- table(ALSA_w1_la$HOWMANY)
BeforeH <- c(sum(BeforeH[2:length(BeforeH)]), BeforeH[1], sum(is.na(ALSA_w1_la$HOWMANY)))
AfterH <- table(ALSA_ds_w1$living_alone)
C <- rbind(BeforeH,AfterH)
colnames(C) <- c(">=1->0","0->1", "NA->999")
kable(C)
```







### Wave 2 

#### Study-specific variable description



| **Name** | `Q2`|`Q2A`|`HOWMANY`|
|-|-|-|-|
| **Label** | `People still living with you?` |`Anyone else now living in your household` |`Number of others in household`|
| **Table name** | `ALSA-Wave2` |`ALSA-Wave2` |`ALSA-Wave1`|
| **Categories** |`1 = Yes; 2 = No`|`1 = Yes; 2 = No`|  |
| **Missings** |  |  |  `99` |
| **Description** |  |  |  |


    
```{r assign2, echo=F}
opal.assign.table.tibble(o, 'ALSA_w2_la','ALSA.ALSA-Wave2',
                         variables=list('Q2', 'Q2A'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w1_la','ALSA.ALSA-Wave1',
                         variables=list('HOWMANY'), missings = TRUE)
```

```{r local2, echo=F}
ALSA_w2_la <- opal.execute(o,'ALSA_w2_la')
ALSA_w1_la <- opal.execute(o,'ALSA_w1_la')

vari <- ALSA_w2_la$Q2
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_la$Q2, missing_values = NA)
ggplot(ALSA_w2_la, aes(x=factor(Q2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")

vari <- ALSA_w2_la$Q2A
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w2_la$Q2A, missing_values = NA)
ggplot(ALSA_w2_la, aes(x=factor(Q2A))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variables they have to be recoded as follows:

* `if living_alone_w1 = 1`
        + `if Q2A = 1 => 0`
        + `if Q2A = 2 => 1`
        + `if Q2A = NA => 999`
* `if living_alone_w1 = 0 or 999`
    - `if Q2 = 1 => 0`
    - `if Q2 = 2`
        + `if Q2A = 1 => 0`
        + `if Q2A = 2 => 1` 
        + `if Q2A = NA => 999`
    - `if Q2 = NA`
        + `if Q2A = 1 => 0`
        + `if Q2A = 2 => 999`
        + `if Q2A = NA => 999`


**R script:**

```{r harmo2}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], HOWMANY=as.numeric(new_2[,2]))
  new_22
}

ALSA_w2_la$HOWMANY <- Add_indiv(old = ALSA_w1_la, new = ALSA_w2_la)$HOWMANY

ALSA_w2_la$living_alone_w1 <- car::recode(ALSA_w2_la$HOWMANY, "0=1; 1:hi=0; NA=999")
  
  
linv_alone_ALSA <- function(la_w1, Still_living, anyone_living){
  n <- length(la_w1)
  LA_w2 <- rep(NA,n)
  Still_living <- car::recode(Still_living, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  
  for(i in 1:n){
    if(la_w1[i]==1){
      if(anyone_living[i]==1){LA_w2[i] <- 0}
      if(anyone_living[i]==2){LA_w2[i] <- 1}
      if(anyone_living[i]==999){LA_w2[i] <- 999}
      
    } 
    if(la_w1[i]==0 | la_w1[i]==999 ){
      if(Still_living[i]==1){LA_w2[i] <- 0}
      if(Still_living[i]==2){
        if(anyone_living[i]==1){LA_w2[i] <- 0}
        if(anyone_living[i]==2){LA_w2[i] <- 1}
        if(anyone_living[i]==999){LA_w2[i] <- 999} } 
      if(Still_living[i]==999){
        if(anyone_living[i]==1){LA_w2[i] <- 0}
        if(anyone_living[i]==2){LA_w2[i] <- 999}
        if(anyone_living[i]==999){LA_w2[i] <- 999}
      } }
      
    }
  
  LA_w2
  
}

ALSA_w2_la$living_alone_w2 <- linv_alone_ALSA(la_w1 = ALSA_w2_la$living_alone_w1, Still_living = ALSA_w2_la$Q2, anyone_living = ALSA_w2_la$Q2A)
  
  
ALSA_ds_w2 <- tibble(id=ALSA_w2_la$id)
ALSA_ds_w2$living_alone <- car::recode(ALSA_w2_la$living_alone_w2, "NA=999")
ALSA_ds_w2$living_alone <- labelled(ALSA_ds_w2$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript2, echo=F}
vari <- ALSA_ds_w2$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w2$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w2, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2, echo=F}
```







### Wave 3 

#### Study-specific variable description



| **Name** | `HMNEWW3`|
|-|-|
| **Label** | `NUMBER OF ADDITIONS TO HOUSEHOLD` |
| **Table name** | `ALSA-Wave3` |
| **Description** |  |

    
```{r assign3, echo=F}
opal.assign.table.tibble(o, 'ALSA_w3_la','ALSA.ALSA-Wave3',
                         variables=list('HMNEWW3'), missings = TRUE)
```

```{r local3, echo=F}
ALSA_w3_la <- opal.execute(o,'ALSA_w3_la')
vari <- ALSA_w3_la$HMNEWW3
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w3_la$HMNEWW3, missing_values = NA)
ggplot(ALSA_w3_la, aes(x=factor(HMNEWW3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if HMNEWW3 >= 1 then 0`
* `if HMNEWW3 = 0`
    + `if la_w2 = 0 or 999 => 999`
    + `if la_w2 = 1 => 1`
* `if HMNEWW3 = NA then 999`


**R script:**

```{r harmo3}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w2=as.numeric(new_2[,2]))
  new_22
}

ALSA_w3_la$LA_w2 <- Add_indiv(old = ALSA_ds_w2, new = ALSA_w3_la)$LA_w2


linv_alone_ALSA <- function(LA_previousW, anyone_living){
  n <- length(LA_previousW)
  LA_previousW <- car::recode(LA_previousW, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  LA <- rep(NA,n)
  for(i in 1:n){
    if(anyone_living[i]>=1 & anyone_living[i]<900){LA[i] <- 0} 
    if(anyone_living[i]==0){
      if(LA_previousW[i]==0 | LA_previousW[i]==999){LA[i] <- 999}
      if(LA_previousW[i]==1){LA[i] <- 1}
    }
    if(anyone_living[i]==999){LA[i] <- 0} 
  }
  LA
  
}

ALSA_w3_la$living_alone_w3 <- linv_alone_ALSA(LA_previousW = ALSA_w3_la$LA_w2, anyone_living = ALSA_w3_la$HMNEWW3)


ALSA_ds_w3 <- tibble(id=ALSA_w3_la$id)
ALSA_ds_w3$living_alone <- car::recode(ALSA_w3_la$living_alone_w3, "NA=999")
ALSA_ds_w3$living_alone <- labelled(ALSA_ds_w3$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript3, echo=F}
vari <- ALSA_ds_w3$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w3$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w3, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation3, echo=F}
```








### Wave 4 

#### Study-specific variable description



| **Name** | `CORESW4`|`NEWRESW4`|
|-|-|-|
| **Label** | `PEOPLE STILL LIVING WITH YOU??` |`IS THERE ANYONE ELSE NOW LIVING IN YOUR` |
| **Table name** | `ALSA-Wave4` |`ALSA-Wave4` |
| **Categories** |`1 = Yes; 2 = No`|`1 = Yes; 2 = No`|
| **Description** |  |  |

    
```{r assign4, echo=F}
opal.assign.table.tibble(o, 'ALSA_w4_la','ALSA.ALSA-Wave4',
                         variables=list('CORESW4', 'NEWRESW4'), missings = TRUE)
```

```{r local4, echo=F}
ALSA_w4_la <- opal.execute(o,'ALSA_w4_la')

vari <- ALSA_w4_la$CORESW4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_la$CORESW4, missing_values = NA)
ggplot(ALSA_w4_la, aes(x=factor(CORESW4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("People still living with you?") + ylab("Frequency")

vari <- ALSA_w4_la$NEWRESW4
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w4_la$NEWRESW4, missing_values = NA)
ggplot(ALSA_w4_la, aes(x=factor(NEWRESW4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is there anyone else now living in your?") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variables they have to be recoded as follows:

* `if living_alone_w3 = 1`
        + `if NEWRESW4 = 1 => 0`
        + `if NEWRESW4 = 2 => 1`
        + `if NEWRESW4 = NA => 999`
* `if living_alone_w3 = 0 or 999`
    - `if CORESW4 = 1 => 0`
    - `if CORESW4 = 2`
        + `if NEWRESW4 = 1 => 0`
        + `if NEWRESW4 = 2 => 1` 
        + `if NEWRESW4 = NA => 999`
    - `if CORESW4 = NA`
        + `if NEWRESW4 = 1 => 0`
        + `if NEWRESW4 = 2 => 999`
        + `if NEWRESW4 = NA => 999`

**R script:**

```{r harmo4}
same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w3=as.numeric(new_2[,2]))
  new_22
}

ALSA_w4_la$LA_w3 <- same_indiv(old = ALSA_ds_w3, new = ALSA_w4_la)$LA_w3


linv_alone_ALSA <- function(la_previousW, Still_living, anyone_living){
  n <- length(la_previousW)
  LA <- rep(NA,n)
  la_previousW <- car::recode(la_previousW, "NA=999")
  Still_living <- car::recode(Still_living, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  
  for(i in 1:n){
    if(la_previousW[i]==1){
      if(anyone_living[i]==1){LA[i] <- 0}
      if(anyone_living[i]==2){LA[i] <- 1}
      if(anyone_living[i]==999){LA[i] <- 999}
      
    } 
    if(la_previousW[i]==0 | la_previousW[i]==999 ){
      if(Still_living[i]==1){LA[i] <- 0}
      if(Still_living[i]==2){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 1}
        if(anyone_living[i]==999){LA[i] <- 999} } 
      if(Still_living[i]==999){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 999}
        if(anyone_living[i]==999){LA[i] <- 999}
      } }
      
    }
  
  LA
  
}

ALSA_w4_la$living_alone_w4 <- linv_alone_ALSA(la_previousW = ALSA_w4_la$LA_w3, Still_living = ALSA_w4_la$CORESW4, anyone_living = ALSA_w4_la$NEWRESW4)



ALSA_ds_w4 <- tibble(id=ALSA_w4_la$id)
ALSA_ds_w4$living_alone <- car::recode(ALSA_w4_la$living_alone_w4, "NA=999")
ALSA_ds_w4$living_alone <- labelled(ALSA_ds_w4$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript4, echo=F}
vari <- ALSA_ds_w4$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w4$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w4, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation4, echo=F}
```







### Wave 5 

#### Study-specific variable description



| **Name** | `CORESW5`| `NEWRE1W5`| `NEWRE2W5`| `NEWRE3W5`|`NEWRE4W5`|
|-|-|-|-|-|-|
| **Label** | `Q2 I AM NOW GOING TO READ OUT THE NAMES??` |`Q2A IS THERE ANYONE ELSE NOW LIVING IN` | `Q2A.2 IS THERE ANYONE ELSE NOW LIVING I` | `Q2A.3 IS THERE ANYONE ELSE NOW LIVING I` |`Q2A.4 IS THERE ANYONE ELSE NOW LIVING I` |
| **Table name** | `ALSA-Wave5` | `ALSA-Wave5` |`ALSA-Wave5` |`ALSA-Wave5` |`ALSA-Wave5` |
| **Categories** |`1 = Yes; 2 = No`|`1 = Yes; 2 = No`|`1 = Yes; 2 = No`|`1 = Yes; 2 = No`|`1 = Yes; 2 = No`|
| **Missings** |`3 = Refused/Dont know (do not read)`|  |  |  |  |
| **Description** |  |  |  |  |  |



```{r assign5, echo=F}
opal.assign.table.tibble(o, 'ALSA_w5_la','ALSA.ALSA-Wave5',
                         variables=list('CORESW5', 'NEWRE1W5', 'NEWRE2W5', 'NEWRE3W5', 'NEWRE4W5'), missings = TRUE)

```

```{r local5, echo=F}
ALSA_w5_la <- opal.execute(o,'ALSA_w5_la')

vari <- ALSA_w5_la$CORESW5
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(3))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w5_la$CORESW5, missing_values = 3)
ggplot(ALSA_w5_la, aes(x=factor(CORESW5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")

vari <- ALSA_w5_la$NEWRE1W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w5_la$NEWRE1W5, missing_values = NA)
ggplot(ALSA_w5_la, aes(x=factor(NEWRE1W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")

vari <- ALSA_w5_la$NEWRE2W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w5_la$NEWRE2W5, missing_values = NA)
ggplot(ALSA_w5_la, aes(x=factor(NEWRE2W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")


vari <- ALSA_w5_la$NEWRE3W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w5_la$NEWRE3W5, missing_values = NA)
ggplot(ALSA_w5_la, aes(x=factor(NEWRE3W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")


vari <- ALSA_w5_la$NEWRE4W5
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w5_la$NEWRE4W5, missing_values = NA)
ggplot(ALSA_w5_la, aes(x=factor(NEWRE4W5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variables they have to be recoded as follows:

* `if living_alone_w4 = 1`
        + `if NEWRESW5 = 1 => 0`
        + `if NEWRESW5 = 2 => 1`
        + `if NEWRESW5 = NA => 999`
* `if living_alone_w4 = 0 or 999`
    - `if CORESW5 = 1 => 0`
    - `if CORESW5 = 2`
        + `if NEWRESW5 = 1 => 0`
        + `if NEWRESW5 = 2 => 1` 
        + `if NEWRESW5 = NA => 999`
    - `if CORESW5 = NA`
        + `if NEWRESW5 = 1 => 0`
        + `if NEWRESW5 = 2 => 999`
        + `if NEWRESW5 = NA => 999`

**R script:**

```{r harmo5}
#First of all, it is going to compute a NEWRESW5 join NEWREXW5 (X=1, 2, 3, 4):

ALSA_w5_la$NEWRESW5 <- ALSA_w5_la$NEWRE1W5
sum(is.na(ALSA_w5_la$NEWRE2W5[is.na(ALSA_w5_la$NEWRESW5)]))
sum(is.na(ALSA_w5_la$NEWRE3W5[is.na(ALSA_w5_la$NEWRESW5)]))
sum(is.na(ALSA_w5_la$NEWRE4W5[is.na(ALSA_w5_la$NEWRESW5)]))

#There is not any new value. 


Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w4=as.numeric(new_2[,2]))
  new_22
}


ALSA_w5_la$LA_w4 <- Add_indiv(old = ALSA_ds_w4, new = ALSA_w5_la)$LA_w4
  
  
linv_alone_ALSA <- function(la_previousW, Still_living, anyone_living){
  n <- length(la_previousW)
  LA <- rep(NA,n)
  la_previousW <- car::recode(la_previousW, "NA=999")
  Still_living <- car::recode(Still_living, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  
  for(i in 1:n){
    if(la_previousW[i]==1){
      if(anyone_living[i]==1){LA[i] <- 0}
      if(anyone_living[i]==2){LA[i] <- 1}
      if(anyone_living[i]==999){LA[i] <- 999}
      
    } 
    if(la_previousW[i]==0 | la_previousW[i]==999 ){
      if(Still_living[i]==1){LA[i] <- 0}
      if(Still_living[i]==2){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 1}
        if(anyone_living[i]==999){LA[i] <- 999} } 
      if(Still_living[i]==999){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 999}
        if(anyone_living[i]==999){LA[i] <- 999}
      } }
      
    }
  
  LA
  
}

ALSA_w5_la$living_alone_w4 <- linv_alone_ALSA(la_previousW = ALSA_w5_la$LA_w4, Still_living = ALSA_w5_la$CORESW5, anyone_living = ALSA_w5_la$NEWRESW5)



ALSA_ds_w5 <- tibble(id=ALSA_w5_la$id)
ALSA_ds_w5$living_alone <- car::recode(ALSA_w5_la$living_alone_w4, "NA=999")
ALSA_ds_w5$living_alone <- labelled(ALSA_ds_w5$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript5, echo=F}
vari <- ALSA_ds_w5$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w5$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w5, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation5, echo=F}
```







### Wave 6 

#### Study-specific variable description



| **Name** | `HOWMANW6`|
|-|-|
| **Label** | `how many people live with you` |
| **Table name** | `ALSA-Wave6` |
| **Description** |  |

    
```{r assign6, echo=F}
opal.assign.table.tibble(o, 'ALSA_w6_la','ALSA.ALSA-Wave6',
                         variables=list('HOWMANW6'), missings = TRUE)
```

```{r local6, echo=F}
ALSA_w6_la <- opal.execute(o,'ALSA_w6_la')
vari <- ALSA_w6_la$HOWMANW6
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w6_la$HOWMANW6, missing_values = NA)
ggplot(ALSA_w6_la, aes(x=factor(HOWMANW6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if HOWMANW6 >= 1 then 0`
* `if HOWMANW6 = 0`
    + `if la_w5 = 0 or 999 => 999`
    + `if la_w5 = 1 => 1`
* `if HOWMANW6 = NA then 999`

**R script:**

```{r harmo6}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w5=as.numeric(new_2[,2]))
  new_22
}

ALSA_w6_la$LA_w5 <- Add_indiv(old = ALSA_ds_w5, new = ALSA_w6_la)$LA_w5


linv_alone_ALSA <- function(LA_previousW, anyone_living){
  n <- length(LA_previousW)
  LA_previousW <- car::recode(LA_previousW, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  LA <- rep(NA,n)
  for(i in 1:n){
    if(anyone_living[i]>=1 & anyone_living[i]<900){LA[i] <- 0} 
    if(anyone_living[i]==0){
      if(LA_previousW[i]==0 | LA_previousW[i]==999){LA[i] <- 999}
      if(LA_previousW[i]==1){LA[i] <- 1}
    }
    if(anyone_living[i]==999){LA[i] <- 0} 
  }
  LA
  
}

ALSA_w6_la$living_alone_w6 <- linv_alone_ALSA(LA_previousW = ALSA_w6_la$LA_w5, anyone_living = ALSA_w6_la$HOWMANW6)


ALSA_ds_w6 <- tibble(id=ALSA_w6_la$id)
ALSA_ds_w6$living_alone <- car::recode(ALSA_w6_la$living_alone_w6, "NA=999")
ALSA_ds_w6$living_alone <- labelled(ALSA_ds_w6$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript6, echo=F}
vari <- ALSA_ds_w6$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w6$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w6, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6, echo=F}
```







### Wave 7 

#### Study-specific variable description



| **Name** | `howmanw7`|
|-|-|
| **Label** | `how many people live with you` |
| **Table name** | `ALSA-Wave7` |
| **Description** |  |

    
```{r assign7, echo=F}
opal.assign.table.tibble(o, 'ALSA_w7_la','ALSA.ALSA-Wave7',
                         variables=list('howmanw7'), missings = TRUE)
```

```{r local7, echo=F}
ALSA_w7_la <- opal.execute(o,'ALSA_w7_la')
vari <-  ALSA_w7_la$howmanw7
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w7_la$howmanw7, missing_values = NA)
ggplot(ALSA_w7_la, aes(x=factor(howmanw7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* `if howmanw7 >= 1 then 0`
* `if howmanw7 = 0`
    + `if la_w5 = 0 or 999 => 999`
    + `if la_w5 = 1 => 1`
* `if howmanw7 = NA then 999`


**R script:**

```{r harmo7}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w6=as.numeric(new_2[,2]))
  new_22
}

ALSA_w7_la$LA_w6 <- Add_indiv(old = ALSA_ds_w6, new = ALSA_w7_la)$LA_w6


linv_alone_ALSA <- function(LA_previousW, anyone_living){
  n <- length(LA_previousW)
  LA_previousW <- car::recode(LA_previousW, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  LA <- rep(NA,n)
  for(i in 1:n){
    if(anyone_living[i]>=1 & anyone_living[i]<900){LA[i] <- 0} 
    if(anyone_living[i]==0){
      if(LA_previousW[i]==0 | LA_previousW[i]==999){LA[i] <- 999}
      if(LA_previousW[i]==1){LA[i] <- 1}
    }
    if(anyone_living[i]==999){LA[i] <- 0} 
  }
  LA
  
}

ALSA_w7_la$living_alone_w7 <- linv_alone_ALSA(LA_previousW = ALSA_w7_la$LA_w6, anyone_living = ALSA_w7_la$howmanw7)


ALSA_ds_w7 <- tibble(id=ALSA_w7_la$id)
ALSA_ds_w7$living_alone <- car::recode(ALSA_w7_la$living_alone_w7, "NA=999")
ALSA_ds_w7$living_alone <- labelled(ALSA_ds_w7$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript7, echo=F}
vari <- ALSA_ds_w7$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w7$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w7, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation7, echo=F}
```







### Wave 8 

#### Study-specific variable description



| **Name** | `coresw8`|`newresw8`|
|-|-|-|
| **Label** | `People still living with you?` | `New household members` |
| **Table name** | `ALSA-Wave8` |`ALSA-Wave8` |
| **Categories** |`1 = Yes; 2 = No`|`1 = Yes; 2 = No`|
| **Missings** |`0 = Not Answered`|`0 = Not Answered`|
| **Description** |  |  |

    
```{r assign8, echo=F}
opal.assign.table.tibble(o, 'ALSA_w8_la','ALSA.ALSA-Wave8',
                         variables=list('coresw8', 'newresw8'), missings = TRUE)
```

```{r local8, echo=F}
ALSA_w8_la <- opal.execute(o,'ALSA_w8_la')

vari <- ALSA_w8_la$coresw8
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w8_la$coresw8, missing_values = 0)
ggplot(ALSA_w8_la, aes(x=factor(coresw8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("People still living with you?") + ylab("Frequency")

vari <- ALSA_w8_la$newresw8
kable(Categorical_summary(vari, missing_values = c(0))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(0))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(0))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w8_la$newresw8, missing_values = 0)
ggplot(ALSA_w8_la, aes(x=factor(newresw8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variables they have to be recoded as follows:

* `if living_alone_w7 = 1`
        + `if newresw8 = 1 => 0`
        + `if newresw8 = 2 => 1`
        + `if newresw8 = NA => 999`
* `if living_alone_w7 = 0 or 999`
    - `if coresw8 = 1 => 0`
    - `if coresw8 = 2`
        + `if newresw8 = 1 => 0`
        + `if newresw8 = 2 => 1` 
        + `if newresw8 = NA => 999`
    - `if coresw8 = NA`
        + `if newresw8 = 1 => 0`
        + `if newresw8 = 2 => 999`
        + `if newresw8 = NA => 999`

**R script:**

```{r harmo8}
same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w7=as.numeric(new_2[,2]))
  new_22
}

ALSA_w8_la$LA_w7 <- same_indiv(old = ALSA_ds_w7, new = ALSA_w8_la)$LA_w7


linv_alone_ALSA <- function(la_previousW, Still_living, anyone_living){
  n <- length(la_previousW)
  LA <- rep(NA,n)
  la_previousW <- car::recode(la_previousW, "NA=999")
  Still_living <- car::recode(Still_living, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  
  for(i in 1:n){
    if(la_previousW[i]==1){
      if(anyone_living[i]==1){LA[i] <- 0}
      if(anyone_living[i]==2){LA[i] <- 1}
      if(anyone_living[i]==999){LA[i] <- 999}
      
    } 
    if(la_previousW[i]==0 | la_previousW[i]==999 ){
      if(Still_living[i]==1){LA[i] <- 0}
      if(Still_living[i]==2){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 1}
        if(anyone_living[i]==999){LA[i] <- 999} } 
      if(Still_living[i]==999){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 999}
        if(anyone_living[i]==999){LA[i] <- 999}
      } }
      
    }
  
  LA
  
}

ALSA_w8_la$living_alone_w8 <- linv_alone_ALSA(la_previousW = ALSA_w8_la$LA_w7, Still_living = ALSA_w8_la$coresw8, anyone_living = ALSA_w8_la$newresw8)


ALSA_ds_w8 <- tibble(id=ALSA_w8_la$id)
ALSA_ds_w8$living_alone <- car::recode(ALSA_w8_la$living_alone_w8, "NA=999")
ALSA_ds_w8$living_alone <- labelled(ALSA_ds_w8$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript8, echo=F}
vari <- ALSA_ds_w8$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w8$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w8, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation8, echo=F}
```







### Wave 9 

#### Study-specific variable description



| **Name** | `HOWMANW9`|
|-|-|
| **Label** | `how many people live with you W9` |
| **Table name** | `ALSA-Wave9` |
| **Description** |  |

    
```{r assign9, echo=F}
opal.assign.table.tibble(o, 'ALSA_w9_la','ALSA.ALSA-Wave9',
                         variables=list('HOWMANW9'), missings = TRUE)
```

```{r local9, echo=F}
ALSA_w9_la <- opal.execute(o,'ALSA_w9_la')
vari <- ALSA_w9_la$HOWMANW9
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w9_la$HOWMANW9, missing_values = NA)
ggplot(ALSA_w9_la, aes(x=factor(HOWMANW9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if HOWMANW9 >= 1 then 0`
* `if HOWMANW9 = 0`
    + `if la_w8 = 0 or 999 => 999`
    + `if la_w8 = 1 => 1`
* `if HOWMANW9 = NA then 999`


**R script:**

```{r harmo9}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w8=as.numeric(new_2[,2]))
  new_22
}

ALSA_w9_la$LA_w8 <- Add_indiv(old = ALSA_ds_w8, new = ALSA_w9_la)$LA_w8


linv_alone_ALSA <- function(LA_previousW, anyone_living){
  n <- length(LA_previousW)
  LA_previousW <- car::recode(LA_previousW, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  LA <- rep(NA,n)
  for(i in 1:n){
    if(anyone_living[i]>=1 & anyone_living[i]<900){LA[i] <- 0} 
    if(anyone_living[i]==0){
      if(LA_previousW[i]==0 | LA_previousW[i]==999){LA[i] <- 999}
      if(LA_previousW[i]==1){LA[i] <- 1}
    }
    if(anyone_living[i]==999){LA[i] <- 0} 
  }
  LA
  
}

ALSA_w9_la$living_alone_w9 <- linv_alone_ALSA(LA_previousW = ALSA_w9_la$LA_w8, anyone_living = ALSA_w9_la$HOWMANW9)

ALSA_ds_w9 <- tibble(id=ALSA_w9_la$id)
ALSA_ds_w9$living_alone <- car::recode(ALSA_w9_la$living_alone_w9, "NA=999")
ALSA_ds_w9$living_alone <- labelled(ALSA_ds_w9$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript9, echo=F}
vari <- ALSA_ds_w9$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w9$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w9, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation9, echo=F}
```








### Wave 10 

#### Study-specific variable description



| **Name** | `coresw10`| `newrew10`|
|-|-|-|
| **Label** | `People still living with you?` |`New household members` |
| **Table name** | `ALSA-Wave10` | `ALSA-Wave10` |
| **Categories** |`0 = No; 1 = Yes`|`0 = No; 1 = Yes`|
| **Missings** |`99 = Not Answered`|`99 = Not Answered`|
| **Description** |  |  |

    
```{r assign10, echo=F}
opal.assign.table.tibble(o, 'ALSA_w10_la','ALSA.ALSA-Wave10',
                         variables=list('coresw10', 'newrew10'), missings = TRUE)
```

```{r local10, echo=F}
ALSA_w10_la <- opal.execute(o,'ALSA_w10_la')

vari <- ALSA_w10_la$coresw10
kable(Categorical_summary(vari, missing_values = c(99))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(99))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(99))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w10_la$coresw10, missing_values = 99)
ggplot(ALSA_w10_la, aes(x=factor(coresw10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")

vari <- ALSA_w10_la$newrew10
kable(Categorical_summary(vari, missing_values = c(99))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(99))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(99))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_w10_la$newrew10, missing_values = 99)
ggplot(ALSA_w10_la, aes(x=factor(newrew10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variables they have to be recoded as follows:

* `if living_alone_w9 = 1`
        + `if newrew10 = 1 => 0`
        + `if newrew10 = 2 => 1`
        + `if newrew10 = NA => 999`
* `if living_alone_w9 = 0 or 999`
    - `if coresw10 = 1 => 0`
    - `if coresw10 = 2`
        + `if newrew10 = 1 => 0`
        + `if newrew10 = 2 => 1` 
        + `if newrew10 = NA => 999`
    - `if coresw10 = NA`
        + `if newrew10 = 1 => 0`
        + `if newrew10 = 2 => 999`
        + `if newrew10 = NA => 999`



**R script:**

```{r harmo10}
same_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w9=as.numeric(new_2[,2]))
  new_22
}

ALSA_w10_la$LA_w9 <- same_indiv(old = ALSA_ds_w9, new = ALSA_w10_la)$LA_w9


linv_alone_ALSA <- function(la_previousW, Still_living, anyone_living){
  n <- length(la_previousW)
  LA <- rep(NA,n)
  la_previousW <- car::recode(la_previousW, "NA=999")
  Still_living <- car::recode(Still_living, "NA=999; 0=2")
  anyone_living <- car::recode(anyone_living, "NA=999; 0=2")
  
  for(i in 1:n){
    if(la_previousW[i]==1){
      if(anyone_living[i]==1){LA[i] <- 0}
      if(anyone_living[i]==2){LA[i] <- 1}
      if(anyone_living[i]==999){LA[i] <- 999}
      
    } 
    if(la_previousW[i]==0 | la_previousW[i]==999 ){
      if(Still_living[i]==1){LA[i] <- 0}
      if(Still_living[i]==2){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 1}
        if(anyone_living[i]==999){LA[i] <- 999} } 
      if(Still_living[i]==999){
        if(anyone_living[i]==1){LA[i] <- 0}
        if(anyone_living[i]==2){LA[i] <- 999}
        if(anyone_living[i]==999){LA[i] <- 999}
      } }
      
    }
  
  LA
  
}

ALSA_w10_la$living_alone_w10 <- linv_alone_ALSA(la_previousW = ALSA_w10_la$LA_w9, Still_living = ALSA_w10_la$coresw10, anyone_living = ALSA_w10_la$newrew10)



ALSA_ds_w10 <- tibble(id=ALSA_w10_la$id)
ALSA_ds_w10$living_alone <- car::recode(ALSA_w10_la$living_alone_w10, "NA=999")
ALSA_ds_w10$living_alone <- labelled(ALSA_ds_w10$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript10, echo=F}
vari <- ALSA_ds_w10$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w10$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w10, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation10, echo=F}
```








### Wave 11 

#### Study-specific variable description



| **Name** | `HOWMANW11`|
|-|-|
| **Label** | `how many people live with you W11` |
| **Table name** | `ALSA-Wave11` |
| **Description** |  |

    
```{r assign11, echo=F}
opal.assign.table.tibble(o, 'ALSA_w11_la','ALSA.ALSA-Wave11',
                         variables=list('HOWMANW11'), missings = TRUE)
```

```{r local11, echo=F}
ALSA_w11_la <- opal.execute(o,'ALSA_w11_la')
vari <- ALSA_w11_la$HOWMANW11
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w11_la$HOWMANW11, missing_values = NA)
ggplot(ALSA_w11_la, aes(x=factor(HOWMANW11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if HOWMANW11 >= 1 then 0`
* `if HOWMANW11 = 0`
    + `if la_w10 = 0 or 999 => 999`
    + `if la_w10 = 1 => 1`
* `if HOWMANW11 = NA then 999`

**R script:**

```{r harmo11}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w10=as.numeric(new_2[,2]))
  new_22
}

ALSA_w11_la$LA_w10 <- Add_indiv(old = ALSA_ds_w10, new = ALSA_w11_la)$LA_w10


linv_alone_ALSA <- function(LA_previousW, anyone_living){
  n <- length(LA_previousW)
  LA_previousW <- car::recode(LA_previousW, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  LA <- rep(NA,n)
  for(i in 1:n){
    if(anyone_living[i]>=1 & anyone_living[i]<900){LA[i] <- 0} 
    if(anyone_living[i]==0){
      if(LA_previousW[i]==0 | LA_previousW[i]==999){LA[i] <- 999}
      if(LA_previousW[i]==1){LA[i] <- 1}
    }
    if(anyone_living[i]==999){LA[i] <- 0} 
  }
  LA
  
}

ALSA_w11_la$living_alone_w11 <- linv_alone_ALSA(LA_previousW = ALSA_w11_la$LA_w10, anyone_living = ALSA_w11_la$HOWMANW11)

ALSA_ds_w11 <- tibble(id=ALSA_w11_la$id)
ALSA_ds_w11$living_alone <- car::recode(ALSA_w11_la$living_alone_w11, "NA=999")
ALSA_ds_w11$living_alone <- labelled(ALSA_ds_w11$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript11, echo=F}
vari <- ALSA_ds_w11$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w11$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w11, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation11, echo=F}
```










### Wave 12 

#### Study-specific variable description



| **Name** | `HOWMANW12`|
|-|-|
| **Label** | `how many people live with you W12` |
| **Table name** | `ALSA-Wave12` |
| **Description** |  |

    
```{r assign12, echo=F}
opal.assign.table.tibble(o, 'ALSA_w12_la','ALSA.ALSA-Wave12',
                         variables=list('HOWMANW12'), missings = TRUE)
```

```{r local12, echo=F}
ALSA_w12_la <- opal.execute(o,'ALSA_w12_la')
vari <-  ALSA_w12_la$HOWMANW12
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w12_la$HOWMANW12, missing_values = NA)
ggplot(ALSA_w12_la, aes(x=factor(HOWMANW12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if HOWMANW12 >= 1 then 0`
* `if HOWMANW12 = 0`
    + `if la_w11 = 0 or 999 => 999`
    + `if la_w11 = 1 => 1`
* `if HOWMANW12 = NA then 999`


**R script:**

```{r harmo12}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w11=as.numeric(new_2[,2]))
  new_22
}

ALSA_w12_la$LA_w11 <- Add_indiv(old = ALSA_ds_w11, new = ALSA_w12_la)$LA_w11


linv_alone_ALSA <- function(LA_previousW, anyone_living){
  n <- length(LA_previousW)
  LA_previousW <- car::recode(LA_previousW, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  LA <- rep(NA,n)
  for(i in 1:n){
    if(anyone_living[i]>=1 & anyone_living[i]<900){LA[i] <- 0} 
    if(anyone_living[i]==0){
      if(LA_previousW[i]==0 | LA_previousW[i]==999){LA[i] <- 999}
      if(LA_previousW[i]==1){LA[i] <- 1}
    }
    if(anyone_living[i]==999){LA[i] <- 0} 
  }
  LA
  
}

ALSA_w12_la$living_alone_w12 <- linv_alone_ALSA(LA_previousW = ALSA_w12_la$LA_w11, anyone_living = ALSA_w12_la$HOWMANW12)

ALSA_ds_w12 <- tibble(id=ALSA_w12_la$id)
ALSA_ds_w12$living_alone <- car::recode(ALSA_w12_la$living_alone_w12, "NA=999")
ALSA_ds_w12$living_alone <- labelled(ALSA_ds_w12$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript12, echo=F}
vari <- ALSA_ds_w12$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w12$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w12, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation12, echo=F}
```










### Wave 13 

#### Study-specific variable description



| **Name** | `HOWMANW13`|
|-|-|
| **Label** | `how many people live with you` |
| **Table name** | `ALSA-Wave13` |
| **Description** |  |

    
```{r assign13, echo=F}
opal.assign.table.tibble(o, 'ALSA_w13_la','ALSA.ALSA-Wave13',
                         variables=list('HOWMANW13'), missings = TRUE)
```

```{r local13, echo=F}
ALSA_w13_la <- opal.execute(o,'ALSA_w13_la')
vari <- ALSA_w13_la$HOWMANW13
kable(Categorical_summary(vari, missing_values = NA)[2], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
#Categorical_summary(var = ALSA_w13_la$HOWMANW13, missing_values = NA)
ggplot(ALSA_w13_la, aes(x=factor(HOWMANW13))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if HOWMANW13 >= 1 then 0`
* `if HOWMANW13 = 0`
    + `if la_w12 = 0 or 999 => 999`
    + `if la_w12 = 1 => 1`
* `if HOWMANW13 = NA then 999`

**R script:**

```{r harmo13}
Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], NA)
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], LA_w12=as.numeric(new_2[,2]))
  new_22
}

ALSA_w13_la$LA_w12 <- Add_indiv(old = ALSA_ds_w12, new = ALSA_w13_la)$LA_w12


linv_alone_ALSA <- function(LA_previousW, anyone_living){
  n <- length(LA_previousW)
  LA_previousW <- car::recode(LA_previousW, "NA=999")
  anyone_living <- car::recode(anyone_living, "NA=999")
  LA <- rep(NA,n)
  for(i in 1:n){
    if(anyone_living[i]>=1 & anyone_living[i]<900){LA[i] <- 0} 
    if(anyone_living[i]==0){
      if(LA_previousW[i]==0 | LA_previousW[i]==999){LA[i] <- 999}
      if(LA_previousW[i]==1){LA[i] <- 1}
    }
    if(anyone_living[i]==999){LA[i] <- 0} 
  }
  LA
  
}

ALSA_w13_la$living_alone_w13 <- linv_alone_ALSA(LA_previousW = ALSA_w13_la$LA_w12, anyone_living = ALSA_w13_la$HOWMANW13)

ALSA_ds_w13 <- tibble(id=ALSA_w13_la$id)
ALSA_ds_w13$living_alone <- car::recode(ALSA_w13_la$living_alone_w13, "NA=999")
ALSA_ds_w13$living_alone <- labelled(ALSA_ds_w13$living_alone, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996,  "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript13, echo=F}
vari <- ALSA_ds_w13$living_alone
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ALSA_ds_w13$living_alone, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ALSA_ds_w13, aes(x=factor(living_alone))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Living Alone") + ylab("Frequency")
```

#### Validation
```{r crosstabulation13, echo=F}
```
Information in each wave is different and also dependent from each other. This could introduce some bias and it also explains some percentage of the missing values.






# Quality estimation
[Comments on the quality of the new harmonised variable.]

```{r save, echo=FALSE}
living_alone <- ALSA_ds_w1
save(living_alone, file = "../RData/w1/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w2
save(living_alone, file = "../RData/w2/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w3
save(living_alone, file = "../RData/w3/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w4
save(living_alone, file = "../RData/w4/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w5
save(living_alone, file = "../RData/w5/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w6
save(living_alone, file = "../RData/w6/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w7
save(living_alone, file = "../RData/w7/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w8
save(living_alone, file = "../RData/w8/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w9
save(living_alone, file = "../RData/w9/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w10
save(living_alone, file = "../RData/w10/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w11
save(living_alone, file = "../RData/w11/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w12
save(living_alone, file = "../RData/w12/living_alone.RData")
rm(living_alone)

living_alone <- ALSA_ds_w13
save(living_alone, file = "../RData/w13/living_alone.RData")
rm(living_alone)
```


```{r closeRsession, echo=FALSE}
opal.logout(o)
```
