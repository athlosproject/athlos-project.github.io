---
title: "Year of Birth"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 
<!-- # Installation, loading packages -->
```{r setup, include=FALSE}
source("../../setup.r")
```
<!-- ########################################################## --> 
<!-- # Loading DS description -->
```{r main, child='../../_DS_Rmd/ybirthDS.Rmd'}
```
```{r global, echo=F}
source('../../_DS_Rmd/ybirthDS.R')
```

# Data process


## Australia

### Wave 1 

#### Study-specific variable description


| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |
    
```{r assign1, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
```

```{r local1, echo=F}


#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

vari <- ALSA_w1_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w1_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo1}
ALSA_ds_w1 <- tibble(id=ALSA_w1_ybirth$id)
ALSA_ds_w1$ybirth <- car::recode(ALSA_w1_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w1$ybirth <- labelled(ALSA_ds_w1$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript1, echo=F}
vari <- ALSA_ds_w1$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w1, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation1, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w1$ybirth!=ALSA_w1_ybirth$Year))
```



```{r importOPAL1, echo=F}

#opal.assign.data(o, 'ALSA_ds_w1', ALSA_ds_w1)
#opal.symbol_import(o,'ALSA_ds_w1', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w1 <- ALSA_ds_w1
ALSA_m_ds_w1$ybirth <- car::recode(ALSA_m_ds_w1$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w1', ALSA_m_ds_w1)
#opal.symbol_import(o,'ALSA_m_ds_w1', project='_Athlos_Harm_Dataset')
```





### Wave 2 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |
    
```{r assign2, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w2_id','ALSA.ALSA-Wave2',
                         variables=list('DATE'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w2_id <- opal.execute(o,'ALSA_w2_id')

```

```{r local2, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}


ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w2_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w2_id)

vari <- ALSA_w2_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w2_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo2}
ALSA_ds_w2 <- tibble(id=ALSA_w2_ybirth$id)
ALSA_ds_w2$ybirth <- car::recode(ALSA_w2_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w2$ybirth <- labelled(ALSA_ds_w2$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript2, echo=F}
vari <- ALSA_ds_w2$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w2, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation2, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w2$ybirth!=ALSA_w2_ybirth$Year))
```



```{r importOPAL2, echo=F}

#opal.assign.data(o, 'ALSA_ds_w2', ALSA_ds_w2)
#opal.symbol_import(o,'ALSA_ds_w2', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w2 <- ALSA_ds_w2
ALSA_m_ds_w2$ybirth <- car::recode(ALSA_m_ds_w2$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w2', ALSA_m_ds_w2)
#opal.symbol_import(o,'ALSA_m_ds_w2', project='_Athlos_Harm_Dataset')
```






### Wave 3 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |


```{r assign3, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w3_id','ALSA.ALSA-Wave3',
                         variables=list('SEXW3'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w3_id <- opal.execute(o,'ALSA_w3_id')

```

```{r local3, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w3_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w3_id)


vari <- ALSA_w3_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w3_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo3}
ALSA_ds_w3 <- tibble(id=ALSA_w3_ybirth$id)
ALSA_ds_w3$ybirth <- car::recode(ALSA_w3_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w3$ybirth <- labelled(ALSA_ds_w3$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript3, echo=F}
vari <- ALSA_ds_w3$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w3, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation3, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w3$ybirth!=ALSA_w3_ybirth$Year))
```



```{r importOPAL3, echo=F}

#opal.assign.data(o, 'ALSA_ds_w3', ALSA_ds_w3)
#opal.symbol_import(o,'ALSA_ds_w3', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w3 <- ALSA_ds_w3
ALSA_m_ds_w3$ybirth <- car::recode(ALSA_m_ds_w3$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w3', ALSA_m_ds_w3)
#opal.symbol_import(o,'ALSA_m_ds_w3', project='_Athlos_Harm_Dataset')
```





### Wave 4 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |

    
```{r assign4, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w4_id','ALSA.ALSA-Wave4',
                         variables=list('W4QUNO'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w4_id <- opal.execute(o,'ALSA_w4_id')

```

```{r local4, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w4_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w4_id)


vari <- ALSA_w4_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w4_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo4}
ALSA_ds_w4 <- tibble(id=ALSA_w4_ybirth$id)
ALSA_ds_w4$ybirth <- car::recode(ALSA_w4_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w4$ybirth <- labelled(ALSA_ds_w4$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript4, echo=F}
vari <- ALSA_ds_w4$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w4, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation4, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w4$ybirth!=ALSA_w4_ybirth$Year))
```



```{r importOPAL4, echo=F}

#opal.assign.data(o, 'ALSA_ds_w4', ALSA_ds_w4)
#opal.symbol_import(o,'ALSA_ds_w4', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w4 <- ALSA_ds_w4
ALSA_m_ds_w4$ybirth <- car::recode(ALSA_m_ds_w4$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w4', ALSA_m_ds_w4)
#opal.symbol_import(o,'ALSA_m_ds_w4', project='_Athlos_Harm_Dataset')
```







### Wave 5 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |

    
```{r assign5, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w5_id','ALSA.ALSA-Wave5',
                         variables=list('INTTYPW5'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w5_id <- opal.execute(o,'ALSA_w5_id')

```

```{r local5, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w5_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w5_id)


vari <- ALSA_w5_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w5_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo5}
ALSA_ds_w5 <- tibble(id=ALSA_w5_ybirth$id)
ALSA_ds_w5$ybirth <- car::recode(ALSA_w5_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w5$ybirth <- labelled(ALSA_ds_w5$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript5, echo=F}
vari <- ALSA_ds_w5$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w1, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation5, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w5$ybirth!=ALSA_w5_ybirth$Year))
```



```{r importOPAL5, echo=F}

#opal.assign.data(o, 'ALSA_ds_w5', ALSA_ds_w5)
#opal.symbol_import(o,'ALSA_ds_w5', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w5 <- ALSA_ds_w5
ALSA_m_ds_w5$ybirth <- car::recode(ALSA_m_ds_w5$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w5', ALSA_m_ds_w5)
#opal.symbol_import(o,'ALSA_m_ds_w5', project='_Athlos_Harm_Dataset')
```






### Wave 6 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |


    
```{r assign6, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w6_id','ALSA.ALSA-Wave6',
                         variables=list('AGEW6'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w6_id <- opal.execute(o,'ALSA_w6_id')

```

```{r local6, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w6_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w6_id)


vari <- ALSA_w6_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w6_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`


**R script:**

```{r harmo6}
ALSA_ds_w6 <- tibble(id=ALSA_w6_ybirth$id)
ALSA_ds_w6$ybirth <- car::recode(ALSA_w6_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w6$ybirth <- labelled(ALSA_ds_w6$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript6, echo=F}
vari <- ALSA_ds_w6$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w6, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation6, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w6$ybirth!=ALSA_w6_ybirth$Year))
```



```{r importOPAL6, echo=F}

#opal.assign.data(o, 'ALSA_ds_w6', ALSA_ds_w6)
#opal.symbol_import(o,'ALSA_ds_w6', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w6 <- ALSA_ds_w6
ALSA_m_ds_w6$ybirth <- car::recode(ALSA_m_ds_w6$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w6', ALSA_m_ds_w6)
#opal.symbol_import(o,'ALSA_m_ds_w6', project='_Athlos_Harm_Dataset')
```







### Wave 7 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |


    
```{r assign7, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w7_id','ALSA.ALSA-Wave7',
                         variables=list('sex'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w7_id <- opal.execute(o,'ALSA_w7_id')

```

```{r local7, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w7_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w7_id)


vari <- ALSA_w7_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w7_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`


**R script:**

```{r harmo7}
ALSA_ds_w7 <- tibble(id=ALSA_w7_ybirth$id)
ALSA_ds_w7$ybirth <- car::recode(ALSA_w7_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w7$ybirth <- labelled(ALSA_ds_w7$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript7, echo=F}
vari <- ALSA_ds_w7$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w7, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation7, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w7$ybirth!=ALSA_w7_ybirth$Year))
```



```{r importOPAL7, echo=F}

#opal.assign.data(o, 'ALSA_ds_w7', ALSA_ds_w7)
#opal.symbol_import(o,'ALSA_ds_w7', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w7 <- ALSA_ds_w7
ALSA_m_ds_w7$ybirth <- car::recode(ALSA_m_ds_w7$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w7', ALSA_m_ds_w7)
#opal.symbol_import(o,'ALSA_m_ds_w7', project='_Athlos_Harm_Dataset')
```






### Wave 8 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |


    
```{r assign8, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w8_id','ALSA.ALSA-Wave8',
                         variables=list('Date'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w8_id <- opal.execute(o,'ALSA_w8_id')

```

```{r local8, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w8_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w8_id)


vari <- ALSA_w8_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w8_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo8}
ALSA_ds_w8 <- tibble(id=ALSA_w8_ybirth$id)
ALSA_ds_w8$ybirth <- car::recode(ALSA_w8_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w8$ybirth <- labelled(ALSA_ds_w8$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript8, echo=F}
vari <- ALSA_ds_w8$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w8, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation8, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w8$ybirth!=ALSA_w8_ybirth$Year))
```



```{r importOPAL8, echo=F}

#opal.assign.data(o, 'ALSA_ds_w8', ALSA_ds_w8)
#opal.symbol_import(o,'ALSA_ds_w8', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w8 <- ALSA_ds_w8
ALSA_m_ds_w8$ybirth <- car::recode(ALSA_m_ds_w8$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w8', ALSA_m_ds_w8)
#opal.symbol_import(o,'ALSA_m_ds_w8', project='_Athlos_Harm_Dataset')
```






### Wave 9 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |`dob`|
|----------|------------|-|
| **Label** | `Birthdate` |`Date of Birth`|
| **Table name** | `ALSA-Wave1` |`ALSA-Wave9`|
| **Missings** | `99999999 = Missing` |`NA; 2024-06-19; 1992-06-14`|
| **Description** |  |  |
    

    
```{r assign9, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w9_id','ALSA.ALSA-Wave9',
                         variables=list('sex'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w9_id <- opal.execute(o,'ALSA_w9_id')

```

```{r local9, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w9_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w9_id)


vari <- ALSA_w9_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w9_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo9}
ALSA_ds_w9 <- tibble(id=ALSA_w9_ybirth$id)
ALSA_ds_w9$ybirth <- car::recode(ALSA_w9_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w9$ybirth <- labelled(ALSA_ds_w9$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript9, echo=F}
vari <- ALSA_ds_w9$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w9, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") + xlim(1888,1929)
```


#### Validation
```{r crosstabulation9, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w9$ybirth!=ALSA_w9_ybirth$Year,na.rm=T))
```

We contrast with `dob`, the specific date of birth variable from wave 9:


```{r crosstabulation9_2, echo=F, results='asis'}
opal.assign.table.tibble(o, 'ALSA_w9_compr_ybirth','ALSA.ALSA-Wave9',
                         variables=list('dob'), missings = TRUE)

ALSA_w9_compr_ybirth <- opal.execute(o,'ALSA_w9_compr_ybirth')
ALSA_w9_compr_ybirth$ybirth_w9 <- year(ALSA_w9_compr_ybirth$dob) 

vari <- ALSA_w9_compr_ybirth$ybirth_w9
kable(Continuous_summary(var = vari, missing_values = c(1992,2924))[3],caption = 'dob')
kable(Continuous_summary(vari, missing_values = c(1992,2024))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(1992,2024))$summary, caption = "Summary")


ALSA_w9_compr_ybirth$ybirth_w1 <- ALSA_ds_w9$ybirth
ALSA_w9_compr_ybirth$ydiff <- ALSA_w9_compr_ybirth$ybirth_w1 - ALSA_w9_compr_ybirth$ybirth_w9

mis1b9 <- sum(is.na(ALSA_w9_compr_ybirth[4,])&!is.na(ALSA_w9_compr_ybirth[3,]))
cat("Number of missings of year of birth in wave 1 but not missing in wave 9:",mis1b9)

Diffw1w9 <- as.data.frame(table(ALSA_w9_compr_ybirth$ydiff))
names(Diffw1w9) <- c("years of difference", "quantity of individuals")
kable(Diffw1w9,caption="Difference of years between waves 1 and 9 in the answers",align = 'c')

kable(ALSA_w9_compr_ybirth[which(ALSA_w9_compr_ybirth$ydiff %in% c(-100,1,-1,-70)),],align = 'c',caption="Specific individuals with non-trivial difference" )


```

Checking the big differences of 100 and 70 years, we deduce wave 9 answers are bad.


```{r importOPAL9, echo=F}

#opal.assign.data(o, 'ALSA_ds_w9', ALSA_ds_w9)
#opal.symbol_import(o,'ALSA_ds_w9', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w9 <- ALSA_ds_w9
ALSA_m_ds_w9$ybirth <- car::recode(ALSA_m_ds_w9$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w9', ALSA_m_ds_w9)
#opal.symbol_import(o,'ALSA_m_ds_w9', project='_Athlos_Harm_Dataset')
```






### Wave 10 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |


    
```{r assign10, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w10_id','ALSA.ALSA-Wave10',
                         variables=list('Date'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w10_id <- opal.execute(o,'ALSA_w10_id')

```

```{r local10, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w10_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w10_id)


vari <- ALSA_w10_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w10_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo10}
ALSA_ds_w10 <- tibble(id=ALSA_w10_ybirth$id)
ALSA_ds_w10$ybirth <- car::recode(ALSA_w10_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w10$ybirth <- labelled(ALSA_ds_w10$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript10, echo=F}
vari <- ALSA_ds_w10$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w10, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") +xlim(1900,1929)
```

#### Validation
```{r crosstabulation10, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w10$ybirth!=ALSA_w10_ybirth$Year,na.rm=T))
```



```{r importOPAL10, echo=F}

#opal.assign.data(o, 'ALSA_ds_w10', ALSA_ds_w10)
#opal.symbol_import(o,'ALSA_ds_w10', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w10 <- ALSA_ds_w10
ALSA_m_ds_w10$ybirth <- car::recode(ALSA_m_ds_w10$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w10', ALSA_m_ds_w10)
#opal.symbol_import(o,'ALSA_m_ds_w10', project='_Athlos_Harm_Dataset')
```



### Wave 11


#### Study-specific variable description


| **Name** | `BIRTHDAT` |`dob`|
|----------|------------|-|
| **Label** | `Birthdate` |`date of birth`|
| **Table name** | `ALSA-Wave1` | `ALSA-Wave11` |
| **Missings** | `99999999 = Missing` |  |
| **Description** |  |  |

    
```{r assign11, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w11_id','ALSA.ALSA-Wave11',
                         variables=list('SEXW11'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w11_id <- opal.execute(o,'ALSA_w11_id')

```

```{r local11, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w11_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w11_id)


vari <- ALSA_w11_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w11_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo11}
ALSA_ds_w11 <- tibble(id=ALSA_w11_ybirth$id)
ALSA_ds_w11$ybirth <- car::recode(ALSA_w11_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w11$ybirth <- labelled(ALSA_ds_w11$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript11, echo=F}
vari <- ALSA_ds_w11$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w11, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation11, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w11$ybirth!=ALSA_w11_ybirth$Year))
```

We contrast with `dob`, the specific date of birth variable from wave 11:


```{r crosstabulation11_2, echo=F,results='asis'}
opal.assign.table.tibble(o, 'ALSA_w11_compr_ybirth','ALSA.ALSA-Wave11',
                         variables=list('dob'), missings = TRUE)



ALSA_w11_compr_ybirth <- opal.execute(o,'ALSA_w11_compr_ybirth')
ALSA_w11_compr_ybirth$ybirth_w11 <- as.numeric(format(ALSA_w11_compr_ybirth$dob, '%Y'))
vari <- ALSA_w11_compr_ybirth$ybirth_w11
kable(Continuous_summary(vari, missing_values = NA)[3], caption = 'dob')
pander(Continuous_summary(vari, missing_values = NA)$summary, caption = "Summary")
pander(Continuous_summary(vari, missing_values = NA)$values_table, caption = "Values table")

ALSA_w11_compr_ybirth$ybirth_w1 <- ALSA_ds_w11$ybirth
ALSA_w11_compr_ybirth$ydiff <- ALSA_w11_compr_ybirth$ybirth_w11 - ALSA_w11_compr_ybirth$ybirth_w1

mis1b11 <- sum(is.na(ALSA_w11_compr_ybirth$ybirth_1)&!is.na(ALSA_w11_compr_ybirth$ybirth_11))
cat("Number of missings of year of birth in wave 1 but not missing in wave 11:",mis1b11)

Diffw1w11 <- as.data.frame(table(ALSA_w11_compr_ybirth$ydiff))
names(Diffw1w11) <- c("years of difference", "quantity of individuals")
kable(Diffw1w11,caption="Difference of years between waves 1 and 11 in the answers",align = 'c')

kable(ALSA_w11_compr_ybirth[which(ALSA_w11_compr_ybirth$ydiff==-1),],align = 'c',caption="Specific individuals with non-trivial difference" )

```

Even finding 2 individuals with differences between wave 1 and wave 11, no changes are done.



```{r importOPAL11, echo=F}

#opal.assign.data(o, 'ALSA_ds_w11', ALSA_ds_w11)
#opal.symbol_import(o,'ALSA_ds_w11', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w11 <- ALSA_ds_w11
ALSA_m_ds_w11$ybirth <- car::recode(ALSA_m_ds_w11$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w11', ALSA_m_ds_w11)
#opal.symbol_import(o,'ALSA_m_ds_w11', project='_Athlos_Harm_Dataset')
```





### Wave 12 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |`dob`|
|----------|------------|-|
| **Label** | `Birthdate` |`date of birth`|
| **Table name** | `ALSA-Wave1` | `ALSA-Wave12` |
| **Missings** | `99999999 = Missing` |  |
| **Description** |  |  |

    
```{r assign12, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w12_id','ALSA.ALSA-Wave12',
                         variables=list('SEXW12'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w12_id <- opal.execute(o,'ALSA_w12_id')

```

```{r local12, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w12_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w12_id)


vari <- ALSA_w12_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w12_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo12}
ALSA_ds_w12 <- tibble(id=ALSA_w12_ybirth$id)
ALSA_ds_w12$ybirth <- car::recode(ALSA_w12_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w12$ybirth <- labelled(ALSA_ds_w12$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript12, echo=F}
vari <- ALSA_ds_w12$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w12, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") 
```

#### Validation
```{r crosstabulation12, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w12$ybirth!=ALSA_w12_ybirth$Year))
```

We contrast with `dob`, the specific date of birth variable from wave 12:


```{r crosstabulation12_2, echo=F, results='asis'}
opal.assign.table.tibble(o, 'ALSA_w12_compr_ybirth','ALSA.ALSA-Wave12',
                         variables=list( 'dob'), missings = TRUE)

ALSA_w12_compr_ybirth <- opal.execute(o,'ALSA_w12_compr_ybirth')
ALSA_w12_compr_ybirth$ybirth_w12 <- as.numeric(format(ALSA_w12_compr_ybirth$dob, '%Y'))


vari <- ALSA_w12_compr_ybirth$ybirth_w12
kable(Continuous_summary(vari, missing_values = NA)[3], caption = 'dob')
pander(Continuous_summary(vari, missing_values = NA)$summary, caption = "Summary")
pander(Continuous_summary(vari, missing_values = NA)$values_table, caption = "Values table")

ALSA_w12_compr_ybirth$ybirth_w1 <- ALSA_ds_w12$ybirth
ALSA_w12_compr_ybirth$ydiff <- ALSA_w12_compr_ybirth$ybirth_w12 - ALSA_w12_compr_ybirth$ybirth_w1

mis1b12 <- sum(is.na(ALSA_w12_compr_ybirth$ybirth_w1)&!is.na(ALSA_w12_compr_ybirth$ybirth_w11))
cat("Number of missings of year of birth in wave 1 but not missing in wave 12:",mis1b12)



Diffw1w12 <- as.data.frame(table(ALSA_w12_compr_ybirth$ydiff))
names(Diffw1w12) <- c("years of difference", "quantity of individuals")
kable(Diffw1w12,caption="Difference of years between waves 1 and 12 in the answers",align = 'c')

```





```{r importOPAL12, echo=F}

#opal.assign.data(o, 'ALSA_ds_w12', ALSA_ds_w12)
#opal.symbol_import(o,'ALSA_ds_w12', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w12 <- ALSA_ds_w12
ALSA_m_ds_w12$ybirth <- car::recode(ALSA_m_ds_w12$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w12', ALSA_m_ds_w12)
#opal.symbol_import(o,'ALSA_m_ds_w12', project='_Athlos_Harm_Dataset')
```





### Wave 13 

#### Study-specific variable description



| **Name** | `BIRTHDAT` |
|----------|------------|
| **Label** | `Birthdate` |
| **Table name** | `ALSA-Wave1` |
| **Missings** | `99999999 = Missing` |
| **Description** |  |
    
```{r assign13, echo=F}
opal.assign.table.tibble(o, 'ALSA_w1_ybirth','ALSA.ALSA-Wave1',
                         variables=list('BIRTHDAT'), missings = TRUE)
opal.assign.table.tibble(o, 'ALSA_w13_id','ALSA.ALSA-Wave13',
                         variables=list('proxy'), missings = TRUE)
ALSA_w1_ybirth <- opal.execute(o,'ALSA_w1_ybirth')
ALSA_w13_id <- opal.execute(o,'ALSA_w13_id')

```

```{r local13, echo=F}

#This function return a table with the date of birth separated by columns:
Date_of_birth <- function(date){
  date <- as.numeric(date)
  n <- length(date)
  D <- matrix(NA, nrow = n, ncol = 3)
  for(i in 1:n){
    if(log10(date[i])+1>=8){
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 3, 5), 
                                                                     last=c(2, 4, 8)))))
    }
    else{
      D[i,] <- as.numeric(t(sapply(date[i], 
                                               function(x) substring(x, first=c(1, 2, 4), 
                                                                     last=c(1, 3, 7)))))
    }
  }
  colnames(D) <- c("Day", "Month", "Year")
  D
}

ALSA_w1_ybirth <- cbind(ALSA_w1_ybirth, Date_of_birth(ALSA_w1_ybirth$BIRTHDAT))

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,4))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], BIRTHDAT=as.numeric(new_2[,2]), Day=as.numeric(new_2[,3]), Month=as.numeric(new_2[,4]), Year=as.numeric(new_2[,5]))
  new_22
}


ALSA_w13_ybirth <- Add_indiv(old = ALSA_w1_ybirth, new = ALSA_w13_id)


vari <- ALSA_w13_ybirth$Year
kable(Continuous_summary(var = vari, missing_values = c(9999))[3], caption = ds_label)
kable(Continuous_summary(vari, missing_values = c(9999))[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = c(9999))$summary, caption = "Summary")

ggplot(ALSA_w13_ybirth, aes(Year)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency")
```

#### Harmonisation algorithm
The harmonized variable is the same than the study-specific variable, but the missing values have to be recoded as follows:

* `NA into 999`
* `9999 into 999`

**R script:**

```{r harmo13}
ALSA_ds_w13 <- tibble(id=ALSA_w13_ybirth$id)
ALSA_ds_w13$ybirth <- car::recode(ALSA_w13_ybirth$Year, "c(NA, 9999)=999")
ALSA_ds_w13$ybirth <- labelled(ALSA_ds_w13$ybirth, labels = c("Missing"=999, "Do not know"=998, "Refuse"=997, "Not attempt not done"=996, "Does not answer"=995,  "Not applicable"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript13, echo=F}
vari <- ALSA_ds_w13$ybirth
kable(Continuous_summary(var = vari, missing_values = miss_values_vector)[3])
kable(Continuous_summary(vari, missing_values = miss_values_vector)[2], caption = "Values")
pander(Continuous_summary(vari, missing_values = miss_values_vector)$summary, caption = "Summary")

ggplot(ALSA_ds_w13, aes(ybirth)) + geom_histogram(stat="count", fill="steelblue") + xlab("Year of birth") + ylab("Frequency") +xlim(1910,1929)
```

#### Validation
```{r crosstabulation13, echo=F, results = 'asis'}
cat("The quantity of values of the harmonised variable which disagree with the initial variable is: ",sum(ALSA_ds_w13$ybirth!=ALSA_w13_ybirth$Year,na.rm=T))
```



```{r importOPAL13, echo=F}

#opal.assign.data(o, 'ALSA_ds_w13', ALSA_ds_w13)
#opal.symbol_import(o,'ALSA_ds_w13', project='_Athlos_Harm_Dataset')

ALSA_m_ds_w13 <- ALSA_ds_w13
ALSA_m_ds_w13$ybirth <- car::recode(ALSA_m_ds_w13$ybirth, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'ALSA_m_ds_w13', ALSA_m_ds_w13)
#opal.symbol_import(o,'ALSA_m_ds_w13', project='_Athlos_Harm_Dataset')
```



## Summary of descriptive statistics of the harmonised variable accross populations and waves





```{r summ, echo=F}

l.hds <- list(w1 = ALSA_ds_w1, w2 = ALSA_ds_w2, w3 = ALSA_ds_w3, w4 = ALSA_ds_w4, w5 = ALSA_ds_w5, w6 = ALSA_ds_w6, w7 = ALSA_ds_w7, w8 = ALSA_ds_w8, w9 = ALSA_ds_w9, w10 = ALSA_ds_w10, w11 = ALSA_ds_w11, w12 = ALSA_ds_w12, w13 = ALSA_ds_w13)
m.hds <- list()

for(name in names(l.hds)) {
  aux_object <- l.hds[[name]]
  label(l.hds[[name]][[2]]) <- label(aux_object[[2]]) <- ds_label
  l.hds[[name]][[2]] <- labelled(l.hds[[name]][[2]], labels = cont_label)
  aux_object[[2]] <- car::recode(aux_object[[2]], "miss_values_vector=NA")
  aux_object[[2]] <- labelled(aux_object[[2]], labels = cont_label)
  m_name <- paste0("ALSA_m_ds_",name)
  assign(m_name, aux_object)
  m.hds[[name]] <- get(paste0("ALSA_m_ds_",name))
  rm(aux_object)
}

t.summ <- summary(m.hds[[1]][2])[1:6]
t.hds <- substr(t.summ,1,regexpr(":", t.summ, fixed=T)-1)
for (i in seq_along(l.hds)){
  t.summ <- summary(m.hds[[i]][2])[1:6]
  t.hds <- cbind(t.hds,as.numeric(substr(t.summ,regexpr(":", t.summ, fixed=T)+1,nchar(t.summ))))
}
t.hds <- rbind(t.hds,c("sample size", sapply(l.hds,function(wave) length(wave[[1]]))))

dimnames(t.hds)[[2]] <- c(dimnames(summary(m.hds[[1]][2]))[[2]],names(l.hds))
kable(t.hds,caption=ds_label)



```

# Quality estimation

No comments.



```{r save, echo=FALSE}
ybirth <- ALSA_ds_w1
save(ybirth, file = "../RData/w1/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w2
save(ybirth, file = "../RData/w2/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w3
save(ybirth, file = "../RData/w3/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w4
save(ybirth, file = "../RData/w4/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w5
save(ybirth, file = "../RData/w5/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w6
save(ybirth, file = "../RData/w6/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w7
save(ybirth, file = "../RData/w7/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w8
save(ybirth, file = "../RData/w8/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w9
save(ybirth, file = "../RData/w9/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w10
save(ybirth, file = "../RData/w10/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w11
save(ybirth, file = "../RData/w11/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w12
save(ybirth, file = "../RData/w12/ybirth.RData")
rm(ybirth)

ybirth <- ALSA_ds_w13
save(ybirth, file = "../RData/w13/ybirth.RData")
rm(ybirth)
```


```{r closeRsession, echo=FALSE}
opal.logout(o)
```

