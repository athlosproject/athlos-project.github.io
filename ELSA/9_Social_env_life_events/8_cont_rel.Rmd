---
title: "Are the contacts ( face-to-face/phone/mail/Internet communicators) with family members/relatives frequent (i.e. contact once a week or more often)?"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("../../setup_iago.r")
```

<!-- ########################################################## --> 



# Description of DataSchema variable

The description of harmonised variables is the following:

* Short name: `cont_rel`
* Variable label: `Are the contacts ( face-to-face/phone/mail/Internet communicators) with family members/relatives frequent (i.e. contact once a week or more often)?`
* Domain: `Social environment`
* Value type: `cathegorical`
* Categories:

**Code** | **Category Label**
-------- | ------------------
0        | No
1        | Yes


* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing


<!-- ########################################################## --> 

# Data process

## England

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised are:

* Name: `scchdg`
* Label: `On average how often do you meet up with your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
    
* Name: `scfamg`
* Label: `On average how often meet up with family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`

* Name: `dhr2` UP TO `dhr13`
* Label: `What is [your/member of household~s] relationship to [person 2]`
* Categories:
    + `1 = Husband/Wife`
    + `2 = Partner/cohabitee`
    + `3 = Natural son/daughter`
    + `4 = Adopted son/daughter`
    + `5 = Foster son/daughter`
    + `6 = Step son/daughter/child of partner`
    + `7 = Son/daughter-in-law`
    + `8 = Natural parent`
    + `9 = Adoptive parent`
    + `10 = Foster parent`
    + `11 = Stepparent/parent s partner`
    + `12 = Parent-in-law`
    + `13 = Natural brother/sister`
    + `14 = Half-brother/sister`
    + `15 = Step-brother/sister`
    + `16 = Adopted brother/sister`
    + `17 = Foster brother/sister`
    + `18 = Brother/sister-in-law`
    + `19 = Grandchild`
    + `20 = Grandparent`
    + `21 = Other relative`
    + `22 = Other non-relative`
    + `96 = Self (THIS CODE NOT USED)`
* Missings:
    + `-9 = Refusal`
    + `-8 = Don't Know`
    + `-1 = Not applicable`
    
* Note: IF relationship os self: DHR=96, "Code 96 is not valid for this question"

* Description: 
```{r assign1, echo=F}
opal.assign.table.tibble(o, 'ELSA_w1_cont_rel','ELSA.wave_1_core_data_v3',
                         variables=list('scchdg','scfamg',
                                        'scchdh','scchdi','scfami',
                                        'dhr2','dhr3','dhr4','dhr5','dhr6','dhr7','dhr8','dhr9', 'dhr10','dhr11','dhr12','dhr13'), missings = TRUE)
```

```{r local1, echo=F}
ELSA_w1_cont_rel <- opal.execute(o,'ELSA_w1_cont_rel')

vari <- ELSA_w1_cont_rel$scchdg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$scchdg, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(scchdg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you meet up with your children") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$scfamg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$scfamg, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(scfamg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often meet up with family members") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$scchdh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$scchdh, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$scchdi
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$scfami
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr2
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person2") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr3
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person3") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr4
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person4") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr5
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person5") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr6
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person6") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr7
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person7") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr8
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person8") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr9
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person9") + ylab("Frequency")



vari <- ELSA_w1_cont_rel$dhr10
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person10") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr11
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person11") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr12
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person12") + ylab("Frequency")

vari <- ELSA_w1_cont_rel$dhr13
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w1_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w1_cont_rel, aes(x=factor(dhr13))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person13") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdg  OR scfamg in {1,2,3} OR scchdh  OR scchdi OR scfami in {1,2} OR  any of dhr2,..,dhr13 in 1:21 into 1`
* `scchdg AND scfamg in {4,5,6} AND scchdh AND scchdi AND scfami in {3,4,5,6} AND all dhr2,..,dhr13 not in 1:21 into 0`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfami  in (-9,NA) AND dhr2 AND,..., AND dhr13 in (-8,-9,96,NA)  into 999`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfami AND dhr2 AND,.., AND dhr13 = -1  into 996`




**R script:**

```{r harmo1, echo=TRUE}
ELSA_ds_w1 <- tibble(id=ELSA_w1_cont_rel$id)

ELSA_w1_cont_rel$scchdg <- car::recode(as.vector(ELSA_w1_cont_rel$scchdg), "NA='-999'")
ELSA_w1_cont_rel$scfamg <- car::recode(as.vector(ELSA_w1_cont_rel$scfamg), "NA='-999'")
ELSA_w1_cont_rel$scchdh <- car::recode(as.vector(ELSA_w1_cont_rel$scchdh), "NA='-999'")
ELSA_w1_cont_rel$scchdi <- car::recode(as.vector(ELSA_w1_cont_rel$scchdi), "NA='-999'")
ELSA_w1_cont_rel$scfami <- car::recode(as.vector(ELSA_w1_cont_rel$scfami), "NA='-999'")
ELSA_w1_cont_rel$dhr2 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr2), "NA='-999'")
ELSA_w1_cont_rel$dhr3 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr3), "NA='-999'")
ELSA_w1_cont_rel$dhr4 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr4), "NA='-999'")
ELSA_w1_cont_rel$dhr5 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr5), "NA='-999'")
ELSA_w1_cont_rel$dhr6 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr6), "NA='-999'")
ELSA_w1_cont_rel$dhr7 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr7), "NA='-999'")
ELSA_w1_cont_rel$dhr8 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr8), "NA='-999'")
ELSA_w1_cont_rel$dhr9 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr9), "NA='-999'")
ELSA_w1_cont_rel$dhr10 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr10), "NA='-999'")
ELSA_w1_cont_rel$dhr11 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr11), "NA='-999'")
ELSA_w1_cont_rel$dhr12 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr12), "NA='-999'")
ELSA_w1_cont_rel$dhr13 <- car::recode(as.vector(ELSA_w1_cont_rel$dhr13), "NA='-999'")

ELSA_ds_w1$cont_rel <- c(NA) 
for(i in 1:dim(ELSA_w1_cont_rel)[1]){
  if( ELSA_w1_cont_rel$scchdg[i] %in% c(1,2,3) | 
      ELSA_w1_cont_rel$scfamg[i] %in% c(1,2,3) |
      ELSA_w1_cont_rel$scchdh[i] %in% c(1,2) | 
      ELSA_w1_cont_rel$scchdi[i] %in% c(1,2) |
      ELSA_w1_cont_rel$scfami[i] %in% c(1,2) |
      ELSA_w1_cont_rel$dhr2[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr3[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr4[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr5[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr6[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr7[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr8[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr9[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr10[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr11[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr12[i] %in% c(1:21) | 
      ELSA_w1_cont_rel$dhr13[i] %in% c(1:21)) { 
    ELSA_ds_w1$cont_rel[i] = 1 }
  else if( ELSA_w1_cont_rel$scchdg[i] %in% c(-9, -999) &  
           ELSA_w1_cont_rel$scfamg[i] %in% c(-9, -999) &
           ELSA_w1_cont_rel$scchdh[i] %in% c(-9, -999) & 
           ELSA_w1_cont_rel$scchdi[i] %in% c(-9, -999) &
           ELSA_w1_cont_rel$scfami[i] %in% c(-9, -999) &
           ELSA_w1_cont_rel$dhr2[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr3[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr4[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr5[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr6[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr7[i] %in% c(96,-8, -9, -999) &
           ELSA_w1_cont_rel$dhr8[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr9[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr10[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr11[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr12[i] %in% c(96,-8, -9, -999) & 
           ELSA_w1_cont_rel$dhr13[i] %in% c(96,-8, -9, -999)){ 
    ELSA_ds_w1$cont_rel[i] = 999 }
  else if( ELSA_w1_cont_rel$scchdg[i] == -1 &  
           ELSA_w1_cont_rel$scfamg[i] == -1 &
           ELSA_w1_cont_rel$scchdh[i] == -1 & 
           ELSA_w1_cont_rel$scchdi[i] == -1 &
           ELSA_w1_cont_rel$scfami[i] == -1 &
           ELSA_w1_cont_rel$dhr2[i] == -1 & 
           ELSA_w1_cont_rel$dhr3[i] == -1 & 
           ELSA_w1_cont_rel$dhr4[i] == -1 & 
           ELSA_w1_cont_rel$dhr5[i] == -1 & 
           ELSA_w1_cont_rel$dhr6[i] == -1 & 
           ELSA_w1_cont_rel$dhr7[i] == -1 &
           ELSA_w1_cont_rel$dhr8[i] == -1 & 
           ELSA_w1_cont_rel$dhr9[i] == -1 & 
           ELSA_w1_cont_rel$dhr10[i] == -1 & 
           ELSA_w1_cont_rel$dhr11[i] == -1 & 
           ELSA_w1_cont_rel$dhr12[i] == -1 & 
           ELSA_w1_cont_rel$dhr13[i] == -1 ){ 
    ELSA_ds_w1$cont_rel[i] = 996 }
  else if( ELSA_w1_cont_rel$scchdg[i] %in% c(4,5,6) &  
           ELSA_w1_cont_rel$scfamg[i] %in% c(4,5,6) &
           ELSA_w1_cont_rel$scchdh[i] %in% c(3,4,5,6) & 
           ELSA_w1_cont_rel$scchdi[i] %in% c(3,4,5,6) & 
           ELSA_w1_cont_rel$scfami[i] %in% c(3,4,5,6) & 
           !( ELSA_w1_cont_rel$dhr2[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr3[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr4[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr5[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr6[i] %in% c(1:21) |
              ELSA_w1_cont_rel$dhr7[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr8[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr9[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr10[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr11[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr12[i] %in% c(1:21) | 
              ELSA_w1_cont_rel$dhr13[i] %in% c(1:21) )){ 
    ELSA_ds_w1$cont_rel[i] = 0 }
}



ELSA_ds_w1$cont_rel <- car::recode(as.vector(ELSA_ds_w1$cont_rel), "NA='999'")
ELSA_ds_w1$cont_rel <- labelled(ELSA_ds_w1$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1, echo=F}
vari <- ELSA_ds_w1$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_ds_w1$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w1, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are contacts with relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1, echo=F}

```

 
 


### Wave 2

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `scchdg`
* Label: `On average how often do you meet up with your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
    
* Name: `scfamg`
* Label: `On average how often meet up with family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`


* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`


* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
* Name: `DhR12` UP TO `DhR12`
* Label: `Relationship of this person to Person 2 in the household`
* Categories:
    + `1 = Husband/Wife`
    + `2 = Partner/cohabitee`
    + `3 = Natural son/daughter`
    + `4 = Adopted son/daughter`
    + `5 = Foster son/daughter`
    + `6 = Step son/daughter/child of partner`
    + `7 = Son/daughter-in-law`
    + `8 = Natural parent`
    + `9 = Adoptive parent`
    + `10 = Foster parent`
    + `11 = Stepparent/parent s partner`
    + `12 = Parent-in-law`
    + `13 = Natural brother/sister`
    + `14 = Half-brother/sister`
    + `15 = Step-brother/sister`
    + `16 = Adopted brother/sister`
    + `17 = Foster brother/sister`
    + `18 = Brother/sister-in-law`
    + `19 = Grandchild`
    + `20 = Grandparent`
    + `21 = Other relative`
    + `22 = Other non-relative`
    + `96 = (THIS CODE NOT USED)`
* Missings:
    + `-9 = Refusal`
    + `-8 = Don't Know`
    + `-1 = Not applicable`  
* Description: 
```{r assign2, echo=F}
opal.assign.table.tibble(o, 'ELSA_w2_cont_rel','ELSA.wave_2_core_data_v4',
                         variables=list('scchdg','scfamg',
                                        'scchdh','scchdi','scfamh','scfami',
                                        'DhR2','DhR3','DhR4','DhR5','DhR6','DhR7','DhR8','DhR9', 'DhR10','DhR11','DhR12'), missings = TRUE)
```

```{r local2, echo=F}
ELSA_w2_cont_rel <- opal.execute(o,'ELSA_w2_cont_rel')
vari <- ELSA_w2_cont_rel$scchdg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$scchdg, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(scchdg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you meet up with your children") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$scfamg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$scfamg, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(scfamg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often meet up with family members") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$scchdh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$scchdh, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$scchdi
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$scfamh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do youspeak on the phone to family members") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$scfami
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR2
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person2") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR3
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person3") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR4
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person4") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR5
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person5") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR6
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person6") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR7
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person7") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR8
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person8") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR9
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person9") + ylab("Frequency")



vari <- ELSA_w2_cont_rel$DhR10
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person10") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR11
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person11") + ylab("Frequency")

vari <- ELSA_w2_cont_rel$DhR12
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w2_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w2_cont_rel, aes(x=factor(DhR12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person12") + ylab("Frequency")


```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:
* `scchdg  OR scfamg in {1,2,3} OR scchdh  OR scchdi OR scfamh OR scfami in {1,2} OR  any of DhR2,..,DhR12 in 1:21 into 1`
* `scchdg AND scfamg in {4,5,6} AND scchdh AND scchdi AND scfamh AND scfami in {3,4,5,6} AND all DhR2,..,DhR12 not in 1:21 into 0`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfami  in (-9,NA) AND DhR2 AND,..., AND DhR13 in (-8,-9,96,NA)  into 999`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfami AND DhR2 AND,.., AND DhR13 = -1  into 996`



**R script:**

```{r harmo2, echo=TRUE}
ELSA_ds_w2 <- tibble(id=ELSA_w2_cont_rel$id)

ELSA_w2_cont_rel$scchdg <- car::recode(as.vector(ELSA_w2_cont_rel$scchdg), "NA='-999'")
ELSA_w2_cont_rel$scfamg <- car::recode(as.vector(ELSA_w2_cont_rel$scfamg), "NA='-999'")
ELSA_w2_cont_rel$scchdh <- car::recode(as.vector(ELSA_w2_cont_rel$scchdh), "NA='-999'")
ELSA_w2_cont_rel$scchdi <- car::recode(as.vector(ELSA_w2_cont_rel$scchdi), "NA='-999'")
ELSA_w2_cont_rel$scfami <- car::recode(as.vector(ELSA_w2_cont_rel$scfamh), "NA='-999'")
ELSA_w2_cont_rel$scfami <- car::recode(as.vector(ELSA_w2_cont_rel$scfami), "NA='-999'")
ELSA_w2_cont_rel$DhR2 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR2), "NA='-999'")
ELSA_w2_cont_rel$DhR3 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR3), "NA='-999'")
ELSA_w2_cont_rel$DhR4 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR4), "NA='-999'")
ELSA_w2_cont_rel$DhR5 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR5), "NA='-999'")
ELSA_w2_cont_rel$DhR6 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR6), "NA='-999'")
ELSA_w2_cont_rel$DhR7 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR7), "NA='-999'")
ELSA_w2_cont_rel$DhR8 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR8), "NA='-999'")
ELSA_w2_cont_rel$DhR9 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR9), "NA='-999'")
ELSA_w2_cont_rel$DhR10 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR10), "NA='-999'")
ELSA_w2_cont_rel$DhR11 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR11), "NA='-999'")
ELSA_w2_cont_rel$DhR12 <- car::recode(as.vector(ELSA_w2_cont_rel$DhR12), "NA='-999'")


ELSA_ds_w2$cont_rel <- c(NA) 
for(i in 1:dim(ELSA_w2_cont_rel)[1]){
  if( ELSA_w2_cont_rel$scchdg[i] %in% c(1,2,3) | 
      ELSA_w2_cont_rel$scfamg[i] %in% c(1,2,3) |
      ELSA_w2_cont_rel$scchdh[i] %in% c(1,2) | 
      ELSA_w2_cont_rel$scchdi[i] %in% c(1,2) |
      ELSA_w2_cont_rel$scfamh[i] %in% c(1,2) |
      ELSA_w2_cont_rel$scfami[i] %in% c(1,2) |
      ELSA_w2_cont_rel$DhR2[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR3[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR4[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR5[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR6[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR7[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR8[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR9[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR10[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR11[i] %in% c(1:21) | 
      ELSA_w2_cont_rel$DhR12[i] %in% c(1:21)) { 
    ELSA_ds_w2$cont_rel[i] = 1 }
  else if( ELSA_w2_cont_rel$scchdg[i] %in% c(-9, -999) &  
           ELSA_w2_cont_rel$scfamg[i] %in% c(-9, -999) &
           ELSA_w2_cont_rel$scchdh[i] %in% c(-9, -999) & 
           ELSA_w2_cont_rel$scchdi[i] %in% c(-9, -999) &
           ELSA_w2_cont_rel$scfamh[i] %in% c(-9, -999) &
           ELSA_w2_cont_rel$scfami[i] %in% c(-9, -999) &
           ELSA_w2_cont_rel$DhR2[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR3[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR4[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR5[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR6[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR7[i] %in% c(96,-8, -9, -999) &
           ELSA_w2_cont_rel$DhR8[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR9[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR10[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR11[i] %in% c(96,-8, -9, -999) & 
           ELSA_w2_cont_rel$DhR12[i] %in% c(96,-8, -9, -999) ){ 
    ELSA_ds_w2$cont_rel[i] = 999 }
  else if( ELSA_w2_cont_rel$scchdg[i] == -1 &  
           ELSA_w2_cont_rel$scfamg[i] == -1 &
           ELSA_w2_cont_rel$scchdh[i] == -1 & 
           ELSA_w2_cont_rel$scchdi[i] == -1 &
           ELSA_w2_cont_rel$scfamh[i] == -1 &
           ELSA_w2_cont_rel$scfami[i] == -1 &
           ELSA_w2_cont_rel$DhR2[i] == -1 & 
           ELSA_w2_cont_rel$DhR3[i] == -1 & 
           ELSA_w2_cont_rel$DhR4[i] == -1 & 
           ELSA_w2_cont_rel$DhR5[i] == -1 & 
           ELSA_w2_cont_rel$DhR6[i] == -1 & 
           ELSA_w2_cont_rel$DhR7[i] == -1 &
           ELSA_w2_cont_rel$DhR8[i] == -1 & 
           ELSA_w2_cont_rel$DhR9[i] == -1 & 
           ELSA_w2_cont_rel$DhR10[i] == -1 & 
           ELSA_w2_cont_rel$DhR11[i] == -1 & 
           ELSA_w2_cont_rel$DhR12[i] == -1 ){ 
    ELSA_ds_w2$cont_rel[i] = 996 }
  else if( ELSA_w2_cont_rel$scchdg[i] %in% c(4,5,6) &  
           ELSA_w2_cont_rel$scfamg[i] %in% c(4,5,6) &
           ELSA_w2_cont_rel$scchdh[i] %in% c(3,4,5,6) & 
           ELSA_w2_cont_rel$scchdi[i] %in% c(3,4,5,6) & 
           ELSA_w2_cont_rel$scfamh[i] %in% c(3,4,5,6) &
           ELSA_w2_cont_rel$scfami[i] %in% c(3,4,5,6) & 
           !( ELSA_w2_cont_rel$DhR2[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR3[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR4[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR5[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR6[i] %in% c(1:21) |
              ELSA_w2_cont_rel$DhR7[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR8[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR9[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR10[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR11[i] %in% c(1:21) | 
              ELSA_w2_cont_rel$DhR12[i] %in% c(1:21) )){ 
    ELSA_ds_w2$cont_rel[i] = 0 }
}

ELSA_ds_w2$cont_rel <- car::recode(as.vector(ELSA_ds_w2$cont_rel), "NA='999'")
ELSA_ds_w2$cont_rel <- labelled(ELSA_ds_w2$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript2, echo=F}
vari <- ELSA_ds_w2$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_ds_w2$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w2, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are contacts with relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2, echo=F}

```

 
 



### Wave 3

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `scchdg`
* Label: `On average how often do you meet up with your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-1	= Item not applicable`
    
    
* Name: `scfamg`
* Label: `On average how often meet up with family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-1	= Item not applicable`

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8 = Don't know`
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-1	= Item not applicable`

* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-1	= Item not applicable`
* Name: `dhr1` UP TO `dhr12`
* Label: `Relationship of this person to Person 2 in the household`
* Categories:
    + `1 = Husband/Wife`
    + `2 = Partner/cohabitee`
    + `3 = Natural son/daughter`
    + `4 = Adopted son/daughter`
    + `5 = Foster son/daughter`
    + `6 = Step son/daughter/child of partner`
    + `7 = Son/daughter-in-law`
    + `8 = Natural parent`
    + `9 = Adoptive parent`
    + `10 = Foster parent`
    + `11 = Stepparent/parent s partner`
    + `12 = Parent-in-law`
    + `13 = Natural brother/sister`
    + `14 = Half-brother/sister`
    + `15 = Step-brother/sister`
    + `16 = Adopted brother/sister`
    + `17 = Foster brother/sister`
    + `18 = Brother/sister-in-law`
    + `19 = Grandchild`
    + `20 = Grandparent`
    + `21 = Other relative`
    + `22 = Other non-relative`
    + `96 = (THIS CODE NOT USED)`
* Missings:
    + `-9 = Refusal`
    + `-8 = Don't Know`
    + `-2 = Schedule not applicable`
    + `-1 = Not applicable`

* Description: 
```{r assign3, echo=F}
opal.assign.table.tibble(o, 'ELSA_w3_cont_rel','ELSA.wave_3_elsa_data_v4',
                         variables=list('scchdg','scfamg',
                                        'scchdh','scchdi','scfamh','scfami', 
                                        'dhr2','dhr3','dhr4','dhr5','dhr6','dhr7','dhr8','dhr9',
                                       'dhr10','dhr11','dhr12'), missings = TRUE)
```

```{r local3, echo=F}
ELSA_w3_cont_rel <- opal.execute(o,'ELSA_w3_cont_rel')

vari <- ELSA_w3_cont_rel$scchdg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$scchdg, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(scchdg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you meet up with your children") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$scfamg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$scfamg, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(scfamg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often meet up with family members") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$scchdh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$scchdh, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$scchdi
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$scfamh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(scfamh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do speak on the phone to family members") + ylab("Frequency")


vari <- ELSA_w3_cont_rel$scfami
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr2
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person2") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr3
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person3") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr4
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person4") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr5
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person5") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr6
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person6") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr7
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person7") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr8
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person8") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr9
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person9") + ylab("Frequency")



vari <- ELSA_w3_cont_rel$dhr10
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person10") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr11
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person11") + ylab("Frequency")

vari <- ELSA_w3_cont_rel$dhr12
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w3_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w3_cont_rel, aes(x=factor(dhr12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person12") + ylab("Frequency")



```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdg  OR scfamg in {1,2,3} OR scchdh  OR scchdi OR scfamh OR scfami in {1,2} OR  any of dhr2,..,dhr12 in 1:21 into 1`
* `scchdg AND scfamg in {4,5,6} AND scchdh AND scchdi AND scfamh AND scfami in {3,4,5,6} AND all dhr2,..,dhr12 not in 1:21 into 0`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfamh AND scfami  in (-9,NA) AND dhr2 AND,..., AND dhr12 in (-8,-9,96,NA)  into 999`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfamh AND scfami AND dhr2 AND,.., AND dhr12 in (-1,-2)  into 996`


**R script:**

```{r harmo3, echo=TRUE}
ELSA_ds_w3 <- tibble(id=ELSA_w3_cont_rel$id)

ELSA_w3_cont_rel$scchdg <- car::recode(as.vector(ELSA_w3_cont_rel$scchdg), "NA='-999'")
ELSA_w3_cont_rel$scfamg <- car::recode(as.vector(ELSA_w3_cont_rel$scfamg), "NA='-999'")
ELSA_w3_cont_rel$scchdh <- car::recode(as.vector(ELSA_w3_cont_rel$scchdh), "NA='-999'")
ELSA_w3_cont_rel$scchdi <- car::recode(as.vector(ELSA_w3_cont_rel$scchdi), "NA='-999'")
ELSA_w3_cont_rel$scfami <- car::recode(as.vector(ELSA_w3_cont_rel$scfami), "NA='-999'")
ELSA_w3_cont_rel$dhr2 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr2), "NA='-999'")
ELSA_w3_cont_rel$dhr3 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr3), "NA='-999'")
ELSA_w3_cont_rel$dhr4 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr4), "NA='-999'")
ELSA_w3_cont_rel$dhr5 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr5), "NA='-999'")
ELSA_w3_cont_rel$dhr6 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr6), "NA='-999'")
ELSA_w3_cont_rel$dhr7 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr7), "NA='-999'")
ELSA_w3_cont_rel$dhr8 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr8), "NA='-999'")
ELSA_w3_cont_rel$dhr9 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr9), "NA='-999'")
ELSA_w3_cont_rel$dhr10 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr10), "NA='-999'")
ELSA_w3_cont_rel$dhr11 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr11), "NA='-999'")
ELSA_w3_cont_rel$dhr12 <- car::recode(as.vector(ELSA_w3_cont_rel$dhr12), "NA='-999'")


ELSA_ds_w3$cont_rel <- c(NA) 
for(i in 1:dim(ELSA_w3_cont_rel)[1]){
  if( ELSA_w3_cont_rel$scchdg[i] %in% c(1,2,3) | 
      ELSA_w3_cont_rel$scfamg[i] %in% c(1,2,3) |
      ELSA_w3_cont_rel$scchdh[i] %in% c(1,2) | 
      ELSA_w3_cont_rel$scchdi[i] %in% c(1,2) |
      ELSA_w3_cont_rel$scfamh[i] %in% c(1,2) |
      ELSA_w3_cont_rel$scfami[i] %in% c(1,2) |
      ELSA_w3_cont_rel$dhr2[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr3[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr4[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr5[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr6[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr7[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr8[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr9[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr10[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr11[i] %in% c(1:21) | 
      ELSA_w3_cont_rel$dhr12[i] %in% c(1:21) ) { 
    ELSA_ds_w3$cont_rel[i] = 1 }
  else if( ELSA_w3_cont_rel$scchdg[i] %in% c(-9, -999) &  
           ELSA_w3_cont_rel$scfamg[i] %in% c(-9, -999) &
           ELSA_w3_cont_rel$scchdh[i] %in% c(-9, -999) & 
           ELSA_w3_cont_rel$scchdi[i] %in% c(-9, -999) &
           ELSA_w3_cont_rel$scfamh[i] %in% c(-9, -999) &
           ELSA_w3_cont_rel$scfami[i] %in% c(-9, -999) &
           ELSA_w3_cont_rel$dhr2[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr3[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr4[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr5[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr6[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr7[i] %in% c(96,-8, -9, -999) &
           ELSA_w3_cont_rel$dhr8[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr9[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr10[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr11[i] %in% c(96,-8, -9, -999) & 
           ELSA_w3_cont_rel$dhr12[i] %in% c(96,-8, -9, -999) ){ 
    ELSA_ds_w3$cont_rel[i] = 999 }
  else if( ELSA_w3_cont_rel$scchdg[i] == -1 &  
           ELSA_w3_cont_rel$scfamg[i] == -1 &
           ELSA_w3_cont_rel$scchdh[i] == -1 & 
           ELSA_w3_cont_rel$scchdi[i] == -1 &
           ELSA_w3_cont_rel$scfamh[i] == -1 &
           ELSA_w3_cont_rel$scfami[i] == -1 &
           ELSA_w3_cont_rel$dhr2[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr3[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr4[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr5[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr6[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr7[i] %in% c(-1,-2) &
           ELSA_w3_cont_rel$dhr8[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr9[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr10[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr11[i] %in% c(-1,-2) & 
           ELSA_w3_cont_rel$dhr12[i] %in% c(-1,-2) ){ 
    ELSA_ds_w3$cont_rel[i] = 996 }
  else if( ELSA_w3_cont_rel$scchdg[i] %in% c(4,5,6) &  
           ELSA_w3_cont_rel$scfamg[i] %in% c(4,5,6) &
           ELSA_w3_cont_rel$scchdh[i] %in% c(3,4,5,6) & 
           ELSA_w3_cont_rel$scchdi[i] %in% c(3,4,5,6) &
           ELSA_w3_cont_rel$scfamh[i] %in% c(3,4,5,6) & 
           ELSA_w3_cont_rel$scfami[i] %in% c(3,4,5,6) & 
           !( ELSA_w3_cont_rel$dhr2[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr3[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr4[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr5[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr6[i] %in% c(1:21) |
              ELSA_w3_cont_rel$dhr7[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr8[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr9[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr10[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr11[i] %in% c(1:21) | 
              ELSA_w3_cont_rel$dhr12[i] %in% c(1:21) )){ 
    ELSA_ds_w3$cont_rel[i] = 0 }
}

ELSA_ds_w3$cont_rel <- car::recode(as.vector(ELSA_ds_w3$cont_rel), "NA='999'")
ELSA_ds_w3$cont_rel <- labelled(ELSA_ds_w3$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript3, echo=F}
vari <- ELSA_ds_w3$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_ds_w1$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w3, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are contacts with relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation3, echo=F}

```

 
 


### Wave 4

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `scchdg`
* Label: `On average how often do you meet up with your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-1	= Item not applicable`
    
    
* Name: `scfamg`
* Label: `On average how often meet up with family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-1	= Item not applicable`
* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `How often the respondent writes to or emails other relatives`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-1	= Item not applicable`
* Name: `dhr2` UP TO `dhr12` (dhr13 to dhr16 have NA or -1 only)
* Label: `Relationship of this person to Person 1 in the household`
* Categories:
    + `1 = Husband/Wife`
    + `2 = Partner/cohabitee`
    + `3 = Natural son/daughter`
    + `4 = Adopted son/daughter`
    + `5 = Foster son/daughter`
    + `6 = Step son/daughter/child of partner`
    + `7 = Son/daughter-in-law`
    + `8 = Natural parent`
    + `9 = Adoptive parent`
    + `10 = Foster parent`
    + `11 = Stepparent/parent s partner`
    + `12 = Parent-in-law`
    + `13 = Natural brother/sister`
    + `14 = Half-brother/sister`
    + `15 = Step-brother/sister`
    + `16 = Adopted brother/sister`
    + `17 = Foster brother/sister`
    + `18 = Brother/sister-in-law`
    + `19 = Grandchild`
    + `20 = Grandparent`
    + `21 = Other relative`
    + `22 = Other non-relative`
    + `96 = (THIS CODE NOT USED)`
* Missings:
    + `-9 = Refusal`
    + `-8 = Don't Know`
    + `-2 = Schedule not applicable`
    + `-1 = Not applicable`
     

* Description: 
```{r assign4, echo=F}
opal.assign.table.tibble(o, 'ELSA_w4_cont_rel','ELSA.wave_4_elsa_data_v3',
                         variables=list('scchdg','scfamg', 
                                        'scchdh','scchdi','scfami',
                                      'dhr2','dhr3','dhr4','dhr5','dhr6','dhr7','dhr8','dhr9','dhr10','dhr11','dhr12'), missings = TRUE)
```

```{r local4, echo=F}
ELSA_w4_cont_rel <- opal.execute(o,'ELSA_w4_cont_rel')


vari <- ELSA_w4_cont_rel$scchdg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$scchdg, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(scchdg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you meet up with your children") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$scfamg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$scfamg, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(scfamg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often meet up with family members") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$scchdh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$scchdh, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$scchdi
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$scfami
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr2
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person2") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr3
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person3") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr4
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person4") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr5
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person5") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr6
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person6") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr7
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person7") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr8
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person8") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr9
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person9") + ylab("Frequency")



vari <- ELSA_w4_cont_rel$dhr10
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person10") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr11
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person11") + ylab("Frequency")

vari <- ELSA_w4_cont_rel$dhr12
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w4_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w4_cont_rel, aes(x=factor(dhr12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person12") + ylab("Frequency")

```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdg  OR scfamg in {1,2,3} OR scchdh  OR scchdi OR scfami in {1,2} OR  any of dhr2,..,dhr12 in 1:21 into 1`
* `scchdg AND scfamg in {4,5,6} AND scchdh AND scchdi AND scfami in {3,4,5,6} AND all dhr2,..,dhr12 not in 1:21 into 0`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfami  in (-9,NA) AND dhr2 AND,..., AND dhr12 in (-8,-9,96,NA)  into 999`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfami AND dhr2 AND,.., AND dhr12 in (-1, -2)  into 996`


**R script:**

```{r harmo4, echo=TRUE}
ELSA_ds_w4 <- tibble(id=ELSA_w4_cont_rel$id)

ELSA_w4_cont_rel$scchdg <- car::recode(as.vector(ELSA_w4_cont_rel$scchdg), "NA='-999'")
ELSA_w4_cont_rel$scfamg <- car::recode(as.vector(ELSA_w4_cont_rel$scfamg), "NA='-999'")
ELSA_w4_cont_rel$scchdh <- car::recode(as.vector(ELSA_w4_cont_rel$scchdh), "NA='-999'")
ELSA_w4_cont_rel$scchdi <- car::recode(as.vector(ELSA_w4_cont_rel$scchdi), "NA='-999'")
ELSA_w4_cont_rel$scfami <- car::recode(as.vector(ELSA_w4_cont_rel$scfami), "NA='-999'")
ELSA_w4_cont_rel$dhr2 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr2), "NA='-999'")
ELSA_w4_cont_rel$dhr3 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr3), "NA='-999'")
ELSA_w4_cont_rel$dhr4 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr4), "NA='-999'")
ELSA_w4_cont_rel$dhr5 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr5), "NA='-999'")
ELSA_w4_cont_rel$dhr6 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr6), "NA='-999'")
ELSA_w4_cont_rel$dhr7 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr7), "NA='-999'")
ELSA_w4_cont_rel$dhr8 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr8), "NA='-999'")
ELSA_w4_cont_rel$dhr9 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr9), "NA='-999'")
ELSA_w4_cont_rel$dhr10 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr10), "NA='-999'")
ELSA_w4_cont_rel$dhr11 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr11), "NA='-999'")
ELSA_w4_cont_rel$dhr12 <- car::recode(as.vector(ELSA_w4_cont_rel$dhr12), "NA='-999'")

ELSA_ds_w4$cont_rel <- c(NA) 
for(i in 1:dim(ELSA_w4_cont_rel)[1]){
  if( ELSA_w4_cont_rel$scchdg[i] %in% c(1,2,3) | 
      ELSA_w4_cont_rel$scfamg[i] %in% c(1,2,3) |
      ELSA_w4_cont_rel$scchdh[i] %in% c(1,2) | 
      ELSA_w4_cont_rel$scchdi[i] %in% c(1,2) |
      ELSA_w4_cont_rel$scfami[i] %in% c(1,2) |
      ELSA_w4_cont_rel$dhr2[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr3[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr4[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr5[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr6[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr7[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr8[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr9[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr10[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr11[i] %in% c(1:21) | 
      ELSA_w4_cont_rel$dhr12[i] %in% c(1:21)) { 
    ELSA_ds_w4$cont_rel[i] = 1 }
  else if( ELSA_w4_cont_rel$scchdg[i] %in% c(-9, -999) &  
           ELSA_w4_cont_rel$scfamg[i] %in% c(-9, -999) &
           ELSA_w4_cont_rel$scchdh[i] %in% c(-9, -999) & 
           ELSA_w4_cont_rel$scchdi[i] %in% c(-9, -999) &
           ELSA_w4_cont_rel$scfami[i] %in% c(-9, -999) &
           ELSA_w4_cont_rel$dhr2[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr3[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr4[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr5[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr6[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr7[i] %in% c(96,-8, -9, -999) &
           ELSA_w4_cont_rel$dhr8[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr9[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr10[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr11[i] %in% c(96,-8, -9, -999) & 
           ELSA_w4_cont_rel$dhr12[i] %in% c(96,-8, -9, -999)){ 
    ELSA_ds_w4$cont_rel[i] = 999 }
  else if( ELSA_w4_cont_rel$scchdg[i] == -1 &  
           ELSA_w4_cont_rel$scfamg[i] == -1 &
           ELSA_w4_cont_rel$scchdh[i] == -1 & 
           ELSA_w4_cont_rel$scchdi[i] == -1 &
           ELSA_w4_cont_rel$scfami[i] == -1 &
           ELSA_w4_cont_rel$dhr2[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr3[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr4[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr5[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr6[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr7[i] %in% c(-1,-2) &
           ELSA_w4_cont_rel$dhr8[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr9[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr10[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr11[i] %in% c(-1,-2) & 
           ELSA_w4_cont_rel$dhr12[i] %in% c(-1,-2)){ 
    ELSA_ds_w4$cont_rel[i] = 996 }
  else if( ELSA_w4_cont_rel$scchdg[i] %in% c(4,5,6) &  
           ELSA_w4_cont_rel$scfamg[i] %in% c(4,5,6) &
           ELSA_w4_cont_rel$scchdh[i] %in% c(3,4,5,6) & 
           ELSA_w4_cont_rel$scchdi[i] %in% c(3,4,5,6) & 
           ELSA_w4_cont_rel$scfami[i] %in% c(3,4,5,6) & 
           !( ELSA_w4_cont_rel$dhr2[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr3[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr4[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr5[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr6[i] %in% c(1:21) |
              ELSA_w4_cont_rel$dhr7[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr8[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr9[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr10[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr11[i] %in% c(1:21) | 
              ELSA_w4_cont_rel$dhr12[i] %in% c(1:21))){ 
    ELSA_ds_w4$cont_rel[i] = 0 }
}
ELSA_ds_w4$cont_rel <- car::recode(as.vector(ELSA_ds_w4$cont_rel), "NA='999'")
ELSA_ds_w4$cont_rel <- labelled(ELSA_ds_w4$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript4, echo=F}
vari <- ELSA_ds_w4$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_ds_w1$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w4, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are contacts with relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation4, echo=F}

```

 
 


### Wave 5

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `scchdg`
* Label: `On average how often do you meet up with your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
    
* Name: `scfamg`
* Label: `On average how often meet up with family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-2 = Schedule Not Applicable`    
    + `-1	= Item not applicable`

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable` 
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`

* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
* Name: `dhr1` UP TO `dhr16` (dhr13 to dhr16 have NA or -1 only)
* Label: `Relationship of this person to Person 1 in the household`
* Categories:
    + `1 = Husband/Wife`
    + `2 = Partner/cohabitee`
    + `3 = Natural son/daughter`
    + `4 = Adopted son/daughter`
    + `5 = Foster son/daughter`
    + `6 = Step son/daughter/child of partner`
    + `7 = Son/daughter-in-law`
    + `8 = Natural parent`
    + `9 = Adoptive parent`
    + `10 = Foster parent`
    + `11 = Stepparent/parent s partner`
    + `12 = Parent-in-law`
    + `13 = Natural brother/sister`
    + `14 = Half-brother/sister`
    + `15 = Step-brother/sister`
    + `16 = Adopted brother/sister`
    + `17 = Foster brother/sister`
    + `18 = Brother/sister-in-law`
    + `19 = Grandchild`
    + `20 = Grandparent`
    + `21 = Other relative`
    + `22 = Other non-relative`
    + `96 = (THIS CODE NOT USED)`
* Missings:
    + `-9 = Refusal`
    + `-8 = Don't Know`
    + `-2 = Schedule not applicable`
    + `-1 = Not applicable`


* Description: 
```{r assign5, echo=F}
opal.assign.table.tibble(o, 'ELSA_w5_cont_rel','ELSA.wave_5_elsa_data_v4',
                         variables=list('scchdg','scfamg',
                                        'scchdh','scchdi','scfamh','scfami',
                                        'dhr2','dhr3','dhr4','dhr5','dhr6','dhr7','dhr8','dhr9',
                                       'dhr10','dhr11','dhr12','dhr13','dhr14','dhr15','dhr16'
                                        ), missings = TRUE)
```

```{r local5, echo=F}
ELSA_w5_cont_rel <- opal.execute(o,'ELSA_w5_cont_rel')

vari <- ELSA_w5_cont_rel$scchdg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$scchdg, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(scchdg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you meet up with your children") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$scfamg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$scfamg, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(scfamg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often meet up with family members") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$scchdh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$scchdh, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$scchdi
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$scfamh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(scfamh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do speak on the phone to family members") + ylab("Frequency")


vari <- ELSA_w5_cont_rel$scfami
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr2
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person2") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr3
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person3") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr4
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person4") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr5
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person5") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr6
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person6") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr7
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person7") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr8
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person8") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr9
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person9") + ylab("Frequency")



vari <- ELSA_w5_cont_rel$dhr10
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person10") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr11
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person11") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr12
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person12") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr13
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr13))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person13") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr14
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr14, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr14))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person14") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr15
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr15))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person15") + ylab("Frequency")

vari <- ELSA_w5_cont_rel$dhr16
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w5_cont_rel$dhr11, missing_values = NA)
ggplot(ELSA_w5_cont_rel, aes(x=factor(dhr16))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person16") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdg  OR scfamg in {1,2,3} OR scchdh  OR scchdi OR scfamh OR scfami in {1,2} OR  any of dhr2,..,dhr16 in 1:21 into 1`
* `scchdg AND scfamg in {4,5,6} AND scchdh AND scchdi AND scfamh AND scfami in {3,4,5,6} AND all dhr2,..,dhr16 not in 1:21 into 0`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfamh AND scfami  in (-9,NA) AND dhr2 AND,..., AND dhr16 in (-8,-9,96,NA)  into 999`
* `scchdg AND scfamg AND scchdh AND scchdi AND scfamh AND scfami AND dhr2 AND,.., AND dhr16 in (-1,-2)  into 996`


**R script:**

```{r harmo5, echo=TRUE}
ELSA_ds_w5 <- tibble(id=ELSA_w5_cont_rel$id)

ELSA_w5_cont_rel$scchdg <- car::recode(as.vector(ELSA_w5_cont_rel$scchdg), "NA='-999'")
ELSA_w5_cont_rel$scfamg <- car::recode(as.vector(ELSA_w5_cont_rel$scfamg), "NA='-999'")
ELSA_w5_cont_rel$scchdh <- car::recode(as.vector(ELSA_w5_cont_rel$scchdh), "NA='-999'")
ELSA_w5_cont_rel$scchdi <- car::recode(as.vector(ELSA_w5_cont_rel$scchdi), "NA='-999'")
ELSA_w5_cont_rel$scfami <- car::recode(as.vector(ELSA_w5_cont_rel$scfami), "NA='-999'")
ELSA_w5_cont_rel$dhr2 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr2), "NA='-999'")
ELSA_w5_cont_rel$dhr3 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr3), "NA='-999'")
ELSA_w5_cont_rel$dhr4 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr4), "NA='-999'")
ELSA_w5_cont_rel$dhr5 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr5), "NA='-999'")
ELSA_w5_cont_rel$dhr6 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr6), "NA='-999'")
ELSA_w5_cont_rel$dhr7 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr7), "NA='-999'")
ELSA_w5_cont_rel$dhr8 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr8), "NA='-999'")
ELSA_w5_cont_rel$dhr9 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr9), "NA='-999'")
ELSA_w5_cont_rel$dhr10 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr10), "NA='-999'")
ELSA_w5_cont_rel$dhr11 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr11), "NA='-999'")
ELSA_w5_cont_rel$dhr12 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr12), "NA='-999'")
ELSA_w5_cont_rel$dhr13 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr13), "NA='-999'")
ELSA_w5_cont_rel$dhr14 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr14), "NA='-999'")
ELSA_w5_cont_rel$dhr15 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr15), "NA='-999'")
ELSA_w5_cont_rel$dhr16 <- car::recode(as.vector(ELSA_w5_cont_rel$dhr16), "NA='-999'")


ELSA_ds_w5$cont_rel <- c(NA) 
for(i in 1:dim(ELSA_w5_cont_rel)[1]){
  if( ELSA_w5_cont_rel$scchdg[i] %in% c(1,2,3) | 
      ELSA_w5_cont_rel$scfamg[i] %in% c(1,2,3) |
      ELSA_w5_cont_rel$scchdh[i] %in% c(1,2) | 
      ELSA_w5_cont_rel$scchdi[i] %in% c(1,2) |
      ELSA_w5_cont_rel$scfamh[i] %in% c(1,2) |
      ELSA_w5_cont_rel$scfami[i] %in% c(1,2) |
      ELSA_w5_cont_rel$dhr2[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr3[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr4[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr5[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr6[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr7[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr8[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr9[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr10[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr11[i] %in% c(1:21) | 
      ELSA_w5_cont_rel$dhr12[i] %in% c(1:21)| 
      ELSA_w5_cont_rel$dhr13[i] %in% c(1:21)| 
      ELSA_w5_cont_rel$dhr14[i] %in% c(1:21)| 
      ELSA_w5_cont_rel$dhr15[i] %in% c(1:21)| 
      ELSA_w5_cont_rel$dhr16[i] %in% c(1:21) ) { 
    ELSA_ds_w5$cont_rel[i] = 1 }
  else if( ELSA_w5_cont_rel$scchdg[i] %in% c(-9, -999) &  
           ELSA_w5_cont_rel$scfamg[i] %in% c(-9, -999) &
           ELSA_w5_cont_rel$scchdh[i] %in% c(-9, -999) & 
           ELSA_w5_cont_rel$scchdi[i] %in% c(-9, -999) &
           ELSA_w5_cont_rel$scfamh[i] %in% c(-9, -999) &
           ELSA_w5_cont_rel$scfami[i] %in% c(-9, -999) &
           ELSA_w5_cont_rel$dhr2[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr3[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr4[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr5[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr6[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr7[i] %in% c(96,-8, -9, -999) &
           ELSA_w5_cont_rel$dhr8[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr9[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr10[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr11[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr12[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr13[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr14[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr15[i] %in% c(96,-8, -9, -999) & 
           ELSA_w5_cont_rel$dhr16[i] %in% c(96,-8, -9, -999) ){ 
    ELSA_ds_w5$cont_rel[i] = 999 }
  else if( ELSA_w5_cont_rel$scchdg[i] == -1 &  
           ELSA_w5_cont_rel$scfamg[i] == -1 &
           ELSA_w5_cont_rel$scchdh[i] == -1 & 
           ELSA_w5_cont_rel$scchdi[i] == -1 &
           ELSA_w5_cont_rel$scfamh[i] == -1 &
           ELSA_w5_cont_rel$scfami[i] == -1 &
           ELSA_w5_cont_rel$dhr2[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr3[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr4[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr5[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr6[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr7[i] %in% c(-1,-2) &
           ELSA_w5_cont_rel$dhr8[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr9[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr10[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr11[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr12[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr13[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr14[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr15[i] %in% c(-1,-2) & 
           ELSA_w5_cont_rel$dhr16[i] %in% c(-1,-2) ){ 
    ELSA_ds_w5$cont_rel[i] = 996 }
  else if( ELSA_w5_cont_rel$scchdg[i] %in% c(4,5,6) &  
           ELSA_w5_cont_rel$scfamg[i] %in% c(4,5,6) &
           ELSA_w5_cont_rel$scchdh[i] %in% c(3,4,5,6) & 
           ELSA_w5_cont_rel$scchdi[i] %in% c(3,4,5,6) &
           ELSA_w5_cont_rel$scfamh[i] %in% c(3,4,5,6) & 
           ELSA_w5_cont_rel$scfami[i] %in% c(3,4,5,6) & 
           !( ELSA_w5_cont_rel$dhr2[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr3[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr4[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr5[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr6[i] %in% c(1:21) |
              ELSA_w5_cont_rel$dhr7[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr8[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr9[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr10[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr11[i] %in% c(1:21) | 
              ELSA_w5_cont_rel$dhr12[i] %in% c(1:21)| 
              ELSA_w5_cont_rel$dhr13[i] %in% c(1:21)| 
              ELSA_w5_cont_rel$dhr14[i] %in% c(1:21)| 
              ELSA_w5_cont_rel$dhr15[i] %in% c(1:21)| 
              ELSA_w5_cont_rel$dhr16[i] %in% c(1:21) )){ 
    ELSA_ds_w5$cont_rel[i] = 0 }
}

ELSA_ds_w5$cont_rel <- car::recode(as.vector(ELSA_ds_w5$cont_rel), "NA='999'")
ELSA_ds_w5$cont_rel <- labelled(ELSA_ds_w5$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript5, echo=F}
vari <- ELSA_ds_w5$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_ds_w1$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w5, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are contacts with relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation5, echo=F}

```

 
 


### Wave 6

#### Study-specific variable description

The study-specific variable elected to be harmonised is:

* Name: `scchdg`
* Label: `On average how often do you meet up with your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
    
* Name: `scfamg`
* Label: `On average how often meet up with family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-2 = Schedule Not Applicable`    
    + `-1	= Item not applicable`

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable` 
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`

* Name: `scchdt`
* Label: `How often the respondent sends or receives text messages to/from their children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`


* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
* Name: `scfamt`
* Label: `How often the respondent sends or receives text messages to/from other relatives`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
* Name: `dhr1` UP TO `dhr16` (dhr13 to dhr16 have NA or -1 only)
* Label: `Relationship of this person to Person 1 in the household`
* Categories:
    + `1 = Husband/Wife`
    + `2 = Partner/cohabitee`
    + `3 = Natural son/daughter`
    + `4 = Adopted son/daughter`
    + `5 = Foster son/daughter`
    + `6 = Step son/daughter/child of partner`
    + `7 = Son/daughter-in-law`
    + `8 = Natural parent`
    + `9 = Adoptive parent`
    + `10 = Foster parent`
    + `11 = Stepparent/parent s partner`
    + `12 = Parent-in-law`
    + `13 = Natural brother/sister`
    + `14 = Half-brother/sister`
    + `15 = Step-brother/sister`
    + `16 = Adopted brother/sister`
    + `17 = Foster brother/sister`
    + `18 = Brother/sister-in-law`
    + `19 = Grandchild`
    + `20 = Grandparent`
    + `21 = Other relative`
    + `22 = Other non-relative`
    + `96 = (THIS CODE NOT USED)`
* Missings:
    + `-9 = Refusal`
    + `-8 = Don't Know`
    + `-2 = Schedule not applicable`
    + `-1 = Not applicable`
* Description: 
```{r assign6, echo=F}
opal.assign.table.tibble(o, 'ELSA_w6_cont_rel','ELSA.wave_6_elsa_data_v2',
                         variables=list('scchdg','scfamg',
                                        'scchdh','scchdi','scchdt','scfamh','scfami','scfamt',
                                        'DhR2','DhR3','DhR4','DhR5','DhR6','DhR7','DhR8','DhR9',
                                       'DhR10','DhR11','DhR12','DhR13','DhR14','DhR15','DhR16'), missings = TRUE)
```

```{r local6, echo=F}
ELSA_w6_cont_rel <- opal.execute(o,'ELSA_w6_cont_rel')

vari <- ELSA_w6_cont_rel$scchdg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scchdg, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scchdg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you meet up with your children") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$scfamg
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scfamg, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scfamg))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often meet up with family members") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$scchdh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scchdh, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$scchdi
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$scchdt
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scchdt))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you send or receive text messages to/from your children") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$scfamh
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scfamh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do speak on the phone to family members") + ylab("Frequency")


vari <- ELSA_w6_cont_rel$scfami
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scfami, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$scfamt
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$scchdi, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(scfamt))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you send or receive text messages to/from family members") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR2
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR2))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person2") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR3
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR3))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person3") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR4
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR4))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person4") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR5
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR5))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person5") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR6
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR6))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person6") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR7
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR7))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person7") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR8
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR8))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person8") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR9
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR9))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person9") + ylab("Frequency")



vari <- ELSA_w6_cont_rel$DhR10
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR10))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person10") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR11
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR11))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person11") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR12
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR12))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person12") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR13
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR13))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person13") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR14
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR14, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR14))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person14") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR15
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR15))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person15") + ylab("Frequency")

vari <- ELSA_w6_cont_rel$DhR16
kable(Categorical_summary(vari, missing_values = c(-1,-2,-8,-9, 96))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(-1,-8,-9))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_w6_cont_rel$DhR11, missing_values = NA)
ggplot(ELSA_w6_cont_rel, aes(x=factor(DhR16))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Relationship to person16") + ylab("Frequency")


```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdg  OR scfamg in {1,2,3} OR scchdh  OR scchdi OR scchdt OR scfamh OR scfami OR scfamt in {1,2} OR  any of DhR2,..,DhR16 in 1:21 into 1`
* `scchdg AND scfamg in {4,5,6} AND scchdh AND scchdi AND scchdt AND scfamh AND scfami AND scfamt in {3,4,5,6} AND all DhR2,..,DhR16 not in 1:21 into 0`
* `scchdg AND scfamg AND scchdh AND scchdi AND scchdt AND scfamh AND scfami AND scfamt  in (-9,NA) AND DhR2,..,DhR16 in (-9,96,NA)  into 999`
* `scchdg AND scfamg AND scchdh AND scchdi AND scchdt AND scfamh AND scfami AND scfamt AND DhR2,..,DhR16 in (-1,-2)  into 996`
* `scchdg AND scfamg AND scchdh AND scchdi AND scchdt AND scfamh AND scfami AND scfamt AND DhR2,..,DhR16 -8  into 998`



**R script:**

```{r harmo6, echo=TRUE}
ELSA_ds_w6 <- tibble(id=ELSA_w6_cont_rel$id)

ELSA_w6_cont_rel$scchdg <- car::recode(as.vector(ELSA_w6_cont_rel$scchdg), "NA='-999'")
ELSA_w6_cont_rel$scfamg <- car::recode(as.vector(ELSA_w6_cont_rel$scfamg), "NA='-999'")

ELSA_w6_cont_rel$scchdh <- car::recode(as.vector(ELSA_w6_cont_rel$scchdh), "NA='-999'")
ELSA_w6_cont_rel$scchdi <- car::recode(as.vector(ELSA_w6_cont_rel$scchdi), "NA='-999'")
ELSA_w6_cont_rel$scchdt <- car::recode(as.vector(ELSA_w6_cont_rel$scchdt), "NA='-999'")

ELSA_w6_cont_rel$scfamh <- car::recode(as.vector(ELSA_w6_cont_rel$scfamh), "NA='-999'")
ELSA_w6_cont_rel$scfami <- car::recode(as.vector(ELSA_w6_cont_rel$scfami), "NA='-999'")
ELSA_w6_cont_rel$scfamt <- car::recode(as.vector(ELSA_w6_cont_rel$scfamt), "NA='-999'")

ELSA_w6_cont_rel$DhR2 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR2), "NA='-999'")
ELSA_w6_cont_rel$DhR3 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR3), "NA='-999'")
ELSA_w6_cont_rel$DhR4 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR4), "NA='-999'")
ELSA_w6_cont_rel$DhR5 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR5), "NA='-999'")
ELSA_w6_cont_rel$DhR6 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR6), "NA='-999'")
ELSA_w6_cont_rel$DhR7 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR7), "NA='-999'")
ELSA_w6_cont_rel$DhR8 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR8), "NA='-999'")
ELSA_w6_cont_rel$DhR9 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR9), "NA='-999'")
ELSA_w6_cont_rel$DhR10 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR10), "NA='-999'")
ELSA_w6_cont_rel$DhR11 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR11), "NA='-999'")
ELSA_w6_cont_rel$DhR12 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR12), "NA='-999'")
ELSA_w6_cont_rel$DhR13 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR13), "NA='-999'")
ELSA_w6_cont_rel$DhR14 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR14), "NA='-999'")
ELSA_w6_cont_rel$DhR15 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR15), "NA='-999'")
ELSA_w6_cont_rel$DhR16 <- car::recode(as.vector(ELSA_w6_cont_rel$DhR16), "NA='-999'")


ELSA_ds_w6$cont_rel <- c(NA) 
for(i in 1:dim(ELSA_w6_cont_rel)[1]){
  if( ELSA_w6_cont_rel$scchdg[i] %in% c(1,2,3) | 
      ELSA_w6_cont_rel$scfamg[i] %in% c(1,2,3) |
      ELSA_w6_cont_rel$scchdh[i] %in% c(1,2) | 
      ELSA_w6_cont_rel$scchdi[i] %in% c(1,2) |
      ELSA_w6_cont_rel$scchdt[i] %in% c(1,2) |
      ELSA_w6_cont_rel$scfamh[i] %in% c(1,2) |
      ELSA_w6_cont_rel$scfami[i] %in% c(1,2) |
      ELSA_w6_cont_rel$scfamt[i] %in% c(1,2) |
      ELSA_w6_cont_rel$DhR2[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR3[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR4[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR5[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR6[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR7[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR8[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR9[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR10[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR11[i] %in% c(1:21) | 
      ELSA_w6_cont_rel$DhR12[i] %in% c(1:21)| 
      ELSA_w6_cont_rel$DhR13[i] %in% c(1:21)| 
      ELSA_w6_cont_rel$DhR14[i] %in% c(1:21)| 
      ELSA_w6_cont_rel$DhR15[i] %in% c(1:21)| 
      ELSA_w6_cont_rel$DhR16[i] %in% c(1:21) ) { 
    ELSA_ds_w6$cont_rel[i] = 1 }
  else if( ELSA_w6_cont_rel$scchdg[i] %in% c(-9, -999) &  
           ELSA_w6_cont_rel$scfamg[i] %in% c(-9, -999) &
           ELSA_w6_cont_rel$scchdh[i] %in% c(-9, -999) &
           ELSA_w6_cont_rel$scchdi[i] %in% c(-9, -999) &
      ELSA_w6_cont_rel$scchdt[i] %in% c(-9, -999) &
      ELSA_w6_cont_rel$scfamh[i] %in% c(-9, -999) &
      ELSA_w6_cont_rel$scfami[i] %in% c(-9, -999) &
      ELSA_w6_cont_rel$scfamt[i] %in% c(-9, -999) &
           ELSA_w6_cont_rel$DhR2[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR3[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR4[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR5[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR6[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR7[i] %in% c(96, -9, -999) &
           ELSA_w6_cont_rel$DhR8[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR9[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR10[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR11[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR12[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR13[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR14[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR15[i] %in% c(96, -9, -999) & 
           ELSA_w6_cont_rel$DhR16[i] %in% c(96, -9, -999) ){ 
    ELSA_ds_w6$cont_rel[i] = 999 }
  else if( ELSA_w6_cont_rel$scchdg[i] %in% c(-1,-2) &  
           ELSA_w6_cont_rel$scfamg[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$scchdh[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$scchdi[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$scchdt[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$scfamh[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$scfami[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$scfamt[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$DhR2[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR3[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR4[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR5[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR6[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR7[i] %in% c(-1,-2) &
           ELSA_w6_cont_rel$DhR8[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR9[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR10[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR11[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR12[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR13[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR14[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR15[i] %in% c(-1,-2) & 
           ELSA_w6_cont_rel$DhR16[i] %in% c(-1,-2) ){ 
    ELSA_ds_w6$cont_rel[i] = 996 }
  else if( ELSA_w6_cont_rel$scchdg[i] ==-8 &  
           ELSA_w6_cont_rel$scfamg[i] ==-8 &
           ELSA_w6_cont_rel$scchdh[i] ==-8 &
           ELSA_w6_cont_rel$scchdi[i] ==-8 &
           ELSA_w6_cont_rel$scchdt[i] ==-8 &
           ELSA_w6_cont_rel$scfamh[i] ==-8 &
           ELSA_w6_cont_rel$scfami[i] ==-8 &
           ELSA_w6_cont_rel$scfamt[i]==-8 &
           ELSA_w6_cont_rel$DhR2[i] ==-8 & 
           ELSA_w6_cont_rel$DhR3[i] ==-8 & 
           ELSA_w6_cont_rel$DhR4[i] ==-8 & 
           ELSA_w6_cont_rel$DhR5[i] ==-8 & 
           ELSA_w6_cont_rel$DhR6[i] ==-8 & 
           ELSA_w6_cont_rel$DhR7[i]==-8 &
           ELSA_w6_cont_rel$DhR8[i] ==-8 & 
           ELSA_w6_cont_rel$DhR9[i] ==-8 & 
           ELSA_w6_cont_rel$DhR10[i] ==-8 & 
           ELSA_w6_cont_rel$DhR11[i] ==-8 & 
           ELSA_w6_cont_rel$DhR12[i] ==-8 & 
           ELSA_w6_cont_rel$DhR13[i] ==-8 & 
           ELSA_w6_cont_rel$DhR14[i] ==-8 & 
           ELSA_w6_cont_rel$DhR15[i] ==-8 & 
           ELSA_w6_cont_rel$DhR16[i] ==-8 ){ 
    ELSA_ds_w6$cont_rel[i] = 998 }
  else if( ELSA_w6_cont_rel$scchdg[i] %in% c(4,5,6) &  
           ELSA_w6_cont_rel$scfamg[i] %in% c(4,5,6) &
           ELSA_w6_cont_rel$scchdh[i] %in% c(3,4,5,6) &
           ELSA_w6_cont_rel$scchdi[i] %in% c(3,4,5,6) &
           ELSA_w6_cont_rel$scchdt[i] %in% c(3,4,5,6) &
           ELSA_w6_cont_rel$scfamh[i] %in% c(3,4,5,6) &
           ELSA_w6_cont_rel$scfami[i] %in% c(3,4,5,6) &
           ELSA_w6_cont_rel$scfamt[i] %in% c(3,4,5,6) &
           !( ELSA_w6_cont_rel$DhR2[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR3[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR4[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR5[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR6[i] %in% c(1:21) |
              ELSA_w6_cont_rel$DhR7[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR8[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR9[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR10[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR11[i] %in% c(1:21) | 
              ELSA_w6_cont_rel$DhR12[i] %in% c(1:21)| 
              ELSA_w6_cont_rel$DhR13[i] %in% c(1:21)| 
              ELSA_w6_cont_rel$DhR14[i] %in% c(1:21)| 
              ELSA_w6_cont_rel$DhR15[i] %in% c(1:21)| 
              ELSA_w6_cont_rel$DhR16[i] %in% c(1:21) )){ 
    ELSA_ds_w6$cont_rel[i] = 0 }
}

ELSA_ds_w6$cont_rel <- car::recode(as.vector(ELSA_ds_w6$cont_rel), "NA='999'")
ELSA_ds_w6$cont_rel <- labelled(ELSA_ds_w6$cont_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript6, echo=F}
vari <- ELSA_ds_w6$cont_rel
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = ELSA_ds_w1$cont_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w6, aes(x=factor(cont_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are contacts with relatives frequent") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6, echo=F}

```

 
```{r save, echo=FALSE}
cont_rel <- ELSA_ds_w1
save(cont_rel, file = "../RData/w1/cont_rel.RData")
rm(cont_rel)

cont_rel <- ELSA_ds_w2
save(cont_rel, file = "../RData/w2/cont_rel.RData")
rm(cont_rel)

cont_rel <- ELSA_ds_w3
save(cont_rel, file = "../RData/w3/cont_rel.RData")
rm(cont_rel)

cont_rel <- ELSA_ds_w4
save(cont_rel, file = "../RData/w4/cont_rel.RData")
rm(cont_rel)

cont_rel <- ELSA_ds_w5
save(cont_rel, file = "../RData/w5/cont_rel.RData")
rm(cont_rel)

cont_rel <- ELSA_ds_w6
save(cont_rel, file = "../RData/w6/cont_rel.RData")
rm(cont_rel)
```






# Quality estimation
```{r closeRsession, echo=FALSE} 
opal.logout(o)
```
