---
title: "ELSA"
author: "Katarzyna Jablonska"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true 
    depth: 6
    number_sections: true  
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r prepare, message=FALSE, include=FALSE}
library(bitops)
library(RCurl)
library(rjson)
library(mime)
library(opal)
library(tibble)
library(car)
library(labelled)
library(Hmisc)
source("Continuous_summary.R")
source("Categorical_summary.R")

# authenticate within opal server 
o <- opal.login('','...','http://...')
```

# Socio-demographic and economic characteristics 

## `Other forms of contacts with relatives`


### Description of DataSchema variable `Are other forms of contacts (phone/mail/Internet communicators) with family members/relatives frequent (i.e. contact once a week or more often)`

The description of harmonised variable is the following:
  
* Name: `oth_rel`
* Label: `Are other forms of contacts with family members/relatives frequent (i.e. contact once a week or more often)`
* Type: categorical
* Categories: 
    + `0 = no`
    + `1 = yes`
* Missings: 
    + `991 = CAPI/interviewer error`
    + `992 = Impute`
    + `993 = Disable to measure`
    + `994 = Not attempt/not done/not yet recorded`
    + `995 = Don't answer`
    + `996 = Not applicable`
    + `997 = Refuse`
    + `998 = Do not know`
    + `999 = Missing`



### ELSA - Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`




```{r assign1}
opal.assign.table.tibble(o, 'ELSA_w1_oth_rel','ELSA.wave_1_core_data_v3', 
                        variables=list('scchdh','scchdi','scfami'), missings = TRUE)
```

```{r local1}
ELSA_w1_oth_rel <- opal.execute(o,'ELSA_w1_oth_rel')
Categorical_summary(var = ELSA_w1_oth_rel$scchdh, missing_values = NA)
ggplot(ELSA_w1_oth_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w1_oth_rel$scchdi, missing_values = NA)
ggplot(ELSA_w1_oth_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w1_oth_rel$scfami, missing_values = NA)
ggplot(ELSA_w1_oth_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if scchdh in {1,2} OR scchdi in {1,2} OR scfami in {1,2} - into 1`
* `else if scchdh in {3,4,5,6} AND scchdi in {3,4,5,6} AND scfami in {3,4,5,6} - into 0`
* `scchdh = -9 OR scchdi = -9  OR scfami = -9 into 995`
* `scchdh = -1 OR scchdi = -1 OR scfami = -1 into 996`
* `NA into 999`

R code of the ALGORITHM:

```{r harmo1}
ELSA_ds_w1 <- tibble(id=ELSA_w1_oth_rel$id)

ELSA_w1_oth_rel$scchdh <- car::recode(as.vector(ELSA_w1_oth_rel$scchdh), "NA='-999'")
ELSA_w1_oth_rel$scchdi <- car::recode(as.vector(ELSA_w1_oth_rel$scchdi), "NA='-999'")
ELSA_w1_oth_rel$scfami <- car::recode(as.vector(ELSA_w1_oth_rel$scfami), "NA='-999'")

ELSA_ds_w1$oth_rel <- c(NA) # I think it is required
for(i in 1:dim(ELSA_w1_oth_rel)[1]){
  if( ELSA_w1_oth_rel$scchdh[i] %in% c(1,2) | ELSA_w1_oth_rel$scchdi[i] %in% c(1,2) | ELSA_w1_oth_rel$scfami[i] %in% c(1,2) ) { 
    ELSA_ds_w1$oth_rel[i] = 1 }
  else if( ELSA_w1_oth_rel$scchdh[i] %in% c(3,4,5,6) & ELSA_w1_oth_rel$scchdi[i] %in% c(3,4,5,6) & ELSA_w1_oth_rel$scfami[i] %in% c(3,4,5,6) ){ 
    ELSA_ds_w1$oth_rel[i] = 0 }
  else if( ELSA_w1_oth_rel$scchdh[i] == -9 | ELSA_w1_oth_rel$scchdi[i] == -9 | ELSA_w1_oth_rel$scfami[i] == -9 ) { 
    ELSA_ds_w1$oth_rel[i] = 995 }
  else if( ELSA_w1_oth_rel$scchdh[i] == -1 |  ELSA_w1_oth_rel$scchdi[i] == -1 | ELSA_w1_oth_rel$scfami[i] == -1 ){ 
    ELSA_ds_w1$oth_rel[i] = 996 }
}

ELSA_ds_w1$oth_rel <- car::recode(as.vector(ELSA_ds_w1$oth_rel), "NA='999'")
ELSA_ds_w1$oth_rel <- labelled(ELSA_ds_w1$oth_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript1}
Categorical_summary(var = ELSA_ds_w1$oth_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w1, aes(x=factor(oth_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are other forms of contacts contacts with relatives frequent (i.e. contact once a week or more often)") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### ELSA - Wave 2

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`


* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`
    
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-1	= Item not applicable`


```{r assign2}
opal.assign.table.tibble(o, 'ELSA_w2_oth_rel','ELSA.wave_2_core_data_v4', 
                        variables=list('scchdh','scchdi','scfamh','scfami'), missings = TRUE)
```

```{r local2}
ELSA_w2_oth_rel <- opal.execute(o,'ELSA_w2_oth_rel')
Categorical_summary(var = ELSA_w2_oth_rel$scchdh, missing_values = NA)
ggplot(ELSA_w2_oth_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w2_oth_rel$scchdi, missing_values = NA)
ggplot(ELSA_w2_oth_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w2_oth_rel$scfamh, missing_values = NA)
ggplot(ELSA_w2_oth_rel, aes(x=factor(scfamh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("How often the respondent speaks with other relatives on the phone") + ylab("Frequency")
Categorical_summary(var = ELSA_w2_oth_rel$scfami, missing_values = NA)
ggplot(ELSA_w2_oth_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you write or email family members") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdh in {1,2} OR scchdi in {1,2} OR scfamh in {1,2} OR scfami in {1,2} - into 1`
* `scchdh in {3,4,5,6} AND scchdi in {3,4,5,6} AND scfamh in {3,4,5,6} AND scfami in {3,4,5,6} - into 0`
* `scchdh = -9 OR scchdi = -9 OR scfamh = -9 OR scfami = -9 into 995`
* `scchdh = -1 OR scchdi = -1 OR scfamh = -1 OR scfami = -1 into 996`
* `NA into 999`

R code of the ALGORITHM:

```{r harmo2}
ELSA_ds_w2 <- tibble(id=ELSA_w2_oth_rel$id)

ELSA_w2_oth_rel$scchdh <- car::recode(as.vector(ELSA_w2_oth_rel$scchdh), "NA='-999'")
ELSA_w2_oth_rel$scchdi <- car::recode(as.vector(ELSA_w2_oth_rel$scchdi), "NA='-999'")
ELSA_w2_oth_rel$scfamh <- car::recode(as.vector(ELSA_w2_oth_rel$scfamh), "NA='-999'")
ELSA_w2_oth_rel$scfami <- car::recode(as.vector(ELSA_w2_oth_rel$scfami), "NA='-999'")

ELSA_ds_w2$oth_rel <- c(NA) # I think it is required
for(i in 1:dim(ELSA_w2_oth_rel)[1]){
  if( ELSA_w2_oth_rel$scchdh[i] %in% c(1,2) | ELSA_w2_oth_rel$scchdi[i] %in% c(1,2) |
      ELSA_w2_oth_rel$scfamh[i] %in% c(1,2) | ELSA_w2_oth_rel$scfami[i] %in% c(1,2) ) { 
    ELSA_ds_w2$oth_rel[i] = 1 }
  else if( ELSA_w2_oth_rel$scchdh[i] %in% c(3,4,5,6) &  ELSA_w2_oth_rel$scchdi[i] %in% c(3,4,5,6) &
           ELSA_w2_oth_rel$scfamh[i] %in% c(3,4,5,6) &  ELSA_w2_oth_rel$scfami[i] %in% c(3,4,5,6) ){ 
    ELSA_ds_w2$oth_rel[i] = 0 }
  else if( ELSA_w2_oth_rel$scchdh[i] == -9 |  ELSA_w2_oth_rel$scchdi[i] == -9 |
           ELSA_w2_oth_rel$scfamh[i] == -9 |  ELSA_w2_oth_rel$scfami[i] == -9 ) { 
    ELSA_ds_w2$oth_rel[i] = 995 }
  else if( ELSA_w2_oth_rel$scchdh[i] == -1 |  ELSA_w2_oth_rel$scchdi[i] == -1 |
           ELSA_w2_oth_rel$scfamh[i] == -1 |  ELSA_w2_oth_rel$scfami[i] == -1 ){ 
    ELSA_ds_w2$oth_rel[i] = 996 }
}

ELSA_ds_w2$oth_rel <- car::recode(as.vector(ELSA_ds_w2$oth_rel), "NA='999'")
ELSA_ds_w2$oth_rel <- labelled(ELSA_ds_w2$oth_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript2}
Categorical_summary(var = ELSA_ds_w2$oth_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w2, aes(x=factor(oth_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are other forms of contacts contacts with relatives frequent (i.e. contact once a week or more often)") + ylab("Frequency")
```

#### Validation
```{r crosstabulation2}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### ELSA - Wave 3

The study-specific variable elected to be harmonised is:

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8 = Don't know`
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-1	= Item not applicable`

* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-1	= Item not applicable`


```{r assign3}
opal.assign.table.tibble(o, 'ELSA_w3_oth_rel','ELSA.wave_3_elsa_data_v4', 
                        variables=list('scchdh','scchdi','scfamh','scfami'), missings = TRUE)
```

```{r local3}
ELSA_w3_oth_rel <- opal.execute(o,'ELSA_w3_oth_rel')
Categorical_summary(var = ELSA_w3_oth_rel$scchdh, missing_values = NA)
ggplot(ELSA_w3_oth_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w3_oth_rel$scchdi, missing_values = NA)
ggplot(ELSA_w3_oth_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w3_oth_rel$scfamh, missing_values = NA)
ggplot(ELSA_w3_oth_rel, aes(x=factor(scfamh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("How often the respondent speaks with other relatives on the phone") + ylab("Frequency")
Categorical_summary(var = ELSA_w3_oth_rel$scfami, missing_values = NA)
ggplot(ELSA_w3_oth_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you write or email family members") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdh in {1,2} OR scchdi in {1,2} OR scfamh in {1,2} OR scfami in {1,2} - into 1`
* `scchdh in {3,4,5,6} AND scchdi in {3,4,5,6} AND scfamh in {3,4,5,6} AND scfami in {3,4,5,6} - into 0`
* `scchdh = -9 OR scchdi = -9 OR scfamh = -9 OR scfami = -9 into 995`
* `scchdh = -8 OR scchdi = -8 OR scfamh = -8 OR scfami = -8 into 998`
* `scchdh = -1 OR scchdi = -1 OR scfamh = -1 OR scfami = -1 into 996`
* `NA into 999`

R code of the ALGORITHM:

```{r harmo3}
ELSA_ds_w3 <- tibble(id=ELSA_w3_oth_rel$id)

ELSA_w3_oth_rel$scchdh <- car::recode(as.vector(ELSA_w3_oth_rel$scchdh), "NA='-999'")
ELSA_w3_oth_rel$scchdi <- car::recode(as.vector(ELSA_w3_oth_rel$scchdi), "NA='-999'")
ELSA_w3_oth_rel$scfamh <- car::recode(as.vector(ELSA_w3_oth_rel$scfamh), "NA='-999'")
ELSA_w3_oth_rel$scfami <- car::recode(as.vector(ELSA_w3_oth_rel$scfami), "NA='-999'")

ELSA_ds_w3$oth_rel <- c(NA) # I think it is required
for(i in 1:dim(ELSA_w3_oth_rel)[1]){
  if( ELSA_w3_oth_rel$scchdh[i] %in% c(1,2) | ELSA_w3_oth_rel$scchdi[i] %in% c(1,2) |
      ELSA_w3_oth_rel$scfamh[i] %in% c(1,2) | ELSA_w3_oth_rel$scfami[i] %in% c(1,2) ) { 
    ELSA_ds_w3$oth_rel[i] = 1 }
  else if( ELSA_w3_oth_rel$scchdh[i] %in% c(3,4,5,6) &  ELSA_w3_oth_rel$scchdi[i] %in% c(3,4,5,6) &
           ELSA_w3_oth_rel$scfamh[i] %in% c(3,4,5,6) &  ELSA_w3_oth_rel$scfami[i] %in% c(3,4,5,6) ){ 
    ELSA_ds_w3$oth_rel[i] = 0 }
  else if( ELSA_w3_oth_rel$scchdh[i] == -9 |  ELSA_w3_oth_rel$scchdi[i] == -9 |
           ELSA_w3_oth_rel$scfamh[i] == -9 |  ELSA_w3_oth_rel$scfami[i] == -9 ) { 
    ELSA_ds_w3$oth_rel[i] = 995 }
  else if( ELSA_w3_oth_rel$scchdh[i] == -8 |  ELSA_w3_oth_rel$scchdi[i] == -8 |
           ELSA_w3_oth_rel$scfamh[i] == -8 |  ELSA_w3_oth_rel$scfami[i] == -8 ) { 
    ELSA_ds_w3$oth_rel[i] = 998 }
  else if( ELSA_w3_oth_rel$scchdh[i] == -1 |  ELSA_w3_oth_rel$scchdi[i] == -1 |
           ELSA_w3_oth_rel$scfamh[i] == -1 |  ELSA_w3_oth_rel$scfami[i] == -1 ){ 
    ELSA_ds_w3$oth_rel[i] = 996 }
}

ELSA_ds_w3$oth_rel <- car::recode(as.vector(ELSA_ds_w3$oth_rel), "NA='999'")
ELSA_ds_w3$oth_rel <- labelled(ELSA_ds_w3$oth_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript3}
Categorical_summary(var = ELSA_ds_w3$oth_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w3, aes(x=factor(oth_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are other forms of contacts contacts with relatives frequent (i.e. contact once a week or more often)") + ylab("Frequency")
```

#### Validation
```{r crosstabulation3}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]



### ELSA - Wave 4

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `How often the respondent writes to or emails other relatives`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know` 
    + `-1	= Item not applicable`
     


```{r assign4}
opal.assign.table.tibble(o, 'ELSA_w4_oth_rel','ELSA.wave_4_elsa_data_v3', 
                        variables=list('scchdh','scchdi','scfami'), missings = TRUE)
```

```{r local4}
ELSA_w4_oth_rel <- opal.execute(o,'ELSA_w4_oth_rel')
Categorical_summary(var = ELSA_w4_oth_rel$scchdh, missing_values = NA)
ggplot(ELSA_w4_oth_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w4_oth_rel$scchdi, missing_values = NA)
ggplot(ELSA_w4_oth_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w4_oth_rel$scfami, missing_values = NA)
ggplot(ELSA_w4_oth_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("How often the respondent writes to or emails other relatives") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdh in {1,2} OR scchdi in {1,2} OR scfami in {1,2} into 1`
* `scchdh in {3,4,5,6} AND scchdi in {3,4,5,6} AND scfami in {3,4,5,6} into 0`
* `scchdh = -9 OR scchdi = -9 OR scfami = -9 into 995`
* `scchdh = -8 OR scchdi = -8 OR scfami = -8 into 998`
* `scchdh = -1 OR scchdi = -1 OR scfami = -1 into 996`
* `NA into 999`

R code of the ALGORITHM:

```{r harmo4}
ELSA_ds_w4 <- tibble(id=ELSA_w4_oth_rel$id)

ELSA_w4_oth_rel$scchdh <- car::recode(as.vector(ELSA_w4_oth_rel$scchdh), "NA='-999'")
ELSA_w4_oth_rel$scchdi <- car::recode(as.vector(ELSA_w4_oth_rel$scchdi), "NA='-999'")
ELSA_w4_oth_rel$scfami <- car::recode(as.vector(ELSA_w4_oth_rel$scfami), "NA='-999'")

ELSA_ds_w4$oth_rel <- c(NA) # I think it is required
for(i in 1:dim(ELSA_w4_oth_rel)[1]){
  if( ELSA_w4_oth_rel$scchdh[i] %in% c(1,2) | ELSA_w4_oth_rel$scchdi[i] %in% c(1,2) | ELSA_w4_oth_rel$scfami[i] %in% c(1,2) ) { 
    ELSA_ds_w4$oth_rel[i] = 1 }
  else if( ELSA_w4_oth_rel$scchdh[i] %in% c(3,4,5,6) & ELSA_w4_oth_rel$scchdi[i] %in% c(3,4,5,6) & ELSA_w4_oth_rel$scfami[i] %in% c(3,4,5,6) ){ 
    ELSA_ds_w4$oth_rel[i] = 0 }
  else if( ELSA_w4_oth_rel$scchdh[i] == -9 | ELSA_w4_oth_rel$scchdi[i] == -9 | ELSA_w4_oth_rel$scfami[i] == -9 ) { ELSA_ds_w4$oth_rel[i] = 995 }
  else if( ELSA_w4_oth_rel$scchdh[i] == -8 | ELSA_w4_oth_rel$scchdi[i] == -8 | ELSA_w4_oth_rel$scfami[i] == -8 ) { ELSA_ds_w4$oth_rel[i] = 998 }
  else if( ELSA_w4_oth_rel$scchdh[i] == -1 | ELSA_w4_oth_rel$scchdi[i] == -1 | ELSA_w4_oth_rel$scfami[i] == -1 ) { ELSA_ds_w4$oth_rel[i] = 996 }
}

ELSA_ds_w4$oth_rel <- car::recode(as.vector(ELSA_ds_w4$oth_rel), "NA='999'")
ELSA_ds_w4$oth_rel <- labelled(ELSA_ds_w4$oth_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript4}
Categorical_summary(var = ELSA_ds_w4$oth_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w4, aes(x=factor(oth_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are other forms of contacts contacts with relatives frequent (i.e. contact once a week or more often)") + ylab("Frequency")
```

#### Validation
```{r crosstabulation4}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]


### ELSA - Wave 5

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable` 
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`

* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`


```{r assign5}
opal.assign.table.tibble(o, 'ELSA_w5_oth_rel','ELSA.wave_5_elsa_data_v4', 
                        variables=list('scchdh','scchdi','scfamh','scfami'), missings = TRUE)
```

```{r local5}
ELSA_w5_oth_rel <- opal.execute(o,'ELSA_w5_oth_rel')
Categorical_summary(var = ELSA_w5_oth_rel$scchdh, missing_values = NA)
ggplot(ELSA_w5_oth_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w5_oth_rel$scchdi, missing_values = NA)
ggplot(ELSA_w5_oth_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w5_oth_rel$scfamh, missing_values = NA)
ggplot(ELSA_w5_oth_rel, aes(x=factor(scfamh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("How often the respondent speaks with other relatives on the phone") + ylab("Frequency")
Categorical_summary(var = ELSA_w5_oth_rel$scfami, missing_values = NA)
ggplot(ELSA_w5_oth_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("On average how often do you write or email family members") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `scchdh in {1,2} OR scchdi in {1,2} OR scfamh in {1,2} OR scfami in {1,2} - into 1`
* `scchdh in {3,4,5,6} AND scchdi in {3,4,5,6} AND scfamh in {3,4,5,6} AND scfami in {3,4,5,6} - into 0`
* `scchdh = -9 OR scchdi = -9 OR scfamh = -9 OR scfami = -9 into 995`
* `scchdh = -8 OR scchdi = -8 OR scfamh = -8 OR scfami = -8 into 998`
* `scchdh = -2 OR scchdi = -2 OR scfamh = -2 OR scfami = -2 into 996`
* `scchdh = -1 OR scchdi = -1 OR scfamh = -1 OR scfami = -1 into 996`
* `NA into 999`

R code of the ALGORITHM:

```{r harmo5}
ELSA_ds_w5 <- tibble(id=ELSA_w5_oth_rel$id)

ELSA_w5_oth_rel$scchdh <- car::recode(as.vector(ELSA_w5_oth_rel$scchdh), "NA='-999'")
ELSA_w5_oth_rel$scchdi <- car::recode(as.vector(ELSA_w5_oth_rel$scchdi), "NA='-999'")
ELSA_w5_oth_rel$scfamh <- car::recode(as.vector(ELSA_w5_oth_rel$scfamh), "NA='-999'")
ELSA_w5_oth_rel$scfami <- car::recode(as.vector(ELSA_w5_oth_rel$scfami), "NA='-999'")

ELSA_ds_w5$oth_rel <- c(NA) # I think it is required
for(i in 1:dim(ELSA_w5_oth_rel)[1]){
  if( ELSA_w5_oth_rel$scchdh[i] %in% c(1,2) | ELSA_w5_oth_rel$scchdi[i] %in% c(1,2) |
      ELSA_w5_oth_rel$scfamh[i] %in% c(1,2) | ELSA_w5_oth_rel$scfami[i] %in% c(1,2) ) { 
    ELSA_ds_w5$oth_rel[i] = 1 }
  else if( ELSA_w5_oth_rel$scchdh[i] %in% c(3,4,5,6) &  ELSA_w5_oth_rel$scchdi[i] %in% c(3,4,5,6) &
           ELSA_w5_oth_rel$scfamh[i] %in% c(3,4,5,6) &  ELSA_w5_oth_rel$scfami[i] %in% c(3,4,5,6) ){ 
    ELSA_ds_w5$oth_rel[i] = 0 }
  else if( ELSA_w5_oth_rel$scchdh[i] == -9 |  ELSA_w5_oth_rel$scchdi[i] == -9 |
           ELSA_w5_oth_rel$scfamh[i] == -9 |  ELSA_w5_oth_rel$scfami[i] == -9 ) { 
    ELSA_ds_w5$oth_rel[i] = 995 }
  else if( ELSA_w5_oth_rel$scchdh[i] == -8 |  ELSA_w5_oth_rel$scchdi[i] == -8 |
           ELSA_w5_oth_rel$scfamh[i] == -8 |  ELSA_w5_oth_rel$scfami[i] == -8 ) { 
    ELSA_ds_w5$oth_rel[i] = 998 }
  else if( ELSA_w5_oth_rel$scchdh[i] == -2 |  ELSA_w5_oth_rel$scchdi[i] == -2 |
           ELSA_w5_oth_rel$scfamh[i] == -2 |  ELSA_w5_oth_rel$scfami[i] == -2 ){ 
    ELSA_ds_w5$oth_rel[i] = 996 }
  else if( ELSA_w5_oth_rel$scchdh[i] == -1 |  ELSA_w5_oth_rel$scchdi[i] == -1 |
           ELSA_w5_oth_rel$scfamh[i] == -1 |  ELSA_w5_oth_rel$scfami[i] == -1 ){ 
    ELSA_ds_w5$oth_rel[i] = 996 }
}

ELSA_ds_w5$oth_rel <- car::recode(as.vector(ELSA_ds_w5$oth_rel), "NA='999'")
ELSA_ds_w5$oth_rel <- labelled(ELSA_ds_w5$oth_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript5}
Categorical_summary(var = ELSA_ds_w5$oth_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w5, aes(x=factor(oth_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are other forms of contacts contacts with relatives frequent (i.e. contact once a week or more often)") + ylab("Frequency")
```

#### Validation
```{r crosstabulation5}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]



### ELSA - Wave 6

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `scchdh`
* Label: `on average how often do you speak on the phone to your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable` 
    + `-1	= Item not applicable`
    
* Name: `scchdi`
* Label: `on average how often do you write or email your children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`

* Name: `scchdt`
* Label: `How often the respondent sends or receives text messages to/from their children`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`
    + `-8	= Don't know`    
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`


* Name: `scfamh`
* Label: `How often the respondent speaks with other relatives on the phone`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
* Name: `scfami`
* Label: `on average how often do you write or email family members`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`
    
* Name: `scfamt`
* Label: `How often the respondent sends or receives text messages to/from other relatives`
* Categories:
    + `1	= Three or more times a week`
    + `2	= Once or twice a week`
    + `3	= Once or twice a month`	
    + `4	= Every few months`
    + `5	= Once or twice a year`
    + `6	= Less than once a year or never`
* Missings:
    + `-9	= Not answered`    
    + `-8 = Don't know`
    + `-2 = Schedule Not Applicable`
    + `-1	= Item not applicable`


```{r assign6}
opal.assign.table.tibble(o, 'ELSA_w6_oth_rel','ELSA.wave_6_elsa_data_v2', 
                        variables=list('scchdh','scchdi','scchdt','scfamh','scfami','scfamt'), missings = TRUE)
```

```{r local6}
ELSA_w6_oth_rel <- opal.execute(o,'ELSA_w6_oth_rel')
Categorical_summary(var = ELSA_w6_oth_rel$scchdh, missing_values = NA)
ggplot(ELSA_w6_oth_rel, aes(x=factor(scchdh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you speak on the phone to your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w6_oth_rel$scchdi, missing_values = NA)
ggplot(ELSA_w6_oth_rel, aes(x=factor(scchdi))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email your children") + ylab("Frequency")
Categorical_summary(var = ELSA_w6_oth_rel$scchdt, missing_values = NA)
ggplot(ELSA_w6_oth_rel, aes(x=factor(scchdt))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("How often the respondent sends or receives text messages to/from their children") + ylab("Frequency")
Categorical_summary(var = ELSA_w6_oth_rel$scfamh, missing_values = NA)
ggplot(ELSA_w6_oth_rel, aes(x=factor(scfamh))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("How often the respondent speaks with other relatives on the phone") + ylab("Frequency")
Categorical_summary(var = ELSA_w6_oth_rel$scfami, missing_values = NA)
ggplot(ELSA_w6_oth_rel, aes(x=factor(scfami))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("on average how often do you write or email family members") + ylab("Frequency")
Categorical_summary(var = ELSA_w6_oth_rel$scfamt, missing_values = NA)
ggplot(ELSA_w6_oth_rel, aes(x=factor(scfamt))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("How often the respondent sends or receives text messages to/from other relatives") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `if any of scchdh, scchdi, scchdt, scfamh, scfami, scfamt in {1,2} - into 1`
* `if all of scchdh, scchdi, scchdt, scfamh, scfami, scfamt in {3,4,5,6} - into 0`
* `if any of scchdh, scchdi, scchdt, scfamh, scfami, scfamt = -9 - into into 995`
* `if any of scchdh, scchdi, scchdt, scfamh, scfami, scfamt = -8 - into into 998`
* `if any of scchdh, scchdi, scchdt, scfamh, scfami, scfamt = -2 - into into 996`
* `if any of scchdh, scchdi, scchdt, scfamh, scfami, scfamt = -1 - into into 996`
* `NA into 999`

R code of the ALGORITHM:

```{r harmo6}
ELSA_ds_w6 <- tibble(id=ELSA_w6_oth_rel$id)

ELSA_w6_oth_rel$scchdh <- car::recode(as.vector(ELSA_w6_oth_rel$scchdh), "NA='-999'")
ELSA_w6_oth_rel$scchdi <- car::recode(as.vector(ELSA_w6_oth_rel$scchdi), "NA='-999'")
ELSA_w6_oth_rel$scchdt <- car::recode(as.vector(ELSA_w6_oth_rel$scchdt), "NA='-999'")
ELSA_w6_oth_rel$scfami <- car::recode(as.vector(ELSA_w6_oth_rel$scfami), "NA='-999'")
ELSA_w6_oth_rel$scfamh <- car::recode(as.vector(ELSA_w6_oth_rel$scfamh), "NA='-999'")
ELSA_w6_oth_rel$scfamt <- car::recode(as.vector(ELSA_w6_oth_rel$scfamt), "NA='-999'")

ELSA_ds_w6$oth_rel <- c(NA) # I think it is required
for(i in 1:dim(ELSA_w6_oth_rel)[1]){
  if( ELSA_w6_oth_rel$scchdh[i] %in% c(1,2) | ELSA_w6_oth_rel$scchdi[i] %in% c(1,2) | ELSA_w6_oth_rel$scchdt[i] %in% c(1,2) |
      ELSA_w6_oth_rel$scfamh[i] %in% c(1,2) | ELSA_w6_oth_rel$scfami[i] %in% c(1,2) | ELSA_w6_oth_rel$scfamt[i] %in% c(1,2) ) { 
    ELSA_ds_w6$oth_rel[i] = 1 }
  else if( ELSA_w6_oth_rel$scchdh[i] %in% c(3,4,5,6) & ELSA_w6_oth_rel$scchdi[i] %in% c(3,4,5,6) & ELSA_w6_oth_rel$scchdt[i] %in% c(3,4,5,6) &
           ELSA_w6_oth_rel$scfamh[i] %in% c(3,4,5,6) & ELSA_w6_oth_rel$scfami[i] %in% c(3,4,5,6) & ELSA_w6_oth_rel$scfamt[i] %in% c(3,4,5,6) ){ 
    ELSA_ds_w6$oth_rel[i] = 0 }
  else if( ELSA_w6_oth_rel$scchdh[i] == -9 | ELSA_w6_oth_rel$scchdi[i] == -9 | ELSA_w6_oth_rel$scchdt[i] == -9 |
           ELSA_w6_oth_rel$scfamh[i] == -9 | ELSA_w6_oth_rel$scfami[i] == -9 | ELSA_w6_oth_rel$scfamt[i] == -9 ) { 
    ELSA_ds_w6$oth_rel[i] = 995 }
  else if( ELSA_w6_oth_rel$scchdh[i] == -8 | ELSA_w6_oth_rel$scchdi[i] == -8 | ELSA_w6_oth_rel$scchdt[i] == -8 |
           ELSA_w6_oth_rel$scfamh[i] == -8 | ELSA_w6_oth_rel$scfami[i] == -8 | ELSA_w6_oth_rel$scfamt[i] == -8 ) { 
    ELSA_ds_w6$oth_rel[i] = 998 }
  else if( ELSA_w6_oth_rel$scchdh[i] == -2 | ELSA_w6_oth_rel$scchdi[i] == -2 | ELSA_w6_oth_rel$scchdt[i] == -2 |
           ELSA_w6_oth_rel$scfamh[i] == -2 | ELSA_w6_oth_rel$scfami[i] == -2 | ELSA_w6_oth_rel$scfamt[i] == -2 ) { 
    ELSA_ds_w6$oth_rel[i] = 996 }
  else if( ELSA_w6_oth_rel$scchdh[i] == -1 | ELSA_w6_oth_rel$scchdi[i] == -1 | ELSA_w6_oth_rel$scchdt[i] == -1 |
           ELSA_w6_oth_rel$scfamh[i] == -1 | ELSA_w6_oth_rel$scfami[i] == -1 | ELSA_w6_oth_rel$scfamt[i] == -1 ){ 
    ELSA_ds_w6$oth_rel[i] = 996 }
}

ELSA_ds_w6$oth_rel <- car::recode(as.vector(ELSA_ds_w6$oth_rel), "NA='999'")
ELSA_ds_w6$oth_rel <- labelled(ELSA_ds_w6$oth_rel, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistics of the new harmonised variable
```{r descript6}
Categorical_summary(var = ELSA_ds_w6$oth_rel, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(ELSA_ds_w6, aes(x=factor(oth_rel))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Are other forms of contacts contacts with relatives frequent (i.e. contact once a week or more often)") + ylab("Frequency")
```

#### Validation
```{r crosstabulation6}

```

#### Quality estimation
[Comments on the quality of the new harmonised variable.]
