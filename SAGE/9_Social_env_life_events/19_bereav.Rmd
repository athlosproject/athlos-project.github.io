---
title: "Experience of a loss of any close person"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->

```{r setup, include=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_ania.r")
```

<!-- ########################################################## --> 



# Description of DataSchema variable

The description of harmonised variables is the following:

* Short name: `bereav`
* Variable label: `Experience of a loss of any close person`
* Domain: `Social environment`
* Value type: `cathegorical`
* Categories:

**Code** | **Category Label**
-------- | ------------------
0        | No
1        | Yes


* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing


<!-- ########################################################## --> 

# Data process

## China

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q1012`
* Label: `q1012: marital status`
* Categories: 
    + `1 = never married`
    + `2 = currently married`
    + `3 = cohabiting`
    + `4 = separated/divorced`
    + `5 = widowed`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`


* Description: 
```{r assign1 ch}
opal.assign.table.tibble(o, 'SAGE_china_w1_bereav','SAGE.chinaINDData', variables=list('q1012'), missings = TRUE)
```

```{r local1 ch}
SAGE_china_w1_bereav <- opal.execute(o,'SAGE_china_w1_bereav')
vari <- SAGE_china_w1_bereav$q1012
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_china_w1_bereav$q1012, missing_values = NA)
ggplot(SAGE_china_w1_bereav, aes(x=factor(q1012))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("marital status") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `5 into 1`
* `1:4 into 0`
* `8 into 998`
* `9 into 996`
* `NA into 999`

**R script:**

```{r harmo1 ch, echo=TRUE}
SAGE_china_ds_w1 <- tibble(id=SAGE_china_w1_bereav$id)
SAGE_china_ds_w1$bereav <- car::recode(as.vector(SAGE_china_w1_bereav$q1012), "5='1'; 1:4='0'; 8='998'; 9='996'; NA='999'")
SAGE_china_ds_w1$bereav <- labelled(SAGE_china_ds_w1$bereav, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1 ch}
vari <- SAGE_china_ds_w1$bereav
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_china_ds_w1$bereav, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SAGE_china_ds_w1, aes(x=factor(bereav))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of a loss of any close person") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1 ch}
AfterH <- table(SAGE_china_ds_w1$bereav)
BeforeH <- table(SAGE_china_w1_bereav$q1012, useNA='ifany')
BeforeH1 <- c(NA)
BeforeH1[[1]] <- sum(BeforeH[c(1:4)])
BeforeH1[c(2,3,4)] <- BeforeH[c(5,6,7)]
C <- rbind(BeforeH1,AfterH)
colnames(C) <- c("1:4->0","5->1","8->998","NA->999")
kable(C)
```

 
 


## Ghana

### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q1012`
* Label: `q1012: marital status`
* Categories: 
    + `1 = never married`
    + `2 = currently married`
    + `3 = cohabiting`
    + `4 = separated/divorced`
    + `5 = widowed`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8005a`
* Label: `q8005: Is somebody in the household who needed help alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005b`
* Label: `q8005b: Is somebody in the household who needed help alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005c`
* Label: `q8005c: Is somebody in the household who needed help alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005d`
* Label: `q8005d: Is somebody in the household who needed help alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8029b`
* Label: ` q8029b: Is this child alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8030b`
* Label: ` q8030b: Is this child alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8031b`
* Label: ` q8031b: Is this child alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8032b`
* Label: ` q8032b: Is this child alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    



* Description: 
```{r assign1 gh}
opal.assign.table.tibble(o, 'SAGE_ghana_w1_bereav','SAGE.ghanaINDData', 
                        variables=list('q1012','q8005a','q8005b','q8005c','q8005d',
                                       'q8029b','q8030b','q8031b','q8032b'), missings = TRUE)
```


```{r local1 gh}
SAGE_ghana_w1_bereav <- opal.execute(o,'SAGE_ghana_w1_bereav')

vari <- SAGE_ghana_w1_bereav$q1012
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q1012, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q1012))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("marital status") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8005a
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8005a, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8005a))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (1)") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8005b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8005b, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8005b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (2)") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8005c
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8005c, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8005c))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (3)") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8005d
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8005d, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8005d))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (4)") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8029b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8029b, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8029b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (1)?") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8030b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8030b, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8030b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (2)?") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8031b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8031b, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8031b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("(Is this child alive or dead (3)?") + ylab("Frequency")

vari <- SAGE_ghana_w1_bereav$q8032b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_w1_bereav$q8032b, missing_values = NA)
ggplot(SAGE_ghana_w1_bereav, aes(x=factor(q8032b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (4)?") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `q1012=5 or q8005a=2 or q8005b=2 or q8005c=2 or q8005d=2 or q8029b=2 or q8030b=2 or q8031b=2 or q8032b=2 INTO 1`
* `q1012 in (1,2,3,4) and q8005a=1 and q8005b=1 and q8005c=1 and q8005d=1 and q8029b=1 and q8030b=1 and   `
`  q8031b=1 and q8032b=1 INTO 0`
* `q1012=8 or q8005a=8 or q8005b=8 or q8005c=8 or q8005d=8 or q8029b=8 or q8030b=8 or q8031b=8 or q8032b=8 INTO 998`
* `q1012=9 or q8005a=9 or q8005b=9 or q8005c=9 or q8005d=9 or q8029b=9 or q8030b=9 or q8031b=9 or q8032b=9 INTO 996`
* `NA into 999`

**R script:**

```{r harmo1 gh, echo=TRUE}
SAGE_ghana_ds_w1 <- tibble(id=SAGE_ghana_w1_bereav$id)

SAGE_ghana_w1_bereav$q1012 <- car::recode(as.vector(SAGE_ghana_w1_bereav$q1012), "NA='-999'")
SAGE_ghana_w1_bereav$q8005a <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8005a), "NA='-999'")
SAGE_ghana_w1_bereav$q8005b <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8005b), "NA='-999'")
SAGE_ghana_w1_bereav$q8005c <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8005c), "NA='-999'")
SAGE_ghana_w1_bereav$q8005d <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8005d), "NA='-999'")
SAGE_ghana_w1_bereav$q8029b <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8029b), "NA='-999'")
SAGE_ghana_w1_bereav$q8030b <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8030b), "NA='-999'")
SAGE_ghana_w1_bereav$q8031b <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8031b), "NA='-999'")
SAGE_ghana_w1_bereav$q8032b <- car::recode(as.vector(SAGE_ghana_w1_bereav$q8032b), "NA='-999'")

SAGE_ghana_ds_w1$bereav <- c(NA)
for(i in 1:dim(SAGE_ghana_w1_bereav)[1]){
  if( SAGE_ghana_w1_bereav$q1012[i] == 5 | SAGE_ghana_w1_bereav$q8005a[i] == 2 | SAGE_ghana_w1_bereav$q8005b[i] == 2
       | SAGE_ghana_w1_bereav$q8005c[i] == 2 | SAGE_ghana_w1_bereav$q8005d[i] == 2 | SAGE_ghana_w1_bereav$q8029b[i] == 2
       | SAGE_ghana_w1_bereav$q8030b[i] == 2 | SAGE_ghana_w1_bereav$q8031b[i] == 2 | SAGE_ghana_w1_bereav$q8032b[i] == 2 ) {
  SAGE_ghana_ds_w1$bereav[i] = 1 }
  
  else if( SAGE_ghana_w1_bereav$q1012[i] == -999 & SAGE_ghana_w1_bereav$q8005a[i] == -999 &
           SAGE_ghana_w1_bereav$q8005b[i] == -999 & SAGE_ghana_w1_bereav$q8005c[i] == -999 & SAGE_ghana_w1_bereav$q8005d[i] == -999 &
           SAGE_ghana_w1_bereav$q8029b[i] == -999 & SAGE_ghana_w1_bereav$q8030b[i] == -999 & SAGE_ghana_w1_bereav$q8031b[i] == -999 &
           SAGE_ghana_w1_bereav$q8032b[i] == -999 ) {
  SAGE_ghana_ds_w1$bereav[i] = 999 }
  
  else if( SAGE_ghana_w1_bereav$q1012[i] == 8 & SAGE_ghana_w1_bereav$q8005a[i] == 8 &
           SAGE_ghana_w1_bereav$q8005b[i] == 8 & SAGE_ghana_w1_bereav$q8005c[i] == 8 & SAGE_ghana_w1_bereav$q8005d[i] == 8 &
           SAGE_ghana_w1_bereav$q8029b[i] == 8 & SAGE_ghana_w1_bereav$q8030b[i] == 8 & SAGE_ghana_w1_bereav$q8031b[i] == 8 &
           SAGE_ghana_w1_bereav$q8032b[i] == 8 ) {
  SAGE_ghana_ds_w1$bereav[i] = 998 }
  
  else if( SAGE_ghana_w1_bereav$q1012[i] == 9 & SAGE_ghana_w1_bereav$q8005a[i] == 9 &
           SAGE_ghana_w1_bereav$q8005b[i] == 9 & SAGE_ghana_w1_bereav$q8005c[i] == 9 & SAGE_ghana_w1_bereav$q8005d[i] == 9 &
           SAGE_ghana_w1_bereav$q8029b[i] == 9 & SAGE_ghana_w1_bereav$q8030b[i] == 9 & SAGE_ghana_w1_bereav$q8031b[i] == 9 &
           SAGE_ghana_w1_bereav$q8032b[i] == 9 ) {
  SAGE_ghana_ds_w1$bereav[i] = 996 }
  
  else if( SAGE_ghana_w1_bereav$q1012[i] %in% c(-999,1,2,3,4) & SAGE_ghana_w1_bereav$q8005a[i] %in% c(1,-999) &
           SAGE_ghana_w1_bereav$q8005b[i] %in% c(1,-999) & SAGE_ghana_w1_bereav$q8005c[i] %in% c(1,-999) & SAGE_ghana_w1_bereav$q8005d[i] %in% c(1,-999) &
           SAGE_ghana_w1_bereav$q8029b[i] %in% c(1,-999) & SAGE_ghana_w1_bereav$q8030b[i] %in% c(1,-999) & SAGE_ghana_w1_bereav$q8031b[i] %in% c(1,-999) &
           SAGE_ghana_w1_bereav$q8032b[i] %in% c(1,-999) ) {
  SAGE_ghana_ds_w1$bereav[i] = 0 }
}

SAGE_ghana_ds_w1$bereav <- car::recode(as.vector(SAGE_ghana_ds_w1$bereav), "NA='999'")
SAGE_ghana_ds_w1$bereav <- labelled(SAGE_ghana_ds_w1$bereav, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1 gh}
vari <- SAGE_ghana_ds_w1$bereav
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_ghana_ds_w1$bereav, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SAGE_ghana_ds_w1, aes(x=factor(bereav))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of a loss of any close person") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1 gh}

```

 
 


## India
### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q1012`
* Label: `q1012: marital status`
* Categories: 
    + `1 = never married`
    + `2 = currently married`
    + `3 = cohabiting`
    + `4 = separated/divorced`
    + `5 = widowed`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8005a`
* Label: `q8005: Is somebody in the household who needed help alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005b`
* Label: `q8005b: Is somebody in the household who needed help alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005c`
* Label: `q8005c: Is somebody in the household who needed help alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005d`
* Label: `q8005d: Is somebody in the household who needed help alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8029b`
* Label: ` q8029b: Is this child alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8030b`
* Label: ` q8030b: Is this child alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8031b`
* Label: ` q8031b: Is this child alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8032b`
* Label: ` q8032b: Is this child alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    



* Description: 
```{r assign1 ind}
opal.assign.table.tibble(o, 'SAGE_india_w1_bereav','SAGE.indiaINDData', 
                        variables=list('q1012','q8005a','q8005b','q8005c','q8005d',
                                       'q8029b','q8030b','q8031b','q8032b'), missings = TRUE)
```


```{r local1 ind}
SAGE_india_w1_bereav <- opal.execute(o,'SAGE_india_w1_bereav')


vari <- SAGE_india_w1_bereav$q1012
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q1012, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q1012))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("marital status") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8005a
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8005a, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8005a))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (1)") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8005b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8005b, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8005b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (2)") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8005c
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8005c, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8005c))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (3)") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8005d
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8005d, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8005d))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (4)") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8029b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8029b, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8029b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (1)?") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8030b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8030b, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8030b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (2)?") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8031b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8031b, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8031b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("(Is this child alive or dead (3)?") + ylab("Frequency")

vari <- SAGE_india_w1_bereav$q8032b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_w1_bereav$q8032b, missing_values = NA)
ggplot(SAGE_india_w1_bereav, aes(x=factor(q8032b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (4)?") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `q1012=5 or q8005a=2 or q8005b=2 or q8005c=2 or q8005d=2 or q8029b=2 or q8030b=2 or q8031b=2 or q8032b=2 INTO 1`
* `q1012 in (1,2,3,4) and q8005a=1 and q8005b=1 and q8005c=1 and q8005d=1 and q8029b=1 and q8030b=1 and   `
`  q8031b=1 and q8032b=1 INTO 0`
* `q1012=8 or q8005a=8 or q8005b=8 or q8005c=8 or q8005d=8 or q8029b=8 or q8030b=8 or q8031b=8 or q8032b=8 INTO 998`
* `q1012=9 or q8005a=9 or q8005b=9 or q8005c=9 or q8005d=9 or q8029b=9 or q8030b=9 or q8031b=9 or q8032b=9 INTO 996`
* `NA into 999`

**R script:**

```{r harmo1 ind, echo=TRUE}
SAGE_india_ds_w1 <- tibble(id=SAGE_india_w1_bereav$id)

SAGE_india_w1_bereav$q1012 <- car::recode(as.vector(SAGE_india_w1_bereav$q1012), "NA='-999'")
SAGE_india_w1_bereav$q8005a <- car::recode(as.vector(SAGE_india_w1_bereav$q8005a), "NA='-999'")
SAGE_india_w1_bereav$q8005b <- car::recode(as.vector(SAGE_india_w1_bereav$q8005b), "NA='-999'")
SAGE_india_w1_bereav$q8005c <- car::recode(as.vector(SAGE_india_w1_bereav$q8005c), "NA='-999'")
SAGE_india_w1_bereav$q8005d <- car::recode(as.vector(SAGE_india_w1_bereav$q8005d), "NA='-999'")
SAGE_india_w1_bereav$q8029b <- car::recode(as.vector(SAGE_india_w1_bereav$q8029b), "NA='-999'")
SAGE_india_w1_bereav$q8030b <- car::recode(as.vector(SAGE_india_w1_bereav$q8030b), "NA='-999'")
SAGE_india_w1_bereav$q8031b <- car::recode(as.vector(SAGE_india_w1_bereav$q8031b), "NA='-999'")
SAGE_india_w1_bereav$q8032b <- car::recode(as.vector(SAGE_india_w1_bereav$q8032b), "NA='-999'")


SAGE_india_ds_w1$bereav <- c(NA)   
for(i in 1:dim(SAGE_india_w1_bereav)[1]){
  if( SAGE_india_w1_bereav$q1012[i] == 5 | SAGE_india_w1_bereav$q8005a[i] == 2 | SAGE_india_w1_bereav$q8005b[i] == 2
       | SAGE_india_w1_bereav$q8005c[i] == 2 | SAGE_india_w1_bereav$q8005d[i] == 2 | SAGE_india_w1_bereav$q8029b[i] == 2
       | SAGE_india_w1_bereav$q8030b[i] == 2 | SAGE_india_w1_bereav$q8031b[i] == 2 | SAGE_india_w1_bereav$q8032b[i] == 2 ) {
  SAGE_india_ds_w1$bereav[i] = 1 }
  
  else if( SAGE_india_w1_bereav$q1012[i] == -999 & SAGE_india_w1_bereav$q8005a[i] == -999 &
           SAGE_india_w1_bereav$q8005b[i] == -999 & SAGE_india_w1_bereav$q8005c[i] == -999 & SAGE_india_w1_bereav$q8005d[i] == -999 &
           SAGE_india_w1_bereav$q8029b[i] == -999 & SAGE_india_w1_bereav$q8030b[i] == -999 & SAGE_india_w1_bereav$q8031b[i] == -999 &
           SAGE_india_w1_bereav$q8032b[i] == -999 ) {
  SAGE_india_ds_w1$bereav[i] = 999 }
  
  else if( SAGE_india_w1_bereav$q1012[i] == 8 & SAGE_india_w1_bereav$q8005a[i] == 8 &
           SAGE_india_w1_bereav$q8005b[i] == 8 & SAGE_india_w1_bereav$q8005c[i] == 8 & SAGE_india_w1_bereav$q8005d[i] == 8 &
           SAGE_india_w1_bereav$q8029b[i] == 8 & SAGE_india_w1_bereav$q8030b[i] == 8 & SAGE_india_w1_bereav$q8031b[i] == 8 &
           SAGE_india_w1_bereav$q8032b[i] == 8 ) {
  SAGE_india_ds_w1$bereav[i] = 998 }
  
  else if( SAGE_india_w1_bereav$q1012[i] == 9 & SAGE_india_w1_bereav$q8005a[i] == 9 &
           SAGE_india_w1_bereav$q8005b[i] == 9 & SAGE_india_w1_bereav$q8005c[i] == 9 & SAGE_india_w1_bereav$q8005d[i] == 9 &
           SAGE_india_w1_bereav$q8029b[i] == 9 & SAGE_india_w1_bereav$q8030b[i] == 9 & SAGE_india_w1_bereav$q8031b[i] == 9 &
           SAGE_india_w1_bereav$q8032b[i] == 9 ) {
  SAGE_india_ds_w1$bereav[i] = 996 }
  
  else if( SAGE_india_w1_bereav$q1012[i] %in% c(-999,1,2,3,4) & SAGE_india_w1_bereav$q8005a[i] %in% c(1,-999) &
           SAGE_india_w1_bereav$q8005b[i] %in% c(1,-999) & SAGE_india_w1_bereav$q8005c[i] %in% c(1,-999) & SAGE_india_w1_bereav$q8005d[i] %in% c(1,-999) &
           SAGE_india_w1_bereav$q8029b[i] %in% c(1,-999) & SAGE_india_w1_bereav$q8030b[i] %in% c(1,-999) & SAGE_india_w1_bereav$q8031b[i] %in% c(1,-999) &
           SAGE_india_w1_bereav$q8032b[i] %in% c(1,-999) ) {
  SAGE_india_ds_w1$bereav[i] = 0 }
}

SAGE_india_ds_w1$bereav <- car::recode(as.vector(SAGE_india_ds_w1$bereav), "NA='999'")
SAGE_india_ds_w1$bereav <- labelled(SAGE_india_ds_w1$bereav, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1 ind}
vari <- SAGE_india_ds_w1$bereav
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_india_ds_w1$bereav, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SAGE_india_ds_w1, aes(x=factor(bereav))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of a loss of any close person") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1 ind}

```

 
 


## Mexico
### SAGE Mexico - Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q1012`
* Label: `q1012: marital status`
* Categories: 
    + `1 = never married`
    + `2 = currently married`
    + `3 = cohabiting`
    + `4 = separated/divorced`
    + `5 = widowed`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8005a`
* Label: `q8005: Is somebody in the household who needed help alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005b`
* Label: `q8005b: Is somebody in the household who needed help alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005c`
* Label: `q8005c: Is somebody in the household who needed help alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005d`
* Label: `q8005d: Is somebody in the household who needed help alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8029b`
* Label: ` q8029b: Is this child alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8030b`
* Label: ` q8030b: Is this child alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8031b`
* Label: ` q8031b: Is this child alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8032b`
* Label: ` q8032b: Is this child alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`


* Description: 
```{r assign1 mex}
opal.assign.table.tibble(o, 'SAGE_mexico_w1_bereav','SAGE.mexicoINDdata', 
                        variables=list('q1012','q8005a','q8005b','q8005c','q8005d',
                                       'q8029b','q8030b','q8031b','q8032b'), missings = TRUE)
```


```{r local1 mex}
SAGE_mexico_w1_bereav <- opal.execute(o,'SAGE_mexico_w1_bereav')


vari <- SAGE_mexico_w1_bereav$q1012
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q1012, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q1012))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("marital status") + ylab("Frequency")


vari <- SAGE_mexico_w1_bereav$q8005a
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8005a, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8005a))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (1)") + ylab("Frequency")

vari <- SAGE_mexico_w1_bereav$q8005b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8005b, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8005b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (2)") + ylab("Frequency")

vari <- SAGE_mexico_w1_bereav$q8005c
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8005c, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8005c))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (3)") + ylab("Frequency")

vari <- SAGE_mexico_w1_bereav$q8005d
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8005d, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8005d))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (4)") + ylab("Frequency")

vari <- SAGE_mexico_w1_bereav$q8029b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8029b, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8029b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (1)?") + ylab("Frequency")

vari <- SAGE_mexico_w1_bereav$q8030b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8030b, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8030b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (2)?") + ylab("Frequency")

vari <- SAGE_mexico_w1_bereav$q8031b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8031b, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8031b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("(Is this child alive or dead (3)?") + ylab("Frequency")

vari <- SAGE_mexico_w1_bereav$q8032b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_w1_bereav$q8032b, missing_values = NA)
ggplot(SAGE_mexico_w1_bereav, aes(x=factor(q8032b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (4)?") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `q1012=5 or q8005a=2 or q8005b=2 or q8005c=2 or q8005d=2 or q8029b=2 or q8030b=2 or q8031b=2 or q8032b=2 INTO 1`
* `q1012 in (1,2,3,4) and q8005a=1 and q8005b=1 and q8005c=1 and q8005d=1 and q8029b=1 and q8030b=1 and   `
`  q8031b=1 and q8032b=1 INTO 0`
* `q1012=8 or q8005a=8 or q8005b=8 or q8005c=8 or q8005d=8 or q8029b=8 or q8030b=8 or q8031b=8 or q8032b=8 INTO 998`
* `q1012=9 or q8005a=9 or q8005b=9 or q8005c=9 or q8005d=9 or q8029b=9 or q8030b=9 or q8031b=9 or q8032b=9 INTO 996`
* `NA into 999`

**R script:**

```{r harmo1 mex, echo=TRUE}
SAGE_mexico_ds_w1 <- tibble(id=SAGE_mexico_w1_bereav$id)

SAGE_mexico_w1_bereav$q1012 <- car::recode(as.vector(SAGE_mexico_w1_bereav$q1012), "NA='-999'")
SAGE_mexico_w1_bereav$q8005a <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8005a), "NA='-999'")
SAGE_mexico_w1_bereav$q8005b <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8005b), "NA='-999'")
SAGE_mexico_w1_bereav$q8005c <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8005c), "NA='-999'")
SAGE_mexico_w1_bereav$q8005d <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8005d), "NA='-999'")
SAGE_mexico_w1_bereav$q8029b <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8029b), "NA='-999'")
SAGE_mexico_w1_bereav$q8030b <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8030b), "NA='-999'")
SAGE_mexico_w1_bereav$q8031b <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8031b), "NA='-999'")
SAGE_mexico_w1_bereav$q8032b <- car::recode(as.vector(SAGE_mexico_w1_bereav$q8032b), "NA='-999'")


SAGE_mexico_ds_w1$bereav <- c(NA)   
for(i in 1:dim(SAGE_mexico_w1_bereav)[1]){
  if( SAGE_mexico_w1_bereav$q1012[i] == 5 | SAGE_mexico_w1_bereav$q8005a[i] == 2 | SAGE_mexico_w1_bereav$q8005b[i] == 2
       | SAGE_mexico_w1_bereav$q8005c[i] == 2 | SAGE_mexico_w1_bereav$q8005d[i] == 2 | SAGE_mexico_w1_bereav$q8029b[i] == 2
       | SAGE_mexico_w1_bereav$q8030b[i] == 2 | SAGE_mexico_w1_bereav$q8031b[i] == 2 | SAGE_mexico_w1_bereav$q8032b[i] == 2 ) {
  SAGE_mexico_ds_w1$bereav[i] = 1 }
  
  else if( SAGE_mexico_w1_bereav$q1012[i] == -999 & SAGE_mexico_w1_bereav$q8005a[i] == -999 &
           SAGE_mexico_w1_bereav$q8005b[i] == -999 & SAGE_mexico_w1_bereav$q8005c[i] == -999 & SAGE_mexico_w1_bereav$q8005d[i] == -999 &
           SAGE_mexico_w1_bereav$q8029b[i] == -999 & SAGE_mexico_w1_bereav$q8030b[i] == -999 & SAGE_mexico_w1_bereav$q8031b[i] == -999 &
           SAGE_mexico_w1_bereav$q8032b[i] == -999 ) {
  SAGE_mexico_ds_w1$bereav[i] = 999 }
  
  else if( SAGE_mexico_w1_bereav$q1012[i] == 8 & SAGE_mexico_w1_bereav$q8005a[i] == 8 &
           SAGE_mexico_w1_bereav$q8005b[i] == 8 & SAGE_mexico_w1_bereav$q8005c[i] == 8 & SAGE_mexico_w1_bereav$q8005d[i] == 8 &
           SAGE_mexico_w1_bereav$q8029b[i] == 8 & SAGE_mexico_w1_bereav$q8030b[i] == 8 & SAGE_mexico_w1_bereav$q8031b[i] == 8 &
           SAGE_mexico_w1_bereav$q8032b[i] == 8 ) {
  SAGE_mexico_ds_w1$bereav[i] = 998 }
  
  else if( SAGE_mexico_w1_bereav$q1012[i] == 9 & SAGE_mexico_w1_bereav$q8005a[i] == 9 &
           SAGE_mexico_w1_bereav$q8005b[i] == 9 & SAGE_mexico_w1_bereav$q8005c[i] == 9 & SAGE_mexico_w1_bereav$q8005d[i] == 9 &
           SAGE_mexico_w1_bereav$q8029b[i] == 9 & SAGE_mexico_w1_bereav$q8030b[i] == 9 & SAGE_mexico_w1_bereav$q8031b[i] == 9 &
           SAGE_mexico_w1_bereav$q8032b[i] == 9 ) {
  SAGE_mexico_ds_w1$bereav[i] = 996 }
  
  else if( SAGE_mexico_w1_bereav$q1012[i] %in% c(-999,1,2,3,4) & SAGE_mexico_w1_bereav$q8005a[i] %in% c(1,-999) &
           SAGE_mexico_w1_bereav$q8005b[i] %in% c(1,-999) & SAGE_mexico_w1_bereav$q8005c[i] %in% c(1,-999) & SAGE_mexico_w1_bereav$q8005d[i] %in% c(1,-999) &
           SAGE_mexico_w1_bereav$q8029b[i] %in% c(1,-999) & SAGE_mexico_w1_bereav$q8030b[i] %in% c(1,-999) & SAGE_mexico_w1_bereav$q8031b[i] %in% c(1,-999) &
           SAGE_mexico_w1_bereav$q8032b[i] %in% c(1,-999) ) {
  SAGE_mexico_ds_w1$bereav[i] = 0 }
}

SAGE_mexico_ds_w1$bereav <- car::recode(as.vector(SAGE_mexico_ds_w1$bereav), "NA='999'")
SAGE_mexico_ds_w1$bereav <- labelled(SAGE_mexico_ds_w1$bereav, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1 mex}
vari <- SAGE_mexico_ds_w1$bereav
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_mexico_ds_w1$bereav, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SAGE_mexico_ds_w1, aes(x=factor(bereav))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of a loss of any close person") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1 mex}

```

 
 


## Russia
### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q1012`
* Label: `q1012: marital status`
* Categories: 
    + `1 = never married`
    + `2 = currently married`
    + `3 = cohabiting`
    + `4 = separated/divorced`
    + `5 = widowed`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8005a`
* Label: `q8005: Is somebody in the household who needed help alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005b`
* Label: `q8005b: Is somebody in the household who needed help alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005c`
* Label: `q8005c: Is somebody in the household who needed help alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005d`
* Label: `q8005d: Is somebody in the household who needed help alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8029b`
* Label: ` q8029b: Is this child alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8030b`
* Label: ` q8030b: Is this child alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8031b`
* Label: ` q8031b: Is this child alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8032b`
* Label: ` q8032b: Is this child alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`


* Description: 
```{r assign1 russ}
opal.assign.table.tibble(o, 'SAGE_russia_w1_bereav','SAGE.russiaINDdata', 
                        variables=list('q1012','q8005a','q8005b','q8005c','q8005d',
                                       'q8029b','q8030b','q8031b','q8032b'), missings = TRUE)
```


```{r local1 russ}
SAGE_russia_w1_bereav <- opal.execute(o,'SAGE_russia_w1_bereav')


vari <- SAGE_russia_w1_bereav$q1012
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q1012, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q1012))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("marital status") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8005a
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8005a, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8005a))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (1)") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8005b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8005b, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8005b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (2)") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8005c
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8005c, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8005c))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (3)") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8005d
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8005d, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8005d))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (4)") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8029b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8029b, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8029b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (1)?") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8030b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8030b, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8030b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (2)?") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8031b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8031b, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8031b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("(Is this child alive or dead (3)?") + ylab("Frequency")

vari <- SAGE_russia_w1_bereav$q8032b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_w1_bereav$q8032b, missing_values = NA)
ggplot(SAGE_russia_w1_bereav, aes(x=factor(q8032b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (4)?") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `q1012=5 or q8005a=2 or q8005b=2 or q8005c=2 or q8005d=2 or q8029b=2 or q8030b=2 or q8031b=2 or q8032b=2 INTO 1`
* `q1012 in (1,2,3,4) and q8005a=1 and q8005b=1 and q8005c=1 and q8005d=1 and q8029b=1 and q8030b=1 and   `
`  q8031b=1 and q8032b=1 INTO 0`
* `q1012=8 or q8005a=8 or q8005b=8 or q8005c=8 or q8005d=8 or q8029b=8 or q8030b=8 or q8031b=8 or q8032b=8 INTO 998`
* `q1012=9 or q8005a=9 or q8005b=9 or q8005c=9 or q8005d=9 or q8029b=9 or q8030b=9 or q8031b=9 or q8032b=9 INTO 996`
* `NA into 999`

**R script:**

```{r harmo1 russ, echo=TRUE}
SAGE_russia_ds_w1 <- tibble(id=SAGE_russia_w1_bereav$id)

SAGE_russia_w1_bereav$q1012 <- car::recode(as.vector(SAGE_russia_w1_bereav$q1012), "NA='-999'")
SAGE_russia_w1_bereav$q8005a <- car::recode(as.vector(SAGE_russia_w1_bereav$q8005a), "NA='-999'")
SAGE_russia_w1_bereav$q8005b <- car::recode(as.vector(SAGE_russia_w1_bereav$q8005b), "NA='-999'")
SAGE_russia_w1_bereav$q8005c <- car::recode(as.vector(SAGE_russia_w1_bereav$q8005c), "NA='-999'")
SAGE_russia_w1_bereav$q8005d <- car::recode(as.vector(SAGE_russia_w1_bereav$q8005d), "NA='-999'")
SAGE_russia_w1_bereav$q8029b <- car::recode(as.vector(SAGE_russia_w1_bereav$q8029b), "NA='-999'")
SAGE_russia_w1_bereav$q8030b <- car::recode(as.vector(SAGE_russia_w1_bereav$q8030b), "NA='-999'")
SAGE_russia_w1_bereav$q8031b <- car::recode(as.vector(SAGE_russia_w1_bereav$q8031b), "NA='-999'")
SAGE_russia_w1_bereav$q8032b <- car::recode(as.vector(SAGE_russia_w1_bereav$q8032b), "NA='-999'")


SAGE_russia_ds_w1$bereav <- c(NA)   
for(i in 1:dim(SAGE_russia_w1_bereav)[1]){
  if( SAGE_russia_w1_bereav$q1012[i] == 5 | SAGE_russia_w1_bereav$q8005a[i] == 2 | SAGE_russia_w1_bereav$q8005b[i] == 2
       | SAGE_russia_w1_bereav$q8005c[i] == 2 | SAGE_russia_w1_bereav$q8005d[i] == 2 | SAGE_russia_w1_bereav$q8029b[i] == 2
       | SAGE_russia_w1_bereav$q8030b[i] == 2 | SAGE_russia_w1_bereav$q8031b[i] == 2 | SAGE_russia_w1_bereav$q8032b[i] == 2 ) {
  SAGE_russia_ds_w1$bereav[i] = 1 }
  
  else if( SAGE_russia_w1_bereav$q1012[i] == -999 & SAGE_russia_w1_bereav$q8005a[i] == -999 &
           SAGE_russia_w1_bereav$q8005b[i] == -999 & SAGE_russia_w1_bereav$q8005c[i] == -999 & SAGE_russia_w1_bereav$q8005d[i] == -999 &
           SAGE_russia_w1_bereav$q8029b[i] == -999 & SAGE_russia_w1_bereav$q8030b[i] == -999 & SAGE_russia_w1_bereav$q8031b[i] == -999 &
           SAGE_russia_w1_bereav$q8032b[i] == -999 ) {
  SAGE_russia_ds_w1$bereav[i] = 999 }
  
  else if( SAGE_russia_w1_bereav$q1012[i] == 8 & SAGE_russia_w1_bereav$q8005a[i] == 8 &
           SAGE_russia_w1_bereav$q8005b[i] == 8 & SAGE_russia_w1_bereav$q8005c[i] == 8 & SAGE_russia_w1_bereav$q8005d[i] == 8 &
           SAGE_russia_w1_bereav$q8029b[i] == 8 & SAGE_russia_w1_bereav$q8030b[i] == 8 & SAGE_russia_w1_bereav$q8031b[i] == 8 &
           SAGE_russia_w1_bereav$q8032b[i] == 8 ) {
  SAGE_russia_ds_w1$bereav[i] = 998 }
  
  else if( SAGE_russia_w1_bereav$q1012[i] == 9 & SAGE_russia_w1_bereav$q8005a[i] == 9 &
           SAGE_russia_w1_bereav$q8005b[i] == 9 & SAGE_russia_w1_bereav$q8005c[i] == 9 & SAGE_russia_w1_bereav$q8005d[i] == 9 &
           SAGE_russia_w1_bereav$q8029b[i] == 9 & SAGE_russia_w1_bereav$q8030b[i] == 9 & SAGE_russia_w1_bereav$q8031b[i] == 9 &
           SAGE_russia_w1_bereav$q8032b[i] == 9 ) {
  SAGE_russia_ds_w1$bereav[i] = 996 }
  
  else if( SAGE_russia_w1_bereav$q1012[i] %in% c(-999,1,2,3,4) & SAGE_russia_w1_bereav$q8005a[i] %in% c(1,-999) &
           SAGE_russia_w1_bereav$q8005b[i] %in% c(1,-999) & SAGE_russia_w1_bereav$q8005c[i] %in% c(1,-999) & SAGE_russia_w1_bereav$q8005d[i] %in% c(1,-999) &
           SAGE_russia_w1_bereav$q8029b[i] %in% c(1,-999) & SAGE_russia_w1_bereav$q8030b[i] %in% c(1,-999) & SAGE_russia_w1_bereav$q8031b[i] %in% c(1,-999) &
           SAGE_russia_w1_bereav$q8032b[i] %in% c(1,-999) ) {
  SAGE_russia_ds_w1$bereav[i] = 0 }
}

SAGE_russia_ds_w1$bereav <- car::recode(as.vector(SAGE_russia_ds_w1$bereav), "NA='999'")
SAGE_russia_ds_w1$bereav <- labelled(SAGE_russia_ds_w1$bereav, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1 russ}
vari <- SAGE_russia_ds_w1$bereav
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_russia_ds_w1$bereav, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SAGE_russia_ds_w1, aes(x=factor(bereav))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of a loss of any close person") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1 russ}

```

 
 


## South Africa
### Wave 1 

#### Study-specific variables

The study-specific variable elected to be harmonised is:

* Name: `q1012`
* Label: `q1012: marital status`
* Categories: 
    + `1 = never married`
    + `2 = currently married`
    + `3 = cohabiting`
    + `4 = separated/divorced`
    + `5 = widowed`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8005a`
* Label: `q8005: Is somebody in the household who needed help alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005b`
* Label: `q8005b: Is somebody in the household who needed help alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005c`
* Label: `q8005c: Is somebody in the household who needed help alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
* Name: `q8005d`
* Label: `q8005d: Is somebody in the household who needed help alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
    
    
* Name: `q8029b`
* Label: ` q8029b: Is this child alive or dead (1)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8030b`
* Label: ` q8030b: Is this child alive or dead (2)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8031b`
* Label: ` q8031b: Is this child alive or dead (3)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`
        
* Name: `q8032b`
* Label: ` q8032b: Is this child alive or dead (4)?`
* Categories: 
    + `1 = alive`
    + `2 = dead`
* Missings:
    + `8 = don't know`
    + `9 = not applicable`


* Description: 
```{r assign1 sa}
opal.assign.table.tibble(o, 'SAGE_SA_w1_bereav','SAGE.southAfricaINDdata', 
                        variables=list('q1012','q8005a','q8005b','q8005c','q8005d',
                                       'q8029b','q8030b','q8031b','q8032b'), missings = TRUE)
```

```{r local1 sa}
SAGE_SA_w1_bereav <- opal.execute(o,'SAGE_SA_w1_bereav')


vari <- SAGE_SA_w1_bereav$q1012
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q1012, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q1012))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("marital status") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8005a
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8005a, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8005a))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (1)") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8005b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8005b, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8005b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (2)") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8005c
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8005c, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8005c))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (3)") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8005d
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8005d, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8005d))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is somebody in the household who needed help alive or dead (4)") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8029b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8029b, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8029b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (1)?") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8030b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8030b, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8030b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (2)?") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8031b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8031b, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8031b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("(Is this child alive or dead (3)?") + ylab("Frequency")

vari <- SAGE_SA_w1_bereav$q8032b
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = attributes(vari)$`spss::shortName`) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_w1_bereav$q8032b, missing_values = NA)
ggplot(SAGE_SA_w1_bereav, aes(x=factor(q8032b))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Is this child alive or dead (4)?") + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `q1012=5 or q8005a=2 or q8005b=2 or q8005c=2 or q8005d=2 or q8029b=2 or q8030b=2 or q8031b=2 or q8032b=2 INTO 1`
* `q1012 in (1,2,3,4) and q8005a=1 and q8005b=1 and q8005c=1 and q8005d=1 and q8029b=1 and q8030b=1 and   `
`  q8031b=1 and q8032b=1 INTO 0`
* `q1012=8 or q8005a=8 or q8005b=8 or q8005c=8 or q8005d=8 or q8029b=8 or q8030b=8 or q8031b=8 or q8032b=8 INTO 998`
* `q1012=9 or q8005a=9 or q8005b=9 or q8005c=9 or q8005d=9 or q8029b=9 or q8030b=9 or q8031b=9 or q8032b=9 INTO 996`
* `NA into 999`

**R script:**

```{r harmo1 sa, echo=TRUE}
SAGE_SA_ds_w1 <- tibble(id=SAGE_SA_w1_bereav$id)

SAGE_SA_w1_bereav$q1012 <- car::recode(as.vector(SAGE_SA_w1_bereav$q1012), "NA='-999'")
SAGE_SA_w1_bereav$q8005a <- car::recode(as.vector(SAGE_SA_w1_bereav$q8005a), "NA='-999'")
SAGE_SA_w1_bereav$q8005b <- car::recode(as.vector(SAGE_SA_w1_bereav$q8005b), "NA='-999'")
SAGE_SA_w1_bereav$q8005c <- car::recode(as.vector(SAGE_SA_w1_bereav$q8005c), "NA='-999'")
SAGE_SA_w1_bereav$q8005d <- car::recode(as.vector(SAGE_SA_w1_bereav$q8005d), "NA='-999'")
SAGE_SA_w1_bereav$q8029b <- car::recode(as.vector(SAGE_SA_w1_bereav$q8029b), "NA='-999'")
SAGE_SA_w1_bereav$q8030b <- car::recode(as.vector(SAGE_SA_w1_bereav$q8030b), "NA='-999'")
SAGE_SA_w1_bereav$q8031b <- car::recode(as.vector(SAGE_SA_w1_bereav$q8031b), "NA='-999'")
SAGE_SA_w1_bereav$q8032b <- car::recode(as.vector(SAGE_SA_w1_bereav$q8032b), "NA='-999'")


SAGE_SA_ds_w1$bereav <- c(NA)   
for(i in 1:dim(SAGE_SA_w1_bereav)[1]){
  if( SAGE_SA_w1_bereav$q1012[i] == 5 | SAGE_SA_w1_bereav$q8005a[i] == 2 | SAGE_SA_w1_bereav$q8005b[i] == 2
       | SAGE_SA_w1_bereav$q8005c[i] == 2 | SAGE_SA_w1_bereav$q8005d[i] == 2 | SAGE_SA_w1_bereav$q8029b[i] == 2
       | SAGE_SA_w1_bereav$q8030b[i] == 2 | SAGE_SA_w1_bereav$q8031b[i] == 2 | SAGE_SA_w1_bereav$q8032b[i] == 2 ) {
  SAGE_SA_ds_w1$bereav[i] = 1 }
  
  else if( SAGE_SA_w1_bereav$q1012[i] == -999 & SAGE_SA_w1_bereav$q8005a[i] == -999 &
           SAGE_SA_w1_bereav$q8005b[i] == -999 & SAGE_SA_w1_bereav$q8005c[i] == -999 & SAGE_SA_w1_bereav$q8005d[i] == -999 &
           SAGE_SA_w1_bereav$q8029b[i] == -999 & SAGE_SA_w1_bereav$q8030b[i] == -999 & SAGE_SA_w1_bereav$q8031b[i] == -999 &
           SAGE_SA_w1_bereav$q8032b[i] == -999 ) {
  SAGE_SA_ds_w1$bereav[i] = 999 }
  
  else if( SAGE_SA_w1_bereav$q1012[i] == 8 & SAGE_SA_w1_bereav$q8005a[i] == 8 &
           SAGE_SA_w1_bereav$q8005b[i] == 8 & SAGE_SA_w1_bereav$q8005c[i] == 8 & SAGE_SA_w1_bereav$q8005d[i] == 8 &
           SAGE_SA_w1_bereav$q8029b[i] == 8 & SAGE_SA_w1_bereav$q8030b[i] == 8 & SAGE_SA_w1_bereav$q8031b[i] == 8 &
           SAGE_SA_w1_bereav$q8032b[i] == 8 ) {
  SAGE_SA_ds_w1$bereav[i] = 998 }
  
  else if( SAGE_SA_w1_bereav$q1012[i] == 9 & SAGE_SA_w1_bereav$q8005a[i] == 9 &
           SAGE_SA_w1_bereav$q8005b[i] == 9 & SAGE_SA_w1_bereav$q8005c[i] == 9 & SAGE_SA_w1_bereav$q8005d[i] == 9 &
           SAGE_SA_w1_bereav$q8029b[i] == 9 & SAGE_SA_w1_bereav$q8030b[i] == 9 & SAGE_SA_w1_bereav$q8031b[i] == 9 &
           SAGE_SA_w1_bereav$q8032b[i] == 9 ) {
  SAGE_SA_ds_w1$bereav[i] = 996 }
  
  else if( SAGE_SA_w1_bereav$q1012[i] %in% c(-999,1,2,3,4) & SAGE_SA_w1_bereav$q8005a[i] %in% c(1,-999) &
           SAGE_SA_w1_bereav$q8005b[i] %in% c(1,-999) & SAGE_SA_w1_bereav$q8005c[i] %in% c(1,-999) & SAGE_SA_w1_bereav$q8005d[i] %in% c(1,-999) &
           SAGE_SA_w1_bereav$q8029b[i] %in% c(1,-999) & SAGE_SA_w1_bereav$q8030b[i] %in% c(1,-999) & SAGE_SA_w1_bereav$q8031b[i] %in% c(1,-999) &
           SAGE_SA_w1_bereav$q8032b[i] %in% c(1,-999) ) {
  SAGE_SA_ds_w1$bereav[i] = 0 }
}

SAGE_SA_ds_w1$bereav <- car::recode(as.vector(SAGE_SA_ds_w1$bereav), "NA='999'")
SAGE_SA_ds_w1$bereav <- labelled(SAGE_SA_ds_w1$bereav, labels = c("No"=0, "Yes"=1, "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Don't answer"=995,  "Not attempt/not done/not yet recorded"=994, "Disable to measure"=993, "Impute"=992, "CAPI/interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1 sa}
vari <- SAGE_SA_ds_w1$bereav
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3]) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
#Categorical_summary(var = SAGE_SA_ds_w1$bereav, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))
ggplot(SAGE_SA_ds_w1, aes(x=factor(bereav))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab("Experience of a loss of any close person") + ylab("Frequency")
```

#### Validation
```{r crosstabulation1 sa}

```

 
 


```{r save, echo=FALSE}
bereav <- SAGE_SA_ds_w1
save(bereav, file = "../RData/SA_w1/bereav.RData")
rm(bereav)

bereav <- SAGE_china_ds_w1
save(bereav, file = "../RData/china_w1/bereav.RData")
rm(bereav)

bereav <- SAGE_ghana_ds_w1
save(bereav, file = "../RData/ghana_w1/bereav.RData")
rm(bereav)

bereav <- SAGE_india_ds_w1
save(bereav, file = "../RData/india_w1/bereav.RData")
rm(bereav)

bereav <- SAGE_mexico_ds_w1
save(bereav, file = "../RData/mexico_w1/bereav.RData")
rm(bereav)

bereav <- SAGE_russia_ds_w1
save(bereav, file = "../RData/russia_w1/bereav.RData")
rm(bereav)



```

# Quality estimation
```{r closeRsession, echo=FALSE} 
opal.logout(o)
```
