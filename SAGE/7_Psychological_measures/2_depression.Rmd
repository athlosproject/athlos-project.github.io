---
title: "Current depressive status"
output: 
  html_document:
    theme: united
    highlight: tango
    toc: true
    toc_depth: 6
    toc_float:
      collapsed: true
      smooth_scroll: true
    number_sections: true
---

<!-- ########################################################## --> 

<!-- # Installation, loading packages -->
<!-- **R script:** -->



```{r setup, include=FALSE, echo=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_albert.r")
```

<!-- ########################################################## --> 

# Description of DataSchema variable

The description of harmonised variable is the following:

* Short name: `depression`
* Variable label: `Current depressive status of the participant`
* Variable description: `Current depressive status of the participant`
* Domain: `Psycological measures`
* Value type: `categorical`
* Category coding:

**Code** | **Category Label**
-------- | ------------------
0        | no depression
1        | depression

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing


```{r lab, echo=FALSE}
ds_label <- "Current depressive status"
ds_label_all <- "Current depressive status of the participant"
```


<!-- ########################################################## --> 

# Data process

## South Africa

### Wave 1 

#### Study-specific variable description

| **Name** | `q4042`| `q4043` | `q4045` | `q4046` | `q4047` | `q4049` | `q4050` | `q4052` | `q4054` | `q4044` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `q4042: several days`| `q4043: loss of interest` | `q4045: more than 2 weeks?` | `q4046: daily?` | `q4047: loss of appetite` | `q4049: falling asleep` | `q4050: waking up` | `q4052: moving slowly` | `q4054: restlessness, jitters` | `q4044: lack of energy` | 
| **Table name** | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` |
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | 
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | 
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | 

| **Name** | `q4055`| `q4056` | `q4048` | `q4051` | `q4058` | `q4059` |
|-|-|-|-|-|-|-|
| **Label** | `q4055: low self-esteem`| `q4056: hopelessness` | `q4048: slow thinking` | `q4051: difficulty concentrating` | `q4058: morbid thoughts` | `q4059: suicide attempts` | 
| **Table name** | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | 
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` |
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` |  
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` |  


```{r assign1,  echo=FALSE}
opal.assign.table.tibble(o, 'SAGE_dep','SAGE.southAfricaINDdata',
                         variables=list('q4042', 'q4043', 'q4045', 'q4046', 'q4047', 'q4049', 'q4050', 'q4052', 'q4054', 'q4044', 'q4055', 'q4056', 'q4048', 'q4051', 'q4058', 'q4059'), missings = TRUE)
SAGE_dep <- opal.execute(o,'SAGE_dep')
```

```{r local1,  echo=FALSE}
vari <- SAGE_dep$q4042
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4043
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4044
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4045
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4046
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4047
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4048
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4049
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4050
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4051
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4052
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4054
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4055
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4056
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4058
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4059
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* First of all, recode the variables in symptoms as follows:
    + `s1 = 1 if q4042=1; s1 = 0 if q4042=2`
    + `s2 = 1 if q4043=1; s2 = 0 if q4043=2`
    + `s3 = 1 if q4047=1; s3 = 0 if q4047=2`
    + `s4 = 1 if q4049=1 or q4050=1; s4 = 0 if q4049=0 and q4050=0`
    + `s5 = 1 if q4052=1 or q4054=1; s5 = 0 if q4052=0 and q4054=0`
    + `s6 = 1 if q4044=1; s1 = 0 if q4044=2`
    + `s7 = 1 if q4055=1 or q4056=1; s7 = 0 if q4055=0 and q4056=0`
    + `s8 = 1 if q4048=1 or q4051=1; s8 = 0 if q4048=0 and q4051=0`
    + `s9 = 1 if q4058=1 or q4059=1; s9 = 0 if q4058=0 and q4059=0`

* the harmonized variable will be 0 for the individuals that: 
    + `s1, s2 and s6 = 0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=0`
  
* the individuals that has ((s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=1) the final score is computed suming all the symptoms and the final score is recoded as follows: 
    + `final_score < 5 into 0`
    + `final_score >=5 into 1`

* the individuals that are not in any condition are recoded as follows: 
    + `NA into 999`

**R script:**

```{r harmo1,   echo=TRUE}
SAGE_dep$q42 <- car::recode(SAGE_dep$q4042, "2=0; 8=NA; 9=NA")
SAGE_dep$q43 <- car::recode(SAGE_dep$q4043, "2=0; 8=NA; 9=NA")
SAGE_dep$q45 <- car::recode(SAGE_dep$q4045, "2=0; 8=NA; 9=NA")
SAGE_dep$q46 <- car::recode(SAGE_dep$q4046, "2=0; 8=NA; 9=NA")
SAGE_dep$q47 <- car::recode(SAGE_dep$q4047, "2=0; 8=NA; 9=NA")
SAGE_dep$q49 <- car::recode(SAGE_dep$q4049, "2=0; 8=NA; 9=NA")
SAGE_dep$q50 <- car::recode(SAGE_dep$q4050, "2=0; 8=NA; 9=NA")
SAGE_dep$q52 <- car::recode(SAGE_dep$q4052, "2=0; 8=NA; 9=NA")
SAGE_dep$q54 <- car::recode(SAGE_dep$q4054, "2=0; 8=NA; 9=NA")
SAGE_dep$q44 <- car::recode(SAGE_dep$q4044, "2=0; 8=NA; 9=NA")
SAGE_dep$q55 <- car::recode(SAGE_dep$q4055, "2=0; 8=NA; 9=NA")
SAGE_dep$q56 <- car::recode(SAGE_dep$q4056, "2=0; 8=NA; 9=NA")
SAGE_dep$q48 <- car::recode(SAGE_dep$q4048, "2=0; 8=NA; 9=NA")
SAGE_dep$q51 <- car::recode(SAGE_dep$q4051, "2=0; 8=NA; 9=NA")
SAGE_dep$q58 <- car::recode(SAGE_dep$q4058, "2=0; 8=NA; 9=NA")
SAGE_dep$q59 <- car::recode(SAGE_dep$q4059, "2=0; 8=NA; 9=NA")


SAGE_dep$s1 <- SAGE_dep$q42
SAGE_dep$s2 <- SAGE_dep$q43
SAGE_dep$s6 <- SAGE_dep$q44

SAGE_dep$s3 <- SAGE_dep$q47
SAGE_dep$s4 <- car::recode(SAGE_dep$q49+SAGE_dep$q50, "2=1; 1=1")
SAGE_dep$s5 <- car::recode(SAGE_dep$q52+SAGE_dep$q54, "2=1; 1=1")
SAGE_dep$s7 <- car::recode(SAGE_dep$q55+SAGE_dep$q56, "2=1; 1=1")
SAGE_dep$s8 <- car::recode(SAGE_dep$q48+SAGE_dep$q51, "2=1; 1=1")
SAGE_dep$s9 <- car::recode(SAGE_dep$q58+SAGE_dep$q59, "2=1; 1=1")

SAGE_dep$dep <- NA
SAGE_dep$final_score <- NA

SAGE_dep$dep[which(SAGE_dep$s1==0 & SAGE_dep$s2==0 & SAGE_dep$s6==0)] <- 0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==0)] <-0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==0)] <-0


SAGE_dep$final_score[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1)] <- apply(SAGE_dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1),34:42], MARGIN = 1, FUN = sum)

SAGE_dep$dep[!is.na(SAGE_dep$final_score)] <- car::recode(SAGE_dep$final_score[!is.na(SAGE_dep$final_score)], "0:4=0; 5:hi=1")



SAGE_SA_ds_w1 <- tibble(id=SAGE_dep$id)
SAGE_SA_ds_w1$depression <- car::recode(SAGE_dep$dep, "NA=999")
SAGE_SA_ds_w1$depression <- labelled(SAGE_SA_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript1,  echo=FALSE}
vari <- SAGE_SA_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(SAGE_SA_ds_w1, aes(x=factor(depression))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation1,  echo=FALSE}
```

 
 
```{r importOPAL1,  echo=FALSE}
#opal.assign.data(o, 'SAGE_SA_ds_w1', SAGE_SA_ds_w1)
#opal.symbol_import(o,'SAGE_SA_ds_w1', project='_Athlos_Harm_Dataset')
label(SAGE_SA_ds_w1$depression) <- ds_label_all
depression <- SAGE_SA_ds_w1
save(depression, file = "../RData/SA_w1/depression.RData")
rm(depression)

SAGE_SA_m_ds_w1 <- SAGE_SA_ds_w1
SAGE_SA_m_ds_w1$depression <- car::recode(SAGE_SA_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'SAGE_SA_m_ds_w1', SAGE_SA_m_ds_w1)
#opal.symbol_import(o,'SAGE_SA_m_ds_w1', project='_Athlos_Harm_Dataset')
```





## Ghana

### Wave 1 

#### Study-specific variable description

| **Name** | `q4042`| `q4043` | `q4045` | `q4046` | `q4047` | `q4049` | `q4050` | `q4052` | `q4054` | `q4044` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `q4042: several days`| `q4043: loss of interest` | `q4045: more than 2 weeks?` | `q4046: daily?` | `q4047: loss of appetite` | `q4049: falling asleep` | `q4050: waking up` | `q4052: moving slowly` | `q4054: restlessness, jitters` | `q4044: lack of energy` | 
| **Table name** | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` |
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | 
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | 
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | 

| **Name** | `q4055`| `q4056` | `q4048` | `q4051` | `q4058` | `q4059` |
|-|-|-|-|-|-|-|
| **Label** | `q4055: low self-esteem`| `q4056: hopelessness` | `q4048: slow thinking` | `q4051: difficulty concentrating` | `q4058: morbid thoughts` | `q4059: suicide attempts` | 
| **Table name** | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | `ghanaINDData` | 
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` |
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` |  
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` |  

```{r assign_ghana,  echo=FALSE}
opal.assign.table.tibble(o, 'SAGE_dep','SAGE.ghanaINDData',
                         variables=list('q4042', 'q4043', 'q4045', 'q4046', 'q4047', 'q4049', 'q4050', 'q4052', 'q4054', 'q4044', 'q4055', 'q4056', 'q4048', 'q4051', 'q4058', 'q4059'), missings = TRUE)
SAGE_dep <- opal.execute(o,'SAGE_dep')
```

```{r local_ghana,  echo=FALSE}
vari <- SAGE_dep$q4042
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4043
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4044
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4045
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4046
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4047
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4048
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4049
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4050
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4051
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4052
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4054
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4055
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4056
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4058
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4059
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* First of all, recode the variables in symptoms as follows:
    + `s1 = 1 if q4042=1; s1 = 0 if q4042=2`
    + `s2 = 1 if q4043=1; s2 = 0 if q4043=2`
    + `s3 = 1 if q4047=1; s3 = 0 if q4047=2`
    + `s4 = 1 if q4049=1 or q4050=1; s4 = 0 if q4049=0 and q4050=0`
    + `s5 = 1 if q4052=1 or q4054=1; s5 = 0 if q4052=0 and q4054=0`
    + `s6 = 1 if q4044=1; s1 = 0 if q4044=2`
    + `s7 = 1 if q4055=1 or q4056=1; s7 = 0 if q4055=0 and q4056=0`
    + `s8 = 1 if q4048=1 or q4051=1; s8 = 0 if q4048=0 and q4051=0`
    + `s9 = 1 if q4058=1 or q4059=1; s9 = 0 if q4058=0 and q4059=0`

* the harmonized variable will be 0 for the individuals that: 
    + `s1, s2 and s6 = 0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=0`
  
* the individuals that has ((s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=1) the final score is computed suming all the symptoms and the final score is recoded as follows: 
    + `final_score < 5 into 0`
    + `final_score >=5 into 1`

* the individuals that are not in any condition are recoded as follows: 
    + `NA into 999`

**R script:**

```{r harmo_ghana,   echo=TRUE}
SAGE_dep$q42 <- car::recode(SAGE_dep$q4042, "2=0; 8=NA; 9=NA")
SAGE_dep$q43 <- car::recode(SAGE_dep$q4043, "2=0; 8=NA; 9=NA")
SAGE_dep$q45 <- car::recode(SAGE_dep$q4045, "2=0; 8=NA; 9=NA")
SAGE_dep$q46 <- car::recode(SAGE_dep$q4046, "2=0; 8=NA; 9=NA")
SAGE_dep$q47 <- car::recode(SAGE_dep$q4047, "2=0; 8=NA; 9=NA")
SAGE_dep$q49 <- car::recode(SAGE_dep$q4049, "2=0; 8=NA; 9=NA")
SAGE_dep$q50 <- car::recode(SAGE_dep$q4050, "2=0; 8=NA; 9=NA")
SAGE_dep$q52 <- car::recode(SAGE_dep$q4052, "2=0; 8=NA; 9=NA")
SAGE_dep$q54 <- car::recode(SAGE_dep$q4054, "2=0; 8=NA; 9=NA")
SAGE_dep$q44 <- car::recode(SAGE_dep$q4044, "2=0; 8=NA; 9=NA")
SAGE_dep$q55 <- car::recode(SAGE_dep$q4055, "2=0; 8=NA; 9=NA")
SAGE_dep$q56 <- car::recode(SAGE_dep$q4056, "2=0; 8=NA; 9=NA")
SAGE_dep$q48 <- car::recode(SAGE_dep$q4048, "2=0; 8=NA; 9=NA")
SAGE_dep$q51 <- car::recode(SAGE_dep$q4051, "2=0; 8=NA; 9=NA")
SAGE_dep$q58 <- car::recode(SAGE_dep$q4058, "2=0; 8=NA; 9=NA")
SAGE_dep$q59 <- car::recode(SAGE_dep$q4059, "2=0; 8=NA; 9=NA")


SAGE_dep$s1 <- SAGE_dep$q42
SAGE_dep$s2 <- SAGE_dep$q43
SAGE_dep$s6 <- SAGE_dep$q44

SAGE_dep$s3 <- SAGE_dep$q47
SAGE_dep$s4 <- car::recode(SAGE_dep$q49+SAGE_dep$q50, "2=1; 1=1")
SAGE_dep$s5 <- car::recode(SAGE_dep$q52+SAGE_dep$q54, "2=1; 1=1")
SAGE_dep$s7 <- car::recode(SAGE_dep$q55+SAGE_dep$q56, "2=1; 1=1")
SAGE_dep$s8 <- car::recode(SAGE_dep$q48+SAGE_dep$q51, "2=1; 1=1")
SAGE_dep$s9 <- car::recode(SAGE_dep$q58+SAGE_dep$q59, "2=1; 1=1")

SAGE_dep$dep <- NA
SAGE_dep$final_score <- NA

SAGE_dep$dep[which(SAGE_dep$s1==0 & SAGE_dep$s2==0 & SAGE_dep$s6==0)] <- 0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==0)] <-0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==0)] <-0


SAGE_dep$final_score[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1)] <- apply(SAGE_dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1),34:42], MARGIN = 1, FUN = sum)

SAGE_dep$dep[!is.na(SAGE_dep$final_score)] <- car::recode(SAGE_dep$final_score[!is.na(SAGE_dep$final_score)], "0:4=0; 5:hi=1")


SAGE_ghana_ds_w1 <- tibble(id=SAGE_dep$id)
SAGE_ghana_ds_w1$depression <- car::recode(SAGE_dep$dep, "NA=999")
SAGE_ghana_ds_w1$depression <- labelled(SAGE_ghana_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_ghana,  echo=FALSE}
vari <- SAGE_ghana_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(SAGE_ghana_ds_w1, aes(x=factor(depression))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_ghana,  echo=FALSE}
```

 
 
```{r importOPAL_ghana,  echo=FALSE}
#opal.assign.data(o, 'SAGE_ghana_ds_w1', SAGE_ghana_ds_w1)
#opal.symbol_import(o,'SAGE_ghana_ds_w1', project='_Athlos_Harm_Dataset')
label(SAGE_ghana_ds_w1$depression) <- ds_label_all
depression <- SAGE_ghana_ds_w1
save(depression, file = "../RData/ghana_w1/depression.RData")
rm(depression)

SAGE_ghana_m_ds_w1 <- SAGE_ghana_ds_w1
SAGE_ghana_m_ds_w1$depression <- car::recode(SAGE_ghana_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'SAGE_ghana_m_ds_w1', SAGE_ghana_m_ds_w1)
#opal.symbol_import(o,'SAGE_ghana_m_ds_w1', project='_Athlos_Harm_Dataset')
```



## China

### Wave 1 

#### Study-specific variable description

| **Name** | `q4042`| `q4043` | `q4045` | `q4046` | `q4047` | `q4049` | `q4050` | `q4052` | `q4054` | `q4044` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `q4042: several days`| `q4043: loss of interest` | `q4045: more than 2 weeks?` | `q4046: daily?` | `q4047: loss of appetite` | `q4049: falling asleep` | `q4050: waking up` | `q4052: moving slowly` | `q4054: restlessness, jitters` | `q4044: lack of energy` | 
| **Table name** | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` | `southAfricaINDdata` |
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | 
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | 
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | 

| **Name** | `q4055`| `q4056` | `q4048` | `q4051` | `q4058` | `q4059` |
|-|-|-|-|-|-|-|
| **Label** | `q4055: low self-esteem`| `q4056: hopelessness` | `q4048: slow thinking` | `q4051: difficulty concentrating` | `q4058: morbid thoughts` | `q4059: suicide attempts` | 
| **Table name** | `chinaINDData` | `chinaINDData` | `chinaINDData` | `chinaINDData` | `chinaINDData` | `chinaINDData` | 
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` |
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` |  
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` |  

```{r assign_china,  echo=FALSE}
opal.assign.table.tibble(o, 'SAGE_dep','SAGE.chinaINDData',
                         variables=list('q4042', 'q4043', 'q4045', 'q4046', 'q4047', 'q4049', 'q4050', 'q4052', 'q4054', 'q4044', 'q4055', 'q4056', 'q4048', 'q4051', 'q4058', 'q4059'), missings = TRUE)
SAGE_dep <- opal.execute(o,'SAGE_dep')
```

```{r local_china,  echo=FALSE}
vari <- SAGE_dep$q4042
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4043
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4044
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4045
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4046
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4047
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4048
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4049
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4050
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4051
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4052
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4054
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4055
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4056
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4058
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4059
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* First of all, recode the variables in symptoms as follows:
    + `s1 = 1 if q4042=1; s1 = 0 if q4042=2`
    + `s2 = 1 if q4043=1; s2 = 0 if q4043=2`
    + `s3 = 1 if q4047=1; s3 = 0 if q4047=2`
    + `s4 = 1 if q4049=1 or q4050=1; s4 = 0 if q4049=0 and q4050=0`
    + `s5 = 1 if q4052=1 or q4054=1; s5 = 0 if q4052=0 and q4054=0`
    + `s6 = 1 if q4044=1; s1 = 0 if q4044=2`
    + `s7 = 1 if q4055=1 or q4056=1; s7 = 0 if q4055=0 and q4056=0`
    + `s8 = 1 if q4048=1 or q4051=1; s8 = 0 if q4048=0 and q4051=0`
    + `s9 = 1 if q4058=1 or q4059=1; s9 = 0 if q4058=0 and q4059=0`

* the harmonized variable will be 0 for the individuals that: 
    + `s1, s2 and s6 = 0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=0`
  
* the individuals that has ((s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=1) the final score is computed suming all the symptoms and the final score is recoded as follows: 
    + `final_score < 5 into 0`
    + `final_score >=5 into 1`

* the individuals that are not in any condition are recoded as follows: 
    + `NA into 999`

**R script:**

```{r harmo_china,   echo=TRUE}
SAGE_dep$q42 <- car::recode(SAGE_dep$q4042, "2=0; 8=NA; 9=NA")
SAGE_dep$q43 <- car::recode(SAGE_dep$q4043, "2=0; 8=NA; 9=NA")
SAGE_dep$q45 <- car::recode(SAGE_dep$q4045, "2=0; 8=NA; 9=NA")
SAGE_dep$q46 <- car::recode(SAGE_dep$q4046, "2=0; 8=NA; 9=NA")
SAGE_dep$q47 <- car::recode(SAGE_dep$q4047, "2=0; 8=NA; 9=NA")
SAGE_dep$q49 <- car::recode(SAGE_dep$q4049, "2=0; 8=NA; 9=NA")
SAGE_dep$q50 <- car::recode(SAGE_dep$q4050, "2=0; 8=NA; 9=NA")
SAGE_dep$q52 <- car::recode(SAGE_dep$q4052, "2=0; 8=NA; 9=NA")
SAGE_dep$q54 <- car::recode(SAGE_dep$q4054, "2=0; 8=NA; 9=NA")
SAGE_dep$q44 <- car::recode(SAGE_dep$q4044, "2=0; 8=NA; 9=NA")
SAGE_dep$q55 <- car::recode(SAGE_dep$q4055, "2=0; 8=NA; 9=NA")
SAGE_dep$q56 <- car::recode(SAGE_dep$q4056, "2=0; 8=NA; 9=NA")
SAGE_dep$q48 <- car::recode(SAGE_dep$q4048, "2=0; 8=NA; 9=NA")
SAGE_dep$q51 <- car::recode(SAGE_dep$q4051, "2=0; 8=NA; 9=NA")
SAGE_dep$q58 <- car::recode(SAGE_dep$q4058, "2=0; 8=NA; 9=NA")
SAGE_dep$q59 <- car::recode(SAGE_dep$q4059, "2=0; 8=NA; 9=NA")


SAGE_dep$s1 <- SAGE_dep$q42
SAGE_dep$s2 <- SAGE_dep$q43
SAGE_dep$s6 <- SAGE_dep$q44

SAGE_dep$s3 <- SAGE_dep$q47
SAGE_dep$s4 <- car::recode(SAGE_dep$q49+SAGE_dep$q50, "2=1; 1=1")
SAGE_dep$s5 <- car::recode(SAGE_dep$q52+SAGE_dep$q54, "2=1; 1=1")
SAGE_dep$s7 <- car::recode(SAGE_dep$q55+SAGE_dep$q56, "2=1; 1=1")
SAGE_dep$s8 <- car::recode(SAGE_dep$q48+SAGE_dep$q51, "2=1; 1=1")
SAGE_dep$s9 <- car::recode(SAGE_dep$q58+SAGE_dep$q59, "2=1; 1=1")

SAGE_dep$dep <- NA
SAGE_dep$final_score <- NA

SAGE_dep$dep[which(SAGE_dep$s1==0 & SAGE_dep$s2==0 & SAGE_dep$s6==0)] <- 0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==0)] <-0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==0)] <-0


SAGE_dep$final_score[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1)] <- apply(SAGE_dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1),34:42], MARGIN = 1, FUN = sum)

SAGE_dep$dep[!is.na(SAGE_dep$final_score)] <- car::recode(SAGE_dep$final_score[!is.na(SAGE_dep$final_score)], "0:4=0; 5:hi=1")

SAGE_china_ds_w1 <- tibble(id=SAGE_dep$id)
SAGE_china_ds_w1$depression <- car::recode(SAGE_dep$dep, "NA=999")
SAGE_china_ds_w1$depression <- labelled(SAGE_china_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_china,  echo=FALSE}
vari <- SAGE_china_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(SAGE_china_ds_w1, aes(x=factor(depression))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_china,  echo=FALSE}
```

 

```{r importOPAL_china,  echo=FALSE}
#opal.assign.data(o, 'SAGE_china_ds_w1', SAGE_china_ds_w1)
#opal.symbol_import(o,'SAGE_china_ds_w1', project='_Athlos_Harm_Dataset')
label(SAGE_china_ds_w1$depression) <- ds_label_all
depression <- SAGE_china_ds_w1
save(depression, file = "../RData/china_w1/depression.RData")
rm(depression)

SAGE_china_m_ds_w1 <- SAGE_china_ds_w1
SAGE_china_m_ds_w1$depression <- car::recode(SAGE_china_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'SAGE_china_m_ds_w1', SAGE_china_m_ds_w1)
#opal.symbol_import(o,'SAGE_china_m_ds_w1', project='_Athlos_Harm_Dataset')
```





## India

### Wave 1 

#### Study-specific variable description

| **Name** | `q4042`| `q4043` | `q4045` | `q4046` | `q4047` | `q4049` | `q4050` | `q4052` | `q4054` | `q4044` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `q4042: several days`| `q4043: loss of interest` | `q4045: more than 2 weeks?` | `q4046: daily?` | `q4047: loss of appetite` | `q4049: falling asleep` | `q4050: waking up` | `q4052: moving slowly` | `q4054: restlessness, jitters` | `q4044: lack of energy` | 
| **Table name** | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` |
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | 
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | 
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | 

| **Name** | `q4055`| `q4056` | `q4048` | `q4051` | `q4058` | `q4059` |
|-|-|-|-|-|-|-|
| **Label** | `q4055: low self-esteem`| `q4056: hopelessness` | `q4048: slow thinking` | `q4051: difficulty concentrating` | `q4058: morbid thoughts` | `q4059: suicide attempts` | 
| **Table name** | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | `indiaINDData` | 
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` |
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` |  
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` |  

```{r assign_india,  echo=FALSE}
opal.assign.table.tibble(o, 'SAGE_dep','SAGE.indiaINDData',
                         variables=list('q4042', 'q4043', 'q4045', 'q4046', 'q4047', 'q4049', 'q4050', 'q4052', 'q4054', 'q4044', 'q4055', 'q4056', 'q4048', 'q4051', 'q4058', 'q4059'), missings = TRUE)
SAGE_dep <- opal.execute(o,'SAGE_dep')
```

```{r local_india,  echo=FALSE}
vari <- SAGE_dep$q4042
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4043
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4044
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4045
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4046
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4047
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4048
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4049
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4050
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4051
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4052
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4054
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4055
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4056
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4058
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4059
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* First of all, recode the variables in symptoms as follows:
    + `s1 = 1 if q4042=1; s1 = 0 if q4042=2`
    + `s2 = 1 if q4043=1; s2 = 0 if q4043=2`
    + `s3 = 1 if q4047=1; s3 = 0 if q4047=2`
    + `s4 = 1 if q4049=1 or q4050=1; s4 = 0 if q4049=0 and q4050=0`
    + `s5 = 1 if q4052=1 or q4054=1; s5 = 0 if q4052=0 and q4054=0`
    + `s6 = 1 if q4044=1; s1 = 0 if q4044=2`
    + `s7 = 1 if q4055=1 or q4056=1; s7 = 0 if q4055=0 and q4056=0`
    + `s8 = 1 if q4048=1 or q4051=1; s8 = 0 if q4048=0 and q4051=0`
    + `s9 = 1 if q4058=1 or q4059=1; s9 = 0 if q4058=0 and q4059=0`

* the harmonized variable will be 0 for the individuals that: 
    + `s1, s2 and s6 = 0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=0`
  
* the individuals that has ((s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=1) the final score is computed suming all the symptoms and the final score is recoded as follows: 
    + `final_score < 5 into 0`
    + `final_score >=5 into 1`

* the individuals that are not in any condition are recoded as follows: 
    + `NA into 999`


**R script:**

```{r harmo_india,   echo=TRUE}
SAGE_dep$q42 <- car::recode(SAGE_dep$q4042, "2=0; 8=NA; 9=NA")
SAGE_dep$q43 <- car::recode(SAGE_dep$q4043, "2=0; 8=NA; 9=NA")
SAGE_dep$q45 <- car::recode(SAGE_dep$q4045, "2=0; 8=NA; 9=NA")
SAGE_dep$q46 <- car::recode(SAGE_dep$q4046, "2=0; 8=NA; 9=NA")
SAGE_dep$q47 <- car::recode(SAGE_dep$q4047, "2=0; 8=NA; 9=NA")
SAGE_dep$q49 <- car::recode(SAGE_dep$q4049, "2=0; 8=NA; 9=NA")
SAGE_dep$q50 <- car::recode(SAGE_dep$q4050, "2=0; 8=NA; 9=NA")
SAGE_dep$q52 <- car::recode(SAGE_dep$q4052, "2=0; 8=NA; 9=NA")
SAGE_dep$q54 <- car::recode(SAGE_dep$q4054, "2=0; 8=NA; 9=NA")
SAGE_dep$q44 <- car::recode(SAGE_dep$q4044, "2=0; 8=NA; 9=NA")
SAGE_dep$q55 <- car::recode(SAGE_dep$q4055, "2=0; 8=NA; 9=NA")
SAGE_dep$q56 <- car::recode(SAGE_dep$q4056, "2=0; 8=NA; 9=NA")
SAGE_dep$q48 <- car::recode(SAGE_dep$q4048, "2=0; 8=NA; 9=NA")
SAGE_dep$q51 <- car::recode(SAGE_dep$q4051, "2=0; 8=NA; 9=NA")
SAGE_dep$q58 <- car::recode(SAGE_dep$q4058, "2=0; 8=NA; 9=NA")
SAGE_dep$q59 <- car::recode(SAGE_dep$q4059, "2=0; 8=NA; 9=NA")


SAGE_dep$s1 <- SAGE_dep$q42
SAGE_dep$s2 <- SAGE_dep$q43
SAGE_dep$s6 <- SAGE_dep$q44

SAGE_dep$s3 <- SAGE_dep$q47
SAGE_dep$s4 <- car::recode(SAGE_dep$q49+SAGE_dep$q50, "2=1; 1=1")
SAGE_dep$s5 <- car::recode(SAGE_dep$q52+SAGE_dep$q54, "2=1; 1=1")
SAGE_dep$s7 <- car::recode(SAGE_dep$q55+SAGE_dep$q56, "2=1; 1=1")
SAGE_dep$s8 <- car::recode(SAGE_dep$q48+SAGE_dep$q51, "2=1; 1=1")
SAGE_dep$s9 <- car::recode(SAGE_dep$q58+SAGE_dep$q59, "2=1; 1=1")

SAGE_dep$dep <- NA
SAGE_dep$final_score <- NA

SAGE_dep$dep[which(SAGE_dep$s1==0 & SAGE_dep$s2==0 & SAGE_dep$s6==0)] <- 0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==0)] <-0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==0)] <-0


SAGE_dep$final_score[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1)] <- apply(SAGE_dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1),34:42], MARGIN = 1, FUN = sum)

SAGE_dep$dep[!is.na(SAGE_dep$final_score)] <- car::recode(SAGE_dep$final_score[!is.na(SAGE_dep$final_score)], "0:4=0; 5:hi=1")

SAGE_india_ds_w1 <- tibble(id=SAGE_dep$id)
SAGE_india_ds_w1$depression <- car::recode(SAGE_dep$dep, "NA=999")
SAGE_india_ds_w1$depression <- labelled(SAGE_india_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_india,  echo=FALSE}
vari <- SAGE_india_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(SAGE_india_ds_w1, aes(x=factor(depression))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_india,  echo=FALSE}
```

 
```{r importOPAL_india,  echo=FALSE}
#opal.assign.data(o, 'SAGE_india_ds_w1', SAGE_india_ds_w1)
#opal.symbol_import(o,'SAGE_india_ds_w1', project='_Athlos_Harm_Dataset')
label(SAGE_india_ds_w1$depression) <- ds_label_all
depression <- SAGE_india_ds_w1
save(depression, file = "../RData/india_w1/depression.RData")
rm(depression)

SAGE_india_m_ds_w1 <- SAGE_india_ds_w1
SAGE_india_m_ds_w1$depression <- car::recode(SAGE_india_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'SAGE_india_m_ds_w1', SAGE_india_m_ds_w1)
#opal.symbol_import(o,'SAGE_india_m_ds_w1', project='_Athlos_Harm_Dataset')
```





## Russia

### Wave 1 

#### Study-specific variable description

| **Name** | `q4042`| `q4043` | `q4045` | `q4046` | `q4047` | `q4049` | `q4050` | `q4052` | `q4054` | `q4044` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `q4042: several days`| `q4043: loss of interest` | `q4045: more than 2 weeks?` | `q4046: daily?` | `q4047: loss of appetite` | `q4049: falling asleep` | `q4050: waking up` | `q4052: moving slowly` | `q4054: restlessness, jitters` | `q4044: lack of energy` | 
| **Table name** | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` |
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | 
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | 
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | 

| **Name** | `q4055`| `q4056` | `q4048` | `q4051` | `q4058` | `q4059` |
|-|-|-|-|-|-|-|
| **Label** | `q4055: low self-esteem`| `q4056: hopelessness` | `q4048: slow thinking` | `q4051: difficulty concentrating` | `q4058: morbid thoughts` | `q4059: suicide attempts` | 
| **Table name** | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | `russiaINDdata` | 
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` |
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` |  
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` |  

```{r assign_russia,  echo=FALSE}
opal.assign.table.tibble(o, 'SAGE_dep','SAGE.russiaINDdata',
                         variables=list('q4042', 'q4043', 'q4045', 'q4046', 'q4047', 'q4049', 'q4050', 'q4052', 'q4054', 'q4044', 'q4055', 'q4056', 'q4048', 'q4051', 'q4058', 'q4059'), missings = TRUE)
SAGE_dep <- opal.execute(o,'SAGE_dep')
```

```{r local_russia,  echo=FALSE}
vari <- SAGE_dep$q4042
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4043
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4044
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4045
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4046
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4047
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4048
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4049
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4050
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4051
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4052
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4054
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4055
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4056
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4058
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4059
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* First of all, recode the variables in symptoms as follows:
    + `s1 = 1 if q4042=1; s1 = 0 if q4042=2`
    + `s2 = 1 if q4043=1; s2 = 0 if q4043=2`
    + `s3 = 1 if q4047=1; s3 = 0 if q4047=2`
    + `s4 = 1 if q4049=1 or q4050=1; s4 = 0 if q4049=0 and q4050=0`
    + `s5 = 1 if q4052=1 or q4054=1; s5 = 0 if q4052=0 and q4054=0`
    + `s6 = 1 if q4044=1; s1 = 0 if q4044=2`
    + `s7 = 1 if q4055=1 or q4056=1; s7 = 0 if q4055=0 and q4056=0`
    + `s8 = 1 if q4048=1 or q4051=1; s8 = 0 if q4048=0 and q4051=0`
    + `s9 = 1 if q4058=1 or q4059=1; s9 = 0 if q4058=0 and q4059=0`

* the harmonized variable will be 0 for the individuals that: 
    + `s1, s2 and s6 = 0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=0`
  
* the individuals that has ((s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=1) the final score is computed suming all the symptoms and the final score is recoded as follows: 
    + `final_score < 5 into 0`
    + `final_score >=5 into 1`

* the individuals that are not in any condition are recoded as follows: 
    + `NA into 999`

**R script:**

```{r harmo_russia,   echo=TRUE}
SAGE_dep$q42 <- car::recode(SAGE_dep$q4042, "2=0; 8=NA; 9=NA")
SAGE_dep$q43 <- car::recode(SAGE_dep$q4043, "2=0; 8=NA; 9=NA")
SAGE_dep$q45 <- car::recode(SAGE_dep$q4045, "2=0; 8=NA; 9=NA")
SAGE_dep$q46 <- car::recode(SAGE_dep$q4046, "2=0; 8=NA; 9=NA")
SAGE_dep$q47 <- car::recode(SAGE_dep$q4047, "2=0; 8=NA; 9=NA")
SAGE_dep$q49 <- car::recode(SAGE_dep$q4049, "2=0; 8=NA; 9=NA")
SAGE_dep$q50 <- car::recode(SAGE_dep$q4050, "2=0; 8=NA; 9=NA")
SAGE_dep$q52 <- car::recode(SAGE_dep$q4052, "2=0; 8=NA; 9=NA")
SAGE_dep$q54 <- car::recode(SAGE_dep$q4054, "2=0; 8=NA; 9=NA")
SAGE_dep$q44 <- car::recode(SAGE_dep$q4044, "2=0; 8=NA; 9=NA")
SAGE_dep$q55 <- car::recode(SAGE_dep$q4055, "2=0; 8=NA; 9=NA")
SAGE_dep$q56 <- car::recode(SAGE_dep$q4056, "2=0; 8=NA; 9=NA")
SAGE_dep$q48 <- car::recode(SAGE_dep$q4048, "2=0; 8=NA; 9=NA")
SAGE_dep$q51 <- car::recode(SAGE_dep$q4051, "2=0; 8=NA; 9=NA")
SAGE_dep$q58 <- car::recode(SAGE_dep$q4058, "2=0; 8=NA; 9=NA")
SAGE_dep$q59 <- car::recode(SAGE_dep$q4059, "2=0; 8=NA; 9=NA")


SAGE_dep$s1 <- SAGE_dep$q42
SAGE_dep$s2 <- SAGE_dep$q43
SAGE_dep$s6 <- SAGE_dep$q44

SAGE_dep$s3 <- SAGE_dep$q47
SAGE_dep$s4 <- car::recode(SAGE_dep$q49+SAGE_dep$q50, "2=1; 1=1")
SAGE_dep$s5 <- car::recode(SAGE_dep$q52+SAGE_dep$q54, "2=1; 1=1")
SAGE_dep$s7 <- car::recode(SAGE_dep$q55+SAGE_dep$q56, "2=1; 1=1")
SAGE_dep$s8 <- car::recode(SAGE_dep$q48+SAGE_dep$q51, "2=1; 1=1")
SAGE_dep$s9 <- car::recode(SAGE_dep$q58+SAGE_dep$q59, "2=1; 1=1")

SAGE_dep$dep <- NA
SAGE_dep$final_score <- NA

SAGE_dep$dep[which(SAGE_dep$s1==0 & SAGE_dep$s2==0 & SAGE_dep$s6==0)] <- 0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==0)] <-0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==0)] <-0


SAGE_dep$final_score[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1)] <- apply(SAGE_dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1),34:42], MARGIN = 1, FUN = sum)

SAGE_dep$dep[!is.na(SAGE_dep$final_score)] <- car::recode(SAGE_dep$final_score[!is.na(SAGE_dep$final_score)], "0:4=0; 5:hi=1")

SAGE_russia_ds_w1 <- tibble(id=SAGE_dep$id)
SAGE_russia_ds_w1$depression <- car::recode(SAGE_dep$dep, "NA=999")
SAGE_russia_ds_w1$depression <- labelled(SAGE_russia_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_russia,  echo=FALSE}
vari <- SAGE_russia_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(SAGE_russia_ds_w1, aes(x=factor(depression))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_russia,  echo=FALSE}
```



 
```{r importOPAL_russia,  echo=FALSE}
#opal.assign.data(o, 'SAGE_russia_ds_w1', SAGE_russia_ds_w1)
#opal.symbol_import(o,'SAGE_russia_ds_w1', project='_Athlos_Harm_Dataset')
label(SAGE_russia_ds_w1$depression) <- ds_label_all
depression <- SAGE_russia_ds_w1
save(depression, file = "../RData/russia_w1/depression.RData")
rm(depression)

SAGE_russia_m_ds_w1 <- SAGE_russia_ds_w1
SAGE_russia_m_ds_w1$depression <- car::recode(SAGE_russia_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'SAGE_russia_m_ds_w1', SAGE_russia_m_ds_w1)
#opal.symbol_import(o,'SAGE_russia_m_ds_w1', project='_Athlos_Harm_Dataset')
```




## Mexico

### Wave 1 

#### Study-specific variable description

| **Name** | `q4042`| `q4043` | `q4045` | `q4046` | `q4047` | `q4049` | `q4050` | `q4052` | `q4054` | `q4044` | 
|-|-|-|-|-|-|-|-|-|-|-| 
| **Label** | `q4042: several days`| `q4043: loss of interest` | `q4045: more than 2 weeks?` | `q4046: daily?` | `q4047: loss of appetite` | `q4049: falling asleep` | `q4050: waking up` | `q4052: moving slowly` | `q4054: restlessness, jitters` | `q4044: lack of energy` | 
| **Table name** | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` |
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | 
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | 
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | 

| **Name** | `q4055`| `q4056` | `q4048` | `q4051` | `q4058` | `q4059` |
|-|-|-|-|-|-|-|
| **Label** | `q4055: low self-esteem`| `q4056: hopelessness` | `q4048: slow thinking` | `q4051: difficulty concentrating` | `q4058: morbid thoughts` | `q4059: suicide attempts` | 
| **Table name** | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | `mexicoINDdata` | 
| **Categories** |`1 = yes`| `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` | `1 = yes` |
| | `2 = no` | `2 = no`| `2 = no` | `2 = no` | `2 = no` | `2 = no` | 
| **Missing** |`8 = don't know`| `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` | `8 = don't know` |  
| |`9 = not applicable`| `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` | `9 = not applicable` |  

```{r assign_Mexico,  echo=FALSE}
opal.assign.table.tibble(o, 'SAGE_dep','SAGE.mexicoINDdata',
                         variables=list('q4042', 'q4043', 'q4045', 'q4046', 'q4047', 'q4049', 'q4050', 'q4052', 'q4054', 'q4044', 'q4055', 'q4056', 'q4048', 'q4051', 'q4058', 'q4059'), missings = TRUE)
SAGE_dep <- opal.execute(o,'SAGE_dep')
```

```{r local_Mexico,  echo=FALSE}
vari <- SAGE_dep$q4042
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4043
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4044
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4045
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4046
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4047
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4048
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4049
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4050
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4051
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4052
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4054
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4055
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4056
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4058
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")

vari <- SAGE_dep$q4059
kable(Categorical_summary(vari, missing_values = c(8,9))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(8,9))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(8,9))[2], caption = "Type of missing")
ggplot(SAGE_dep, aes(x=factor(vari))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Harmonisation algorithm
To compute the harmonized variable from the study-specific variable it has to be recoded as follows:

* First of all, recode the variables in symptoms as follows:
    + `s1 = 1 if q4042=1; s1 = 0 if q4042=2`
    + `s2 = 1 if q4043=1; s2 = 0 if q4043=2`
    + `s3 = 1 if q4047=1; s3 = 0 if q4047=2`
    + `s4 = 1 if q4049=1 or q4050=1; s4 = 0 if q4049=0 and q4050=0`
    + `s5 = 1 if q4052=1 or q4054=1; s5 = 0 if q4052=0 and q4054=0`
    + `s6 = 1 if q4044=1; s1 = 0 if q4044=2`
    + `s7 = 1 if q4055=1 or q4056=1; s7 = 0 if q4055=0 and q4056=0`
    + `s8 = 1 if q4048=1 or q4051=1; s8 = 0 if q4048=0 and q4051=0`
    + `s9 = 1 if q4058=1 or q4059=1; s9 = 0 if q4058=0 and q4059=0`

* the harmonized variable will be 0 for the individuals that: 
    + `s1, s2 and s6 = 0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=0`
    + `(s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=0`
  
* the individuals that has ((s1 OR s2 OR s6) is 1 AND q4045=1 AND q4046=1) the final score is computed suming all the symptoms and the final score is recoded as follows: 
    + `final_score < 5 into 0`
    + `final_score >=5 into 1`

* the individuals that are not in any condition are recoded as follows: 
    + `NA into 999`

**R script:**

```{r harmo_Mexico,   echo=TRUE}
SAGE_dep$q42 <- car::recode(SAGE_dep$q4042, "2=0; 8=NA; 9=NA")
SAGE_dep$q43 <- car::recode(SAGE_dep$q4043, "2=0; 8=NA; 9=NA")
SAGE_dep$q45 <- car::recode(SAGE_dep$q4045, "2=0; 8=NA; 9=NA")
SAGE_dep$q46 <- car::recode(SAGE_dep$q4046, "2=0; 8=NA; 9=NA")
SAGE_dep$q47 <- car::recode(SAGE_dep$q4047, "2=0; 8=NA; 9=NA")
SAGE_dep$q49 <- car::recode(SAGE_dep$q4049, "2=0; 8=NA; 9=NA")
SAGE_dep$q50 <- car::recode(SAGE_dep$q4050, "2=0; 8=NA; 9=NA")
SAGE_dep$q52 <- car::recode(SAGE_dep$q4052, "2=0; 8=NA; 9=NA")
SAGE_dep$q54 <- car::recode(SAGE_dep$q4054, "2=0; 8=NA; 9=NA")
SAGE_dep$q44 <- car::recode(SAGE_dep$q4044, "2=0; 8=NA; 9=NA")
SAGE_dep$q55 <- car::recode(SAGE_dep$q4055, "2=0; 8=NA; 9=NA")
SAGE_dep$q56 <- car::recode(SAGE_dep$q4056, "2=0; 8=NA; 9=NA")
SAGE_dep$q48 <- car::recode(SAGE_dep$q4048, "2=0; 8=NA; 9=NA")
SAGE_dep$q51 <- car::recode(SAGE_dep$q4051, "2=0; 8=NA; 9=NA")
SAGE_dep$q58 <- car::recode(SAGE_dep$q4058, "2=0; 8=NA; 9=NA")
SAGE_dep$q59 <- car::recode(SAGE_dep$q4059, "2=0; 8=NA; 9=NA")


SAGE_dep$s1 <- SAGE_dep$q42
SAGE_dep$s2 <- SAGE_dep$q43
SAGE_dep$s6 <- SAGE_dep$q44

SAGE_dep$s3 <- SAGE_dep$q47
SAGE_dep$s4 <- car::recode(SAGE_dep$q49+SAGE_dep$q50, "2=1; 1=1")
SAGE_dep$s5 <- car::recode(SAGE_dep$q52+SAGE_dep$q54, "2=1; 1=1")
SAGE_dep$s7 <- car::recode(SAGE_dep$q55+SAGE_dep$q56, "2=1; 1=1")
SAGE_dep$s8 <- car::recode(SAGE_dep$q48+SAGE_dep$q51, "2=1; 1=1")
SAGE_dep$s9 <- car::recode(SAGE_dep$q58+SAGE_dep$q59, "2=1; 1=1")

SAGE_dep$dep <- NA
SAGE_dep$final_score <- NA

SAGE_dep$dep[which(SAGE_dep$s1==0 & SAGE_dep$s2==0 & SAGE_dep$s6==0)] <- 0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==0)] <-0
SAGE_dep$dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==0)] <-0


SAGE_dep$final_score[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1)] <- apply(SAGE_dep[which( (SAGE_dep$s1==1 | SAGE_dep$s2==1 | SAGE_dep$s6==1) & SAGE_dep$q45==1 & SAGE_dep$q46==1),34:42], MARGIN = 1, FUN = sum)

SAGE_dep$dep[!is.na(SAGE_dep$final_score)] <- car::recode(SAGE_dep$final_score[!is.na(SAGE_dep$final_score)], "0:4=0; 5:hi=1")

SAGE_mexico_ds_w1 <- tibble(id=SAGE_dep$id)
SAGE_mexico_ds_w1$depression <- car::recode(SAGE_dep$dep, "NA=999")
SAGE_mexico_ds_w1$depression <- labelled(SAGE_mexico_ds_w1[[2]], labels = c("no depression"=0, "depression"=1,  "Missing"=999, "Do not know"=998, "Refuse"=997, "Not applicable"=996, "Does not answer"=995,  "Not attempt not done"=994, "Disable to measure"=993, "Impute"=992, "CAPI interviewer error"=991))
```

#### Statistical description of the new harmonised variable
```{r descript_Mexico,  echo=FALSE}
vari <- SAGE_mexico_ds_w1$depression
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = ds_label) 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(SAGE_mexico_ds_w1, aes(x=factor(depression))) + geom_bar(stat="count", width=0.4, fill="steelblue") + xlab(ds_label) + ylab("Frequency")
```

#### Validation
```{r crosstabulation_Mexico,  echo=FALSE}
```


 
```{r importOPAL_Mexico,  echo=FALSE}
#opal.assign.data(o, 'SAGE_mexico_ds_w1', SAGE_mexico_ds_w1)
#opal.symbol_import(o,'SAGE_mexico_ds_w1', project='_Athlos_Harm_Dataset')
label(SAGE_mexico_ds_w1$depression) <- ds_label_all
depression <- SAGE_mexico_ds_w1
save(depression, file = "../RData/mexico_w1/depression.RData")
rm(depression)

SAGE_mexico_m_ds_w1 <- SAGE_mexico_ds_w1
SAGE_mexico_m_ds_w1$depression <- car::recode(SAGE_mexico_m_ds_w1$depression, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'SAGE_mexico_m_ds_w1', SAGE_mexico_m_ds_w1)
#opal.symbol_import(o,'SAGE_mexico_m_ds_w1', project='_Athlos_Harm_Dataset')
```


# Quality estimation

DSM-IV criteria was used to assess depression.



```{r closeRsession, echo=FALSE,  echo=FALSE} 
opal.logout(o)
```

