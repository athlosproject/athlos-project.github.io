---
title: "Mobility - Walking"
output:
  html_document:
    highlight: tango
    number_sections: yes
    theme: united
    toc: yes
    toc_depth: 6
    toc_float:
      collapsed: yes
      smooth_scroll: yes
---

```{r setup, include=FALSE}
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/setup_iago.r")
source("M:/WPs/WP1/Maelstrom/data_process/athlos-project.github.io/CHARLS/CHARLS_ids.R")
```

# Description of DataSchema variable

The description of harmonised variable is the following:

* Short name: `mob_walk`
* Variable label: `Mobility - walking`
* Variable description: `Mobility - walking. Difficulty for walking by yourself and without using any special equipment`
* Domain: `Health status and functional limitations`
* Value type: `categorical`
* Category coding:

**Code** | **Category Label**
-------- | ------------------
0        | Yes
1        | No

* Category missings: 

**Code** | **Category Label**
----| ------------------
991 | CAPI/interviewer error
992 | Impute
993 | Disable to measure
994 | Not attempt/not done
995 | Does not answer
996 | Not applicable
997 | Refuse
998 | Do not know
999 | Missing



# Data process

## China

### Wave 1 

#### Study-specific variable description

The study-specific variables elected to be harmonised is:

* Name: `db003`
* Label: `Have Difficulty Walking 100 metres`
* Categories:
   + `1 = No, I don't have any difficulty` 
   + `2 = I have difficulty but can still do it` 
   + `3 = Yes, I have difficulty and need help` 
   + `4 = I can not do it` 
* Missings
   + `NA`
   
* Name: `db002`
* Label: `Have Difficulty Walking 1 KM`
* Categories:
   + `1 = No, I don't have any difficulty` 
   + `2 = I have difficulty but can still do it` 
   + `3 = Yes, I have difficulty and need help` 
   + `4 = I can not do it` 
* Missings
   + `NA`

| **Name** | `age` |`da001`|`da002`|`da003`|`da004`|`da005_*_, *=1,...,5`|`da007_*_, *=1,...,14`|`da008_*_, *=1,5,11`|
|-|-|-|-|-|-|-|-|-|
| **Label** |`age`|`Self Comment of Your Health`|`Self Comment of Your Health`|`Pain on the Left Side of Your Chest`|`Chest Pains When Climbing Stairs/Uphill or Walking Quickly`|`Do you have one of the following disabilities?: Physical Disabilities; Brain Damage/Mental Retardation; Vision Problem; Hearing Problem; Speech Impediment`|`Have you been diagnosed by a doctor with: Hypertension; Dyslipidemia; Diabetes or High Blood Sugar; Cancer or Malignant Tumor; Chronic Lung Diseases; Liver Disease; Heart Problems; Stroke; Kidney Disease; Stomach or Other Digestive Disease; Emotional, Nervous, or Psychiatric Problems; Memory-Related Disease; Arthritis or Rheumatism; Asthma?`|`Do you know if you have: Hypertension; Chronic Lung Diseases; Emotional, Nervous,or Psychiatric Problems?`|
| **Table name** |`age`|`health_status_and_functioning_wave1`|`health_status_and_functioning_wave1`|`health_status_and_functioning_wave1`|`health_status_and_functioning_wave1`|`health_status_and_functioning_wave1`|`health_status_and_functioning_wave1`|`health_status_and_functioning_wave1`|
| **Categories** | `continuous` |`1 Excellent; 2 Very good; 3 Good; 4 Fair; 5 Poor`|`1 Very good; 2 Good; 3 Fair; 4 Poor; 5 Very poor`|`1 Yes; 2 No`|`1 Yes; 2 No`|`1 Yes; 2 No`|`1 Yes; 2 No`|`1 Yes; 2 No`|
| **Missings** |`999 Missing`|`NA`|`NA`|`NA`|`3 Not applicable; NA`|`NA`|`NA`|`3 Don't know; NA`|
| **Description** |  |  |  |  |  |  |  |  |


```{r assign w1, echo=FALSE}
opal.assign.table.tibble(o, 'CHARLS_w1_mob_walk2','CHARLS.health_status_and_functioning_wave1', variables=list('db002','db003','da001','da002','da003','da004','da005_1_','da005_2_','da005_3_','da005_4_','da005_5_','da007_1_','da007_2_','da007_3_','da007_4_','da007_5_','da007_6_','da007_7_','da007_8_','da007_9_','da007_10_','da007_11_','da007_12_','da007_13_','da007_14_','da008_1_','da008_5_','da008_11_'), missings = TRUE)
CHARLS_w1_mob_walk2 <- opal.execute(o,'CHARLS_w1_mob_walk2')

opal.assign.table.tibble(o, 'CHARLS_w1_id','CHARLS.CHARLS_w1_ids',
                         variables=list('var'), missings = TRUE)
CHARLS_w1_id <- opal.execute(o,'CHARLS_w1_id')


load("../RData/w1/age.RData")




CHARLS_w1_mob_walk2$oldid <- CHARLS_w1_mob_walk2$id
CHARLS_w1_mob_walk2$id <- CHARLS_ids(ids = CHARLS_w1_mob_walk2$oldid)

Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,29))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], oldid=as.numeric(new_2[,30]), da001=as.numeric(new_2[,2]), da002=as.numeric(new_2[,3]), da003=as.numeric(new_2[,4]), da004=as.numeric(new_2[,5]), da005_1_=as.numeric(new_2[,6]), da005_2_=as.numeric(new_2[,7]), da005_3_=as.numeric(new_2[,8]), da005_4_=as.numeric(new_2[,9]), da005_5_=as.numeric(new_2[,10]), da007_1_=as.numeric(new_2[,11]), da007_2_=as.numeric(new_2[,12]), da007_3_=as.numeric(new_2[,13]), da007_4_=as.numeric(new_2[,14]), da007_5_=as.numeric(new_2[,15]), da007_6_=as.numeric(new_2[,16]), da007_7_=as.numeric(new_2[,17]), da007_8_=as.numeric(new_2[,18]), da007_9_=as.numeric(new_2[,19]), da007_10_=as.numeric(new_2[,20]), da007_11_=as.numeric(new_2[,21]), da007_12_=as.numeric(new_2[,22]), da007_13_=as.numeric(new_2[,23]), da007_14_=as.numeric(new_2[,24]), da008_1_=as.numeric(new_2[,25]), da008_5_=as.numeric(new_2[,26]), da008_11_=as.numeric(new_2[,27]), db002=as.numeric(new_2[,28]), db003=as.numeric(new_2[,29]))
  new_22
}

CHARLS_w1_mob_walk <- Add_indiv(old = CHARLS_w1_mob_walk2, new = CHARLS_w1_id)

CHARLS_w1_mob_walk$age <- age$age
```

```{r local w1, echo=FALSE}
vari <- CHARLS_w1_mob_walk$db002 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "db002")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(db002))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Mobility - Walking (1km)") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$db003 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "db003")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(db003))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Mobility - Walking (100m)") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$age 
kable(Continuous_summary(vari, missing_values = c(999))[3], caption = "age")
pander(Continuous_summary(vari, missing_values = c(999))[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(age)) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Age") + ylab("Frequency")+xlim(17,101)

vari <- CHARLS_w1_mob_walk$da001 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da001")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da001))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Self Comment of Your Health") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da002 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da002")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da002))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Self Comment of Your Health") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da003 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da003")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da003))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Pain on the Left Side of Your Chest") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da004
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da004")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da004))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Chest Pains When Climbing Stairs/Uphill or Walking Quickly") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da005_1_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_1_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da005_1_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Physical Disabilities") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da005_2_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_2_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da005_2_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Brain Damage/Mental Retardation") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da005_3_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_3_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da005_3_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Vision Problem") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da005_4_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_4_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da005_4_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Hearing Problem") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da005_5_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_5_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da005_5_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Speech Impediment") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_1_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_1_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_1_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Hypertension") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_2_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_2_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_2_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Dyslipidemia") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_3_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_3_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_3_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Diabetes or High Blood Sugar") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_4_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_4_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_4_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Cancer or Malignant Tumor") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_5_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_5_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_5_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Chronic Lung Diseases") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_6_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_6_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_6_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Liver Disease") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_7_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_7_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_7_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Heart Problems") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_8_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_8_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_8_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Stroke") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_9_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_9_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_9_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Kidney Disease") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_10_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_10_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_10_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Stomach or Other Digestive Disease") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_11_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_11_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_11_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Emotional, Nervous, or Psychiatric Problems") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_12_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_12_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_12_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Memory-Related Disease") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_13_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_13_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_13_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Arthritis or Rheumatism") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da007_14_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_14_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da007_14_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Asthma") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da008_1_
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da008_1_")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da008_1_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Do You Know If You Have Hypertension") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da008_5_
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da008_5_")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da008_5_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Do You Know If You Have Chronic Lung Diseases") + ylab("Frequency")

vari <- CHARLS_w1_mob_walk$da008_11_
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da008_11_")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w1_mob_walk, aes(x=factor(da008_11_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Do You Know If You Have Emotional, Nervous,or Psychiatric Problems") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `(db002==1) into 1`
* `Younger than 50 such that (DA001 == 1 or 2 or DA002== 1 or 2) and DA003 == 2 and DA004 == 2 and DA005_*_ == 2 and DA007_*_ == 2 and DA008_*_ == 2 into 1`
* `2,3,4 into 0`
* `NA into 999` 

**R script**

```{r harmo w1}
CHARLS_ds_w1 <- tibble(id=CHARLS_w1_mob_walk$id)
CHARLS_ds_w1$mob_walk <- 999

CHARLS_ds_w1$mob_walk[CHARLS_w1_mob_walk$age<50 & (CHARLS_w1_mob_walk$da001 %in% c(1,2) | CHARLS_w1_mob_walk$da002 %in% c(1,2)) & CHARLS_w1_mob_walk$da003==2 & CHARLS_w1_mob_walk$da004==2 & CHARLS_w1_mob_walk$da005_1_==2 & CHARLS_w1_mob_walk$da005_2_==2 & CHARLS_w1_mob_walk$da005_3_==2 & CHARLS_w1_mob_walk$da005_4_==2 & CHARLS_w1_mob_walk$da005_5_==2 & CHARLS_w1_mob_walk$da007_1_==2 & CHARLS_w1_mob_walk$da007_2_==2 & CHARLS_w1_mob_walk$da007_3_==2 & CHARLS_w1_mob_walk$da007_4_==2 & CHARLS_w1_mob_walk$da007_5_==2 & CHARLS_w1_mob_walk$da007_6_==2 & CHARLS_w1_mob_walk$da007_7_==2 & CHARLS_w1_mob_walk$da007_8_==2 & CHARLS_w1_mob_walk$da007_9_==2 & CHARLS_w1_mob_walk$da007_10_==2 & CHARLS_w1_mob_walk$da007_11_==2 & CHARLS_w1_mob_walk$da007_12_==2 & CHARLS_w1_mob_walk$da007_13_==2 & CHARLS_w1_mob_walk$da007_14_==2 & CHARLS_w1_mob_walk$da008_1_==2 & CHARLS_w1_mob_walk$da008_5_==2 & CHARLS_w1_mob_walk$da008_11_==2 & !is.na(CHARLS_w1_mob_walk$age) & (!is.na(CHARLS_w1_mob_walk$da001) | !is.na(CHARLS_w1_mob_walk$da002)) & !is.na(CHARLS_w1_mob_walk$da003) & !is.na(CHARLS_w1_mob_walk$da004) & !is.na(CHARLS_w1_mob_walk$da005_1_) & !is.na(CHARLS_w1_mob_walk$da005_2_) & !is.na(CHARLS_w1_mob_walk$da005_3_) & !is.na(CHARLS_w1_mob_walk$da005_4_) & !is.na(CHARLS_w1_mob_walk$da005_5_) & !is.na(CHARLS_w1_mob_walk$da007_1_) & !is.na(CHARLS_w1_mob_walk$da007_2_) & !is.na(CHARLS_w1_mob_walk$da007_3_) & !is.na(CHARLS_w1_mob_walk$da007_4_) & !is.na(CHARLS_w1_mob_walk$da007_5_) & !is.na(CHARLS_w1_mob_walk$da007_6_) & !is.na(CHARLS_w1_mob_walk$da007_7_) & !is.na(CHARLS_w1_mob_walk$da007_8_) & !is.na(CHARLS_w1_mob_walk$da007_9_) & !is.na(CHARLS_w1_mob_walk$da007_10_) & !is.na(CHARLS_w1_mob_walk$da007_11_) & !is.na(CHARLS_w1_mob_walk$da007_12_) & !is.na(CHARLS_w1_mob_walk$da007_13_) & !is.na(CHARLS_w1_mob_walk$da007_14_) & !is.na(CHARLS_w1_mob_walk$da008_1_) & !is.na(CHARLS_w1_mob_walk$da008_5_) & !is.na(CHARLS_w1_mob_walk$da008_11_)] <- 1

CHARLS_ds_w1$mob_walk[which(CHARLS_w1_mob_walk$db002 %in% c(2,3,4) | CHARLS_w1_mob_walk$db003 %in% c(2,3,4))] <- 0
CHARLS_ds_w1$mob_walk[which(CHARLS_w1_mob_walk$db002==1)] <- 1







CHARLS_ds_w1$mob_walk <- labelled(CHARLS_ds_w1$mob_walk, labels = c(Yes=0, No=1, Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript w1, echo=FALSE}
vari <- CHARLS_ds_w1$mob_walk 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = "Mobility - Walking")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(CHARLS_ds_w1, aes(x=factor(mob_walk))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Mobility - Walking") + ylab("Frequency")
```

There is an individual which says that have difficulty walking 100 metres, but does not have any difficulty walking 1 km. With the present algorithm we assign it the category 'No', for not having difficulty.




#### Validation
```{r crosstabulation w1, echo=FALSE}
AfterH <- table(CHARLS_ds_w1$mob_walk)
X <- c(
  sum(
    CHARLS_w1_mob_walk$db002 %in% c(2,3,4) | CHARLS_w1_mob_walk$db003 %in% c(2,3,4),na.rm=T),
  sum(
    (CHARLS_w1_mob_walk$age<50 & (CHARLS_w1_mob_walk$da001 %in% c(1,2) | CHARLS_w1_mob_walk$da002 %in% c(1,2)) & CHARLS_w1_mob_walk$da003==2 & CHARLS_w1_mob_walk$da004==2 & CHARLS_w1_mob_walk$da005_1_==2 & CHARLS_w1_mob_walk$da005_2_==2 & CHARLS_w1_mob_walk$da005_3_==2 & CHARLS_w1_mob_walk$da005_4_==2 & CHARLS_w1_mob_walk$da005_5_==2 & CHARLS_w1_mob_walk$da007_1_==2 & CHARLS_w1_mob_walk$da007_2_==2 & CHARLS_w1_mob_walk$da007_3_==2 & CHARLS_w1_mob_walk$da007_4_==2 & CHARLS_w1_mob_walk$da007_5_==2 & CHARLS_w1_mob_walk$da007_6_==2 & CHARLS_w1_mob_walk$da007_7_==2 & CHARLS_w1_mob_walk$da007_8_==2 & CHARLS_w1_mob_walk$da007_9_==2 & CHARLS_w1_mob_walk$da007_10_==2 & CHARLS_w1_mob_walk$da007_11_==2 & CHARLS_w1_mob_walk$da007_12_==2 & CHARLS_w1_mob_walk$da007_13_==2 & CHARLS_w1_mob_walk$da007_14_==2 & CHARLS_w1_mob_walk$da008_1_==2 & CHARLS_w1_mob_walk$da008_5_==2 & CHARLS_w1_mob_walk$da008_11_==2 & !is.na(CHARLS_w1_mob_walk$age) & (!is.na(CHARLS_w1_mob_walk$da001) | !is.na(CHARLS_w1_mob_walk$da002)) & !is.na(CHARLS_w1_mob_walk$da003) & !is.na(CHARLS_w1_mob_walk$da004) & !is.na(CHARLS_w1_mob_walk$da005_1_) & !is.na(CHARLS_w1_mob_walk$da005_2_) & !is.na(CHARLS_w1_mob_walk$da005_3_) & !is.na(CHARLS_w1_mob_walk$da005_4_) & !is.na(CHARLS_w1_mob_walk$da005_5_) & !is.na(CHARLS_w1_mob_walk$da007_1_) & !is.na(CHARLS_w1_mob_walk$da007_2_) & !is.na(CHARLS_w1_mob_walk$da007_3_) & !is.na(CHARLS_w1_mob_walk$da007_4_) & !is.na(CHARLS_w1_mob_walk$da007_5_) & !is.na(CHARLS_w1_mob_walk$da007_6_) & !is.na(CHARLS_w1_mob_walk$da007_7_) & !is.na(CHARLS_w1_mob_walk$da007_8_) & !is.na(CHARLS_w1_mob_walk$da007_9_) & !is.na(CHARLS_w1_mob_walk$da007_10_) & !is.na(CHARLS_w1_mob_walk$da007_11_) & !is.na(CHARLS_w1_mob_walk$da007_12_) & !is.na(CHARLS_w1_mob_walk$da007_13_) & !is.na(CHARLS_w1_mob_walk$da007_14_) & !is.na(CHARLS_w1_mob_walk$da008_1_) & !is.na(CHARLS_w1_mob_walk$da008_5_) & !is.na(CHARLS_w1_mob_walk$da008_11_)) | CHARLS_w1_mob_walk$db002==1, na.rm=T)
  )

BeforeH<- c(X[1:2],length(CHARLS_ds_w1$id)-sum(X[1:2]))

C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2,3,4->0","(db002==1) or younger than 50 & healthy->1","NA->999") 
kable(C)
```

```{r importOPAL w1, echo=FALSE}
label(CHARLS_ds_w1$mob_walk) <- "Mobility - walking"
#opal.assign.data(o, 'CHARLS_ds_w1', CHARLS_ds_w1)
#opal.symbol_import(o,'CHARLS_ds_w1', project='_Athlos_Harm_Dataset')
mob_walk <- CHARLS_ds_w1
save(mob_walk, file = "../RData/w1/mob_walk.RData")

CHARLS_m_ds_w1 <- CHARLS_ds_w1
CHARLS_m_ds_w1$mob_walk <- car::recode(CHARLS_m_ds_w1$mob_walk, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'CHARLS_m_ds_w1', CHARLS_m_ds_w1)
#opal.symbol_import(o,'CHARLS_m_ds_w1', project='_Athlos_Harm_Dataset')
```




### Wave 2 

#### Study-specific variable description


The study-specific variables elected to be harmonised is:

* Name: `db002`
* Label: `Have Difficulty Walking 1 KM`
* Categories:
   + `1 = No, I don't have any difficulty` 
   + `2 = I have difficulty but can still do it` 
   + `3 = Yes, I have difficulty and need help` 
   + `4 = I can not do it` 
* Missings
   + `NA`

* Name: `db003`
* Label: `Have Difficulty Walking 100 metres`
* Categories:
   + `1 = No, I don't have any difficulty` 
   + `2 = I have difficulty but can still do it` 
   + `3 = Yes, I have difficulty and need help` 
   + `4 = I can not do it` 
* Missings
   + `NA`

| **Name** | `age` |`da001`|`da002`|`da003`|`da004`|`da005_*_, *=1,...,5`|`da007_*_, *=1,...,14`|`da008_*_, *=1,5,11`|
|-|-|-|-|-|-|-|-|-|
| **Label** |`age`|`Self Comment of Your Health`|`Self Comment of Your Health`|`Pain on the Left Side of Your Chest`|`Chest Pains When Climbing Stairs/Uphill or Walking Quickly`|`Do you have one of the following disabilities?: Physical Disabilities; Brain Damage/Mental Retardation; Vision Problem; Hearing Problem; Speech Impediment`|`Have you been diagnosed by a doctor with: Hypertension; Dyslipidemia; Diabetes or High Blood Sugar; Cancer or Malignant Tumor; Chronic Lung Diseases; Liver Disease; Heart Problems; Stroke; Kidney Disease; Stomach or Other Digestive Disease; Emotional, Nervous, or Psychiatric Problems; Memory-Related Disease; Arthritis or Rheumatism; Asthma?`|`Do you know if you have: Hypertension; Chronic Lung Diseases; Emotional, Nervous,or Psychiatric Problems?`|
| **Table name** |`age`|`health_status_and_functioning_wave2`|`health_status_and_functioning_wave2`|`health_status_and_functioning_wave2`|`health_status_and_functioning_wave2`|`health_status_and_functioning_wave2`|`health_status_and_functioning_wave2`|`health_status_and_functioning_wave2`|
| **Categories** | `continuous` |`1 Excellent; 2 Very good; 3 Good; 4 Fair; 5 Poor`|`1 Very good; 2 Good; 3 Fair; 4 Poor; 5 Very poor`|`1 Yes; 2 No`|`1 Yes; 2 No`|`1 Yes; 2 No`|`1 Yes; 2 No`|`1 Yes; 2 No`|
| **Missings** |`999 Missing`|`NA`|`NA`|`NA`|`3 Not applicable; NA`|`NA`|`NA`|`3 Don't know; NA`|
| **Description** |  |  |  |  |  |  |  |  |


```{r assign w2, echo=FALSE}
opal.assign.table.tibble(o, 'CHARLS_w2_mob_walk2','CHARLS.Health_Status_and_Functioning_wave2', variables=list('db002','db003','da001','da002','da003','da004','da005_1_','da005_2_','da005_3_','da005_4_','da005_5_','da007_1_','da007_2_','da007_3_','da007_4_','da007_5_','da007_6_','da007_7_','da007_8_','da007_9_','da007_10_','da007_11_','da007_12_','da007_13_','da007_14_','da008_1_','da008_5_','da008_11_'), missings = TRUE)
CHARLS_w2_mob_walk2 <- opal.execute(o,'CHARLS_w2_mob_walk2')

opal.assign.table.tibble(o, 'CHARLS_w2_id','CHARLS.CHARLS_w2_ids',
                         variables=list('var'), missings = TRUE)
CHARLS_w2_id <- opal.execute(o,'CHARLS_w2_id')


load("../RData/w2/age.RData")




Add_indiv <- function(old, new){
  
  new_2 <- matrix(NA, nrow = dim(new)[1], ncol=dim(old)[2])
  oldm <- as.matrix(old)
  
  for(i in 1:length(new$id)){
    if(sum(new$id[i]==old$id)>=1){
      new_2[i,] <- oldm[which(new$id[i]==old$id),]
    } else {
      new_2[i,] <- c(new$id[i], rep(NA,28))
    }
  }
  
  new_22 <- data.frame(id=new_2[,1], da001=as.numeric(new_2[,2]), da002=as.numeric(new_2[,3]), da003=as.numeric(new_2[,4]), da004=as.numeric(new_2[,5]), da005_1_=as.numeric(new_2[,6]), da005_2_=as.numeric(new_2[,7]), da005_3_=as.numeric(new_2[,8]), da005_4_=as.numeric(new_2[,9]), da005_5_=as.numeric(new_2[,10]), da007_1_=as.numeric(new_2[,11]), da007_2_=as.numeric(new_2[,12]), da007_3_=as.numeric(new_2[,13]), da007_4_=as.numeric(new_2[,14]), da007_5_=as.numeric(new_2[,15]), da007_6_=as.numeric(new_2[,16]), da007_7_=as.numeric(new_2[,17]), da007_8_=as.numeric(new_2[,18]), da007_9_=as.numeric(new_2[,19]), da007_10_=as.numeric(new_2[,20]), da007_11_=as.numeric(new_2[,21]), da007_12_=as.numeric(new_2[,22]), da007_13_=as.numeric(new_2[,23]), da007_14_=as.numeric(new_2[,24]), da008_1_=as.numeric(new_2[,25]), da008_5_=as.numeric(new_2[,26]), da008_11_=as.numeric(new_2[,27]), db002=as.numeric(new_2[,28]), db003=as.numeric(new_2[,29]))
  new_22
}

CHARLS_w2_mob_walk <- Add_indiv(old = CHARLS_w2_mob_walk2, new = CHARLS_w2_id)


CHARLS_w2_mob_walk$age <- age$age

```

```{r local w2, echo=FALSE}
vari <- CHARLS_w2_mob_walk$db002 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "db002")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(db002))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Mobility - Walking (1km)") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$db003 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "db003")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(db002))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Mobility - Walking (100m)") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$age 
kable(Continuous_summary(vari, missing_values = c(999))[3], caption = "age")
pander(Continuous_summary(vari, missing_values = c(999))[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(age)) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Age") + ylab("Frequency")+xlim(16,102)

vari <- CHARLS_w2_mob_walk$da001 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da001")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da001))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Self Comment of Your Health") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da002 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da002")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da002))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Self Comment of Your Health") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da003 
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da003")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da003))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Pain on the Left Side of Your Chest") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da004
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da004")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da004))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Chest Pains When Climbing Stairs/Uphill or Walking Quickly") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da005_1_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_1_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da005_1_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Physical Disabilities") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da005_2_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_2_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da005_2_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Brain Damage/Mental Retardation") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da005_3_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_3_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da005_3_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Vision Problem") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da005_4_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_4_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da005_4_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Hearing Problem") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da005_5_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da005_5_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da005_5_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Speech Impediment") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_1_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_1_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_1_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Hypertension") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_2_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_2_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_2_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Dyslipidemia") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_3_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_3_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_3_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Diabetes or High Blood Sugar") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_4_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_4_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_4_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Cancer or Malignant Tumor") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_5_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_5_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_5_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Chronic Lung Diseases") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_6_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_6_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_6_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Liver Disease") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_7_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_7_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_7_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Heart Problems") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_8_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_8_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_8_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Stroke") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_9_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_9_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_9_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Kidney Disease") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_10_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_10_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_10_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Stomach or Other Digestive Disease") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_11_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_11_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_11_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Emotional, Nervous, or Psychiatric Problems") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_12_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_12_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_12_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Memory-Related Disease") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_13_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_13_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_13_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Arthritis or Rheumatism") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da007_14_
kable(Categorical_summary(vari, missing_values = NA)[2], caption = "da007_14_")
kable(Categorical_summary(vari, missing_values = NA)[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da007_14_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Asthma") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da008_1_
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da008_1_")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da008_1_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Do You Know If You Have Hypertension") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da008_5_
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da008_5_")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da008_5_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Do You Know If You Have Chronic Lung Diseases") + ylab("Frequency")

vari <- CHARLS_w2_mob_walk$da008_11_
kable(Categorical_summary(vari, missing_values = c(3))[3], caption = "da008_11_")
kable(Categorical_summary(vari, missing_values = c(3))[1], caption = "Category")
ggplot(CHARLS_w2_mob_walk, aes(x=factor(da008_11_))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Do You Know If You Have Emotional, Nervous,or Psychiatric Problems") + ylab("Frequency")
```

#### Harmonisation algorithm

To compute the harmonize variable from the study-specific variable it has to be recoded as follows:

* `(db002==1) into 1`
* `Younger than 50 such that (DA001 == 1 or 2 or DA002== 1 or 2) and DA003 == 2 and DA004 == 2 and DA005_*_ == 2 and DA007_*_ == 2 and DA008_*_ == 2 into 1`
* `2,3,4 into 0`
* `NA into 999` 


**R script**

```{r harmo w2}
CHARLS_ds_w2 <- tibble(id=CHARLS_w2_mob_walk$id)


CHARLS_ds_w2$mob_walk <- 999

CHARLS_ds_w2$mob_walk[CHARLS_w2_mob_walk$age<50 & (CHARLS_w2_mob_walk$da001 %in% c(1,2) | CHARLS_w2_mob_walk$da002 %in% c(1,2)) & CHARLS_w2_mob_walk$da003==2 & CHARLS_w2_mob_walk$da004==2 & CHARLS_w2_mob_walk$da005_1_==2 & CHARLS_w2_mob_walk$da005_2_==2 & CHARLS_w2_mob_walk$da005_3_==2 & CHARLS_w2_mob_walk$da005_4_==2 & CHARLS_w2_mob_walk$da005_5_==2 & CHARLS_w2_mob_walk$da007_1_==2 & CHARLS_w2_mob_walk$da007_2_==2 & CHARLS_w2_mob_walk$da007_3_==2 & CHARLS_w2_mob_walk$da007_4_==2 & CHARLS_w2_mob_walk$da007_5_==2 & CHARLS_w2_mob_walk$da007_6_==2 & CHARLS_w2_mob_walk$da007_7_==2 & CHARLS_w2_mob_walk$da007_8_==2 & CHARLS_w2_mob_walk$da007_9_==2 & CHARLS_w2_mob_walk$da007_10_==2 & CHARLS_w2_mob_walk$da007_11_==2 & CHARLS_w2_mob_walk$da007_12_==2 & CHARLS_w2_mob_walk$da007_13_==2 & CHARLS_w2_mob_walk$da007_14_==2 & CHARLS_w2_mob_walk$da008_1_==2 & CHARLS_w2_mob_walk$da008_5_==2 & CHARLS_w2_mob_walk$da008_11_==2 & !is.na(CHARLS_w2_mob_walk$age) & (!is.na(CHARLS_w2_mob_walk$da001) | !is.na(CHARLS_w2_mob_walk$da002)) & !is.na(CHARLS_w2_mob_walk$da003) & !is.na(CHARLS_w2_mob_walk$da004) & !is.na(CHARLS_w2_mob_walk$da005_1_) & !is.na(CHARLS_w2_mob_walk$da005_2_) & !is.na(CHARLS_w2_mob_walk$da005_3_) & !is.na(CHARLS_w2_mob_walk$da005_4_) & !is.na(CHARLS_w2_mob_walk$da005_5_) & !is.na(CHARLS_w2_mob_walk$da007_1_) & !is.na(CHARLS_w2_mob_walk$da007_2_) & !is.na(CHARLS_w2_mob_walk$da007_3_) & !is.na(CHARLS_w2_mob_walk$da007_4_) & !is.na(CHARLS_w2_mob_walk$da007_5_) & !is.na(CHARLS_w2_mob_walk$da007_6_) & !is.na(CHARLS_w2_mob_walk$da007_7_) & !is.na(CHARLS_w2_mob_walk$da007_8_) & !is.na(CHARLS_w2_mob_walk$da007_9_) & !is.na(CHARLS_w2_mob_walk$da007_10_) & !is.na(CHARLS_w2_mob_walk$da007_11_) & !is.na(CHARLS_w2_mob_walk$da007_12_) & !is.na(CHARLS_w2_mob_walk$da007_13_) & !is.na(CHARLS_w2_mob_walk$da007_14_) & !is.na(CHARLS_w2_mob_walk$da008_1_) & !is.na(CHARLS_w2_mob_walk$da008_5_) & !is.na(CHARLS_w2_mob_walk$da008_11_)] <- 1

CHARLS_ds_w2$mob_walk[which(CHARLS_w2_mob_walk$db002 %in% c(2,3,4) | CHARLS_w2_mob_walk$db003 %in% c(2,3,4))] <- 0
CHARLS_ds_w2$mob_walk[which(CHARLS_w2_mob_walk$db002==1)] <- 1







CHARLS_ds_w2$mob_walk <- labelled(CHARLS_ds_w2$mob_walk, labels = c(Yes=0, No=1, Missing=999, Do_not_know=998, Refuse=997, Not_applicable=996, Does_not_answer=995,  Not_attempt_not_done=994, Disable_to_measure=993, Impute=992, CAPI_interviewer_error=991))
```

#### Statistical description of the new harmonised variable
```{r descript w2, echo=FALSE}
vari <- CHARLS_ds_w2$mob_walk 
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[3], caption = "Mobility - Walking")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[1], caption = "Category")
kable(Categorical_summary(vari, missing_values = c(991, 992, 993, 994, 995, 996, 997, 998, 999))[2], caption = "Type of missing")
ggplot(CHARLS_ds_w2, aes(x=factor(mob_walk))) + geom_bar(stat="count", width=0.4, fill="steelblue") +xlab("Mobility - Walking") + ylab("Frequency")
```

#### Validation
```{r crosstabulation w2, echo=FALSE}

kable( subset(CHARLS_w2_mob_walk,(CHARLS_w2_mob_walk$age<50 & (CHARLS_w2_mob_walk$da001 %in% c(1,2) | CHARLS_w2_mob_walk$da002 %in% c(1,2)) & CHARLS_w2_mob_walk$da003==2 & CHARLS_w2_mob_walk$da004==2 & CHARLS_w2_mob_walk$da005_1_==2 & CHARLS_w2_mob_walk$da005_2_==2 & CHARLS_w2_mob_walk$da005_3_==2 & CHARLS_w2_mob_walk$da005_4_==2 & CHARLS_w2_mob_walk$da005_5_==2 & CHARLS_w2_mob_walk$da007_1_==2 & CHARLS_w2_mob_walk$da007_2_==2 & CHARLS_w2_mob_walk$da007_3_==2 & CHARLS_w2_mob_walk$da007_4_==2 & CHARLS_w2_mob_walk$da007_5_==2 & CHARLS_w2_mob_walk$da007_6_==2 & CHARLS_w2_mob_walk$da007_7_==2 & CHARLS_w2_mob_walk$da007_8_==2 & CHARLS_w2_mob_walk$da007_9_==2 & CHARLS_w2_mob_walk$da007_10_==2 & CHARLS_w2_mob_walk$da007_11_==2 & CHARLS_w2_mob_walk$da007_12_==2 & CHARLS_w2_mob_walk$da007_13_==2 & CHARLS_w2_mob_walk$da007_14_==2 & CHARLS_w2_mob_walk$da008_1_==2 & CHARLS_w2_mob_walk$da008_5_==2 & CHARLS_w2_mob_walk$da008_11_==2 & !is.na(CHARLS_w2_mob_walk$age) & (!is.na(CHARLS_w2_mob_walk$da001) | !is.na(CHARLS_w2_mob_walk$da002)) & !is.na(CHARLS_w2_mob_walk$da003) & !is.na(CHARLS_w2_mob_walk$da004) & !is.na(CHARLS_w2_mob_walk$da005_1_) & !is.na(CHARLS_w2_mob_walk$da005_2_) & !is.na(CHARLS_w2_mob_walk$da005_3_) & !is.na(CHARLS_w2_mob_walk$da005_4_) & !is.na(CHARLS_w2_mob_walk$da005_5_) & !is.na(CHARLS_w2_mob_walk$da007_1_) & !is.na(CHARLS_w2_mob_walk$da007_2_) & !is.na(CHARLS_w2_mob_walk$da007_3_) & !is.na(CHARLS_w2_mob_walk$da007_4_) & !is.na(CHARLS_w2_mob_walk$da007_5_) & !is.na(CHARLS_w2_mob_walk$da007_6_) & !is.na(CHARLS_w2_mob_walk$da007_7_) & !is.na(CHARLS_w2_mob_walk$da007_8_) & !is.na(CHARLS_w2_mob_walk$da007_9_) & !is.na(CHARLS_w2_mob_walk$da007_10_) & !is.na(CHARLS_w2_mob_walk$da007_11_) & !is.na(CHARLS_w2_mob_walk$da007_12_) & !is.na(CHARLS_w2_mob_walk$da007_13_) & !is.na(CHARLS_w2_mob_walk$da007_14_) & !is.na(CHARLS_w2_mob_walk$da008_1_) & !is.na(CHARLS_w2_mob_walk$da008_5_) & !is.na(CHARLS_w2_mob_walk$da008_11_) & CHARLS_w2_mob_walk$db002!=1  & (!is.na(CHARLS_w2_mob_walk$db002) | !is.na(CHARLS_w2_mob_walk$db003))),select=c(id,db002,db003)),align = 'c', caption = "We have to note that there are two individuals younger than 50 and assumed to be healthy which have difficulty walking, and they are categorized so.")


AfterH <- table(CHARLS_ds_w2$mob_walk)



X <- c(
  sum(
    CHARLS_w2_mob_walk$db002 %in% c(2,3,4) | CHARLS_w2_mob_walk$db003 %in% c(2,3,4),na.rm=T),
  sum(
    (CHARLS_w2_mob_walk$age<50 & (CHARLS_w2_mob_walk$da001 %in% c(1,2) | CHARLS_w2_mob_walk$da002 %in% c(1,2)) & CHARLS_w2_mob_walk$da003==2 & CHARLS_w2_mob_walk$da004==2 & CHARLS_w2_mob_walk$da005_1_==2 & CHARLS_w2_mob_walk$da005_2_==2 & CHARLS_w2_mob_walk$da005_3_==2 & CHARLS_w2_mob_walk$da005_4_==2 & CHARLS_w2_mob_walk$da005_5_==2 & CHARLS_w2_mob_walk$da007_1_==2 & CHARLS_w2_mob_walk$da007_2_==2 & CHARLS_w2_mob_walk$da007_3_==2 & CHARLS_w2_mob_walk$da007_4_==2 & CHARLS_w2_mob_walk$da007_5_==2 & CHARLS_w2_mob_walk$da007_6_==2 & CHARLS_w2_mob_walk$da007_7_==2 & CHARLS_w2_mob_walk$da007_8_==2 & CHARLS_w2_mob_walk$da007_9_==2 & CHARLS_w2_mob_walk$da007_10_==2 & CHARLS_w2_mob_walk$da007_11_==2 & CHARLS_w2_mob_walk$da007_12_==2 & CHARLS_w2_mob_walk$da007_13_==2 & CHARLS_w2_mob_walk$da007_14_==2 & CHARLS_w2_mob_walk$da008_1_==2 & CHARLS_w2_mob_walk$da008_5_==2 & CHARLS_w2_mob_walk$da008_11_==2 & !is.na(CHARLS_w2_mob_walk$age) & (!is.na(CHARLS_w2_mob_walk$da001) | !is.na(CHARLS_w2_mob_walk$da002)) & !is.na(CHARLS_w2_mob_walk$da003) & !is.na(CHARLS_w2_mob_walk$da004) & !is.na(CHARLS_w2_mob_walk$da005_1_) & !is.na(CHARLS_w2_mob_walk$da005_2_) & !is.na(CHARLS_w2_mob_walk$da005_3_) & !is.na(CHARLS_w2_mob_walk$da005_4_) & !is.na(CHARLS_w2_mob_walk$da005_5_) & !is.na(CHARLS_w2_mob_walk$da007_1_) & !is.na(CHARLS_w2_mob_walk$da007_2_) & !is.na(CHARLS_w2_mob_walk$da007_3_) & !is.na(CHARLS_w2_mob_walk$da007_4_) & !is.na(CHARLS_w2_mob_walk$da007_5_) & !is.na(CHARLS_w2_mob_walk$da007_6_) & !is.na(CHARLS_w2_mob_walk$da007_7_) & !is.na(CHARLS_w2_mob_walk$da007_8_) & !is.na(CHARLS_w2_mob_walk$da007_9_) & !is.na(CHARLS_w2_mob_walk$da007_10_) & !is.na(CHARLS_w2_mob_walk$da007_11_) & !is.na(CHARLS_w2_mob_walk$da007_12_) & !is.na(CHARLS_w2_mob_walk$da007_13_) & !is.na(CHARLS_w2_mob_walk$da007_14_) & !is.na(CHARLS_w2_mob_walk$da008_1_) & !is.na(CHARLS_w2_mob_walk$da008_5_) & !is.na(CHARLS_w2_mob_walk$da008_11_) & !CHARLS_w2_mob_walk$db002 %in% c(2,3,4) & !CHARLS_w2_mob_walk$db003 %in% c(2,3,4)) | CHARLS_w2_mob_walk$db002==1, na.rm=T)
  )

BeforeH<- c(X[1:2],length(CHARLS_ds_w2$id)-sum(X[1:2]))

C <- rbind(BeforeH,AfterH)
colnames(C) <- c("2,3,4->0","(db002==1) or younger than 50 & healthy->1","NA->999") 

kable(C)


```



```{r importOPAL w2, echo=FALSE}
label(CHARLS_ds_w2$mob_walk) <- "Mobility - walking"
#opal.assign.data(o, 'CHARLS_ds_w2', CHARLS_ds_w2)
#opal.symbol_import(o,'CHARLS_ds_w2', project='_Athlos_Harm_Dataset')
mob_walk <- CHARLS_ds_w2
save(mob_walk, file = "../RData/w2/mob_walk.RData")

CHARLS_m_ds_w2 <- CHARLS_ds_w2
CHARLS_m_ds_w2$mob_walk <- car::recode(CHARLS_m_ds_w2$mob_walk, "c(991, 992, 993, 994, 995, 996, 997,998, 999)=NA")
#opal.assign.data(o, 'CHARLS_m_ds_w2', CHARLS_m_ds_w2)
#opal.symbol_import(o,'CHARLS_m_ds_w2', project='_Athlos_Harm_Dataset')
```



# Quality estimation
In this study subjects reporting difficulties either in walking 100m or walking 1km where coded as having difficulties. 
This is different from the rest of studies in which the question refered to 1km=0.5 miles to ask about difficulty for walking.

```{r closeRsession, echo=FALSE}
opal.logout(o)
```
